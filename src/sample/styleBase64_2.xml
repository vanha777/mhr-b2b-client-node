<?xml version="1.0" encoding="UTF-8"?><?xml-stylesheet type="text/xsl" href="data:text/xsl;charset=utf-8;base64,PCEtLQ0KICAgIENvcHlyaWdodCAyMDE4IEF1c3RyYWxpYW4gRGlnaXRhbCBIZWFsdGggQWdlbmN5DQogICANCiAgICBQcm9kdWN0aW9uIERpc2NsYWltZXIgLSANCiAgICANCiAgICBBdXN0cmFsaWFuIERpZ2l0YWwgSGVhbHRoIEFnZW5jeSAoYXMgTGljZW5zb3IpIGdyYW50cyBZb3UgYSBsaWNlbmNlIA0KICAgIHRvIHRoaXMgUHJvZHVjdCBzdWJqZWN0IHRvIHRoZSB0ZXJtcyBvZiB0aGUgQXBhY2hlIExpY2VuY2UgDQogICAgKHZlcnNpb24gMi4wKSwgYSBjb3B5IG9mIHdoaWNoIGlzIGF2YWlsYWJsZSBhdCANCiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAsIGFuZCB0aGUgZm9sbG93aW5nIHRlcm1zLg0KICAgICANCiAgICBUaGlzIFByb2R1Y3QgbGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbmNlIGFuZCB0aGVzZSB0ZXJtcyBtYXkgDQogICAgYmUgdXNlZCB3aXRoaW4gcHJvZHVjdGlvbiBzb2Z0d2FyZSBzeXN0ZW1zLiBJdCBuZXZlcnRoZWxlc3MgcmVtYWlucyANCiAgICB5b3VyIHJlc3BvbnNpYmlsaXR5IHRvIHRlc3QgYW5kIHZhbGlkYXRlIHRoZSB1c2Ugb2YgdGhpcyBwcm9kdWN0IA0KICAgIHdpdGhpbiB5b3VyIHNvZnR3YXJlIGFuZCB0aGUgbGltaXRhdGlvbiBvZiBsaWFiaWxpdHkgcHJvdmlzaW9ucyBpbiANCiAgICBjbGF1c2UgOCBvZiB0aGUgQXBhY2hlIExpY2VuY2UgY29udGludWUgdG8gYXBwbHkuDQogICAgDQogICAgRGVzcGl0ZSBjbGF1c2UgNyBvZiB0aGUgQXBhY2hlIExpY2VuY2UsIGlmIGEgY29uZGl0aW9uIG9yIHdhcnJhbnR5IA0KICAgIGlzIGltcGxpZWQgYnkgc3RhdHV0ZSBvciBsYXcgdGhhdCBjYW5ub3QgYmUgZXhjbHVkZWQsIHRoZW4gdGhlIA0KICAgIGxpYWJpbGl0eSBvZiBhIENvbnRyaWJ1dG9yIHRvIHRoZSBleHRlbnQgdGhhdCBpdCBoYXMgY29udHJpYnV0ZWQgdG8gDQogICAgYSBicmVhY2ggb2YgdGhhdCBjb25kaXRpb24gb3Igd2FycmFudHkgaXMgbGltaXRlZCB0byBvbmUgb3IgbW9yZSBvZiANCiAgICB0aGUgZm9sbG93aW5nIGF0IGl0cyBvcHRpb246IChhKSBpbiB0aGUgY2FzZSBvZiBnb29kcywgYW55IG9uZSBvZiANCiAgICB0aGUgZm9sbG93aW5nOiB0aGUgcmVwbGFjZW1lbnQgb2YgdGhvc2UgZ29vZHMgb3IgdGhlIHJlLXN1cHBseSBvZiANCiAgICBlcXVpdmFsZW50IGdvb2RzOyB0aGUgcmVwYWlyIG9mIHRob3NlIGdvb2RzOyB0aGUgcGF5bWVudCBvZiB0aGUgDQogICAgY29zdCBvZiByZXBsYWNpbmcgdGhvc2Ugb3IgYWNxdWlyaW5nIGVxdWl2YWxlbnQgZ29vZHM7IG9yIHRoZSANCiAgICBwYXltZW50IG9mIHRoZSBjb3N0IG9mIGhhdmluZyB0aG9zZSBnb29kcyByZXBhaXJlZDsgYW5kIChiKSBpbiB0aGUgDQogICAgY2FzZSBvZiBzZXJ2aWNlczogdGhlIHN1cHBseWluZyBvZiB0aG9zZSBzZXJ2aWNlcyBhZ2Fpbjsgb3IgdGhlIA0KICAgIHBheW1lbnQgb2YgdGhlIGNvc3Qgb2YgaGF2aW5nIHRob3NlIHNlcnZpY2VzIHN1cHBsaWVkIGFnYWluLg0KICAgICANCiAgICBBIHRlcm0gd2hpY2ggaXMgZ2l2ZW4gYSBtZWFuaW5nIGluIHRoZSBBcGFjaGUgTGljZW5jZSwgaGFzIHRoZSBzYW1lIA0KICAgIG1lYW5pbmcgd2hlbiB1c2VkIGluIHRoZXNlIHRlcm1zLg0KICAgIA0KICAgIFJldmlzaW9uIEhpc3Rvcnk6DQoNCiAgICBWZXJzaW9uIDEuMS4yIHwgMTAvMTIvMjAyMA0KICAgIC0gSGVhZGVycyBpbiBwYXRoIHJlcG9ydCBmb3Igc3BlY2ltZW4gYW5kIHJlcG9ydCBkYXRlIHRoZSB3cm9uZyB3YXkgYXJvdW5kDQogICAgDQogICAgVmVyc2lvbiAxLjEuMSB8IDE5LzA2LzIwMTgNCiAgICAtIFVwZGF0ZWQgdG8gbWF0Y2ggcHJlc2VudGF0aW9uIGd1aWRlDQogICAgDQogICAgVmVyc2lvbiAwLjAuMSB8IDMxLzAxLzIwMTgNCiAgICAtIEluaXRpYWwgdmVyc2lvbiAgICANCiAgICANCi0tPg0KDQo8eHNsOnN0eWxlc2hlZXQgdmVyc2lvbj0iMS4wIiB4bWxuczp4c2w9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvWFNML1RyYW5zZm9ybSINCiAgICB4bWxuczpjZGE9InVybjpobDctb3JnOnYzIiB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIg0KICAgIHhtbG5zOmV4dD0iaHR0cDovL25zLmVsZWN0cm9uaWNoZWFsdGgubmV0LmF1L0NpL0NkYS9FeHRlbnNpb25zLzMuMCINCiAgICB4bWxuczpwYXRoPSJodHRwOi8vbnMuZWxlY3Ryb25pY2hlYWx0aC5uZXQuYXUvcGNlaHIveHNkL2ludGVyZmFjZXMvUGF0aG9sb2d5UmVwb3J0Vmlldy8xLjAiDQogICAgeG1sbnM6ZGk9Imh0dHA6Ly9ucy5lbGVjdHJvbmljaGVhbHRoLm5ldC5hdS9wY2Voci94c2QvaW50ZXJmYWNlcy9EaWFnbm9zdGljSW1hZ2luZ1JlcG9ydFZpZXcvMS4wIg0KICAgIHhtbG5zOmNjZT0iaHR0cDovL25zLmVsZWN0cm9uaWNoZWFsdGgubmV0LmF1L3BjZWhyL3hzZC9jb21tb24vQ29tbW9uQ29yZUVsZW1lbnRzLzEuMCINCiAgICB4bWxuczp2Y3Q9Imh0dHA6Ly9ucy5lbGVjdHJvbmljaGVhbHRoLm5ldC5hdS9wY2Voci94c2Qvdmlldy9WaWV3Q29tbW9uVHlwZS8xLjAiDQogICAgZXhjbHVkZS1yZXN1bHQtcHJlZml4ZXM9InhzaSBjZGEgZXh0IHBhdGggZGkgY2NlIHZjdCI+DQoNCiAgICA8IS0tIFBBUkFNRVRFUlMgLS0+DQogICAgPHhzbDpwYXJhbSBuYW1lPSJiYW5uZXJEaXNwbGF5Ij50cnVlPC94c2w6cGFyYW0+DQogICAgPHhzbDpwYXJhbSBuYW1lPSJjb2xsYXBzZWRHcm91cHMiPmZhbHNlPC94c2w6cGFyYW0+DQogICAgPHhzbDpwYXJhbSBuYW1lPSJhZGRKYXZhU2NyaXB0Ij50cnVlPC94c2w6cGFyYW0+DQoNCiAgICA8IS0tIEdyb3VwIGJ5IHBhcmFtZXRlcnMuIENhbiBvbmx5IGJlIGdyb3VwZWQgYnkgIm9yZ2FuaXNhdGlvbiIgLS0+DQogICAgPHhzbDpwYXJhbSBuYW1lPSJncm91cEJ5Ij48L3hzbDpwYXJhbT4NCiAgICANCiAgICA8IS0tIEZpbHRlciBvbiBwYXRob2xvZ3kgdGVzdCByZXN1bHQgbmFtZSwgb3IgZGlhZ25vc3RpYyBpbWFnaW5nIGV4YW1pbmF0aW9uIHJlc3VsdCBuYW1lIC0tPg0KICAgIDx4c2w6cGFyYW0gbmFtZT0icmVzdWx0TmFtZUZpbHRlciI+PC94c2w6cGFyYW0+DQogICAgDQogICAgPCEtLSANCiAgICAgICAgIFNvcnQgY29sdW1uLiANCiAgICAgICAgIEZvciBEaWFnbm9zdGljIEltYWdpbmcgUmVwb3J0LCBvcHRpb25zIGFyZTogDQogICAgICAgICAtIG9yZ2FuaXNhdGlvbg0KICAgICAgICAgLSBkYXRlDQogICAgICAgICAtIHByb2NlZHVyZQ0KICAgICAgICAgLSBtb2RhbGl0eQ0KICAgICAgICAgLSBhbmF0b21pY2FsTG9jYXRpb24NCiAgICAgICAgIEZvciBQYXRob2xvZ3kgUmVwb3J0LCBvcHRpb25zIGFyZToNCiAgICAgICAgIC0gc3BlY2ltZW5EYXRlDQogICAgLS0+DQogICAgPHhzbDpwYXJhbSBuYW1lPSJzb3J0QnkiPm9yZ2FuaXNhdGlvbjwveHNsOnBhcmFtPg0KICAgIA0KICAgIDwhLS0gS0VZUyAtLT4NCiAgICA8IS0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0tLT4NCiAgICA8eHNsOmtleSBuYW1lPSJkaU9yZ2FuaXNhdGlvbk5hbWVLZXkiIG1hdGNoPSJkaTpkaWFnbm9zdGljSW1hZ2luZ1JlcG9ydCINCiAgICAgICAgdXNlPSJkaTpyZXBvcnRpbmdSYWRpb2xvZ2lzdEluZm9ybWF0aW9uL3ZjdDpoZWFsdGhjYXJlUHJvdmlkZXJPcmdhbmlzYXRpb25OYW1lIi8+DQogICAgPHhzbDprZXkgbmFtZT0iZGlSZXBvcnRJZEtleSIgbWF0Y2g9ImRpOmRpYWdub3N0aWNJbWFnaW5nUmVwb3J0Ig0KICAgICAgICB1c2U9ImRpOnJlcG9ydEluZm9ybWF0aW9uL3ZjdDphY2Nlc3Npb25OdW1iZXIiLz4NCiAgICANCiAgICA8eHNsOmtleSBuYW1lPSJwYXRoT3JnYW5pc2F0aW9uTmFtZUtleSIgbWF0Y2g9InBhdGg6cGF0aG9sb2d5UmVwb3J0Ig0KICAgICAgICB1c2U9InBhdGg6cmVwb3J0aW5nUGF0aG9sb2dpc3RJbmZvcm1hdGlvbi92Y3Q6aGVhbHRoY2FyZVByb3ZpZGVyT3JnYW5pc2F0aW9uTmFtZSIvPg0KICAgIDx4c2w6a2V5IG5hbWU9InBhdGhSZXBvcnRJZEtleSIgbWF0Y2g9InBhdGg6cGF0aG9sb2d5UmVwb3J0Ig0KICAgICAgICB1c2U9InBhdGg6cmVwb3J0SW5mb3JtYXRpb24vdmN0OnBhdGhvbG9naXN0TG9jYWxSZXBvcnRJZCIvPg0KICAgICAgICANCiAgICA8IS0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0tLT4NCiAgICA8IS0tIEVORCBLRVlTIC0tPg0KDQogICAgPCEtLSBPVVRQVVQgLS0+DQogICAgPCEtLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09LS0+DQogICAgPHhzbDpvdXRwdXQgbWV0aG9kPSJodG1sIiBpbmRlbnQ9InllcyIgdmVyc2lvbj0iNC4wMSIgZW5jb2Rpbmc9IlVURi04Ig0KICAgICAgICBkb2N0eXBlLXN5c3RlbT0iaHR0cDovL3d3dy53My5vcmcvVFIvaHRtbDQvc3RyaWN0LmR0ZCINCiAgICAgICAgZG9jdHlwZS1wdWJsaWM9Ii0vL1czQy8vRFREIEhUTUwgNC4wMS8vRU4iLz4NCiAgICA8IS0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0tLT4NCiAgICA8IS0tIFtFTkRdIE9VVFBVVCAtLT4NCg0KDQogICAgPCEtLSBDT05TVEFOVFMgLS0+DQogICAgPCEtLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09LS0+DQogICAgPCEtLSBMb3dlciBDYXNlIENoYXJhY3RlcnMgLS0+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJsb3dlckNhc2VDaGFyYWN0ZXJzIiBzZWxlY3Q9IidhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eiciLz4NCg0KICAgIDwhLS0gVXBwZXIgQ2FzZSBDaGFyYWN0ZXJzIC0tPg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0idXBwZXJDYXNlQ2hhcmFjdGVycyIgc2VsZWN0PSInQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVonIi8+DQoNCiAgICA8IS0tIFZlcnNpb24gb2YgdGhlIEdlbmVyaWMgQ0RBIFN0eWxlc2hlZXQgLS0+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJESF9WSUVXX0NEQV9TVFlMRVNIRUVUX1ZFUlNJT04iPjEuMS4yPC94c2w6dmFyaWFibGU+DQoNCiAgICA8IS0tIFZlcnNpb24gbm90ZSAtLT4NCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9IlZFUlNJT05fTk9URSI+SFRNTCBHZW5lcmF0ZWQgYnkgdGhlIEF1c3RyYWxpYW4gRGlnaXRhbCBIZWFsdGggQWdlbmN5IEdlbmVyaWMNCiAgICAgICAgQ0RBIFN0eWxlc2hlZXQgVmVyc2lvbjogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRESF9WSUVXX0NEQV9TVFlMRVNIRUVUX1ZFUlNJT04iLz4NCiAgICA8L3hzbDp2YXJpYWJsZT4NCg0KICAgIDwhLS0gRG8gbm90ZSBlZGl0IG5vdGUgLS0+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJET19OT1RfRURJVF9OT1RFIj5EbyBOT1QgZWRpdCB0aGlzIEhUTUwgZGlyZWN0bHk6IGl0IHdhcyBnZW5lcmF0ZWQgdmlhIGFuDQogICAgICAgIFhTTFQgdHJhbnNmb3JtYXRpb24gZnJvbSBhIHNvdXJjZSBDREEgUmVsZWFzZSAyIFhNTCBkb2N1bWVudC48L3hzbDp2YXJpYWJsZT4NCg0KICAgIDwhLS0gUHJvdmlkZXIgSWRlbnRpZmllciBDU1MgQ2xhc3NlcyAtLT4NCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9IlBST1ZJREVSX0lORElWSURVQUxfSURFTlRJRklFUl9DU1NfQ0xBU1MiDQogICAgICAgID5QUk9WSURFUl9JTkRJVklEVUFMX0lERU5USUZJRVI8L3hzbDp2YXJpYWJsZT4NCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9IlBST1ZJREVSX09SR0FOSVNBVElPTl9JREVOVElGSUVSX0NTU19DTEFTUyINCiAgICAgICAgPlBST1ZJREVSX09SR0FOSVNBVElPTl9JREVOVElGSUVSPC94c2w6dmFyaWFibGU+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJQUk9WSURFUl9ERVZJQ0VfSURFTlRJRklFUl9DU1NfQ0xBU1MiDQogICAgICAgID5QUk9WSURFUl9ERVZJQ0VfSURFTlRJRklFUjwveHNsOnZhcmlhYmxlPg0KDQogICAgPCEtLSBQYWdlIHdpZHRocyBhbmQgaGVpZ2h0cyAtLT4NCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9IkZVTExfVklFV1BPUlRfV0lEVEhfUFgiPjEwMjQ8L3hzbDp2YXJpYWJsZT4NCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9IlRPUF9NQVJHSU5fV0lEVEhfUFgiPjQ8L3hzbDp2YXJpYWJsZT4NCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9IkxFRlRfTUFSR0lOX1dJRFRIX1BYIj4xMDwveHNsOnZhcmlhYmxlPg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iUklHSFRfTUFSR0lOX1dJRFRIX1BYIj4xMDwveHNsOnZhcmlhYmxlPg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iQ09OVEVOVF9TQ1JPTExfQkFSX1dJRFRIX1BYIj4zMDwveHNsOnZhcmlhYmxlPg0KDQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJGVUxMX0NPTlRFTlRfV0lEVEhfUFgiPjEwMDA8L3hzbDp2YXJpYWJsZT4NCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9Ik1JTklNVU1fQ09OVEVOVF9XSURUSF9QWCI+NzYwPC94c2w6dmFyaWFibGU+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJIQUxGX0NPTlRFTlRfV0lEVEhfUFgiIHNlbGVjdD0iJEZVTExfQ09OVEVOVF9XSURUSF9QWCBkaXYgMiIvPg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iRklGVEhfQ09OVEVOVF9XSURUSF9QWCIgc2VsZWN0PSIkRlVMTF9DT05URU5UX1dJRFRIX1BYIGRpdiA1Ii8+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJRVUFSVEVSX0NPTlRFTlRfV0lEVEhfUFgiIHNlbGVjdD0iJEZVTExfQ09OVEVOVF9XSURUSF9QWCBkaXYgNCIvPg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iRUlHSFRIX0NPTlRFTlRfV0lEVEhfUFgiIHNlbGVjdD0iJEZVTExfQ09OVEVOVF9XSURUSF9QWCBkaXYgOCIvPg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iVEVOVEhfQ09OVEVOVF9XSURUSF9QWCIgc2VsZWN0PSIkRlVMTF9DT05URU5UX1dJRFRIX1BYIGRpdiAxMCIvPg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iVEhSRUVfUVVBUlRFUl9DT05URU5UX1dJRFRIX1BYIiBzZWxlY3Q9IigkRlVMTF9DT05URU5UX1dJRFRIX1BYIGRpdiA0KSAqIDMiLz4NCg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iRlVMTF9DT05URU5UX1dJRFRIX1BDVCI+MTAwPC94c2w6dmFyaWFibGU+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJIQUxGX0NPTlRFTlRfV0lEVEhfUENUIj41MDwveHNsOnZhcmlhYmxlPg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iRklGVEhfQ09OVEVOVF9XSURUSF9QQ1QiPjIwPC94c2w6dmFyaWFibGU+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJRVUFSVEVSX0NPTlRFTlRfV0lEVEhfUENUIj4yNTwveHNsOnZhcmlhYmxlPg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iRUlHSFRIX0NPTlRFTlRfV0lEVEhfUENUIj4xMi41PC94c2w6dmFyaWFibGU+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJURU5USF9DT05URU5UX1dJRFRIX1BDVCI+MTA8L3hzbDp2YXJpYWJsZT4NCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9IlRIUkVFX1FVQVJURVJfQ09OVEVOVF9XSURUSF9QQ1QiPjc1PC94c2w6dmFyaWFibGU+DQoNCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9IkRFVEFJTFNfSEFMRl9UQUJMRV9USF9XSURUSF9QQ1QiPjM1PC94c2w6dmFyaWFibGU+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJERVRBSUxTX0hBTEZfVEFCTEVfVERfV0lEVEhfUENUIg0KICAgICAgICBzZWxlY3Q9IjEwMCAtICRERVRBSUxTX0hBTEZfVEFCTEVfVEhfV0lEVEhfUENUIi8+DQoNCiAgICA8IS0tIENvbG91cnMgLS0+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJHRU5FUkFMX1RBQkxFX0hFQURFUl9DRUxMX0JBQ0tHUk9VTkRfQ09MT1VSIj4jRkZGRkZGPC94c2w6dmFyaWFibGU+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJHRU5FUkFMX1RBQkxFX0hFQURFUl9DRUxMX0JPUkRFUl9DT0xPVVIiPiNFRUVFRUU8L3hzbDp2YXJpYWJsZT4NCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9IkdST1VQX1RBQkxFX0JBQ0tHUk9VTkRfQ09MT1VSIj4jRkVFQUE2PC94c2w6dmFyaWFibGU+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJHUk9VUF9UQUJMRV9CT1JERVJfQ09MT1VSIj4jMDAwMDAwPC94c2w6dmFyaWFibGU+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJIRUFESU5HU19UQUJMRV9CT1JERVJfQ09MT1VSIj4jMDAwMDAwPC94c2w6dmFyaWFibGU+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJEQVRFX0ZJTFRFUl9UQUJMRV9CQUNLR1JPVU5EX0NPTE9VUiI+I0VGRUZFRjwveHNsOnZhcmlhYmxlPg0KICAgIA0KICAgIDwhLS0gU3RhdGljIFRleHQgLS0+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJSRUNPUkRTX0ZJTFRFUkVEX1dBUk5JTkciPldhcm5pbmc6IFNvbWUgcmVjb3JkcyBoYXZlIGJlZW4gaGlkZGVuIGR1ZSB0byB0aGUgZmlsdGVyIGFwcGxpZWQgdG8gdGhpcyBsaXN0LjwveHNsOnZhcmlhYmxlPg0KDQogICAgPCEtLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09LS0+DQogICAgPCEtLSBbRU5EXSBDT05TVEFOVFMgLS0+DQoNCg0KICAgIDwhLS0gR0xPQkFMIFZBUklBQkxFUyAtLT4NCiAgICA8IS0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0tLT4NCg0KICAgIDwhLS0gUGF0aG9sb2d5IFRlc3QgTmFtZSBGaWx0ZXIgLS0+DQogICAgPHhzbDpwYXJhbSBuYW1lPSJyZXN1bHROYW1lRmlsdGVyTG93ZXJjYXNlIiBzZWxlY3Q9InRyYW5zbGF0ZSgkcmVzdWx0TmFtZUZpbHRlciwgJHVwcGVyQ2FzZUNoYXJhY3RlcnMsICRsb3dlckNhc2VDaGFyYWN0ZXJzKSI+PC94c2w6cGFyYW0+DQoNCiAgICA8IS0tIERvYyBUeXBlIC0tPg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iUEFUSF9WSUVXIiBzZWxlY3Q9Ii9wYXRoOnBhdGhvbG9neVJlcG9ydFZpZXdSZXNwb25zZS9wYXRoOnZpZXdNZXRhZGF0YS9wYXRoOmluZm9ybWF0aW9uQXZhaWxhYmxlIi8+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJESV9WSUVXIiBzZWxlY3Q9Ii9kaTpkaWFnbm9zdGljSW1hZ2luZ1JlcG9ydFZpZXdSZXNwb25zZS9kaTp2aWV3TWV0YWRhdGEvZGk6aW5mb3JtYXRpb25BdmFpbGFibGUiLz4NCiAgICANCiAgICA8IS0tIENEQSBEb2N1bWVudCBUaXRsZSAtLT4NCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9ImNkYURvY3VtZW50VGl0bGUiPg0KICAgICAgICA8eHNsOmNob29zZT4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkRElfVklFVyI+IERpYWdub3N0aWMgSW1hZ2luZyBSZXBvcnQgVmlldyA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRQQVRIX1ZJRVciPiBQYXRob2xvZ3kgUmVwb3J0IFZpZXcgPC94c2w6d2hlbj4gICAgICAgICAgICANCiAgICAgICAgICAgIDx4c2w6b3RoZXJ3aXNlPiBVbmtub3duIFZpZXcgPC94c2w6b3RoZXJ3aXNlPg0KICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgPC94c2w6dmFyaWFibGU+DQoNCiAgICA8IS0tIENEQSBEb2N1bWVudCBDcmVhdGlvbiBEYXRlICAtLT4NCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9ImRhdGVGcm9tRmlsdGVyIj4NCiAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJFBBVEhfVklFVyAhPSAnJyI+DQogICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9Ii8vcGF0aDp2aWV3TWV0YWRhdGEvcGF0aDp2aWV3UGFyYW1ldGVycy9wYXRoOmRhdGVGcm9tRmlsdGVyIi8+DQogICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRESV9WSUVXICE9ICcnIj4NCiAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iLy9kaTp2aWV3TWV0YWRhdGEvZGk6dmlld1BhcmFtZXRlcnMvZGk6ZGF0ZUZyb21GaWx0ZXIiLz4NCiAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICA8eHNsOm90aGVyd2lzZT4gPC94c2w6b3RoZXJ3aXNlPg0KICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgPC94c2w6dmFyaWFibGU+DQoNCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9ImRhdGVUb0ZpbHRlciI+DQogICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRQQVRIX1ZJRVcgIT0gJyciPg0KICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIvL3BhdGg6dmlld01ldGFkYXRhL3BhdGg6dmlld1BhcmFtZXRlcnMvcGF0aDpkYXRlVG9GaWx0ZXIiLz4NCiAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJERJX1ZJRVcgIT0gJyciPg0KICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIvL2RpOnZpZXdNZXRhZGF0YS9kaTp2aWV3UGFyYW1ldGVycy9kaTpkYXRlVG9GaWx0ZXIiLz4NCiAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICA8eHNsOm90aGVyd2lzZT4gPC94c2w6b3RoZXJ3aXNlPg0KICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgPC94c2w6dmFyaWFibGU+DQoNCiAgICA8IS0tIFBhdGllbnQgRGV0YWlscyAtLT4NCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9InBhdGllbnRJSEkiPg0KICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0idHJpbSI+DQogICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0ic3RyaW5nIj4NCiAgICAgICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iZm9ybWF0SEkiPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iaGlWYWx1ZSIgc2VsZWN0PSIvL2NjZTppaGlOdW1iZXIiLz4NCiAgICAgICAgICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPg0KICAgICAgICAgICAgPC94c2w6d2l0aC1wYXJhbT4NCiAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCiAgICA8L3hzbDp2YXJpYWJsZT4NCg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0icGF0aWVudEZhbWlseU5hbWUiPg0KICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0idG9VcHBlckNhc2UiPg0KICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9ImRhdGEiIHNlbGVjdD0iLy9jY2U6bmFtZS9jY2U6ZmFtaWx5TmFtZSIvPg0KICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPg0KICAgIDwveHNsOnZhcmlhYmxlPg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0icGF0aWVudEdpdmVuTmFtZSIgc2VsZWN0PSIvL2NjZTpuYW1lL2NjZTpnaXZlbk5hbWUiLz4NCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9InBhdGllbnRQcmVmaXgiIHNlbGVjdD0iLy9jY2U6bmFtZS9jY2U6bmFtZVRpdGxlIi8+DQoNCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9InBhdGllbnROYW1lIj4NCiAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9InNob3ctcGF0aWVudC1uYW1lIj4NCiAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJuYW1lIiBzZWxlY3Q9Ii8vY2NlOm5hbWUiLz4NCiAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCiAgICA8L3hzbDp2YXJpYWJsZT4NCg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0icGF0aWVudERhdGVPZkJpcnRoIj4NCiAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9ImZvcm1hdERhdGUiPg0KICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9ImRhdGUiIHNlbGVjdD0iLy9jY2U6ZGF0ZU9mQmlydGgiLz4NCiAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCiAgICA8L3hzbDp2YXJpYWJsZT4NCg0KICAgIDx4c2w6dmFyaWFibGUgbmFtZT0icGF0aWVudEFnZSI+DQogICAgICAgIDx4c2w6Y2FsbC10ZW1wbGF0ZSBuYW1lPSJjYWxjdWxhdGVBZ2UiPg0KICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9ImJpcnRoRGF0ZSI+DQogICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9Ii8vY2NlOmRhdGVPZkJpcnRoIi8+DQogICAgICAgICAgICA8L3hzbDp3aXRoLXBhcmFtPg0KICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9ImRvY0RhdGUiPg0KICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkZGF0ZVRvRmlsdGVyIi8+DQogICAgICAgICAgICA8L3hzbDp3aXRoLXBhcmFtPg0KICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPg0KICAgIDwveHNsOnZhcmlhYmxlPg0KDQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJwYXRpZW50U2V4Ij4NCiAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iLy9jY2U6c2V4ID0gJ00nIj5NYWxlPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIvL2NjZTpzZXggPSAnRiciPkZlbWFsZTwveHNsOndoZW4+DQogICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iLy9jY2U6c2V4ID0gJ0knIj5JbnRlcnNleCBvciBJbmRldGVybWluYXRlPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIvL2NjZTpzZXggPSAnTiciPk5vdCBTdGF0ZWQvSW5hZGVxdWF0ZWx5IERlc2NyaWJlZDwveHNsOndoZW4+DQogICAgICAgICAgICA8eHNsOm90aGVyd2lzZT5Vbmtub3duPC94c2w6b3RoZXJ3aXNlPg0KICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgPC94c2w6dmFyaWFibGU+DQoNCiAgICA8eHNsOnZhcmlhYmxlIG5hbWU9IkJBTk5FUl9IRUlHSFRfUFgiIHNlbGVjdD0iOTAiLz4NCg0KICAgIDwhLS0gRG9jdW1lbnQgUmVuZGVyaW5nIFZpZXcgVGl0bGUgLS0+DQogICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJkb2N1bWVudFJlbmRlcmluZ1ZpZXdUaXRsZSI+DQogICAgICAgIDx4c2w6Y2FsbC10ZW1wbGF0ZSBuYW1lPSJ0cmltIj4NCiAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJzdHJpbmciPg0KICAgICAgICAgICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0ic3RyaW5nLWxlbmd0aCgkcGF0aWVudElISSkgJmd0OyAwIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2YNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Q9ImNvbmNhdCgkcGF0aWVudE5hbWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIHwgJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwYXRpZW50U2V4LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyB8IERvQjogJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwYXRpZW50RGF0ZU9mQmlydGgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICgnLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwYXRpZW50QWdlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJykgfCBJSEk6ICcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGF0aWVudElISSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgfCAnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNkYURvY3VtZW50VGl0bGUpIg0KICAgICAgICAgICAgICAgICAgICAgICAgLz4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0PSJjb25jYXQoJHBhdGllbnROYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIHwgJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwYXRpZW50U2V4LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIHwgRG9COiAnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGF0aWVudERhdGVPZkJpcnRoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICgnLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBhdGllbnRBZ2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcpIHwgJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNkYURvY3VtZW50VGl0bGUpIg0KICAgICAgICAgICAgICAgICAgICAgICAgLz4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgICAgIDwveHNsOndpdGgtcGFyYW0+DQogICAgICAgIDwveHNsOmNhbGwtdGVtcGxhdGU+DQogICAgPC94c2w6dmFyaWFibGU+DQoNCiAgICA8IS0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0tLT4NCiAgICA8IS0tIFtFTkRdIEdMT0JBTCBWQVJJQUJMRVMgLS0+DQoNCiAgICA8IS0tIEVOVFJZIFRFTVBMQVRFIC0tPg0KICAgIDwhLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS0tPg0KDQogICAgPHhzbDp0ZW1wbGF0ZSBtYXRjaD0iL2RpOmRpYWdub3N0aWNJbWFnaW5nUmVwb3J0Vmlld1Jlc3BvbnNlIHwgL3BhdGg6cGF0aG9sb2d5UmVwb3J0Vmlld1Jlc3BvbnNlIj4NCiAgICAgICAgDQogICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJodG1sIj4NCiAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImxhbmciPmVuPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9ImhlYWQiPg0KICAgICAgICAgICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJtZXRhIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iaHR0cC1lcXVpdiI+Q29udGVudC1TdHlsZS1UeXBlPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjb250ZW50Ij50ZXh0L2NzczwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgICAgICA8L3hzbDplbGVtZW50Pg0KICAgICAgICAgICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJtZXRhIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0ibmFtZSI+dmlld3BvcnQ8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImNvbnRlbnQiPnVzZXItc2NhbGFibGU9eWVzLCB3aWR0aD08eHNsOnZhbHVlLW9mDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0PSIkRlVMTF9WSUVXUE9SVF9XSURUSF9QWCIvPjwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgICAgICA8L3hzbDplbGVtZW50Pg0KICAgICAgICAgICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJtZXRhIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0ibmFtZSI+Zm9ybWF0LWRldGVjdGlvbjwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY29udGVudCI+dGVsZXBob25lPW5vPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9Im1ldGEiPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJodHRwLWVxdWl2Ij5YLVVBLUNvbXBhdGlibGU8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImNvbnRlbnQiPklFPWVkZ2U8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgPC94c2w6ZWxlbWVudD4NCiAgICAgICAgICAgICAgICA8eHNsOmlmIHRlc3Q9IiRhZGRKYXZhU2NyaXB0PSd0cnVlJyI+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJzY3JpcHQiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0idHlwZSI+dGV4dC9qYXZhc2NyaXB0PC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9ImdldEpRdWVyeUphdmFTY3JpcHRDb2RlIi8+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJzY3JpcHQiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0idHlwZSI+dGV4dC9qYXZhc2NyaXB0PC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgICAgICAgICAgICAgPCFbQ0RBVEFbDQogICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoInRib2R5W2lkXj0nR3JvdXBUYWJsZUhlYWRpbmdJZCddIikuZWFjaChmdW5jdGlvbigpIHsNCiAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoJ2N1cnNvcicsICdwb2ludGVyJyk7DQogICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY2xpY2soZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5uZXh0KCJ0Ym9keVtpZF49J0dyb3VwVGFibGVCb2R5SWQnXSIpLnNsaWRlVG9nZ2xlKDE1KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICB9KTsgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIF1dPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDplbGVtZW50Pg0KICAgICAgICAgICAgICAgIDwveHNsOmlmPg0KICAgICAgICAgICAgICAgIDx4c2w6Y29tbWVudD48eHNsOnZhbHVlLW9mIHNlbGVjdD0iJERPX05PVF9FRElUX05PVEUiLz48L3hzbDpjb21tZW50Pg0KICAgICAgICAgICAgICAgIDx4c2w6Y29tbWVudD48eHNsOnZhbHVlLW9mIHNlbGVjdD0iJFZFUlNJT05fTk9URSIvPjwveHNsOmNvbW1lbnQ+DQoNCiAgICAgICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0idGl0bGUiPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJGRvY3VtZW50UmVuZGVyaW5nVmlld1RpdGxlIi8+DQogICAgICAgICAgICAgICAgPC94c2w6ZWxlbWVudD4NCg0KICAgICAgICAgICAgICAgIDx4c2w6Y2FsbC10ZW1wbGF0ZSBuYW1lPSJhZGRDU1MiLz4NCiAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICA8IS0tIDwvaGVhZD4gLS0+DQogICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0iYm9keSI+ICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgPCEtLSBEaXNwbGF5IHRoZSBCYW5uZXIgLS0+DQogICAgICAgICAgICAgICAgPHhzbDppZiB0ZXN0PSIkYmFubmVyRGlzcGxheSE9J2ZhbHNlJyI+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJkaXYiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY2xhc3MiPkJBTk5FUiBjbGVhcmZpeDwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6Y2FsbC10ZW1wbGF0ZSBuYW1lPSJnZXRCYW5uZXIiLz4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6ZWxlbWVudD4NCg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0iZGl2Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImNsYXNzIj5CQU5ORVJfQkFDSyBjbGVhcmZpeDwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6Y2FsbC10ZW1wbGF0ZSBuYW1lPSJnZXRCYW5uZXIiLz4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6ZWxlbWVudD4NCiAgICAgICAgICAgICAgICA8L3hzbDppZj4NCg0KICAgICAgICAgICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJkaXYiPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+Q09OVEVOVDwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgICAgICAgICAgPCEtLSBEaXNwbGF5IFN0YXJ0IG9mIERvY3VtZW50IEluZGljYXRvciAtLT4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9ImdldFN0YXJ0T2ZEb2N1bWVudEluZGljYXRvciIvPg0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDogMTBweDsgbWFyZ2luLWxlZnQ6IDEwcHg7IG1hcmdpbi1yaWdodDogMTBweDsiPg0KICAgICAgICAgICAgICAgICAgICAgICAgVGhpcyBpcyBub3QgYSBjb21wbGV0ZSB2aWV3IG9mIHRoZSBpbmRpdmlkdWFsJ3MgaGVhbHRoIGluZm9ybWF0aW9uLiAgRm9yIG1vcmUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGluZGl2aWR1YWzigJlzIGhlYWx0aCByZWNvcmQgb3IgZGF0YSwgcGxlYXNlIGNvbnN1bHQgdGhlIGluZGl2aWR1YWwgb3Igb3RoZXIgaGVhbHRoY2FyZSBwcm9mZXNzaW9uYWxzIGFzIG5lZWRlZC4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICA8eHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkRElfVklFVyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9InByb2Nlc3NEaVN0cnVjdHVyZWRCb2R5IiAvPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkUEFUSF9WSUVXIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0icHJvY2Vzc1BhdGhTdHJ1Y3R1cmVkQm9keSIgLz4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4gICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgICAgIDwhLS0gRGlzcGxheSBFbmQgb2YgRG9jdW1lbnQgLS0+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6Y2FsbC10ZW1wbGF0ZSBuYW1lPSJnZXRFbmRPZkRvY3VtZW50SW5kaWNhdG9yIi8+DQoNCiAgICAgICAgICAgICAgICA8L3hzbDplbGVtZW50Pg0KICAgICAgICAgICAgICAgIDwhLS0gPC9kaXY+IC0tPg0KDQoNCiAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICA8IS0tIDwvYm9keT4gLS0+DQogICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgIDwhLS0gPC9odG1sIC0tPg0KDQogICAgPC94c2w6dGVtcGxhdGU+DQoNCiAgICA8IS0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0tLT4NCiAgICA8IS0tIFtFTkRdIEVOVFJZIFRFTVBMQVRFIC0tPg0KDQogICAgPCEtLSBCQU5ORVIgVEVNUExBVEVTIC0tPg0KICAgIDwhLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS0tPg0KDQogICAgPHhzbDp0ZW1wbGF0ZSBuYW1lPSJnZXRCYW5uZXIiPg0KICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0iZGl2Ij4NCiAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImNsYXNzIj5CQU5ORVJfRE9DVU1FTlRfVElUTEVfRElWPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRjZGFEb2N1bWVudFRpdGxlIi8+DQogICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgIDwhLS0gPC9kaXY+IC0tPg0KDQogICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJkaXYiPg0KICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY2xhc3MiPkJBTk5FUl9WSUVXX0RFVEFJTFNfRElWPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgDQogICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0iZGwiPg0KICAgICAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImNsYXNzIj5iYW5uZXJEbDwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICA8eHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRncm91cEJ5ID0gJ29yZ2FuaXNhdGlvbiciPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGR0IGNsYXNzPSJiYW5uZXJEdCI+R3JvdXBlZCBieSA8L2R0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRkIGNsYXNzPSJiYW5uZXJEZCI+T3JnYW5pc2F0aW9uPC9kZD4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRncm91cEJ5ID0gJ3JlcXVlc3RlciciPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGR0IGNsYXNzPSJiYW5uZXJEdCI+R3JvdXBlZCBieSA8L2R0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRkIGNsYXNzPSJiYW5uZXJEZCI+UmVxdWVzdGluZyBQcm9mZXNzaW9uYWw8L2RkPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJGdyb3VwQnkgPSAncmVwb3J0SWQnIGFuZCAkRElfVklFVyI+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZHQgY2xhc3M9ImJhbm5lckR0Ij5Hcm91cGVkIGJ5IDwvZHQ+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGQgY2xhc3M9ImJhbm5lckRkIj5BY2Nlc3Npb24gTm8uPC9kZD4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRncm91cEJ5ID0gJ3JlcG9ydElkJyBhbmQgJFBBVEhfVklFVyI+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZHQgY2xhc3M9ImJhbm5lckR0Ij5Hcm91cGVkIGJ5IDwvZHQ+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGQgY2xhc3M9ImJhbm5lckRkIj5SZXBvcnQgSUQ8L2RkPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICA8eHNsOmlmIHRlc3Q9IiRyZXN1bHROYW1lRmlsdGVyIj4NCiAgICAgICAgICAgICAgICAgICAgPGR0IGNsYXNzPSJiYW5uZXJEdCI+RmlsdGVyZWQgYnkgPC9kdD4NCiAgICAgICAgICAgICAgICAgICAgPGRkIGNsYXNzPSJiYW5uZXJEZCI+Jzx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkcmVzdWx0TmFtZUZpbHRlciIvPic8L2RkPg0KICAgICAgICAgICAgICAgIDwveHNsOmlmPg0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJkdCI+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImNsYXNzIj5iYW5uZXJEdDwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgICAgICAgICAgRnJvbQ0KICAgICAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9ImRkIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY2xhc3MiPmJhbm5lckRkPC94c2w6YXR0cmlidXRlPg0KDQogICAgICAgICAgICAgICAgICAgIDx4c2w6Y2FsbC10ZW1wbGF0ZSBuYW1lPSJmb3JtYXREYXRlIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJkYXRlIiBzZWxlY3Q9IiRkYXRlRnJvbUZpbHRlciIvPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPg0KICAgICAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9ImR0Ij4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY2xhc3MiPmJhbm5lckR0PC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgICAgICAgICBUbw0KICAgICAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9ImRkIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY2xhc3MiPmJhbm5lckRkPC94c2w6YXR0cmlidXRlPg0KDQogICAgICAgICAgICAgICAgICAgIDx4c2w6Y2FsbC10ZW1wbGF0ZSBuYW1lPSJmb3JtYXREYXRlIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJkYXRlIiBzZWxlY3Q9IiRkYXRlVG9GaWx0ZXIiLz4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCg0KICAgICAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICA8L3hzbDplbGVtZW50PiANCiAgICAgICAgPC94c2w6ZWxlbWVudD4gDQoNCiAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9ImRpdiI+DQogICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+QkFOTkVSX1BBVElFTlRfREVUQUlMU19ESVY8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0iZGl2Ij4NCiAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJzdHlsZSI+ZGlzcGxheTogaW5saW5lOyBtYXJnaW4tcmlnaHQ6IDIwcHg7IGZvbnQtc2l6ZToNCiAgICAgICAgICAgICAgICAgICAgMTRweDs8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbg0KICAgICAgICAgICAgICAgICAgICAgICAgdGVzdD0iJHBhdGllbnRGYW1pbHlOYW1lIT0nJyBhbmQgc3RyaW5nLWxlbmd0aCgkcGF0aWVudEZhbWlseU5hbWUpICZndDsgMCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmlmIHRlc3Q9IiRwYXRpZW50UHJlZml4IT0nJyBhbmQgc3RyaW5nLWxlbmd0aCgkcGF0aWVudFByZWZpeCkgJmd0OyAwIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJHBhdGllbnRQcmVmaXgiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnRleHQ+IDwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDppZj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6aWYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXN0PSIkcGF0aWVudEdpdmVuTmFtZSE9JycgYW5kIHN0cmluZy1sZW5ndGgoJHBhdGllbnRHaXZlbk5hbWUpICZndDsgMCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRwYXRpZW50R2l2ZW5OYW1lIi8+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6aWY+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0ic3BhbiI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY2xhc3MiPmJvbGQ8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRwYXRpZW50RmFtaWx5TmFtZSIvPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6ZWxlbWVudD4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0iYiI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRwYXRpZW50TmFtZSIvPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6ZWxlbWVudD4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICA8IS0tIDwvZGl2PiAtLT4NCg0KICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9ImRsIj4NCiAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+YmFubmVyRGw8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9ImR0Ij4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY2xhc3MiPmJhbm5lckR0PC94c2w6YXR0cmlidXRlPiBEb0IgPC94c2w6ZWxlbWVudD4NCiAgICAgICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0iZGQiPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+YmFubmVyRGQ8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkcGF0aWVudERhdGVPZkJpcnRoIi8+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSJjb25jYXQoJyAoJywgJHBhdGllbnRBZ2UsICcpJykiLz4NCiAgICAgICAgICAgICAgICAgICAgPCEtLQ0KICAgICAgICAgICAgICAgICAgICA8eHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSJub3QoJHBhdGllbnRBZ2U9J0RFQ0VBU0VEJykgYW5kIG5vdCgkcGF0aWVudEFnZT0nQUdFIFVOS05PV04nKSBhbmQgc3RyaW5nLWxlbmd0aCgkcGF0aWVudENvZGVkQWdlKSA9IDAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkcGF0aWVudERhdGVPZkJpcnRoIi8+PHhzbDp2YWx1ZS1vZiBzZWxlY3Q9ImNvbmNhdCgnICgnLCAkcGF0aWVudEFnZSkiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iZ2V0Q2FsY3VsYXRlZEFnZUxpbmsiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnRleHQ+KTwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRwYXRpZW50RGF0ZU9mQmlydGgiLz48eHNsOnZhbHVlLW9mIHNlbGVjdD0iY29uY2F0KCcgKCcsICRwYXRpZW50QWdlLCAnKScpIi8+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgLS0+DQogICAgICAgICAgICAgICAgPC94c2w6ZWxlbWVudD4NCiAgICAgICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0iZHQiPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+YmFubmVyRHQ8L3hzbDphdHRyaWJ1dGU+IFNFWCA8L3hzbDplbGVtZW50Pg0KICAgICAgICAgICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJkZCI+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImNsYXNzIj5iYW5uZXJEZDwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRwYXRpZW50U2V4Ii8+DQogICAgICAgICAgICAgICAgPC94c2w6ZWxlbWVudD4NCg0KICAgICAgICAgICAgICAgIDx4c2w6aWYgdGVzdD0iJHBhdGllbnRJSEkhPScnIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9ImR0Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImNsYXNzIj5iYW5uZXJEdDwveHNsOmF0dHJpYnV0ZT4gSUhJIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJkZCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+YmFubmVyRGQ8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJHBhdGllbnRJSEkiLz4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6ZWxlbWVudD4NCiAgICAgICAgICAgICAgICA8L3hzbDppZj4NCiAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICA8IS0tIDwvZGw+IC0tPg0KICAgICAgICA8L3hzbDplbGVtZW50Pg0KICAgICAgICA8IS0tIDwvZGl2PiAtLT4NCiAgICA8L3hzbDp0ZW1wbGF0ZT4NCg0KICAgIDx4c2w6dGVtcGxhdGUgbmFtZT0iZ2V0Q2FsY3VsYXRlZEFnZUxpbmsiPg0KICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0iYSI+DQogICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+YWdlTGluazwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImhyZWYiPiNjYWxjdWxhdGVkQWdlQW5jaG9yPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgPHhzbDp0ZXh0Pio8L3hzbDp0ZXh0Pg0KICAgICAgICA8L3hzbDplbGVtZW50Pg0KICAgIDwveHNsOnRlbXBsYXRlPg0KDQogICAgPCEtLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09LS0+DQogICAgPCEtLSBbRU5EXSBCQU5ORVIgVEVNUExBVEVTIC0tPg0KDQogICAgPCEtLSBDREEgQk9EWSBURU1QTEFURVMgLS0+DQogICAgPCEtLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09LS0+DQoNCiAgICA8eHNsOnRlbXBsYXRlIG5hbWU9InByb2Nlc3NEaVN0cnVjdHVyZWRCb2R5Ij4gICANCg0KICAgICAgICA8eHNsOmlmIHRlc3Q9ImNvdW50KC8vZGk6aW1hZ2luZ0V4YW1pbmF0aW9uUmVzdWx0KSA9IDAiPg0KICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDogMTBweDsgbWFyZ2luLWxlZnQ6IDEwcHg7IG1hcmdpbi1yaWdodDogMTBweDsiPg0KICAgICAgICAgICAgICAgIE5vIGluZm9ybWF0aW9uIGlzIGF2YWlsYWJsZS4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L3hzbDppZj4gICAgIA0KDQogICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iaGlkZGVuQ291bnQiIHNlbGVjdD0iY291bnQoLy9kaTppbWFnaW5nRXhhbWluYXRpb25SZXN1bHQNCiAgICAgICAgICAgIFtub3QoY29udGFpbnModHJhbnNsYXRlKGRpOmV4YW1pbmF0aW9uUmVzdWx0TmFtZS92Y3Q6ZGlzcGxheU5hbWUsICR1cHBlckNhc2VDaGFyYWN0ZXJzLCAkbG93ZXJDYXNlQ2hhcmFjdGVycyksICRyZXN1bHROYW1lRmlsdGVyTG93ZXJjYXNlKSkgYW5kDQogICAgICAgICAgICBub3QoY29udGFpbnModHJhbnNsYXRlKGRpOmV4YW1pbmF0aW9uUmVzdWx0TmFtZS92Y3Q6b3JpZ2luYWxUZXh0LCAkdXBwZXJDYXNlQ2hhcmFjdGVycywgJGxvd2VyQ2FzZUNoYXJhY3RlcnMpLCAkcmVzdWx0TmFtZUZpbHRlckxvd2VyY2FzZSkpXSkiIC8+IA0KICAgICAgICA8eHNsOmlmIHRlc3Q9IiRoaWRkZW5Db3VudCA+IDAiPg0KICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDogMTBweDsgbWFyZ2luLWxlZnQ6IDEwcHg7IG1hcmdpbi1yaWdodDogMTBweDsiPg0KICAgICAgICAgICAgICAgIDxiPldhcm5pbmc6IDwvYj4gDQogICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRoaWRkZW5Db3VudCIgLz4gcmVjb3JkKHMpIGhpZGRlbiBkdWUgdG8gdGhlIGZpbHRlci4gUmVtb3ZlIHRoZSBmaWx0ZXIgdG8gc2VlIHRoZSBmdWxsIGxpc3QuDQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC94c2w6aWY+DQoNCiAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJGdyb3VwQnkgPSAnb3JnYW5pc2F0aW9uJyI+DQogICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9InByb2Nlc3NEaUdyb3VwcyI+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJncm91cHMiIHNlbGVjdD0iL2RpOmRpYWdub3N0aWNJbWFnaW5nUmVwb3J0Vmlld1Jlc3BvbnNlL2RpOmRpYWdub3N0aWNJbWFnaW5nUmVwb3J0W2dlbmVyYXRlLWlkKC4pPWdlbmVyYXRlLWlkKA0KICAgICAgICAgICAgICAgICAgICAgICAga2V5KCdkaU9yZ2FuaXNhdGlvbk5hbWVLZXknLGRpOnJlcG9ydGluZ1JhZGlvbG9naXN0SW5mb3JtYXRpb24vdmN0OmhlYWx0aGNhcmVQcm92aWRlck9yZ2FuaXNhdGlvbk5hbWUpWzFdDQogICAgICAgICAgICAgICAgICAgICAgICApXSI+ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aXRoLXBhcmFtPg0KICAgICAgICAgICAgICAgIDwveHNsOmNhbGwtdGVtcGxhdGU+DQogICAgICAgICAgICA8L3hzbDp3aGVuPiAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgPHhzbDpvdGhlcndpc2U+ICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9InByb2Nlc3NEaVRhYmxlIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9ImVudHJpZXMiICBzZWxlY3Q9Ii9kaTpkaWFnbm9zdGljSW1hZ2luZ1JlcG9ydFZpZXdSZXNwb25zZS9kaTpkaWFnbm9zdGljSW1hZ2luZ1JlcG9ydC9kaTppbWFnaW5nRXhhbWluYXRpb25SZXN1bHQNCiAgICAgICAgICAgICAgICAgICAgICAgIFtjb250YWlucyh0cmFuc2xhdGUoZGk6ZXhhbWluYXRpb25SZXN1bHROYW1lL3ZjdDpkaXNwbGF5TmFtZSwgJHVwcGVyQ2FzZUNoYXJhY3RlcnMsICRsb3dlckNhc2VDaGFyYWN0ZXJzKSwgJHJlc3VsdE5hbWVGaWx0ZXJMb3dlcmNhc2UpIG9yDQogICAgICAgICAgICAgICAgICAgICAgICBjb250YWlucyh0cmFuc2xhdGUoZGk6ZXhhbWluYXRpb25SZXN1bHROYW1lL3ZjdDpvcmlnaW5hbFRleHQsICR1cHBlckNhc2VDaGFyYWN0ZXJzLCAkbG93ZXJDYXNlQ2hhcmFjdGVycyksICRyZXN1bHROYW1lRmlsdGVyTG93ZXJjYXNlKV0iIC8+DQogICAgICAgICAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCiAgICAgICAgICAgIDwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgPC94c2w6Y2hvb3NlPiAgDQogICAgICAgIA0KICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iZ2V0R3JvdXBTcGFjZXIiLz4NCiAgICA8L3hzbDp0ZW1wbGF0ZT4NCiAgICANCiAgICA8eHNsOnRlbXBsYXRlIG5hbWU9InByb2Nlc3NEaVRhYmxlIj4NCiAgICAgICAgPHhzbDpwYXJhbSBuYW1lPSJncm91cE5hbWUiIC8+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0iZW50cmllcyIgLz4NCiAgICAgICAgDQogICAgICAgIDx4c2w6aWYgdGVzdD0iY291bnQoJGVudHJpZXMpID4gMCI+DQogICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iZ2V0R3JvdXBTcGFjZXIiLz4NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgPGRpdiBjbGFzcz0iR3JvdXBUYWJsZUJvcmRlciI+DQogICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzPSJHcm91cFRhYmxlIiB3aWR0aD0iMTAwJSI+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6aWYgdGVzdD0iJGdyb3VwTmFtZSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8dGJvZHkgaWQ9Intjb25jYXQoJ0dyb3VwVGFibGVIZWFkaW5nSWQnLCBwb3NpdGlvbigpKX0iPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY2xhc3MiPkdyb3VwVGFibGVSb3c8L3hzbDphdHRyaWJ1dGU+ICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9Ikdyb3VwVGFibGVHcm91cE5hbWUiPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRncm91cEJ5ID0gJ29yZ2FuaXNhdGlvbiciPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPcmdhbmlzYXRpb246IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Yj48eHNsOnZhbHVlLW9mIHNlbGVjdD0iJGdyb3VwTmFtZSIvPjwvYj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RyPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC90Ym9keT4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6aWY+ICAgICAgDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICA8eHNsOmlmIHRlc3Q9IiRncm91cE5hbWUgPSAnJyBvciAkYWRkSmF2YVNjcmlwdD0ndHJ1ZScgb3IgJGNvbGxhcHNlZEdyb3Vwcz0nZmFsc2UnIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx0Ym9keSBpZD0ie2NvbmNhdCgnR3JvdXBUYWJsZUJvZHlJZCcsIHBvc2l0aW9uKCkpfSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkZ3JvdXBOYW1lIGFuZCAoJGFkZEphdmFTY3JpcHQ9J3RydWUnIGFuZCAkY29sbGFwc2VkR3JvdXBzPSd0cnVlJykiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0ic3R5bGUiPnBhZGRpbmc6IDBweDsgbWFyZ2luOiAwcHg7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyLXNwYWNpbmc6IDBweDsgZGlzcGxheTogbm9uZTs8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0ic3R5bGUiPnBhZGRpbmc6IDBweDsgbWFyZ2luOiAwcHg7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyLXNwYWNpbmc6IDBweDs8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJoZWFkZXJDc3NTdHlsZSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRncm91cE5hbWUiPkdyb3VwRW50cmllc1RhYmxlQ2VsbDwveHNsOndoZW4+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOm90aGVyd2lzZT5Hcm91cEVudHJpZXNUYWJsZUNlbGxOb0JvcmRlcjwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOnZhcmlhYmxlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBzdHlsZT0icGFkZGluZzogMHB4OyBtYXJnaW46IDBweDsgYm9yZGVyLXNwYWNpbmc6IDBweCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT0icGFkZGluZzogMHB4OyBtYXJnaW46IDBweDsgYm9yZGVyLXNwYWNpbmc6IDBweCIgY29sc3Bhbj0iMSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0YWJsZSBjbGFzcz0iR3JvdXBFbnRyaWVzVGFibGUiIHdpZHRoPSIxMDAlIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0ieyRoZWFkZXJDc3NTdHlsZX0gR3JvdXBFbnRyaWVzRGF0ZSI+SW1hZ2luZyBEYXRlPC90aD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6aWYgdGVzdD0iJGdyb3VwQnkgIT0gJ29yZ2FuaXNhdGlvbiciPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0ieyRoZWFkZXJDc3NTdHlsZX0gR3JvdXBFbnRyaWVzT3JnYW5pc2F0aW9uIj5BdXRob3JpbmcgT3JnYW5pc2F0aW9uPC90aD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOmlmPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJ7JGhlYWRlckNzc1N0eWxlfSBHcm91cEVudHJpZXNNb2RhbGl0eSI+TW9kYWxpdHk8L3RoPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJ7JGhlYWRlckNzc1N0eWxlfSBHcm91cEVudHJpZXNFeGFtaW5hdGlvbiI+RXhhbWluYXRpb248L3RoPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJ7JGhlYWRlckNzc1N0eWxlfSBHcm91cEVudHJpZXNNb2RhbGl0eSI+TG9jYXRpb24gLyBMYXRlcmFsaXR5PC90aD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6aWYgdGVzdD0iJGdyb3VwQnkgIT0gJ3JlcG9ydElkJyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJ7JGhlYWRlckNzc1N0eWxlfSBHcm91cEVudHJpZXNBY2Nlc3Npb25ObyI+QWNjZXNzaW9uIE5vLjwvdGg+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDppZj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90cj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RoZWFkPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0Ym9keSBzdHlsZT0icGFkZGluZzogMHB4OyBtYXJnaW46IDBweDsgYm9yZGVyLXNwYWNpbmc6IDBweCI+ICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9InByb2Nlc3NEaVRhYmxlRW50cmllcyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iZW50cmllcyIgc2VsZWN0PSIkZW50cmllcyIvPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3Rib2R5Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90YWJsZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3Rib2R5Pg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDppZj4NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgPC90YWJsZT4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgDQogICAgICAgIDwveHNsOmlmPg0KDQogICAgPC94c2w6dGVtcGxhdGU+DQogICAgDQogICAgPHhzbDp0ZW1wbGF0ZSBuYW1lPSJwcm9jZXNzRGlHcm91cHMiPg0KICAgICAgICA8eHNsOnBhcmFtIG5hbWU9Imdyb3VwcyIgLz4NCiAgICAgICAgDQogICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRncm91cEJ5ID0gJ29yZ2FuaXNhdGlvbiciPg0KICAgICAgICAgICAgICAgIDx4c2w6Zm9yLWVhY2ggc2VsZWN0PSIkZ3JvdXBzIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDpzb3J0IHNlbGVjdD0iZGk6cmVwb3J0aW5nUmFkaW9sb2dpc3RJbmZvcm1hdGlvbi92Y3Q6aGVhbHRoY2FyZVByb3ZpZGVyT3JnYW5pc2F0aW9uTmFtZSIvPg0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJvcmdhbmlzYXRpb25OYW1lIiBzZWxlY3Q9ImRpOnJlcG9ydGluZ1JhZGlvbG9naXN0SW5mb3JtYXRpb24vdmN0OmhlYWx0aGNhcmVQcm92aWRlck9yZ2FuaXNhdGlvbk5hbWUiLz4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJmaWx0ZXJlZEVudHJpZXMiIHNlbGVjdD0ia2V5KCdkaU9yZ2FuaXNhdGlvbk5hbWVLZXknLCAkb3JnYW5pc2F0aW9uTmFtZSkvZGk6aW1hZ2luZ0V4YW1pbmF0aW9uUmVzdWx0DQogICAgICAgICAgICAgICAgICAgICAgICBbY29udGFpbnModHJhbnNsYXRlKGRpOmV4YW1pbmF0aW9uUmVzdWx0TmFtZS92Y3Q6ZGlzcGxheU5hbWUsICR1cHBlckNhc2VDaGFyYWN0ZXJzLCAkbG93ZXJDYXNlQ2hhcmFjdGVycyksICRyZXN1bHROYW1lRmlsdGVyTG93ZXJjYXNlKSBvcg0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbnModHJhbnNsYXRlKGRpOmV4YW1pbmF0aW9uUmVzdWx0TmFtZS92Y3Q6b3JpZ2luYWxUZXh0LCAkdXBwZXJDYXNlQ2hhcmFjdGVycywgJGxvd2VyQ2FzZUNoYXJhY3RlcnMpLCAkcmVzdWx0TmFtZUZpbHRlckxvd2VyY2FzZSldIi8+DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0icHJvY2Vzc0RpVGFibGUiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9Imdyb3VwTmFtZSIgc2VsZWN0PSIkb3JnYW5pc2F0aW9uTmFtZSIgLz4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJlbnRyaWVzIiBzZWxlY3Q9IiRmaWx0ZXJlZEVudHJpZXMiIC8+IA0KICAgICAgICAgICAgICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgPC94c2w6Zm9yLWVhY2g+DQogICAgICAgICAgICA8L3hzbDp3aGVuPiAgICAgICAgICAgIA0KICAgICAgICA8L3hzbDpjaG9vc2U+ICAgICAgICAgDQogICAgPC94c2w6dGVtcGxhdGU+DQogICAgDQogICAgPHhzbDp0ZW1wbGF0ZSBuYW1lPSJwcm9jZXNzUGF0aEdyb3VwcyI+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0iZ3JvdXBzIiAvPg0KICAgICAgICANCiAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJGdyb3VwQnkgPSAnb3JnYW5pc2F0aW9uJyI+ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDx4c2w6Zm9yLWVhY2ggc2VsZWN0PSIkZ3JvdXBzIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDpzb3J0IHNlbGVjdD0icGF0aDpyZXBvcnRpbmdQYXRob2xvZ2lzdEluZm9ybWF0aW9uL3ZjdDpoZWFsdGhjYXJlUHJvdmlkZXJPcmdhbmlzYXRpb25OYW1lIi8+DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICA8eHNsOnZhcmlhYmxlIG5hbWU9Im9yZ2FuaXNhdGlvbk5hbWUiIHNlbGVjdD0icGF0aDpyZXBvcnRpbmdQYXRob2xvZ2lzdEluZm9ybWF0aW9uL3ZjdDpoZWFsdGhjYXJlUHJvdmlkZXJPcmdhbmlzYXRpb25OYW1lIi8+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICA8eHNsOnZhcmlhYmxlIG5hbWU9ImZpbHRlcmVkRW50cmllcyIgc2VsZWN0PSJrZXkoJ3BhdGhPcmdhbmlzYXRpb25OYW1lS2V5JywgJG9yZ2FuaXNhdGlvbk5hbWUpL3BhdGg6cGF0aG9sb2d5VGVzdFJlc3VsdA0KICAgICAgICAgICAgICAgICAgICAgICAgW2NvbnRhaW5zKHRyYW5zbGF0ZShwYXRoOnRlc3RSZXN1bHROYW1lL3ZjdDpkaXNwbGF5TmFtZSwgJHVwcGVyQ2FzZUNoYXJhY3RlcnMsICRsb3dlckNhc2VDaGFyYWN0ZXJzKSwgJHJlc3VsdE5hbWVGaWx0ZXJMb3dlcmNhc2UpIG9yDQogICAgICAgICAgICAgICAgICAgICAgICBjb250YWlucyh0cmFuc2xhdGUocGF0aDp0ZXN0UmVzdWx0TmFtZS92Y3Q6b3JpZ2luYWxUZXh0LCAkdXBwZXJDYXNlQ2hhcmFjdGVycywgJGxvd2VyQ2FzZUNoYXJhY3RlcnMpLCAkcmVzdWx0TmFtZUZpbHRlckxvd2VyY2FzZSldIi8+DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0icHJvY2Vzc1BhdGhUYWJsZSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iZ3JvdXBOYW1lIiBzZWxlY3Q9IiRvcmdhbmlzYXRpb25OYW1lIiAvPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9ImVudHJpZXMiIHNlbGVjdD0iJGZpbHRlcmVkRW50cmllcyIgLz4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4gICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDwveHNsOmZvci1lYWNoPg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgPC94c2w6Y2hvb3NlPiANCiAgICA8L3hzbDp0ZW1wbGF0ZT4NCiAgICANCiAgICA8eHNsOnRlbXBsYXRlIG5hbWU9InByb2Nlc3NEaVRhYmxlRW50cmllcyI+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0iZW50cmllcyIgLz4NCg0KICAgICAgICA8eHNsOmZvci1lYWNoIHNlbGVjdD0iJGVudHJpZXMiPg0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgPHhzbDpzb3J0IA0KICAgICAgICAgICAgICAgIHNlbGVjdD0iLi4vZGk6cmVwb3J0aW5nUmFkaW9sb2dpc3RJbmZvcm1hdGlvbi92Y3Q6aGVhbHRoY2FyZVByb3ZpZGVyT3JnYW5pc2F0aW9uTmFtZVskc29ydEJ5ID0gJ29yZ2FuaXNhdGlvbiddIiANCiAgICAgICAgICAgICAgICBkYXRhLXR5cGU9InRleHQiIG9yZGVyPSJhc2NlbmRpbmciIC8+DQogICAgICAgICAgICA8eHNsOnNvcnQgc2VsZWN0PSJ0cmFuc2xhdGUoY29uY2F0KA0KICAgICAgICAgICAgICAgIGRpOmV4YW1pbmF0aW9uUmVzdWx0TmFtZS92Y3Q6b3JpZ2luYWxUZXh0WyRzb3J0QnkgPSAncHJvY2VkdXJlJ10sIA0KICAgICAgICAgICAgICAgIGRpOmV4YW1pbmF0aW9uUmVzdWx0TmFtZS92Y3Q6ZGlzcGxheU5hbWVbJHNvcnRCeSA9ICdwcm9jZWR1cmUnXQ0KICAgICAgICAgICAgICAgICksICR1cHBlckNhc2VDaGFyYWN0ZXJzLCAkbG93ZXJDYXNlQ2hhcmFjdGVycykiIGRhdGEtdHlwZT0idGV4dCIgb3JkZXI9ImFzY2VuZGluZyIgLz4NCiAgICAgICAgICAgIDx4c2w6c29ydCBzZWxlY3Q9InRyYW5zbGF0ZShjb25jYXQoDQogICAgICAgICAgICAgICAgZGk6bW9kYWxpdHkvdmN0Om9yaWdpbmFsVGV4dFskc29ydEJ5ID0gJ21vZGFsaXR5J10sIA0KICAgICAgICAgICAgICAgIGRpOm1vZGFsaXR5L3ZjdDpkaXNwbGF5TmFtZVskc29ydEJ5ID0gJ21vZGFsaXR5J10NCiAgICAgICAgICAgICAgICApLCAkbG93ZXJDYXNlQ2hhcmFjdGVycywgJHVwcGVyQ2FzZUNoYXJhY3RlcnMpIiBkYXRhLXR5cGU9InRleHQiIG9yZGVyPSJhc2NlbmRpbmciIC8+DQogICAgICAgICAgICA8eHNsOnNvcnQgc2VsZWN0PSJ0cmFuc2xhdGUoY29uY2F0KA0KICAgICAgICAgICAgICAgIGRpOmFuYXRvbWljYWxTaXRlRGV0YWlscy9kaTphbmF0b21pY2FsTG9jYXRpb24vZGk6YW5hdG9taWNhbExvY2F0aW9uTmFtZS92Y3Q6b3JpZ2luYWxUZXh0WyRzb3J0QnkgPSAnYW5hdG9taWNhbExvY2F0aW9uJ10sDQogICAgICAgICAgICAgICAgZGk6YW5hdG9taWNhbFNpdGVEZXRhaWxzL2RpOmFuYXRvbWljYWxMb2NhdGlvbi9kaTphbmF0b21pY2FsTG9jYXRpb25OYW1lL3ZjdDpkaXNwbGF5TmFtZVskc29ydEJ5ID0gJ2FuYXRvbWljYWxMb2NhdGlvbiddDQogICAgICAgICAgICAgICAgKSwgJGxvd2VyQ2FzZUNoYXJhY3RlcnMsICR1cHBlckNhc2VDaGFyYWN0ZXJzKSIgZGF0YS10eXBlPSJ0ZXh0IiBvcmRlcj0iYXNjZW5kaW5nIiAvPiAgICAgICAgICAgIA0KICAgICAgICAgICAgPHhzbDpzb3J0IHNlbGVjdD0iZGk6aW1hZ2luZ1NlcnZpY2VEYXRlVGltZSIgb3JkZXI9ImRlc2NlbmRpbmciIC8+DQogICAgICAgICAgICANCiAgICAgICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iZGlPcmdhbmlzYXRpb24iPg0KICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIuLi9kaTpyZXBvcnRpbmdSYWRpb2xvZ2lzdEluZm9ybWF0aW9uL3ZjdDpoZWFsdGhjYXJlUHJvdmlkZXJPcmdhbmlzYXRpb25OYW1lIiAvPg0KICAgICAgICAgICAgPC94c2w6dmFyaWFibGU+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0icmVwb3J0SWQiIHNlbGVjdD0iLi4vZGk6cmVwb3J0SW5mb3JtYXRpb24vdmN0OmFjY2Vzc2lvbk51bWJlciIgLz4NCg0KICAgICAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJkb2N1bWVudExpbmsiIHNlbGVjdD0iLi4vZGk6cmVwb3J0SW5mb3JtYXRpb24vdmN0OmRvY3VtZW50TGluayIgLz4NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9InRyIj4NCiAgICAgICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0idGQiPiAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImNsYXNzIj5Hcm91cEVudHJpZXNUYWJsZUNlbGw8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6Y2FsbC10ZW1wbGF0ZSBuYW1lPSJmb3JtYXREYXRlIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJkYXRlIiBzZWxlY3Q9ImRpOmltYWdpbmdTZXJ2aWNlRGF0ZVRpbWUiLz4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCiAgICAgICAgICAgICAgICA8L3hzbDplbGVtZW50Pg0KICAgICAgICAgICAgICAgIDx4c2w6aWYgdGVzdD0iJGdyb3VwQnkgIT0gJ29yZ2FuaXNhdGlvbiciPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0idGQiID4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImNsYXNzIj5Hcm91cEVudHJpZXNUYWJsZUNlbGw8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJGRpT3JnYW5pc2F0aW9uIi8+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICAgICAgPC94c2w6aWY+DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9InRkIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY2xhc3MiPkdyb3VwRW50cmllc1RhYmxlQ2VsbDwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9ImNvZGVEZXNjcmlwdGlvbiI+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iY29kZSIgc2VsZWN0PSJkaTptb2RhbGl0eSIvPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPg0KICAgICAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9InRkIj4gICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+R3JvdXBFbnRyaWVzVGFibGVDZWxsPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSJ7JGRvY3VtZW50TGlua30iIGNsYXNzPSJkb2N1bWVudExpbmsiPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iY29kZURlc2NyaXB0aW9uIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJjb2RlIiBzZWxlY3Q9ImRpOmV4YW1pbmF0aW9uUmVzdWx0TmFtZSIvPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPg0KICAgICAgICAgICAgICAgICAgICA8L2E+DQogICAgICAgICAgICAgICAgPC94c2w6ZWxlbWVudD4NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0idGQiPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+R3JvdXBFbnRyaWVzVGFibGVDZWxsPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgPHVsIHN0eWxlPSdwYWRkaW5nLWxlZnQ6IDE1cHg7Jz4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDpmb3ItZWFjaCBzZWxlY3Q9ImRpOmFuYXRvbWljYWxTaXRlRGV0YWlscy9kaTphbmF0b21pY2FsTG9jYXRpb24iPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGxpPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6Y2FsbC10ZW1wbGF0ZSBuYW1lPSJjb2RlRGVzY3JpcHRpb24iPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iY29kZSIgc2VsZWN0PSJkaTphbmF0b21pY2FsTG9jYXRpb25OYW1lIi8+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmlmIHRlc3Q9ImNvdW50KGRpOmxhdGVyYWxpdHkpID4gMCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTogMTFweDsiPjxiPkxhdGVyYWxpdHk6IDwvYj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9ImNvZGVEZXNjcmlwdGlvbiI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iY29kZSIgc2VsZWN0PSJkaTpsYXRlcmFsaXR5Ii8+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOmNhbGwtdGVtcGxhdGU+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOmlmPiAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgICAgICAgICA8L2xpPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDpmb3ItZWFjaD4NCiAgICAgICAgICAgICAgICAgICAgPC91bD4NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIDwhLS0NCiAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9ImNvZGVEZXNjcmlwdGlvbiI+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iY29kZSIgc2VsZWN0PSJkaTphbmF0b21pY2FsU2l0ZURldGFpbHMvZGk6YW5hdG9taWNhbExvY2F0aW9uL2RpOmFuYXRvbWljYWxMb2NhdGlvbk5hbWUiLz4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCiAgICAgICAgICAgICAgICAgICAgLS0+DQogICAgICAgICAgICAgICAgPC94c2w6ZWxlbWVudD4NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICA8IS0tDQogICAgICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9InRkIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY2xhc3MiPkdyb3VwRW50cmllc1RhYmxlQ2VsbDwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9ImNvZGVEZXNjcmlwdGlvbiI+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iY29kZSIgc2VsZWN0PSJkaTphbmF0b21pY2FsU2l0ZURldGFpbHMvZGk6YW5hdG9taWNhbExvY2F0aW9uL2RpOmxhdGVyYWxpdHkiLz4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCiAgICAgICAgICAgICAgICA8L3hzbDplbGVtZW50Pg0KICAgICAgICAgICAgICAgIC0tPg0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDx4c2w6aWYgdGVzdD0iJGdyb3VwQnkgIT0gJ3JlcG9ydElkJyI+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJ0ZCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+R3JvdXBFbnRyaWVzVGFibGVDZWxsPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRyZXBvcnRJZCIvPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDplbGVtZW50Pg0KICAgICAgICAgICAgICAgIDwveHNsOmlmPg0KICAgICAgICAgICAgPC94c2w6ZWxlbWVudD4gICAgICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgPC94c2w6Zm9yLWVhY2g+DQogICAgPC94c2w6dGVtcGxhdGU+DQogICAgDQogICAgPHhzbDp0ZW1wbGF0ZSBuYW1lPSJwcm9jZXNzUGF0aFRhYmxlRW50cmllcyI+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0iZW50cmllcyIgLz4NCiAgICAgICAgDQogICAgICAgIDx4c2w6Zm9yLWVhY2ggc2VsZWN0PSIkZW50cmllcyI+ICAgICAgICAgICANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgPHhzbDpzb3J0IHNlbGVjdD0icGF0aDpzcGVjaW1lbkNvbGxlY3Rpb25EYXRlIiBvcmRlcj0iZGVzY2VuZGluZyIgLz4NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJwYXRoT3JnYW5pc2F0aW9uIj4NCiAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iLi4vcGF0aDpyZXBvcnRpbmdQYXRob2xvZ2lzdEluZm9ybWF0aW9uL3ZjdDpoZWFsdGhjYXJlUHJvdmlkZXJPcmdhbmlzYXRpb25OYW1lIiAvPg0KICAgICAgICAgICAgPC94c2w6dmFyaWFibGU+DQogICAgICAgICAgICANCiAgICAgICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0icmVxdWVzdGluZ09yZ2FuaXNhdGlvbiI+DQogICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9Ii4uL3BhdGg6dGVzdFJlcXVlc3RlckluZm9ybWF0aW9uL3ZjdDpwcm92aWRlck9yZ2FuaXNhdGlvbk5hbWUiIC8+DQogICAgICAgICAgICA8L3hzbDp2YXJpYWJsZT4NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJyZXBvcnRJZCIgc2VsZWN0PSIuLi9wYXRoOnJlcG9ydEluZm9ybWF0aW9uL3ZjdDpwYXRob2xvZ2lzdExvY2FsUmVwb3J0SWQiIC8+DQogICAgICAgICAgICANCiAgICAgICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iZG9jdW1lbnRMaW5rIiBzZWxlY3Q9Ii4uL3BhdGg6cmVwb3J0SW5mb3JtYXRpb24vdmN0OmRvY3VtZW50TGluayIgLz4NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9InRyIj4NCiAgICAgICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0idGQiPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+R3JvdXBFbnRyaWVzVGFibGVDZWxsPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iZm9ybWF0RGF0ZSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iZGF0ZSIgc2VsZWN0PSIuLi9wYXRoOnJlcG9ydEluZm9ybWF0aW9uL3ZjdDpDREFlZmZlY3RpdmVUaW1lIi8+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOmNhbGwtdGVtcGxhdGU+DQogICAgICAgICAgICAgICAgPC94c2w6ZWxlbWVudD4NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0idGQiPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+R3JvdXBFbnRyaWVzVGFibGVDZWxsPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iZm9ybWF0RGF0ZSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iZGF0ZSIgc2VsZWN0PSJwYXRoOnNwZWNpbWVuQ29sbGVjdGlvbkRhdGUiLz4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCiAgICAgICAgICAgICAgICA8L3hzbDplbGVtZW50Pg0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJ0ZCI+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImNsYXNzIj5Hcm91cEVudHJpZXNUYWJsZUNlbGw8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkcmVxdWVzdGluZ09yZ2FuaXNhdGlvbiIvPg0KICAgICAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDx4c2w6aWYgdGVzdD0iJGdyb3VwQnkgIT0gJ29yZ2FuaXNhdGlvbiciPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0idGQiID4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImNsYXNzIj5Hcm91cEVudHJpZXNUYWJsZUNlbGw8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJHBhdGhPcmdhbmlzYXRpb24iLz4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6ZWxlbWVudD4NCiAgICAgICAgICAgICAgICA8L3hzbDppZj4NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0idGQiPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+R3JvdXBFbnRyaWVzVGFibGVDZWxsPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iY29kZURlc2NyaXB0aW9uIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJjb2RlIiBzZWxlY3Q9InBhdGg6cGF0aG9sb2d5RGlzY2lwbGluZSIvPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPg0KICAgICAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9InRkIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY2xhc3MiPkdyb3VwRW50cmllc1RhYmxlQ2VsbDwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0ieyRkb2N1bWVudExpbmt9IiBjbGFzcz0iZG9jdW1lbnRMaW5rIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9ImNvZGVEZXNjcmlwdGlvbiI+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iY29kZSIgc2VsZWN0PSJwYXRoOnRlc3RSZXN1bHROYW1lIi8+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOmNhbGwtdGVtcGxhdGU+DQogICAgICAgICAgICAgICAgICAgIDwvYT4NCiAgICAgICAgICAgICAgICA8L3hzbDplbGVtZW50Pg0KDQogICAgICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9InRkIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY2xhc3MiPkdyb3VwRW50cmllc1RhYmxlQ2VsbDwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRyZXBvcnRJZCIvPg0KICAgICAgICAgICAgICAgIDwveHNsOmVsZW1lbnQ+DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICA8L3hzbDplbGVtZW50PiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIA0KICAgICAgICA8L3hzbDpmb3ItZWFjaD4NCiAgICA8L3hzbDp0ZW1wbGF0ZT4NCiAgICANCiAgICA8eHNsOnRlbXBsYXRlIG5hbWU9InByb2Nlc3NQYXRoU3RydWN0dXJlZEJvZHkiPiAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICA8eHNsOmlmIHRlc3Q9ImNvdW50KC8vcGF0aDpwYXRob2xvZ3lUZXN0UmVzdWx0KSA9IDAiPg0KICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDogMTBweDsgbWFyZ2luLWxlZnQ6IDEwcHg7IG1hcmdpbi1yaWdodDogMTBweDsiPg0KICAgICAgICAgICAgICAgIE5vIGluZm9ybWF0aW9uIGlzIGF2YWlsYWJsZS4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L3hzbDppZj4gICAgDQogICAgICAgICAgICANCiAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJoaWRkZW5Db3VudCIgc2VsZWN0PSJjb3VudCgvL3BhdGg6cGF0aG9sb2d5VGVzdFJlc3VsdA0KICAgICAgICAgICAgW25vdChjb250YWlucyh0cmFuc2xhdGUocGF0aDp0ZXN0UmVzdWx0TmFtZS92Y3Q6ZGlzcGxheU5hbWUsICR1cHBlckNhc2VDaGFyYWN0ZXJzLCAkbG93ZXJDYXNlQ2hhcmFjdGVycyksICRyZXN1bHROYW1lRmlsdGVyTG93ZXJjYXNlKSkgYW5kIA0KICAgICAgICAgICAgbm90KGNvbnRhaW5zKHRyYW5zbGF0ZShwYXRoOnRlc3RSZXN1bHROYW1lL3ZjdDpvcmlnaW5hbFRleHQsICR1cHBlckNhc2VDaGFyYWN0ZXJzLCAkbG93ZXJDYXNlQ2hhcmFjdGVycyksICRyZXN1bHROYW1lRmlsdGVyTG93ZXJjYXNlKSldKSIgLz4gDQogICAgICAgIDx4c2w6aWYgdGVzdD0iJGhpZGRlbkNvdW50ID4gMCI+DQogICAgICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOiAxMHB4OyBtYXJnaW4tbGVmdDogMTBweDsgbWFyZ2luLXJpZ2h0OiAxMHB4OyI+DQogICAgICAgICAgICAgICAgPGI+V2FybmluZzogPC9iPiANCiAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJGhpZGRlbkNvdW50IiAvPiByZWNvcmQocykgaGlkZGVuIGR1ZSB0byB0aGUgZmlsdGVyLiBSZW1vdmUgdGhlIGZpbHRlciB0byBzZWUgdGhlIGZ1bGwgbGlzdC4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L3hzbDppZj4gICAgICAgIA0KICAgICAgICANCiAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJGdyb3VwQnkgPSAnb3JnYW5pc2F0aW9uJyI+DQogICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9InByb2Nlc3NQYXRoR3JvdXBzIj4gICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJncm91cHMiIHNlbGVjdD0iL3BhdGg6cGF0aG9sb2d5UmVwb3J0Vmlld1Jlc3BvbnNlL3BhdGg6cGF0aG9sb2d5UmVwb3J0W2dlbmVyYXRlLWlkKC4pPWdlbmVyYXRlLWlkKA0KICAgICAgICAgICAgICAgICAgICAgICAga2V5KCdwYXRoT3JnYW5pc2F0aW9uTmFtZUtleScscGF0aDpyZXBvcnRpbmdQYXRob2xvZ2lzdEluZm9ybWF0aW9uL3ZjdDpoZWFsdGhjYXJlUHJvdmlkZXJPcmdhbmlzYXRpb25OYW1lKVsxXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIF0iIC8+IA0KICAgICAgICAgICAgICAgIDwveHNsOmNhbGwtdGVtcGxhdGU+DQogICAgICAgICAgICA8L3hzbDp3aGVuPiAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIDx4c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgIDx4c2w6Y2FsbC10ZW1wbGF0ZSBuYW1lPSJwcm9jZXNzUGF0aFRhYmxlIj4gICAgICAgDQogICAgICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJlbnRyaWVzIiBzZWxlY3Q9Ii9wYXRoOnBhdGhvbG9neVJlcG9ydFZpZXdSZXNwb25zZS9wYXRoOnBhdGhvbG9neVJlcG9ydC9wYXRoOnBhdGhvbG9neVRlc3RSZXN1bHQNCiAgICAgICAgICAgICAgICAgICAgICAgIFtjb250YWlucyh0cmFuc2xhdGUocGF0aDp0ZXN0UmVzdWx0TmFtZS92Y3Q6ZGlzcGxheU5hbWUsICR1cHBlckNhc2VDaGFyYWN0ZXJzLCAkbG93ZXJDYXNlQ2hhcmFjdGVycyksICRyZXN1bHROYW1lRmlsdGVyTG93ZXJjYXNlKSBvcg0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbnModHJhbnNsYXRlKHBhdGg6dGVzdFJlc3VsdE5hbWUvdmN0Om9yaWdpbmFsVGV4dCwgJHVwcGVyQ2FzZUNoYXJhY3RlcnMsICRsb3dlckNhc2VDaGFyYWN0ZXJzKSwgJHJlc3VsdE5hbWVGaWx0ZXJMb3dlcmNhc2UpXSIgLz4NCiAgICAgICAgICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPg0KICAgICAgICAgICAgPC94c2w6b3RoZXJ3aXNlPg0KICAgICAgICA8L3hzbDpjaG9vc2U+ICANCiAgICAgICAgDQogICAgICAgIDx4c2w6Y2FsbC10ZW1wbGF0ZSBuYW1lPSJnZXRHcm91cFNwYWNlciIvPg0KICAgIDwveHNsOnRlbXBsYXRlPg0KICAgIA0KICAgIDx4c2w6dGVtcGxhdGUgbmFtZT0icHJvY2Vzc1BhdGhUYWJsZSI+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0iZ3JvdXBOYW1lIiAvPg0KICAgICAgICA8eHNsOnBhcmFtIG5hbWU9ImVudHJpZXMiIC8+DQogICAgICAgICAgICAgICAgDQogICAgICAgIDx4c2w6aWYgdGVzdD0iY291bnQoJGVudHJpZXMpID4gMCI+DQogICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iZ2V0R3JvdXBTcGFjZXIiLz4NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgPGRpdiBjbGFzcz0iR3JvdXBUYWJsZUJvcmRlciI+DQogICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzPSJHcm91cFRhYmxlIiB3aWR0aD0iMTAwJSI+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6aWYgdGVzdD0iJGdyb3VwTmFtZSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8dGJvZHkgaWQ9Intjb25jYXQoJ0dyb3VwVGFibGVIZWFkaW5nSWQnLCBwb3NpdGlvbigpKX0iPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY2xhc3MiPkdyb3VwVGFibGVSb3c8L3hzbDphdHRyaWJ1dGU+ICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9Ikdyb3VwVGFibGVHcm91cE5hbWUiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJGdyb3VwQnkgPSAnb3JnYW5pc2F0aW9uJyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9yZ2FuaXNhdGlvbjogDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJGdyb3VwQnkgPSAncmVwb3J0SWQnIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVwb3J0IElEOiANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkZ3JvdXBCeSA9ICdyZXF1ZXN0ZXInIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVxdWVzdGluZyBQcm9mZXNzaW9uYWw6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxiPjx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkZ3JvdXBOYW1lIi8+PC9iPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3Rib2R5Pg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDppZj4gICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgPHhzbDppZiB0ZXN0PSIkZ3JvdXBOYW1lID0gJycgb3IgJGFkZEphdmFTY3JpcHQ9J3RydWUnIG9yICRjb2xsYXBzZWRHcm91cHM9J2ZhbHNlJyI+DQogICAgICAgICAgICAgICAgICAgICAgICA8dGJvZHkgaWQ9Intjb25jYXQoJ0dyb3VwVGFibGVCb2R5SWQnLCBwb3NpdGlvbigpKX0iPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJGdyb3VwTmFtZSBhbmQgKCRhZGRKYXZhU2NyaXB0PSd0cnVlJyBhbmQgJGNvbGxhcHNlZEdyb3Vwcz0ndHJ1ZScpIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9InN0eWxlIj5wYWRkaW5nOiAwcHg7IG1hcmdpbjogMHB4Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlci1zcGFjaW5nOiAwcHg7IGRpc3BsYXk6IG5vbmU7PC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9InN0eWxlIj5wYWRkaW5nOiAwcHg7IG1hcmdpbjogMHB4Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlci1zcGFjaW5nOiAwcHg7PC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iaGVhZGVyQ3NzU3R5bGUiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkZ3JvdXBOYW1lIj5Hcm91cEVudHJpZXNUYWJsZUNlbGw8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpvdGhlcndpc2U+R3JvdXBFbnRyaWVzVGFibGVDZWxsTm9Cb3JkZXI8L3hzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDp2YXJpYWJsZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHIgc3R5bGU9InBhZGRpbmc6IDBweDsgbWFyZ2luOiAwcHg7IGJvcmRlci1zcGFjaW5nOiAwcHgiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgc3R5bGU9InBhZGRpbmc6IDBweDsgbWFyZ2luOiAwcHg7IGJvcmRlci1zcGFjaW5nOiAwcHgiIGNvbHNwYW49IjEiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3M9Ikdyb3VwRW50cmllc1RhYmxlIiB3aWR0aD0iMTAwJSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoZWFkPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InskaGVhZGVyQ3NzU3R5bGV9IEdyb3VwRW50cmllc0RhdGUiPlJlcG9ydCBEYXRlPC90aD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0ieyRoZWFkZXJDc3NTdHlsZX0gR3JvdXBFbnRyaWVzRGF0ZSI+U3BlY2ltZW4gQ29sbGVjdGVkIERhdGU8L3RoPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDppZiB0ZXN0PSIkZ3JvdXBCeSAhPSAnb3JnYW5pc2F0aW9uJyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJ7JGhlYWRlckNzc1N0eWxlfSBHcm91cEVudHJpZXNPcmdhbmlzYXRpb24iPlBhdGhvbG9neSBPcmdhbmlzYXRpb248L3RoPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6aWY+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InskaGVhZGVyQ3NzU3R5bGV9IEdyb3VwRW50cmllc1N0YXR1cyI+UmVxdWVzdGluZyBPcmdhbmlzYXRpb248L3RoPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJ7JGhlYWRlckNzc1N0eWxlfSBHcm91cEVudHJpZXNTdGF0dXMiPlBhdGhvbG9neSBEaXNjaXBsaW5lPC90aD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0ieyRoZWFkZXJDc3NTdHlsZX0gR3JvdXBFbnRyaWVzTW9kYWxpdHkiPlRlc3QgUmVzdWx0IE5hbWU8L3RoPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDppZiB0ZXN0PSIkZ3JvdXBCeSAhPSAncmVwb3J0SWQnIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InskaGVhZGVyQ3NzU3R5bGV9IEdyb3VwRW50cmllc0FjY2Vzc2lvbk5vIj5SZXBvcnQgSUQ8L3RoPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6aWY+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90aGVhZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGJvZHkgc3R5bGU9InBhZGRpbmc6IDBweDsgbWFyZ2luOiAwcHg7IGJvcmRlci1zcGFjaW5nOiAwcHgiPiAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9InByb2Nlc3NQYXRoVGFibGVFbnRyaWVzIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJlbnRyaWVzIiBzZWxlY3Q9IiRlbnRyaWVzIiAvPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90Ym9keT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGFibGU+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RyPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC90Ym9keT4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6aWY+DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDwvdGFibGU+DQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC94c2w6aWY+DQogICAgICAgIA0KICAgIDwveHNsOnRlbXBsYXRlPg0KDQogICAgPCEtLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09LS0+DQogICAgPCEtLSBbRU5EXSBDREEgQk9EWSBURU1QTEFURVMgLS0+DQoNCiAgICA8IS0tIFNUUlVDVFVSRSBURU1QTEFURVMgLS0+DQogICAgPCEtLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09LS0+DQoNCiAgIDx4c2w6dGVtcGxhdGUgbmFtZT0iYWRkQ1NTIj4NCiAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9InN0eWxlIj4NCiAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9InR5cGUiPnRleHQvY3NzPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0ibWVkaWEiPmFsbDwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgIDwhLS0gQ1NTIGNsYXNzZXMgLS0+DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5uYnNwU3BhbiB7DQogICAgICAgICAgICAgICAgbWFyZ2luLWxlZnQ6IDRweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLnBhZ2VXaWR0aCB7IA0KICAgICAgICAgICAgICAgIG1pbi13aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRNSU5JTVVNX0NPTlRFTlRfV0lEVEhfUFgiLz5weDsNCiAgICAgICAgICAgICAgICBtYXgtd2lkdGg6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkRlVMTF9DT05URU5UX1dJRFRIX1BYIi8+cHg7DQogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC5wYWdlV2lkdGhXaXRoTGVmdE1hcmdpbiB7IA0KICAgICAgICAgICAgICAgIG1pbi13aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRNSU5JTVVNX0NPTlRFTlRfV0lEVEhfUFgiLz5weDsNCiAgICAgICAgICAgICAgICBtYXgtd2lkdGg6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkRlVMTF9DT05URU5UX1dJRFRIX1BYICsgJExFRlRfTUFSR0lOX1dJRFRIX1BYIi8+cHg7DQogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5oYWxmUGFnZVdpZHRoIHsgDQogICAgICAgICAgICAgICAgd2lkdGg6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkSEFMRl9DT05URU5UX1dJRFRIX1BYIi8+cHg7IA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLnF1YXJ0ZXJQYWdlV2lkdGggeyANCiAgICAgICAgICAgICAgICB3aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRRVUFSVEVSX0NPTlRFTlRfV0lEVEhfUFgiLz5weDsgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC5zZWN0aW9uUGFnZVdpZHRoIHsNCiAgICAgICAgICAgICAgICB3aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRGVUxMX0NPTlRFTlRfV0lEVEhfUENUIi8+JTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLnNlY3Rpb25QYWdlV2lkdGhNaW51c01hcmdpbiB7DQogICAgICAgICAgICAgICAgd2lkdGg6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkRlVMTF9DT05URU5UX1dJRFRIX1BDVCAtIDIiLz4lOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgDQogICAgICAgICAgICB1bCB7DQogICAgICAgICAgICAgICAgcGFkZGluZy10b3A6IDBweDsNCiAgICAgICAgICAgICAgICBtYXJnaW4tdG9wOiAwcHg7DQogICAgICAgICAgICAgICAgcGFkZGluZy1ib3R0b206IDBweDsNCiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAwcHg7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIG9sIHsNCiAgICAgICAgICAgICAgICBwYWRkaW5nLXRvcDogMHB4Ow0KICAgICAgICAgICAgICAgIG1hcmdpbi10b3A6IDBweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nLWJvdHRvbTogMHB4Ow0KICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDBweDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLnhGaXhlZCB7DQogICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6bW9ub3NwYWNlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAudW5kZXJsaW5lIHsNCiAgICAgICAgICAgICAgICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLm5vdW5kZXJsaW5lIHsNCiAgICAgICAgICAgICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5ib2xkIHsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLmVtcGhhc2lzIHsNCiAgICAgICAgICAgICAgICBmb250LXZhcmlhbnQ6IHNtYWxsLWNhcHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5pdGFsaWMgew0KICAgICAgICAgICAgICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLkxydWxlIHsNCiAgICAgICAgICAgICAgICBib3JkZXItbGVmdDogMXB4IFNPTElEICMwMDAwMDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5ScnVsZSB7DQogICAgICAgICAgICAgICAgYm9yZGVyLXJpZ2h0OiAxcHggU09MSUQgIzAwMDAwMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLmJvdHJ1bGUgew0KICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBTT0xJRCAjMDAwMDAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLnRvcHJ1bGUgew0KICAgICAgICAgICAgICAgIGJvcmRlci10b3A6IDFweCBTT0xJRCAjMDAwMDAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAubm9McnVsZSB7DQogICAgICAgICAgICAgICAgYm9yZGVyLWxlZnQ6IDFweCBTT0xJRCAjRUVFRUVFOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAubm9ScnVsZSB7DQogICAgICAgICAgICAgICAgYm9yZGVyLXJpZ2h0OiAxcHggU09MSUQgI0VFRUVFRTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLm5vQm90cnVsZSB7DQogICAgICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IFNPTElEICNFRUVFRUU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5ub1RvcHJ1bGUgew0KICAgICAgICAgICAgICAgIGJvcmRlci10b3A6IDFweCBTT0xJRCAjRUVFRUVFOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAucGFyYWdyYXBoIHsNCiAgICAgICAgICAgICAgICBib3JkZXItc3BhY2luZzogMHB4OyANCiAgICAgICAgICAgICAgICBwYWRkaW5nOiAwcHg7DQogICAgICAgICAgICAgICAgYm9yZGVyLXNwYWNpbmc6IDBweDsNCiAgICAgICAgICAgICAgICBlbXB0eS1jZWxsczogc2hvdzsNCiAgICAgICAgICAgICAgICBwYWdlLWJyZWFrLWluc2lkZTogYXZvaWQ7DQogICAgICAgICAgICAgICAgYm9yZGVyOiAwcHggU09MSUQgI0VFRUVFRTsgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLmhvcml6b250YWxzcGFjZXIgew0KICAgICAgICAgICAgICAgIGhlaWdodDogMTVweDsNCiAgICAgICAgICAgICAgICBib3JkZXItc3R5bGU6IG5vbmU7DQogICAgICAgICAgICAgICAgYm9yZGVyLXdpZHRoOiAxcHg7DQogICAgICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiAjRkZGRkZGOw0KICAgICAgICAgICAgICAgIG1pbi13aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRNSU5JTVVNX0NPTlRFTlRfV0lEVEhfUFgiLz5weDsNCiAgICAgICAgICAgICAgICBtYXgtd2lkdGg6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkRlVMTF9DT05URU5UX1dJRFRIX1BYICsgJExFRlRfTUFSR0lOX1dJRFRIX1BYIi8+cHg7DQogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7ICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC5ncm91cHNwYWNlciB7DQogICAgICAgICAgICAgICAgaGVpZ2h0OiA4cHg7DQogICAgICAgICAgICAgICAgYm9yZGVyLXN0eWxlOiBub25lOw0KICAgICAgICAgICAgICAgIGJvcmRlci13aWR0aDogMXB4Ow0KICAgICAgICAgICAgICAgIGJvcmRlci1jb2xvcjogI0ZGRkZGRjsNCiAgICAgICAgICAgICAgICBtaW4td2lkdGg6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkTUlOSU1VTV9DT05URU5UX1dJRFRIX1BYIi8+cHg7DQogICAgICAgICAgICAgICAgbWF4LXdpZHRoOiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJEZVTExfQ09OVEVOVF9XSURUSF9QWCArICRMRUZUX01BUkdJTl9XSURUSF9QWCIvPnB4Ow0KICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAlOyAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuaGkgew0KICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogOXB4Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAuPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRQUk9WSURFUl9JTkRJVklEVUFMX0lERU5USUZJRVJfQ1NTX0NMQVNTIi8+IHsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDlweDsNCiAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogMjBweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLjx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkUFJPVklERVJfT1JHQU5JU0FUSU9OX0lERU5USUZJRVJfQ1NTX0NMQVNTIi8+IHsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDlweDsNCiAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogMjBweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLjx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkUFJPVklERVJfREVWSUNFX0lERU5USUZJRVJfQ1NTX0NMQVNTIi8+IHsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDlweDsNCiAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogMjBweDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLmRvY3VtZW50aW5kaWNhdG9yIHsNCiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgICAgICBtYXgtd2lkdGg6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkRlVMTF9DT05URU5UX1dJRFRIX1BYIC0gMjAiLz5weDsNCiAgICAgICAgICAgICAgICBtaW4td2lkdGg6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkTUlOSU1VTV9DT05URU5UX1dJRFRIX1BYIC0gMjAiLz5weDsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nLWxlZnQ6IDEwcHg7DQogICAgICAgICAgICAgICAgcGFkZGluZy1yaWdodDogMTBweDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLmRvY3VtZW50aW5kaWNhdG9yY29sb3VycyB7DQogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogIzU1NTsNCiAgICAgICAgICAgICAgICBjb2xvcjogI0ZGRkZGRjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLmFkZHJlc3NkbCB7DQogICAgICAgICAgICAgICAgZGlzcGxheTogaW5saW5lOw0KICAgICAgICAgICAgICAgIG1hcmdpbjogMHB4Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBweDsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuYWRkcmVzc2R0IHsNCiAgICAgICAgICAgICAgICBtYXJnaW46IDBweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiAwcHg7DQogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLmFkZHJlc3NkZCB7DQogICAgICAgICAgICAgICAgZGlzcGxheTogaW5saW5lOw0KICAgICAgICAgICAgICAgIG1hcmdpbjogMHB4Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBweDsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAuY29udGFjdGRldGFpbHN1bCB7DQogICAgICAgICAgICAgICAgbGlzdC1zdHlsZS10eXBlOiBub25lOw0KICAgICAgICAgICAgICAgIG1hcmdpbjogMHB4Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nLWxlZnQ6IDA7DQogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLmNvbnRhY3RkZXRhaWxzbGkgew0KICAgICAgICAgICAgICAgIG1hcmdpbjogMHB4Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBweDsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuY29udGFjdGRldGFpbHNkbCB7DQogICAgICAgICAgICAgICAgZGlzcGxheTogaW5saW5lOw0KICAgICAgICAgICAgICAgIG1hcmdpbjogMHB4Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBweDsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuY29udGFjdGRldGFpbHNkdCB7DQogICAgICAgICAgICAgICAgbWFyZ2luOiAwcHg7DQogICAgICAgICAgICAgICAgcGFkZGluZzogMHB4Ow0KICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5jb250YWN0ZGV0YWlsc2RkIHsNCiAgICAgICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmU7DQogICAgICAgICAgICAgICAgbWFyZ2luOiAwcHg7DQogICAgICAgICAgICAgICAgcGFkZGluZzogMHB4Ow0KICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5zcGVjaWFsdGllc3VsIHsNCiAgICAgICAgICAgICAgICBsaXN0LXN0eWxlLXR5cGU6IG5vbmU7DQogICAgICAgICAgICAgICAgbWFyZ2luOiAwcHg7DQogICAgICAgICAgICAgICAgcGFkZGluZzogMHB4Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmctbGVmdDogMDsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuQkFOTkVSIHsNCiAgICAgICAgICAgICAgICB0b3A6IDBweDsNCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDAwMDAwOw0KICAgICAgICAgICAgICAgIGNvbG9yOiAjRkZGRkZGOw0KICAgICAgICAgICAgICAgIG1heC13aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRGVUxMX0NPTlRFTlRfV0lEVEhfUFgiLz5weDsNCiAgICAgICAgICAgICAgICBtaW4td2lkdGg6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkTUlOSU1VTV9DT05URU5UX1dJRFRIX1BYIi8+cHg7DQogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICAgICAgei1pbmRleDogMTAwMDA7DQogICAgICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOw0KICAgICAgICAgICAgICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsNCiAgICAgICAgICAgICAgICBoZWlnaHQ6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkQkFOTkVSX0hFSUdIVF9QWCIvPnB4Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAuQkFOTkVSX0JBQ0sgew0KICAgICAgICAgICAgICAgIHRvcDogMHB4Ow0KICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMwMDAwMDA7DQogICAgICAgICAgICAgICAgY29sb3I6ICNGRkZGRkY7DQogICAgICAgICAgICAgICAgbWF4LXdpZHRoOiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJEZVTExfQ09OVEVOVF9XSURUSF9QWCIvPnB4Ow0KICAgICAgICAgICAgICAgIG1pbi13aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRNSU5JTVVNX0NPTlRFTlRfV0lEVEhfUFgiLz5weDsNCiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgICAgICB6LWluZGV4OiAxMDAwMDsNCiAgICAgICAgICAgICAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7DQogICAgICAgICAgICAgICAgaGVpZ2h0OiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJEJBTk5FUl9IRUlHSFRfUFgiLz5weDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLmNsZWFyZml4OmFmdGVyIHtjb250ZW50OiAiLiI7IGRpc3BsYXk6IGJsb2NrOyBoZWlnaHQ6IDA7IGNsZWFyOiBib3RoOyB2aXNpYmlsaXR5OiBoaWRkZW47fQ0KICAgICAgICAgICAgLmNsZWFyZml4IHtkaXNwbGF5OiBpbmxpbmUtYmxvY2s7fQ0KICAgICAgICAgICAgLyogSGlkZXMgZnJvbSBJRS1tYWMgXCovDQogICAgICAgICAgICAqIGh0bWwgLmNsZWFyZml4IHtoZWlnaHQ6IDElO30NCiAgICAgICAgICAgIC5jbGVhcmZpeCB7ZGlzcGxheTogYmxvY2s7fQ0KICAgICAgICAgICAgLyogRW5kIGhpZGUgZnJvbSBJRS1tYWMgKi8NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLkJBTk5FUl9ET0NVTUVOVF9USVRMRV9ESVYgew0KICAgICAgICAgICAgICAgIHBhZGRpbmctdG9wOiA1cHg7DQogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgICAgICAgICAgbWFyZ2luIDBweDsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDE4cHg7DQogICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6IEhlbHZldGljYTsNCiAgICAgICAgICAgICAgICBjb2xvcjogI0ZGRkZGRjsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgICAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC5CQU5ORVJfUEFUSUVOVF9ERVRBSUxTX0RJViB7DQogICAgICAgICAgICAgICAgcGFkZGluZy10b3A6IDE1cHg7DQogICAgICAgICAgICAgICAgcGFkZGluZy1sZWZ0OiAxNXB4Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmctcmlnaHQ6IDE1cHg7DQogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgICAgICAgICAgIG92ZXJmbG93OiBhdXRvOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuQkFOTkVSX1ZJRVdfREVUQUlMU19ESVYgew0KICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgICAgICAgICAgICBwYWRkaW5nLXRvcDogNXB4Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmctbGVmdDogMTVweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nLXJpZ2h0OiAxNXB4Ow0KICAgICAgICAgICAgICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7ICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5iYW5uZXJEbCB7DQogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICAgICAgZGlzcGxheTogaW5saW5lOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuYmFubmVyRHQgew0KICAgICAgICAgICAgICAgIGRpc3BsYXk6IGlubGluZTsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDE0cHg7DQogICAgICAgICAgICAgICAgY29sb3I6ICNDQ0NDQ0M7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5iYW5uZXJEZCB7DQogICAgICAgICAgICAgICAgbWFyZ2luLWxlZnQ6IDBweDsNCiAgICAgICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmU7DQogICAgICAgICAgICAgICAgZm9udC1zaXplOiAxNHB4Ow0KICAgICAgICAgICAgICAgIG1hcmdpbi1yaWdodDogMzBweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLmF1dGhvck9yZ2FuaXNhdGlvbkNsYXNzIHsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDI2cHg7DQogICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6IEhlbHZldGljYTsNCiAgICAgICAgICAgICAgICBjb2xvcjogIzAwMDAwMDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLnNwYWNlZFNlY3Rpb24geyAgDQogICAgICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMHB4Ow0KICAgICAgICAgICAgICAgIG1hcmdpbi10b3A6IDBweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLmRldGFpbHNIYWxmVGFibGVIZWFkZXJEaXYgew0KICAgICAgICAgICAgICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsNCiAgICAgICAgICAgICAgICBjb2xvcjogIzAwMDAwMDsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAzcHg7DQogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICAgICAgd29yZC13cmFwOiBicmVhay13b3JkOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAuZGV0YWlsc0hhbGZUYWJsZSB7DQogICAgICAgICAgICAgICAgdGFibGUtbGF5b3V0OiBmaXhlZDsNCiAgICAgICAgICAgICAgICB3aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRGVUxMX0NPTlRFTlRfV0lEVEhfUENUIi8+JTsNCiAgICAgICAgICAgICAgICBzcGFjaW5nOiAwcHg7DQogICAgICAgICAgICAgICAgcGFkZGluZzogMHB4Ow0KICAgICAgICAgICAgICAgIGJvcmVyOiAwcHg7DQogICAgICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTVweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLmRldGFpbHNIYWxmVGFibGVUaCB7DQogICAgICAgICAgICAgICAgd2lkdGg6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkREVUQUlMU19IQUxGX1RBQkxFX1RIX1dJRFRIX1BDVCIvPiU7DQogICAgICAgICAgICAgICAgd29yZC13cmFwOiBicmVhay13b3JkOw0KICAgICAgICAgICAgICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7DQogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLmRldGFpbHNIYWxmVGFibGVUaFNwYW4gew0KICAgICAgICAgICAgICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsNCiAgICAgICAgICAgICAgICBmb250LXN0eWxlOiBub3JtYWw7DQogICAgICAgICAgICAgICAgY29sb3I6ICM5OTk5OTk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5kZXRhaWxzSGFsZlRhYmxlVGQgew0KICAgICAgICAgICAgICAgIHdpZHRoOiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJERFVEFJTFNfSEFMRl9UQUJMRV9URF9XSURUSF9QQ1QiLz4lOw0KICAgICAgICAgICAgICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsNCiAgICAgICAgICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KICAgICAgICAgICAgICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLmlkZW50aWZpZXIgew0KICAgICAgICAgICAgICAgIG1hcmdpbi1sZWZ0OiAyMHB4OyANCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDlweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLmRldGFpbHNUYWJsZSB7DQogICAgICAgICAgICAgICAgdGFibGUtbGF5b3V0OiBmaXhlZDsNCiAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogMHB4Ow0KICAgICAgICAgICAgICAgIG1hcmdpbi10b3A6IDBweDsNCiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAwcHg7DQogICAgICAgICAgICAgICAgYm9yZGVyLXRvcDogMHB4Ow0KICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBTT0xJRCAjMDAwMDAwOw0KICAgICAgICAgICAgICAgIHdpZHRoOiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJEZVTExfQ09OVEVOVF9XSURUSF9QQ1QiLz4lOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuZGV0YWlsc1RhYmxlVHIgew0KICAgICAgICAgICAgICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5kZXRhaWxzVGFibGVUZCB7DQogICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjojRjFGMUYxOw0KICAgICAgICAgICAgICAgIHdpZHRoOiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJEhBTEZfQ09OVEVOVF9XSURUSF9QQ1QiLz4lOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuZGV0YWlsc1RhYmxlVGggew0KICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6I0YxRjFGMTsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuc2VjdGlvbkhlYWRlciB7DQogICAgICAgICAgICAgICAgd2lkdGg6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkRlVMTF9DT05URU5UX1dJRFRIX1BDVCIvPiU7DQogICAgICAgICAgICAgICAgZm9udC1zaXplOiAxN3B4Ow0KICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgICAgIGNvbG9yOiAjMDAwMDAwOw0KICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDVweDsNCiAgICAgICAgICAgICAgICBtYXJnaW4tdG9wOiAwcHg7DQogICAgICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IFNPTElEICMwMDAwMDA7Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBweDsNCiAgICAgICAgICAgICAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5uZXN0ZWRTZWN0aW9uSGVhZGVyIHsNCiAgICAgICAgICAgICAgICB3aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRGVUxMX0NPTlRFTlRfV0lEVEhfUENUIC0gMiIvPiU7DQogICAgICAgICAgICAgICAgZm9udC1zaXplOiAxN3B4Ow0KICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgICAgIGNvbG9yOiAjMDAwMDAwOw0KICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDVweDsNCiAgICAgICAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggU09MSUQgIzAwMDAwMDs7DQogICAgICAgICAgICAgICAgd29yZC13cmFwOiBicmVhay13b3JkOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAucGFydGljaXBhbnRzSGVhZGVyIHsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDE3cHg7DQogICAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgICAgICAgICAgY29sb3I6ICMwMDAwMDA7DQogICAgICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogNXB4Ow0KICAgICAgICAgICAgICAgIG1hcmdpbi10b3A6IDBweDsNCiAgICAgICAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggU09MSUQgIzAwMDAwMDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiAwcHg7DQogICAgICAgICAgICAgICAgbWluLXdpZHRoOiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJE1JTklNVU1fQ09OVEVOVF9XSURUSF9QWCAtICgkTEVGVF9NQVJHSU5fV0lEVEhfUFggKyAkUklHSFRfTUFSR0lOX1dJRFRIX1BYKSIvPnB4Ow0KICAgICAgICAgICAgICAgIG1heC13aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRGVUxMX0NPTlRFTlRfV0lEVEhfUFggLSAoJExFRlRfTUFSR0lOX1dJRFRIX1BYICsgJFJJR0hUX01BUkdJTl9XSURUSF9QWCkiLz5weDsNCiAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRMRUZUX01BUkdJTl9XSURUSF9QWCIvPnB4Ow0KICAgICAgICAgICAgICAgIG1hcmdpbi1yaWdodDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRSSUdIVF9NQVJHSU5fV0lEVEhfUFgiLz5weA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAubGlzdFRhYmxlQ2FwdGlvbiB7DQogICAgICAgICAgICAgICAgZm9udC1zdHlsZTogaXRhbGljOw0KICAgICAgICAgICAgICAgIGNvbG9yOiAjOTk5OTk5Ow0KICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiA1cHggNXB4IDVweCAwcHg7DQogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLnBhcnRpY2lwYW50c1RhYmxlQ2xhc3Mgew0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBweDsNCiAgICAgICAgICAgICAgICBib3JkZXItc3BhY2luZzogMHB4Ow0KICAgICAgICAgICAgICAgIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7DQogICAgICAgICAgICAgICAgcGFnZS1icmVhay1pbnNpZGU6IGF2b2lkOw0KICAgICAgICAgICAgICAgIHRhYmxlLWxheW91dDogZml4ZWQ7DQogICAgICAgICAgICAgICAgd29yZC13cmFwOiBicmVhay13b3JkOw0KICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDE1cHg7DQogICAgICAgICAgICAgICAgbWluLXdpZHRoOiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJE1JTklNVU1fQ09OVEVOVF9XSURUSF9QWCAtICgkTEVGVF9NQVJHSU5fV0lEVEhfUFggKyAkUklHSFRfTUFSR0lOX1dJRFRIX1BYKSIvPnB4Ow0KICAgICAgICAgICAgICAgIG1heC13aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRGVUxMX0NPTlRFTlRfV0lEVEhfUFggLSAoJExFRlRfTUFSR0lOX1dJRFRIX1BYICsgJFJJR0hUX01BUkdJTl9XSURUSF9QWCkiLz5weDsNCiAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRMRUZUX01BUkdJTl9XSURUSF9QWCIvPnB4Ow0KICAgICAgICAgICAgICAgIG1hcmdpbi1yaWdodDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRSSUdIVF9NQVJHSU5fV0lEVEhfUFgiLz5weA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICA8IS0tIFNwZWNpZmljIGVsZW1lbnRzIC0tPg0KICAgICAgICAgICAgYm9keSB7IA0KICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICAgICAgICAgICAgICBmb250LWZhbWlseTogVmVyZGFuYSwgSGVsdmV0aWNhLCBTYW5zLVNlcmlmOw0KICAgICAgICAgICAgICAgIHBhZGRpbmc7IDBweDsNCiAgICAgICAgICAgICAgICBjb2xvcjogIzAwMDAwMDsNCiAgICAgICAgICAgICAgICBtYXJnaW46IDBweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiAwcHg7DQogICAgICAgICAgICAgICAgbWluLXdpZHRoOiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJE1JTklNVU1fQ09OVEVOVF9XSURUSF9QWCIvPnB4Ow0KICAgICAgICAgICAgICAgIG1heC13aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRGVUxMX0NPTlRFTlRfV0lEVEhfUFgiLz5weDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcHJlIHsNCiAgICAgICAgICAgICAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7DQogICAgICAgICAgICAgICAgd2hpdGUtc3BhY2U6IHByZS13cmFwOw0KICAgICAgICAgICAgICAgIG1hcmdpbjowcHg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHAuZGl2IHsNCiAgICAgICAgICAgICAgICB3aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRGVUxMX0NPTlRFTlRfV0lEVEhfUFgiLz5weDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYTpsaW5rIHsgDQogICAgICAgICAgICAgICAgY29sb3I6IGJsdWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGE6dmlzaXRlZCB7IA0KICAgICAgICAgICAgICAgIGNvbG9yOiBibHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBhOmhvdmVyIHsNCiAgICAgICAgICAgICAgICBjb2xvcjogcmVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBhOmFjdGl2ZSB7DQogICAgICAgICAgICAgICAgY29sb3I6IHJlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYS5hZ2VMaW5rIHsNCiAgICAgICAgICAgICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGEuYWdlTGluazpsaW5rIHsgDQogICAgICAgICAgICAgICAgY29sb3I6ICNGRkZGRkY7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGEuYWdlTGluazp2aXNpdGVkIHsgDQogICAgICAgICAgICAgICAgY29sb3I6ICNGRkZGRkY7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGEjYWdlTGluazpob3ZlciB7DQogICAgICAgICAgICAgICAgY29sb3I6ICNGRkZGRkY7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGEjYWdlTGluazphY3RpdmUgew0KICAgICAgICAgICAgICAgIGNvbG9yOiAjRkZGRkZGOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgPCEtLSBFbGVtZW50cyB3aXRoIGlkIGF0dHJpYnV0ZXMgLS0+DQoNCiAgICAgICAgICAgIC5IZWFkaW5nc1RhYmxlIHsNCiAgICAgICAgICAgICAgICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOw0KICAgICAgICAgICAgICAgIGJvcmRlci1yaWdodDogMHB4IFNPTElEIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkSEVBRElOR1NfVEFCTEVfQk9SREVSX0NPTE9VUiIvPjsNCiAgICAgICAgICAgICAgICBib3JkZXItbGVmdDogMHB4IFNPTElEIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkSEVBRElOR1NfVEFCTEVfQk9SREVSX0NPTE9VUiIvPjsNCiAgICAgICAgICAgICAgICBib3JkZXItYm90dG9tOiAwcHggU09MSUQgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRIRUFESU5HU19UQUJMRV9CT1JERVJfQ09MT1VSIi8+Ow0KICAgICAgICAgICAgICAgIGJvcmRlci10b3A6IDBweCBTT0xJRCA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJEhFQURJTkdTX1RBQkxFX0JPUkRFUl9DT0xPVVIiLz47DQogICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRkZGRjsNCiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAwcHg7DQogICAgICAgICAgICAgICAgbWFyZ2luLXRvcDogMHB4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuSGVhZGluZ3NUYWJsZURhdGVIZWFkaW5nIHsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDEwcHg7DQogICAgICAgICAgICAgICAgY29sb3I6ICM1NTU7DQogICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6IFZlcmRhbmE7DQogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiA1cHg7DQogICAgICAgICAgICAgICAgd2lkdGg6IDkwcHg7DQogICAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5IZWFkaW5nc1RhYmxlTWVkaWNpbmVEZXRhaWxzSGVhZGluZyB7DQogICAgICAgICAgICAgICAgZm9udC1zaXplOiAxMHB4Ow0KICAgICAgICAgICAgICAgIGNvbG9yOiAjNTU1Ow0KICAgICAgICAgICAgICAgIGZvbnQtZmFtaWx5OiBWZXJkYW5hOw0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDVweDsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuSGVhZGluZ3NUYWJsZUZpcnN0RGlzcGVuc2VIZWFkaW5nIHsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDEwcHg7DQogICAgICAgICAgICAgICAgY29sb3I6ICM1NTU7DQogICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6IFZlcmRhbmE7DQogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiA1cHg7DQogICAgICAgICAgICAgICAgd2lkdGg6IDkwcHg7DQogICAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5IZWFkaW5nc1RhYmxlTGFzdERpc3BlbnNlSGVhZGluZyB7DQogICAgICAgICAgICAgICAgZm9udC1zaXplOiAxMHB4Ow0KICAgICAgICAgICAgICAgIGNvbG9yOiAjNTU1Ow0KICAgICAgICAgICAgICAgIGZvbnQtZmFtaWx5OiBWZXJkYW5hOw0KICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICAgICAgICAgICAgcGFkZGluZzogNXB4Ow0KICAgICAgICAgICAgICAgIHdpZHRoOiA5MXB4Ow0KICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuSGVhZGluZ3NUYWJsZVN1cHBseUhlYWRpbmcgew0KICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTBweDsNCiAgICAgICAgICAgICAgICBjb2xvcjogIzU1NTsNCiAgICAgICAgICAgICAgICBmb250LWZhbWlseTogVmVyZGFuYTsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDVweDsNCiAgICAgICAgICAgICAgICB3aWR0aDogOTFweDsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLkhlYWRpbmdzVGFibGVHZW5lcmljTmFtZUhlYWRpbmcgew0KICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTBweDsNCiAgICAgICAgICAgICAgICBjb2xvcjogIzU1NTsNCiAgICAgICAgICAgICAgICBmb250LWZhbWlseTogVmVyZGFuYTsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDVweDsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLkhlYWRpbmdzVGFibGVCcmFuZE5hbWVIZWFkaW5nIHsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDEwcHg7DQogICAgICAgICAgICAgICAgY29sb3I6ICM1NTU7DQogICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6IFZlcmRhbmE7DQogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiA1cHg7DQogICAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5IZWFkaW5nc1RhYmxlUEJTSXRlbUNvZGVIZWFkaW5nIHsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDEwcHg7DQogICAgICAgICAgICAgICAgY29sb3I6ICM1NTU7DQogICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6IFZlcmRhbmE7DQogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiA1cHg7DQogICAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5Hcm91cFRhYmxlIHsgDQogICAgICAgICAgICAgICAgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsNCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJEdST1VQX1RBQkxFX0JBQ0tHUk9VTkRfQ09MT1VSIi8+Ow0KICAgICAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvOw0KICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDBweDsNCiAgICAgICAgICAgICAgICBtYXJnaW4tdG9wOiAwcHg7DQogICAgICAgICAgICAgICAgcGFkZGluZzogMHB4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuR3JvdXBUYWJsZUJvcmRlciB7DQogICAgICAgICAgICAgICAgYm9yZGVyLXJpZ2h0OiAxcHggU09MSUQgIzAwMDAwMDsNCiAgICAgICAgICAgICAgICBib3JkZXItbGVmdDogMXB4IFNPTElEICMwMDAwMDA7DQogICAgICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IFNPTElEICMwMDAwMDA7DQogICAgICAgICAgICAgICAgYm9yZGVyLXRvcDogMXB4IFNPTElEICMwMDAwMDA7DQogICAgICAgICAgICAgICAgbWFyZ2luLWxlZnQ6IDEwcHg7DQogICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAxMHB4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuR3JvdXBUYWJsZURhdGUgew0KICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7DQogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7DQogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgICAgICAgICB3aWR0aDogOTBweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiA1cHg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5Hcm91cFRhYmxlTWVkaWNpbmVEZXRhaWxzIHsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogbm9ybWFsOw0KICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgICAgICAgICB3aWR0aDogNTYwcHg7DQogICAgICAgICAgICAgICAgcGFkZGluZzogNXB4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICA8eHNsOmlmIHRlc3Q9IiRhZGRKYXZhU2NyaXB0PSd0cnVlJyI+DQogICAgICAgICAgICAgICAgLkdyb3VwVGFibGVSb3c6aG92ZXIgew0KICAgICAgICAgICAgICAgICAgICBjb2xvcjogcmVkOw0KICAgICAgICAgICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICA8L3hzbDppZj4NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLkdyb3VwVGFibGVGaXJzdERpc3BlbnNlIHsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogbm9ybWFsOw0KICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgICAgICAgICB3aWR0aDogOTBweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiA1cHg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5Hcm91cFRhYmxlTGFzdERpc3BlbnNlIHsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogbm9ybWFsOw0KICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgICAgICAgICB3aWR0aDogOTBweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiA1cHg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5Hcm91cFRhYmxlU3VwcGx5IHsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogbm9ybWFsOw0KICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgICAgICAgICB3aWR0aDogOTBweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiA1cHg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5Hcm91cFRhYmxlR3JvdXBOYW1lIHsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogbm9ybWFsOw0KICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiA1cHg7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC5Hcm91cFRhYmxlQnJhbmROYW1lIHsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogbm9ybWFsOw0KICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiA1cHg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5Hcm91cFRhYmxlUEJTSXRlbUNvZGUgew0KICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7DQogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICAgICAgICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDVweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLkdyb3VwVGFibGVOb0dyb3VwaW5nIHsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogbm9ybWFsOw0KICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiA1cHg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5Hcm91cFRhYmxlTm9JbmZvcm1hdGlvbiB7DQogICAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgICAgICAgICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7DQogICAgICAgICAgICAgICAgd2lkdGg6IDkwcHg7DQogICAgICAgICAgICAgICAgcGFkZGluZzogNXB4Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAuR3JvdXBFbnRyaWVzVGFibGUgew0KICAgICAgICAgICAgICAgIGJvcmRlci1yaWdodDogMHB4IFNPTElEICNGRkZGRkY7DQogICAgICAgICAgICAgICAgYm9yZGVyLWxlZnQ6IDBweCBTT0xJRCAjRkZGRkZGOw0KICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDBweCBTT0xJRCAjRkZGRkZGOw0KICAgICAgICAgICAgICAgIGJvcmRlci10b3A6IDBweCBTT0xJRCAjRkZGRkZGOw0KICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7DQogICAgICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMHB4Ow0KICAgICAgICAgICAgICAgIG1hcmdpbi10b3A6IDBweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiAwcHg7DQogICAgICAgICAgICAgICAgYm9yZGVyLXNwYWNpbmc6IDBweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLkdyb3VwRW50cmllc1RhYmxlQ2VsbE5vQm9yZGVyIHsNCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsgDQogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0OyANCiAgICAgICAgICAgICAgICBwYWRkaW5nLWxlZnQ6IDVweDsgDQogICAgICAgICAgICAgICAgcGFkZGluZy1yaWdodDogNXB4OyANCiAgICAgICAgICAgICAgICBwYWRkaW5nLXRvcDogMnB4Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAycHg7ICANCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgLkdyb3VwRW50cmllc1RhYmxlQ2VsbCB7IA0KICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOyANCiAgICAgICAgICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7IA0KICAgICAgICAgICAgICAgIHBhZGRpbmctbGVmdDogNXB4OyANCiAgICAgICAgICAgICAgICBwYWRkaW5nLXJpZ2h0OiA1cHg7IA0KICAgICAgICAgICAgICAgIHBhZGRpbmctdG9wOiAycHg7DQogICAgICAgICAgICAgICAgcGFkZGluZy1ib3R0b206IDJweDsgICAgIA0KICAgICAgICAgICAgICAgIGJvcmRlci10b3A6IDFweCBTT0xJRCAjMDAwMDAwOyANCiAgICAgICAgICAgICB9IA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgLkdyb3VwRW50cmllc0RhdGUgeyANCiAgICAgICAgICAgICAgICB3aWR0aDogOTBweDsgDQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5Hcm91cEVudHJpZXNPcmdhbmlzYXRpb24geyANCiAgICAgICAgICAgICAgICB3aWR0aDogMTgwcHg7IA0KICAgICAgICAgICAgfSANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLkdyb3VwRW50cmllc1JlcXVlc3RlciB7IA0KICAgICAgICAgICAgICAgIHdpZHRoOiAxMzBweDsgDQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5Hcm91cEVudHJpZXNTdGF0dXMgeyANCiAgICAgICAgICAgICAgICB3aWR0aDogOTBweDsgDQogICAgICAgICAgICB9IA0KICAgICAgICAgICAgDQogICAgICAgICAgICAuR3JvdXBFbnRyaWVzTW9kYWxpdHkgeyANCiAgICAgICAgICAgICAgICB3aWR0aDogMTIwcHg7IA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuR3JvdXBFbnRyaWVzRXhhbWluYXRpb24geyANCiAgICAgICAgICAgICAgICB3aWR0aDogMTAwcHg7IA0KICAgICAgICAgICAgfSANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLkdyb3VwRW50cmllc0FjY2Vzc2lvbk5vIHsgDQogICAgICAgICAgICAgICAgd2lkdGg6IDkwcHg7IA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICA8IS0tDQogICAgICAgICAgICAuR3JvdXBFbnRyaWVzVGFibGVFbnRyeURhdGUgew0KICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOw0KICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7DQogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7DQogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgICAgICAgICB3aWR0aDogOTBweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nLWxlZnQ6IDVweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nLXJpZ2h0OiA1cHg7DQogICAgICAgICAgICAgICAgcGFkZGluZy10b3A6IDJweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nLWJvdHRvbTogMnB4Ow0KICAgICAgICAgICAgICAgIGJvcmRlci10b3A6IDFweCBTT0xJRCAjMDAwMDAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAuR3JvdXBFbnRyaWVzVGFibGVFbnRyeVR5cGUgew0KICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOw0KICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7DQogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICAgICAgICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KICAgICAgICAgICAgICAgIHdpZHRoOiA5MHB4Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmctbGVmdDogNXB4Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmctcmlnaHQ6IDVweDsNCiAgICAgICAgICAgICAgICBwYWRkaW5nLXRvcDogMnB4Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAycHg7DQogICAgICAgICAgICAgICAgYm9yZGVyLXRvcDogMXB4IFNPTElEICMwMDAwMDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5Hcm91cEVudHJpZXNUYWJsZUVudHJ5RGV0YWlscyB7DQogICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7DQogICAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgICAgICAgICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7DQogICAgICAgICAgICAgICAgcGFkZGluZy1sZWZ0OiA1cHg7DQogICAgICAgICAgICAgICAgcGFkZGluZy1yaWdodDogNXB4Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmctdG9wOiAycHg7DQogICAgICAgICAgICAgICAgcGFkZGluZy1ib3R0b206IDJweDsNCiAgICAgICAgICAgICAgICBib3JkZXItdG9wOiAxcHggU09MSUQgIzAwMDAwMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgLS0+DQogICAgICAgICAgICANCiAgICAgICAgICAgIGEuZG9jdW1lbnRMaW5rIHsNCiAgICAgICAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsgICAgICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYS5kb2N1bWVudExpbms6bGluayB7IA0KICAgICAgICAgICAgY29sb3I6ICM2NjY2OTk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIDwhLS0NCiAgICAgICAgICAgIGEuZG9jdW1lbnRMaW5rOnZpc2l0ZWQgeyANCiAgICAgICAgICAgIGNvbG9yOiAjMDAwMDAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLS0+DQogICAgICAgICAgICANCiAgICAgICAgICAgIGEuZG9jdW1lbnRMaW5rOmhvdmVyIHsgDQogICAgICAgICAgICBjb2xvcjogIzk5OTlGRjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYS5kb2N1bWVudExpbms6YWN0aXZlIHsgDQogICAgICAgICAgICBjb2xvcjogI0ZGMDAwMDsNCiAgICAgICAgICAgIH0gICAgIA0KICAgICAgICA8L3hzbDplbGVtZW50PiA8IS0tICA8L3N0eWxlIHRleHQ9InRleHQvY3NzIiBtZWRpYT0iYWxsIj4gLS0+DQogICAgICAgIA0KICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0ic3R5bGUiPg0KICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0idHlwZSI+dGV4dC9jc3M8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJtZWRpYSI+c2NyZWVuPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgPCEtLSBDU1MgY2xhc3NlcyAtLT4NCiAgICAgICAgICAgIC5zaG93SGlkZUhlYWRlckRldGFpbHNCdXR0b25UYWJsZVJvdyB7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC5ERVRBSUxTIHsNCiAgICAgICAgICAgICAgICBtaW4td2lkdGg6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkTUlOSU1VTV9DT05URU5UX1dJRFRIX1BYIC0gKCRSSUdIVF9NQVJHSU5fV0lEVEhfUFggKyAkTEVGVF9NQVJHSU5fV0lEVEhfUFgpIi8+cHg7DQogICAgICAgICAgICAgICAgbWF4LXdpZHRoOiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJEZVTExfQ09OVEVOVF9XSURUSF9QWCAtICgkUklHSFRfTUFSR0lOX1dJRFRIX1BYICsgJExFRlRfTUFSR0lOX1dJRFRIX1BYKSIvPnB4Ow0KICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAlDQogICAgICAgICAgICAgICAgbWFyZ2luOiAwcHg7ICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGJvdHRvbTogMHB4OyANCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjRkZGRkZGOw0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBweCAwcHggMHB4IDBweDsNCiAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRMRUZUX01BUkdJTl9XSURUSF9QWCIvPnB4Ow0KICAgICAgICAgICAgICAgIG1hcmdpbi1yaWdodDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRSSUdIVF9NQVJHSU5fV0lEVEhfUFgiLz5weDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgPCEtLSBFbGVtZW50cyB3aXRoIGlkIGF0dHJpYnV0ZXMgLS0+DQogICAgICAgICAgICBkaXYjUk9PVCB7DQogICAgICAgICAgICAgICAgcG9zaXRpb246YWJzb2x1dGU7DQogICAgICAgICAgICAgICAgbWluLXdpZHRoOiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJE1JTklNVU1fQ09OVEVOVF9XSURUSF9QWCIvPnB4Ow0KICAgICAgICAgICAgICAgIG1heC13aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRGVUxMX1ZJRVdQT1JUX1dJRFRIX1BYIi8+cHg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5DT05URU5UIHsNCiAgICAgICAgICAgICAgICBtaW4td2lkdGg6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkTUlOSU1VTV9DT05URU5UX1dJRFRIX1BYIi8+cHg7DQogICAgICAgICAgICAgICAgbWF4LXdpZHRoOiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJEZVTExfQ09OVEVOVF9XSURUSF9QWCIvPnB4Ow0KICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAlDQogICAgICAgICAgICAgICAgbWFyZ2luOiAwcHg7ICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGJvdHRvbTogMHB4OyANCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjRkZGRkZGOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAuQk9EWSB7DQogICAgICAgICAgICAgICAgbWluLXdpZHRoOiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJE1JTklNVU1fQ09OVEVOVF9XSURUSF9QWCIvPnB4Ow0KICAgICAgICAgICAgICAgIG1heC13aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRGVUxMX1ZJRVdQT1JUX1dJRFRIX1BYIC0gKCRMRUZUX01BUkdJTl9XSURUSF9QWCArICRSSUdIVF9NQVJHSU5fV0lEVEhfUFgpIi8+cHg7DQogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCUNCiAgICAgICAgICAgICAgICBtYXJnaW46IDBweDsgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgYm90dG9tOiAwcHg7IA0KICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICNGRkZGRkY7DQogICAgICAgICAgICAgICAgcGFkZGluZzogMHB4IDBweCAwcHggMHB4Ow0KICAgICAgICAgICAgICAgIG1hcmdpbi1sZWZ0OiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJExFRlRfTUFSR0lOX1dJRFRIX1BYIi8+cHg7DQogICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJFJJR0hUX01BUkdJTl9XSURUSF9QWCIvPnB4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICA8L3hzbDplbGVtZW50PiA8IS0tICA8L3N0eWxlIHRleHQ9InRleHQvY3NzIiBtZWRpYT0ic2NyZWVuIj4gLS0+DQogICAgICAgIA0KICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0ic3R5bGUiPg0KICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0idHlwZSI+dGV4dC9jc3M8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJtZWRpYSI+cHJpbnQ8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAuQkFOTkVSIHsNCiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC5CQU5ORVJfQkFDSyB7DQogICAgICAgICAgICB0b3A6IDBweDsNCiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMwMDAwMDA7DQogICAgICAgICAgICBjb2xvcjogI0ZGRkZGRjsNCiAgICAgICAgICAgIG1heC13aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRGVUxMX0NPTlRFTlRfV0lEVEhfUFgiLz5weDsNCiAgICAgICAgICAgIG1pbi13aWR0aDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRNSU5JTVVNX0NPTlRFTlRfV0lEVEhfUFgiLz5weDsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgei1pbmRleDogMTAwMDA7DQogICAgICAgICAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7DQogICAgICAgICAgICBoZWlnaHQ6IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkQkFOTkVSX0hFSUdIVF9QWCIvPnB4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICA8L3hzbDplbGVtZW50PiA8IS0tICA8L3N0eWxlIHRleHQ9InRleHQvY3NzIiBtZWRpYT0icHJpbnQiPiAtLT4NCiAgIDwveHNsOnRlbXBsYXRlPg0KDQogICAgPHhzbDp0ZW1wbGF0ZSBuYW1lPSJnZXRIb3Jpem9udGFsU3BhY2VyIj4NCiAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9ImRpdiI+DQogICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+aG9yaXpvbnRhbHNwYWNlcjwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgPC94c2w6ZWxlbWVudD4NCiAgICA8L3hzbDp0ZW1wbGF0ZT4NCg0KICAgIDx4c2w6dGVtcGxhdGUgbmFtZT0iZ2V0R3JvdXBTcGFjZXIiPg0KICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0iZGl2Ij4NCiAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImNsYXNzIj5ncm91cHNwYWNlcjwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgPC94c2w6ZWxlbWVudD4NCiAgICA8L3hzbDp0ZW1wbGF0ZT4NCg0KICAgIDx4c2w6dGVtcGxhdGUgbmFtZT0iZ2V0U3RhcnRPZkRvY3VtZW50SW5kaWNhdG9yIj4NCiAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9ImdldERvY3VtZW50SW5kaWNhdG9yIj4NCiAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJpbmRpY2F0b3JUZXh0Ij5TVEFSVCBPRiBET0NVTUVOVDwveHNsOndpdGgtcGFyYW0+DQogICAgICAgIDwveHNsOmNhbGwtdGVtcGxhdGU+DQogICAgPC94c2w6dGVtcGxhdGU+DQoNCiAgICA8eHNsOnRlbXBsYXRlIG5hbWU9ImdldEVuZE9mRG9jdW1lbnRJbmRpY2F0b3IiPg0KICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iZ2V0RG9jdW1lbnRJbmRpY2F0b3IiPg0KICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9ImluZGljYXRvclRleHQiPkVORCBPRiBET0NVTUVOVDwveHNsOndpdGgtcGFyYW0+DQogICAgICAgIDwveHNsOmNhbGwtdGVtcGxhdGU+DQogICAgPC94c2w6dGVtcGxhdGU+DQoNCiAgICA8eHNsOnRlbXBsYXRlIG5hbWU9ImdldERvY3VtZW50SW5kaWNhdG9yIj4NCiAgICAgICAgPHhzbDpwYXJhbSBuYW1lPSJpbmRpY2F0b3JUZXh0Ii8+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0ibWFyZ2luVG9wIi8+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0ibWFyZ2luQm90dG9tIi8+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0icGFkZGluZ1RvcCIvPg0KICAgICAgICA8eHNsOnBhcmFtIG5hbWU9InBhZGRpbmdCb3R0b20iLz4NCiAgICAgICAgPHhzbDpwYXJhbSBuYW1lPSJiYWNrZ3JvdW5kQ29sb3VyIi8+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0idGV4dENvbG91ciIvPg0KICAgICAgICA8eHNsOnBhcmFtIG5hbWU9ImJvcmRlckNvbG91ciIvPg0KICAgICAgICA8eHNsOnBhcmFtIG5hbWU9ImZvbnRTaXplIi8+DQoNCiAgICAgICAgPHhzbDppZiB0ZXN0PSIkaW5kaWNhdG9yVGV4dCBhbmQNCiAgICAgICAgICAgICAgICAgICAgICBzdHJpbmctbGVuZ3RoKCRpbmRpY2F0b3JUZXh0KSAmZ3Q7IDAiPg0KICAgICAgICAgICAgPHhzbDplbGVtZW50IG5hbWU9ImRpdiI+DQogICAgICAgICAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbg0KICAgICAgICAgICAgICAgICAgICAgICAgdGVzdD0iKHN0cmluZy1sZW5ndGgoJGJhY2tncm91bmRDb2xvdXIpICZndDsgMCkgb3IgKHN0cmluZy1sZW5ndGgoJHRleHRDb2xvdXIpICZndDsgMCkiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDphdHRyaWJ1dGUgbmFtZT0iY2xhc3MiPmRvY3VtZW50aW5kaWNhdG9yPC94c2w6YXR0cmlidXRlPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6YXR0cmlidXRlIG5hbWU9ImNsYXNzIj5kb2N1bWVudGluZGljYXRvcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50aW5kaWNhdG9yY29sb3VyczwveHNsOmF0dHJpYnV0ZT4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJzdHlsZSI+Ym9yZGVyOiAwcHggU09MSUQgIzAwMDAwMDsgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJG1hcmdpblRvcCBhbmQgc3RyaW5nLWxlbmd0aCgkbWFyZ2luVG9wKSAmZ3Q7IDAiPm1hcmdpbi10b3A6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkbWFyZ2luVG9wIi8+cHg7PC94c2w6d2hlbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6b3RoZXJ3aXNlPm1hcmdpbi10b3A6IDBweDs8L3hzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJG1hcmdpbkJvdHRvbSBhbmQgc3RyaW5nLWxlbmd0aCgkbWFyZ2luQm90dG9tKSAmZ3Q7IDAiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPm1hcmdpbi1ib3R0b206IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkbWFyZ2luQm90dG9tIi8+cHg7PC94c2w6d2hlbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6b3RoZXJ3aXNlPm1hcmdpbi1ib3R0b206IDBweDs8L3hzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJHBhZGRpbmdCb3R0b20gYW5kIHN0cmluZy1sZW5ndGgoJHBhZGRpbmdCb3R0b20pICZndDsgMCINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA+cGFkZGluZy1ib3R0b206IDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkcGFkZGluZ0JvdHRvbSIvPnB4OzwveHNsOndoZW4+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOm90aGVyd2lzZT5wYWRkaW5nLWJvdHRvbTogMHB4OzwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkcGFkZGluZ1RvcCBhbmQgc3RyaW5nLWxlbmd0aCgkcGFkZGluZ1RvcCkgJmd0OyAwIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgID5wYWRkaW5nLXRvcDogPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRwYWRkaW5nVG9wIi8+cHg7PC94c2w6d2hlbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6b3RoZXJ3aXNlPnBhZGRpbmctdG9wOiAwcHg7PC94c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6aWYgdGVzdD0ic3RyaW5nLWxlbmd0aCgkYmFja2dyb3VuZENvbG91cikgJmd0OyAwIj5iYWNrZ3JvdW5kOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICM8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJGJhY2tncm91bmRDb2xvdXIiLz47PC94c2w6aWY+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6aWYgdGVzdD0ic3RyaW5nLWxlbmd0aCgkdGV4dENvbG91cikgJmd0OyAwIj5jb2xvcjogIzx4c2w6dmFsdWUtb2YNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Q9IiR0ZXh0Q29sb3VyIi8+OzwveHNsOmlmPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOmlmIHRlc3Q9InN0cmluZy1sZW5ndGgoJGZvbnRTaXplKSAmZ3Q7IDAiPmZvbnQtc2l6ZTogPHhzbDp2YWx1ZS1vZg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdD0iJGZvbnRTaXplIi8+cHg7PC94c2w6aWY+DQogICAgICAgICAgICAgICAgPC94c2w6YXR0cmlidXRlPg0KDQogICAgICAgICAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSJzdHJpbmctbGVuZ3RoKCRib3JkZXJDb2xvdXIpICZndDsgMCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmVsZW1lbnQgbmFtZT0iZGl2Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJzdHlsZSI+cGFkZGluZzogMHB4OyBtYXJnaW46IDBweDsgYm9yZGVyOiAycHggU09MSUQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICM8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJGJvcmRlckNvbG91ciIvPjs8L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRpbmRpY2F0b3JUZXh0Ii8+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDplbGVtZW50Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSA8L2Rpdj4gLS0+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRpbmRpY2F0b3JUZXh0Ii8+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgICAgICAgICA8L3hzbDplbGVtZW50Pg0KICAgICAgICAgICAgPCEtLSA8L2Rpdj4gLS0+DQogICAgICAgIDwveHNsOmlmPg0KICAgIDwveHNsOnRlbXBsYXRlPg0KDQogICAgPCEtLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09LS0+DQogICAgPCEtLSBbRU5EXSBTVFJVQ1RVUkUgVEVNUExBVEVTIC0tPg0KDQogICAgPCEtLSBVVElMSVRZIFRFTVBMQVRFUyAtLT4NCiAgICA8IS0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0tLT4NCg0KICAgIDx4c2w6dGVtcGxhdGUgbmFtZT0iZ2V0TGlua0hyZWYiPg0KICAgICAgICA8eHNsOnBhcmFtIG5hbWU9InJlY29yZExpbmtBY3QiLz4NCiAgICAgICAgDQogICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0icmVwb3NpdG9yeUlkIiBzZWxlY3Q9IiRyZWNvcmRMaW5rQWN0L2NkYTpyZWZlcmVuY2UvY2RhOmV4dGVybmFsQWN0L2NkYTppZC9Acm9vdCIvPg0KICAgICAgICA8eHNsOnZhcmlhYmxlIG5hbWU9ImRvY3VtZW50SWRSb290IiBzZWxlY3Q9IiRyZWNvcmRMaW5rQWN0L2NkYTpyZWZlcmVuY2UvY2RhOmV4dGVybmFsRG9jdW1lbnQvY2RhOmlkL0Byb290Ii8+DQogICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iZG9jdW1lbnRJZEV4dGVuc2lvbiIgc2VsZWN0PSIkcmVjb3JkTGlua0FjdC9jZGE6cmVmZXJlbmNlL2NkYTpleHRlcm5hbERvY3VtZW50L2NkYTppZC9AZXh0ZW5zaW9uIi8+DQogICAgICAgIA0KICAgICAgICA8eHNsOmNob29zZT4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSJzdHJpbmctbGVuZ3RoKCRkb2N1bWVudElkRXh0ZW5zaW9uKSAmZ3Q7IDAiPg0KICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSJjb25jYXQoJ3BjZWhyOicsJHJlcG9zaXRvcnlJZCwnLycsJGRvY3VtZW50SWRSb290LCdeJywkZG9jdW1lbnRJZEV4dGVuc2lvbikiLz4NCiAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICA8eHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iY29uY2F0KCdwY2VocjonLCRyZXBvc2l0b3J5SWQsJy8nLCRkb2N1bWVudElkUm9vdCkiLz4NCiAgICAgICAgICAgIDwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgPC94c2w6Y2hvb3NlPg0KICAgIDwveHNsOnRlbXBsYXRlPg0KDQogICAgPHhzbDp0ZW1wbGF0ZSBuYW1lPSJmb3JtYXROYW1lIj4NCiAgICAgICAgPHhzbDpwYXJhbSBuYW1lPSJuYW1lIi8+DQogICAgICAgIDx4c2w6aWYgdGVzdD0iJG5hbWUvdmN0Om5hbWVUaXRsZSE9JycgYW5kIHN0cmluZy1sZW5ndGgoJG5hbWUvdmN0Om5hbWVUaXRsZSkgJmd0OyAwIj4NCiAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkbmFtZS92Y3Q6bmFtZVRpdGxlIi8+DQogICAgICAgICAgICA8eHNsOnRleHQ+IDwveHNsOnRleHQ+DQogICAgICAgIDwveHNsOmlmPg0KICAgICAgICA8eHNsOmlmIHRlc3Q9IiRuYW1lL3ZjdDpnaXZlbk5hbWUhPScnIGFuZCBzdHJpbmctbGVuZ3RoKCRuYW1lL3ZjdDpnaXZlbk5hbWUpICZndDsgMCI+DQogICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJG5hbWUvdmN0OmdpdmVuTmFtZSIvPg0KICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICA8L3hzbDppZj4NCiAgICAgICAgPHhzbDppZiB0ZXN0PSIkbmFtZS92Y3Q6ZmFtaWx5TmFtZSE9JycgYW5kIHN0cmluZy1sZW5ndGgoJG5hbWUvdmN0OmZhbWlseU5hbWUpICZndDsgMCI+DQogICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJG5hbWUvdmN0OmZhbWlseU5hbWUiLz4NCiAgICAgICAgICAgIDx4c2w6dGV4dD4gPC94c2w6dGV4dD4NCiAgICAgICAgPC94c2w6aWY+DQogICAgPC94c2w6dGVtcGxhdGU+DQogICAgDQogICAgPHhzbDp0ZW1wbGF0ZSBuYW1lPSJjb2RlRGVzY3JpcHRpb24iPg0KICAgICAgICA8eHNsOnBhcmFtIG5hbWU9ImNvZGUiLz4NCiAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICA8eHNsOndoZW4NCiAgICAgICAgICAgICAgICB0ZXN0PSIkY29kZS92Y3Q6b3JpZ2luYWxUZXh0IT0nJyBhbmQgc3RyaW5nLWxlbmd0aCgkY29kZS92Y3Q6b3JpZ2luYWxUZXh0KSAmZ3Q7IDAiPg0KICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkY29kZS92Y3Q6b3JpZ2luYWxUZXh0Ii8+DQogICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgPHhzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRjb2RlL3ZjdDpkaXNwbGF5TmFtZSIvPg0KICAgICAgICAgICAgPC94c2w6b3RoZXJ3aXNlPg0KICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgPC94c2w6dGVtcGxhdGU+ICAgDQoNCiAgICA8eHNsOnRlbXBsYXRlIG5hbWU9InNob3ctcGF0aWVudC1uYW1lIj4NCiAgICAgICAgPHhzbDpwYXJhbSBuYW1lPSJuYW1lIi8+DQoNCiAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9InRyaW0iPg0KICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9InN0cmluZyI+DQogICAgICAgICAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbmFtZS9jY2U6ZmFtaWx5TmFtZSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmZvci1lYWNoIHNlbGVjdD0iJG5hbWUvY2NlOm5hbWVUaXRsZSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDppZiB0ZXN0PSJzdHJpbmctbGVuZ3RoKC4vdGV4dCgpKSAmZ3Q7IDAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iLi90ZXh0KCkiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOmlmPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6Zm9yLWVhY2g+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmZvci1lYWNoIHNlbGVjdD0iJG5hbWUvY2NlOmdpdmVuTmFtZSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDppZiB0ZXN0PSJzdHJpbmctbGVuZ3RoKC4vdGV4dCgpKSAmZ3Q7IDAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iLi90ZXh0KCkiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOmlmPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6Zm9yLWVhY2g+DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6Zm9yLWVhY2ggc2VsZWN0PSIkbmFtZS9jY2U6ZmFtaWx5TmFtZSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSJzdHJpbmctbGVuZ3RoKC4vdGV4dCgpKSAmZ3Q7IDAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9InRvVXBwZXJDYXNlIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iZGF0YSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIuL3RleHQoKSIvPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOndpdGgtcGFyYW0+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0ic3RyaW5nLWxlbmd0aCguL0BudWxsRmxhdm9yKSAmZ3Q7IDAiPiAoRmFtaWx5IG5hbWUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0ic2hvdy1udWxsLWZsYXZvci12YWx1ZSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9Im51bGxGbGF2b3JWYWx1ZSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIuL0BudWxsRmxhdm9yIi8+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6d2l0aC1wYXJhbT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOmNhbGwtdGVtcGxhdGU+KSA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOmZvci1lYWNoPg0KDQogICAgICAgICAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRuYW1lIi8+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgICAgICAgICA8L3hzbDp3aXRoLXBhcmFtPg0KICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPg0KICAgIDwveHNsOnRlbXBsYXRlPg0KDQogICAgPHhzbDp0ZW1wbGF0ZSBuYW1lPSJzaG93LW51bGwtZmxhdm9yLXZhbHVlIj4NCiAgICAgICAgPHhzbDpwYXJhbSBuYW1lPSJudWxsRmxhdm9yVmFsdWUiLz4NCiAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJG51bGxGbGF2b3JWYWx1ZT0nTkknIj4NCiAgICAgICAgICAgICAgICA8eHNsOnRleHQ+bm8gaW5mb3JtYXRpb248L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbnVsbEZsYXZvclZhbHVlPSdJTlYnIj4NCiAgICAgICAgICAgICAgICA8eHNsOnRleHQ+aW52YWxpZDwveHNsOnRleHQ+DQogICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRudWxsRmxhdm9yVmFsdWU9J0RFUiciPg0KICAgICAgICAgICAgICAgIDx4c2w6dGV4dD5kZXJpdmVkPC94c2w6dGV4dD4NCiAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJG51bGxGbGF2b3JWYWx1ZT0nTklORiciPg0KICAgICAgICAgICAgICAgIDx4c2w6dGV4dD5uZWdhdGl2ZSBpbmZpbml0eTwveHNsOnRleHQ+DQogICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRudWxsRmxhdm9yVmFsdWU9J1BJTkYnIj4NCiAgICAgICAgICAgICAgICA8eHNsOnRleHQ+cG9zaXRpdmUgaW5maW5pdHk8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbnVsbEZsYXZvclZhbHVlPSdVTkMnIj4NCiAgICAgICAgICAgICAgICA8eHNsOnRleHQ+dW4tZW5jb2RlZDwveHNsOnRleHQ+DQogICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRudWxsRmxhdm9yVmFsdWU9J01TSyciPg0KICAgICAgICAgICAgICAgIDx4c2w6dGV4dD5tYXNrZWQ8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbnVsbEZsYXZvclZhbHVlPSdOQSciPg0KICAgICAgICAgICAgICAgIDx4c2w6dGV4dD5ub3QgYXBwbGljYWJsZTwveHNsOnRleHQ+DQogICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRudWxsRmxhdm9yVmFsdWU9J1VOSyciPg0KICAgICAgICAgICAgICAgIDx4c2w6dGV4dD51bmtub3duPC94c2w6dGV4dD4NCiAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJG51bGxGbGF2b3JWYWx1ZT0nQVNLVSciPg0KICAgICAgICAgICAgICAgIDx4c2w6dGV4dD5hc2tlZCBidXQgdW5rbm93bjwveHNsOnRleHQ+DQogICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRudWxsRmxhdm9yVmFsdWU9J05BViciPg0KICAgICAgICAgICAgICAgIDx4c2w6dGV4dD50ZW1wb3JhcmlseSB1bmF2YWlsYWJsZTwveHNsOnRleHQ+DQogICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRudWxsRmxhdm9yVmFsdWU9J05BU0snIj4NCiAgICAgICAgICAgICAgICA8eHNsOnRleHQ+bm90IGFza2VkPC94c2w6dGV4dD4NCiAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJG51bGxGbGF2b3JWYWx1ZT0nUVMnIj4NCiAgICAgICAgICAgICAgICA8eHNsOnRleHQ+c3VmZmljaWVudCBxdWFudGl0eTwveHNsOnRleHQ+DQogICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRudWxsRmxhdm9yVmFsdWU9J1RSQyciPg0KICAgICAgICAgICAgICAgIDx4c2w6dGV4dD50cmFjZTwveHNsOnRleHQ+DQogICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRudWxsRmxhdm9yVmFsdWU9J05QJyI+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0Pm5vdCBwcmVzZW50PC94c2w6dGV4dD4NCiAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgIDwveHNsOmNob29zZT4NCiAgICA8L3hzbDp0ZW1wbGF0ZT4NCiAgICANCiAgICA8eHNsOnRlbXBsYXRlIG5hbWU9ImZvcm1hdERhdGUiPg0KICAgICAgICA8eHNsOnBhcmFtIG5hbWU9ImRhdGUiLz4NCg0KICAgICAgICA8IS0tIGRheSAtLT4NCiAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0ic3Vic3RyaW5nICgkZGF0ZSwgOSwgMSk9JzAnIj4NCiAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0ic3Vic3RyaW5nICgkZGF0ZSwgMTAsIDEpIi8+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSJzdHJpbmctbGVuZ3RoKHN1YnN0cmluZyAoJGRhdGUsIDksIDEpKSAmZ3Q7IDAiPg0KICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSJzdWJzdHJpbmcgKCRkYXRlLCA5LCAyKSIvPg0KICAgICAgICAgICAgICAgIDx4c2w6dGV4dD4gPC94c2w6dGV4dD4NCiAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICA8eHNsOm90aGVyd2lzZS8+DQogICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgPCEtLSBtb250aCAtLT4NCiAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJtb250aCIgc2VsZWN0PSJzdWJzdHJpbmcgKCRkYXRlLCA2LCAyKSIvPg0KICAgICAgICA8eHNsOmNob29zZT4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbW9udGg9JzAxJyI+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PkphbjwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbW9udGg9JzAyJyI+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PkZlYjwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbW9udGg9JzAzJyI+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0Pk1hcjwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbW9udGg9JzA0JyI+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PkFwcjwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbW9udGg9JzA1JyI+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0Pk1heTwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbW9udGg9JzA2JyI+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0Pkp1bjwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbW9udGg9JzA3JyI+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0Pkp1bDwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbW9udGg9JzA4JyI+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PkF1ZzwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbW9udGg9JzA5JyI+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PlNlcDwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbW9udGg9JzEwJyI+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0Pk9jdDwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbW9udGg9JzExJyI+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0Pk5vdjwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkbW9udGg9JzEyJyI+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PkRlYzwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgPC94c2w6Y2hvb3NlPg0KICAgICAgICA8IS0tIHllYXIgLS0+DQogICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSJzdWJzdHJpbmcgKCRkYXRlLCAxLCA0KSIvPg0KICAgIDwveHNsOnRlbXBsYXRlPg0KDQogICAgPHhzbDp0ZW1wbGF0ZSBuYW1lPSJ0b1VwcGVyQ2FzZSI+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0iZGF0YSIvPg0KDQogICAgICAgIDx4c2w6aWYgdGVzdD0iJGRhdGEiPg0KICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZg0KICAgICAgICAgICAgICAgIHNlbGVjdD0idHJhbnNsYXRlKCRkYXRhLCdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicsICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWicpIg0KICAgICAgICAgICAgLz4NCiAgICAgICAgPC94c2w6aWY+DQogICAgPC94c2w6dGVtcGxhdGU+DQoNCiAgICA8eHNsOnRlbXBsYXRlIG5hbWU9ImNhbGN1bGF0ZUFnZSI+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0iYmlydGhEYXRlIi8+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0iZG9jRGF0ZSIvPg0KDQogICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iYmlydGhZZWFyIiBzZWxlY3Q9InN1YnN0cmluZygkYmlydGhEYXRlLDEsNCkiLz4NCiAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJiaXJ0aE1vbnRoIiBzZWxlY3Q9InN1YnN0cmluZygkYmlydGhEYXRlLDYsMikiLz4NCiAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJiaXJ0aERheSIgc2VsZWN0PSJzdWJzdHJpbmcoJGJpcnRoRGF0ZSw5LDIpIi8+DQogICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iY3VycmVudFllYXIiIHNlbGVjdD0ic3Vic3RyaW5nKCRkb2NEYXRlLDEsNCkiLz4NCiAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJjdXJyZW50TW9udGgiIHNlbGVjdD0ic3Vic3RyaW5nKCRkb2NEYXRlLDYsMikiLz4NCiAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJjdXJyZW50RGF5IiBzZWxlY3Q9InN1YnN0cmluZygkZG9jRGF0ZSw5LDIpIi8+DQoNCiAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJzdGFydEFnZSIgc2VsZWN0PSIkY3VycmVudFllYXIgLSAkYmlydGhZZWFyIi8+DQogICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRjdXJyZW50TW9udGggJmx0OyAkYmlydGhNb250aCI+DQogICAgICAgICAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJhZ2UiIHNlbGVjdD0iJHN0YXJ0QWdlIC0gMSIvPg0KICAgICAgICAgICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJGFnZSAmbHQ7IDIiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9ImNhbGN1bGF0ZURheXNXZWVrc01vbnRocyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9ImJpcnRoRGF0ZSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkYmlydGhEYXRlIi8+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6d2l0aC1wYXJhbT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iZG9jRGF0ZSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkZG9jRGF0ZSIvPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOndpdGgtcGFyYW0+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkYWdlIi8+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnRleHQ+eTwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRjdXJyZW50TW9udGggPSAkYmlydGhNb250aCI+DQogICAgICAgICAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkY3VycmVudERheSAmbHQ7ICRiaXJ0aERheSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhcmlhYmxlIG5hbWU9ImFnZSIgc2VsZWN0PSIkc3RhcnRBZ2UgLSAxIi8+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJGFnZSAmbHQ7IDIiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iY2FsY3VsYXRlRGF5c1dlZWtzTW9udGhzIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJiaXJ0aERhdGUiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkYmlydGhEYXRlIi8+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aXRoLXBhcmFtPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9ImRvY0RhdGUiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkZG9jRGF0ZSIvPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6d2l0aC1wYXJhbT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJGFnZSIvPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnRleHQ+eTwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iYWdlIiBzZWxlY3Q9IiRzdGFydEFnZSIvPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRhZ2UgJmx0OyAyIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9ImNhbGN1bGF0ZURheXNXZWVrc01vbnRocyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iYmlydGhEYXRlIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJGJpcnRoRGF0ZSIvPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6d2l0aC1wYXJhbT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJkb2NEYXRlIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJGRvY0RhdGUiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOndpdGgtcGFyYW0+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOmNhbGwtdGVtcGxhdGU+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRhZ2UiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp0ZXh0Pnk8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6b3RoZXJ3aXNlPg0KDQogICAgICAgICAgICAgICAgPC94c2w6Y2hvb3NlPg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iYWdlIiBzZWxlY3Q9IiRzdGFydEFnZSIvPg0KICAgICAgICAgICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJGFnZSAmbHQ7IDIiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9ImNhbGN1bGF0ZURheXNXZWVrc01vbnRocyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9ImJpcnRoRGF0ZSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkYmlydGhEYXRlIi8+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6d2l0aC1wYXJhbT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0iZG9jRGF0ZSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkZG9jRGF0ZSIvPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOndpdGgtcGFyYW0+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkYWdlIi8+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnRleHQ+eTwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgICAgICAgICA8L3hzbDpvdGhlcndpc2U+DQogICAgICAgIDwveHNsOmNob29zZT4NCiAgICA8L3hzbDp0ZW1wbGF0ZT4NCg0KICAgIDx4c2w6dGVtcGxhdGUgbmFtZT0iY2FsY3VsYXRlRGF5c1dlZWtzTW9udGhzIj4NCiAgICAgICAgPHhzbDpwYXJhbSBuYW1lPSJiaXJ0aERhdGUiLz4NCiAgICAgICAgPHhzbDpwYXJhbSBuYW1lPSJkb2NEYXRlIi8+DQoNCiAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJiaXJ0aFllYXIiIHNlbGVjdD0ic3Vic3RyaW5nKCRiaXJ0aERhdGUsMSw0KSIvPg0KICAgICAgICA8eHNsOnZhcmlhYmxlIG5hbWU9ImJpcnRoTW9udGgiIHNlbGVjdD0ic3Vic3RyaW5nKCRiaXJ0aERhdGUsNiwyKSIvPg0KICAgICAgICA8eHNsOnZhcmlhYmxlIG5hbWU9ImJpcnRoRGF5IiBzZWxlY3Q9InN1YnN0cmluZygkYmlydGhEYXRlLDksMikiLz4NCiAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJjdXJyZW50WWVhciIgc2VsZWN0PSJzdWJzdHJpbmcoJGRvY0RhdGUsMSw0KSIvPg0KICAgICAgICA8eHNsOnZhcmlhYmxlIG5hbWU9ImN1cnJlbnRNb250aCIgc2VsZWN0PSJzdWJzdHJpbmcoJGRvY0RhdGUsNiwyKSIvPg0KICAgICAgICA8eHNsOnZhcmlhYmxlIG5hbWU9ImN1cnJlbnREYXkiIHNlbGVjdD0ic3Vic3RyaW5nKCRkb2NEYXRlLDksMikiLz4NCiAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJiaXJ0aE1vbnRoRGF5cyI+DQogICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iZGF5c0luTW9udGgiPg0KICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJtb250aCI+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkYmlydGhNb250aCIvPg0KICAgICAgICAgICAgICAgIDwveHNsOndpdGgtcGFyYW0+DQogICAgICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPg0KICAgICAgICA8L3hzbDp2YXJpYWJsZT4NCg0KICAgICAgICA8eHNsOnZhcmlhYmxlIG5hbWU9InN0YXJ0QWdlIiBzZWxlY3Q9IiRjdXJyZW50WWVhciAtICRiaXJ0aFllYXIiLz4NCiAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICA8IS0tIFNBTUUgWUVBUiAtLT4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkY3VycmVudFllYXIgPSAkYmlydGhZZWFyIj4NCiAgICAgICAgICAgICAgICA8eHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgPCEtLSBTQU1FIE1PTlRIIC0tPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iKCRjdXJyZW50TW9udGggPSAkYmlydGhNb250aCkiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IigkY3VycmVudERheSAtICRiaXJ0aERheSkgJmx0OyA3Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRjdXJyZW50RGF5IC0gJGJpcnRoRGF5Ii8+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dGV4dD5kPC94c2w6dGV4dD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iZmxvb3IoKCRjdXJyZW50RGF5IC0gJGJpcnRoRGF5KSBkaXYgNykiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp0ZXh0Pnc8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgICAgICAgICAgPCEtLSBESUZGIE1PTlRIIC0tPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0ibnVtRGF5cyINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Q9IigkYmlydGhNb250aERheXMgLSAkYmlydGhEYXkpICsgJGN1cnJlbnREYXkiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIoKCRjdXJyZW50TW9udGggLSAkYmlydGhNb250aCkgPSAxKSBhbmQgbnVtRGF5cyAmbHQ7IDciPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJG51bURheXMiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp0ZXh0PmQ8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IigkY3VycmVudE1vbnRoIC0gJGJpcnRoTW9udGgpID0gMSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSJmbG9vcigkbnVtRGF5cyBkaXYgNykiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp0ZXh0Pnc8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IigkY3VycmVudE1vbnRoIC0gJGJpcnRoTW9udGgpID0gMiI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0gR2V0IGRheXMgb2YgbWlkZGxlIG1vbnRoIC0tPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhcmlhYmxlIG5hbWU9Im1pZGRsZU1vbnRoRGF5cyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iZGF5c0luTW9udGgiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJtb250aCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkYmlydGhNb250aCArIDEiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aXRoLXBhcmFtPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6dmFyaWFibGU+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0idG90YWxOdW1EYXlzIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0PSIkbnVtRGF5cyArICRtaWRkbGVNb250aERheXMiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iJHRvdGFsTnVtRGF5cyAmbHQ7IDU2Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iZmxvb3IoJHRvdGFsTnVtRGF5cyBkaXYgNykiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnRleHQ+dzwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp0ZXh0PjJtPC94c2w6dGV4dD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkY3VycmVudE1vbnRoIC0gJGJpcnRoTW9udGgiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp0ZXh0Pm08L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgPC94c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgIDwveHNsOmNob29zZT4NCiAgICAgICAgICAgIDwveHNsOndoZW4+DQoNCiAgICAgICAgICAgIDwhLS0gRElGRiBZRUFSIC0tPg0KICAgICAgICAgICAgPHhzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJ0b3RhbE1vbnRoRGlmZiINCiAgICAgICAgICAgICAgICAgICAgc2VsZWN0PSIoKCRjdXJyZW50WWVhciAtICRiaXJ0aFllYXIpICogMTIpICsgJGN1cnJlbnRNb250aCAtICRiaXJ0aE1vbnRoIi8+DQogICAgICAgICAgICAgICAgPHhzbDp2YXJpYWJsZSBuYW1lPSJudW1EYXlzIiBzZWxlY3Q9IigkYmlydGhNb250aERheXMgLSAkYmlydGhEYXkpICsgJGN1cnJlbnREYXkiLz4NCiAgICAgICAgICAgICAgICA8eHNsOmNob29zZT4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IigkdG90YWxNb250aERpZmYgPSAxKSBhbmQgKCRudW1EYXlzICZsdDsgNykiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRudW1EYXlzIi8+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnRleHQ+ZDwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIoJHRvdGFsTW9udGhEaWZmID0gMSkiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9ImZsb29yKCRudW1EYXlzIGRpdiA3KSIvPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp0ZXh0Pnc8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0iKCR0b3RhbE1vbnRoRGlmZiA9IDIpIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0gR2V0IGRheXMgb2YgbWlkZGxlIG1vbnRoLiBJZiBEZWMsIHRoaXMgaW5jcmVtZW50IHRvIDEzLCB3aWxsIGRlZmF1bHQgdG8gMzEgZGF5cyB3aGljaCBpcyBKYW4gLS0+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhcmlhYmxlIG5hbWU9Im1pZGRsZU1vbnRoRGF5cyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9ImRheXNJbk1vbnRoIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9Im1vbnRoIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkYmlydGhNb250aCArIDEiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6d2l0aC1wYXJhbT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDpjYWxsLXRlbXBsYXRlPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6dmFyaWFibGU+DQogICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhcmlhYmxlIG5hbWU9InRvdGFsTnVtRGF5cyIgc2VsZWN0PSIkbnVtRGF5cyArICRtaWRkbGVNb250aERheXMiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkdG90YWxOdW1EYXlzICZsdDsgNTYiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iZmxvb3IoJHRvdGFsTnVtRGF5cyBkaXYgNykiLz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp0ZXh0Pnc8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dGV4dD4ybTwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSIkY3VycmVudERheSAmbHQ7ICRiaXJ0aERheSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkdG90YWxNb250aERpZmYgLSAxIi8+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dGV4dD5tPC94c2w6dGV4dD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6b3RoZXJ3aXNlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJHRvdGFsTW9udGhEaWZmIi8+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dGV4dD5tPC94c2w6dGV4dD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgICAgICAgICA8L3hzbDpvdGhlcndpc2U+DQogICAgICAgIDwveHNsOmNob29zZT4NCiAgICA8L3hzbDp0ZW1wbGF0ZT4NCg0KICAgIDx4c2w6dGVtcGxhdGUgbmFtZT0iZGF5c0luTW9udGgiPg0KICAgICAgICA8eHNsOnBhcmFtIG5hbWU9Im1vbnRoIi8+DQogICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9IiRtb250aCA9ICcwMicgb3IgbW9udGggPSAyIj4NCiAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iMjgiLz4NCiAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICA8eHNsOndoZW4NCiAgICAgICAgICAgICAgICB0ZXN0PSIkbW9udGggPSAnMDQnIG9yICRtb250aCA9ICcwNicgb3IgJG1vbnRoID0gJzA5JyBvciAkbW9udGggPSAnMTEnIG9yICRtb250aCA9IDQgb3IgJG1vbnRoID0gNiBvciAkbW9udGggPSA5IG9yICRtb250aCA9IDExIj4NCiAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iMzAiLz4NCiAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICA8eHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iMzEiLz4NCiAgICAgICAgICAgIDwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgPC94c2w6Y2hvb3NlPg0KICAgIDwveHNsOnRlbXBsYXRlPg0KDQogICAgPHhzbDp0ZW1wbGF0ZSBuYW1lPSJmb3JtYXRISSI+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0iaGlWYWx1ZSIvPg0KICAgICAgICA8eHNsOmlmIHRlc3Q9IiRoaVZhbHVlIj4NCiAgICAgICAgICAgIDx4c2w6dmFyaWFibGUgbmFtZT0iaWRlbnRpZmllciI+DQogICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9InRyaW0iPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0ic3RyaW5nIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSJzdHJpbmctbGVuZ3RoKCRoaVZhbHVlKSAmZ3Q7IDE2Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0PSJzdWJzdHJpbmcoJGhpVmFsdWUsIHN0cmluZy1sZW5ndGgoJGhpVmFsdWUpLTE1LCBzdHJpbmctbGVuZ3RoKCRoaVZhbHVlKSkiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8eHNsOndoZW4gdGVzdD0ic3RyaW5nLWxlbmd0aCgkaGlWYWx1ZSkgPSAxNiI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSIkaGlWYWx1ZSIvPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgICAgICAgICAgICAgICAgIDwveHNsOndpdGgtcGFyYW0+DQogICAgICAgICAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCiAgICAgICAgICAgIDwveHNsOnZhcmlhYmxlPg0KICAgICAgICAgICAgPHhzbDppZiB0ZXN0PSJzdHJpbmctbGVuZ3RoKCRpZGVudGlmaWVyKT0xNiI+DQogICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9InN1YnN0cmluZygkaWRlbnRpZmllciwxLDQpIi8+DQogICAgICAgICAgICAgICAgPHhzbDp0ZXh0PiA8L3hzbDp0ZXh0Pg0KICAgICAgICAgICAgICAgIDx4c2w6dmFsdWUtb2Ygc2VsZWN0PSJzdWJzdHJpbmcoJGlkZW50aWZpZXIsNSw0KSIvPg0KICAgICAgICAgICAgICAgIDx4c2w6dGV4dD4gPC94c2w6dGV4dD4NCiAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0ic3Vic3RyaW5nKCRpZGVudGlmaWVyLDksNCkiLz4NCiAgICAgICAgICAgICAgICA8eHNsOnRleHQ+IDwveHNsOnRleHQ+DQogICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9InN1YnN0cmluZygkaWRlbnRpZmllciwxMyw0KSIvPg0KICAgICAgICAgICAgPC94c2w6aWY+DQogICAgICAgIDwveHNsOmlmPg0KICAgIDwveHNsOnRlbXBsYXRlPg0KDQogICAgPHhzbDp0ZW1wbGF0ZSBuYW1lPSJwcmludE5CU1BzIj4NCiAgICAgICAgPHhzbDpwYXJhbSBuYW1lPSJudW1iZXIiLz4NCg0KICAgICAgICA8eHNsOmlmIHRlc3Q9IiRudW1iZXIgJmd0OyAwIj4NCiAgICAgICAgICAgIDx4c2w6ZWxlbWVudCBuYW1lPSJzcGFuIj4NCiAgICAgICAgICAgICAgICA8eHNsOmF0dHJpYnV0ZSBuYW1lPSJjbGFzcyI+bmJzcFNwYW48L3hzbDphdHRyaWJ1dGU+DQogICAgICAgICAgICA8L3hzbDplbGVtZW50Pg0KICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9InByaW50TkJTUHMiPg0KICAgICAgICAgICAgICAgIDx4c2w6d2l0aC1wYXJhbSBuYW1lPSJudW1iZXIiIHNlbGVjdD0iJG51bWJlciAtIDEiLz4NCiAgICAgICAgICAgIDwveHNsOmNhbGwtdGVtcGxhdGU+DQogICAgICAgIDwveHNsOmlmPg0KICAgIDwveHNsOnRlbXBsYXRlPg0KDQogICAgPHhzbDp0ZW1wbGF0ZSBuYW1lPSJsVHJpbSI+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0ic3RyaW5nIi8+DQogICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9InN1YnN0cmluZygkc3RyaW5nLCAxLCAxKSA9ICcnIj4NCiAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJHN0cmluZyIvPg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSJub3JtYWxpemUtc3BhY2Uoc3Vic3RyaW5nKCRzdHJpbmcsIDEsIDEpKSA9ICcnIj4NCiAgICAgICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0ibFRyaW0iPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0ic3RyaW5nIiBzZWxlY3Q9InN1YnN0cmluZygkc3RyaW5nLCAyKSIvPg0KICAgICAgICAgICAgICAgIDwveHNsOmNhbGwtdGVtcGxhdGU+DQogICAgICAgICAgICA8L3hzbDp3aGVuPg0KICAgICAgICAgICAgPHhzbDpvdGhlcndpc2U+DQogICAgICAgICAgICAgICAgPHhzbDp2YWx1ZS1vZiBzZWxlY3Q9IiRzdHJpbmciLz4NCiAgICAgICAgICAgIDwveHNsOm90aGVyd2lzZT4NCiAgICAgICAgPC94c2w6Y2hvb3NlPg0KICAgIDwveHNsOnRlbXBsYXRlPg0KDQogICAgPHhzbDp0ZW1wbGF0ZSBuYW1lPSJyVHJpbSI+DQogICAgICAgIDx4c2w6cGFyYW0gbmFtZT0ic3RyaW5nIi8+DQogICAgICAgIDx4c2w6Y2hvb3NlPg0KICAgICAgICAgICAgPHhzbDp3aGVuIHRlc3Q9InN1YnN0cmluZygkc3RyaW5nLCAxLCAxKSA9ICcnIj4NCiAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJHN0cmluZyIvPg0KICAgICAgICAgICAgPC94c2w6d2hlbj4NCiAgICAgICAgICAgIDx4c2w6d2hlbiB0ZXN0PSJub3JtYWxpemUtc3BhY2Uoc3Vic3RyaW5nKCRzdHJpbmcsIHN0cmluZy1sZW5ndGgoJHN0cmluZykpKSA9ICcnIj4NCiAgICAgICAgICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iclRyaW0iPg0KICAgICAgICAgICAgICAgICAgICA8eHNsOndpdGgtcGFyYW0gbmFtZT0ic3RyaW5nIg0KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0PSJzdWJzdHJpbmcoJHN0cmluZywgMSwgc3RyaW5nLWxlbmd0aCgkc3RyaW5nKSAtIDEpIi8+DQogICAgICAgICAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCiAgICAgICAgICAgIDwveHNsOndoZW4+DQogICAgICAgICAgICA8eHNsOm90aGVyd2lzZT4NCiAgICAgICAgICAgICAgICA8eHNsOnZhbHVlLW9mIHNlbGVjdD0iJHN0cmluZyIvPg0KICAgICAgICAgICAgPC94c2w6b3RoZXJ3aXNlPg0KICAgICAgICA8L3hzbDpjaG9vc2U+DQogICAgPC94c2w6dGVtcGxhdGU+DQoNCiAgICA8eHNsOnRlbXBsYXRlIG5hbWU9InRyaW0iPg0KICAgICAgICA8eHNsOnBhcmFtIG5hbWU9InN0cmluZyIvPg0KICAgICAgICA8eHNsOmNhbGwtdGVtcGxhdGUgbmFtZT0iclRyaW0iPg0KICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9InN0cmluZyI+DQogICAgICAgICAgICAgICAgPHhzbDpjYWxsLXRlbXBsYXRlIG5hbWU9ImxUcmltIj4NCiAgICAgICAgICAgICAgICAgICAgPHhzbDp3aXRoLXBhcmFtIG5hbWU9InN0cmluZyIgc2VsZWN0PSIkc3RyaW5nIi8+DQogICAgICAgICAgICAgICAgPC94c2w6Y2FsbC10ZW1wbGF0ZT4NCiAgICAgICAgICAgIDwveHNsOndpdGgtcGFyYW0+DQogICAgICAgIDwveHNsOmNhbGwtdGVtcGxhdGU+DQogICAgPC94c2w6dGVtcGxhdGU+DQoNCiAgICA8IS0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0tLT4NCiAgICA8IS0tIFtFTkRdIFVUSUxJVFkgVEVNUExBVEVTIC0tPg0KDQogICAgPHhzbDp0ZW1wbGF0ZSBuYW1lPSJnZXRKUXVlcnlKYXZhU2NyaXB0Q29kZSI+DQogICAgICAgIDwhW0NEQVRBWw0KICAgICAgICAvKiENCiAgICAgICAgICogalF1ZXJ5IEphdmFTY3JpcHQgTGlicmFyeSB2MS45LjENCiAgICAgICAgICogaHR0cDovL2pxdWVyeS5jb20vDQogICAgICAgICAqDQogICAgICAgICAqIEluY2x1ZGVzIFNpenpsZS5qcw0KICAgICAgICAgKiBodHRwOi8vc2l6emxlanMuY29tLw0KICAgICAgICAgKg0KICAgICAgICAgKiBDb3B5cmlnaHQgMjAwNSwgMjAxMiBqUXVlcnkgRm91bmRhdGlvbiwgSW5jLiBhbmQgb3RoZXIgY29udHJpYnV0b3JzDQogICAgICAgICAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZQ0KICAgICAgICAgKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlDQogICAgICAgICAqDQogICAgICAgICAqIERhdGU6IDIwMTMtMi00DQogICAgICAgICAqLw0KICAgICAgICAoZnVuY3Rpb24oIHdpbmRvdywgdW5kZWZpbmVkICkgew0KICAgICAgICANCiAgICAgICAgLy8gQ2FuJ3QgZG8gdGhpcyBiZWNhdXNlIHNldmVyYWwgYXBwcyBpbmNsdWRpbmcgQVNQLk5FVCB0cmFjZQ0KICAgICAgICAvLyB0aGUgc3RhY2sgdmlhIGFyZ3VtZW50cy5jYWxsZXIuY2FsbGVlIGFuZCBGaXJlZm94IGRpZXMgaWYNCiAgICAgICAgLy8geW91IHRyeSB0byB0cmFjZSB0aHJvdWdoICJ1c2Ugc3RyaWN0IiBjYWxsIGNoYWlucy4gKCMxMzMzNSkNCiAgICAgICAgLy8gU3VwcG9ydDogRmlyZWZveCAxOCsNCiAgICAgICAgLy8idXNlIHN0cmljdCI7DQogICAgICAgIHZhcg0KICAgICAgICAgICAgLy8gVGhlIGRlZmVycmVkIHVzZWQgb24gRE9NIHJlYWR5DQogICAgICAgICAgICByZWFkeUxpc3QsDQogICAgICAgIA0KICAgICAgICAgICAgLy8gQSBjZW50cmFsIHJlZmVyZW5jZSB0byB0aGUgcm9vdCBqUXVlcnkoZG9jdW1lbnQpDQogICAgICAgICAgICByb290alF1ZXJ5LA0KICAgICAgICANCiAgICAgICAgICAgIC8vIFN1cHBvcnQ6IElFPDkNCiAgICAgICAgICAgIC8vIEZvciBgdHlwZW9mIG5vZGUubWV0aG9kYCBpbnN0ZWFkIG9mIGBub2RlLm1ldGhvZCAhPT0gdW5kZWZpbmVkYA0KICAgICAgICAgICAgY29yZV9zdHJ1bmRlZmluZWQgPSB0eXBlb2YgdW5kZWZpbmVkLA0KICAgICAgICANCiAgICAgICAgICAgIC8vIFVzZSB0aGUgY29ycmVjdCBkb2N1bWVudCBhY2NvcmRpbmdseSB3aXRoIHdpbmRvdyBhcmd1bWVudCAoc2FuZGJveCkNCiAgICAgICAgICAgIGRvY3VtZW50ID0gd2luZG93LmRvY3VtZW50LA0KICAgICAgICAgICAgbG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb24sDQogICAgICAgIA0KICAgICAgICAgICAgLy8gTWFwIG92ZXIgalF1ZXJ5IGluIGNhc2Ugb2Ygb3ZlcndyaXRlDQogICAgICAgICAgICBfalF1ZXJ5ID0gd2luZG93LmpRdWVyeSwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBNYXAgb3ZlciB0aGUgJCBpbiBjYXNlIG9mIG92ZXJ3cml0ZQ0KICAgICAgICAgICAgXyQgPSB3aW5kb3cuJCwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBbW0NsYXNzXV0gLT4gdHlwZSBwYWlycw0KICAgICAgICAgICAgY2xhc3MydHlwZSA9IHt9LA0KICAgICAgICANCiAgICAgICAgICAgIC8vIExpc3Qgb2YgZGVsZXRlZCBkYXRhIGNhY2hlIGlkcywgc28gd2UgY2FuIHJldXNlIHRoZW0NCiAgICAgICAgICAgIGNvcmVfZGVsZXRlZElkcyA9IFtdLA0KICAgICAgICANCiAgICAgICAgICAgIGNvcmVfdmVyc2lvbiA9ICIxLjkuMSIsDQogICAgICAgIA0KICAgICAgICAgICAgLy8gU2F2ZSBhIHJlZmVyZW5jZSB0byBzb21lIGNvcmUgbWV0aG9kcw0KICAgICAgICAgICAgY29yZV9jb25jYXQgPSBjb3JlX2RlbGV0ZWRJZHMuY29uY2F0LA0KICAgICAgICAgICAgY29yZV9wdXNoID0gY29yZV9kZWxldGVkSWRzLnB1c2gsDQogICAgICAgICAgICBjb3JlX3NsaWNlID0gY29yZV9kZWxldGVkSWRzLnNsaWNlLA0KICAgICAgICAgICAgY29yZV9pbmRleE9mID0gY29yZV9kZWxldGVkSWRzLmluZGV4T2YsDQogICAgICAgICAgICBjb3JlX3RvU3RyaW5nID0gY2xhc3MydHlwZS50b1N0cmluZywNCiAgICAgICAgICAgIGNvcmVfaGFzT3duID0gY2xhc3MydHlwZS5oYXNPd25Qcm9wZXJ0eSwNCiAgICAgICAgICAgIGNvcmVfdHJpbSA9IGNvcmVfdmVyc2lvbi50cmltLA0KICAgICAgICANCiAgICAgICAgICAgIC8vIERlZmluZSBhIGxvY2FsIGNvcHkgb2YgalF1ZXJ5DQogICAgICAgICAgICBqUXVlcnkgPSBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQgKSB7DQogICAgICAgICAgICAgICAgLy8gVGhlIGpRdWVyeSBvYmplY3QgaXMgYWN0dWFsbHkganVzdCB0aGUgaW5pdCBjb25zdHJ1Y3RvciAnZW5oYW5jZWQnDQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBqUXVlcnkuZm4uaW5pdCggc2VsZWN0b3IsIGNvbnRleHQsIHJvb3RqUXVlcnkgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgLy8gVXNlZCBmb3IgbWF0Y2hpbmcgbnVtYmVycw0KICAgICAgICAgICAgY29yZV9wbnVtID0gL1srLV0/KD86XGQqXC58KVxkKyg/OltlRV1bKy1dP1xkK3wpLy5zb3VyY2UsDQogICAgICAgIA0KICAgICAgICAgICAgLy8gVXNlZCBmb3Igc3BsaXR0aW5nIG9uIHdoaXRlc3BhY2UNCiAgICAgICAgICAgIGNvcmVfcm5vdHdoaXRlID0gL1xTKy9nLA0KICAgICAgICANCiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB3ZSB0cmltIEJPTSBhbmQgTkJTUCAoaGVyZSdzIGxvb2tpbmcgYXQgeW91LCBTYWZhcmkgNS4wIGFuZCBJRSkNCiAgICAgICAgICAgIHJ0cmltID0gL15bXHNcdUZFRkZceEEwXSt8W1xzXHVGRUZGXHhBMF0rJC9nLA0KICAgICAgICANCiAgICAgICAgICAgIC8vIEEgc2ltcGxlIHdheSB0byBjaGVjayBmb3IgSFRNTCBzdHJpbmdzDQogICAgICAgICAgICAvLyBQcmlvcml0aXplICNpZCBvdmVyIDx0YWc+IHRvIGF2b2lkIFhTUyB2aWEgbG9jYXRpb24uaGFzaCAoIzk1MjEpDQogICAgICAgICAgICAvLyBTdHJpY3QgSFRNTCByZWNvZ25pdGlvbiAoIzExMjkwOiBtdXN0IHN0YXJ0IHdpdGggPCkNCiAgICAgICAgICAgIHJxdWlja0V4cHIgPSAvXig/Oig8W1x3XFddKz4pW14+XSp8IyhbXHctXSopKSQvLA0KICAgICAgICANCiAgICAgICAgICAgIC8vIE1hdGNoIGEgc3RhbmRhbG9uZSB0YWcNCiAgICAgICAgICAgIHJzaW5nbGVUYWcgPSAvXjwoXHcrKVxzKlwvPz4oPzo8XC9cMT58KSQvLA0KICAgICAgICANCiAgICAgICAgICAgIC8vIEpTT04gUmVnRXhwDQogICAgICAgICAgICBydmFsaWRjaGFycyA9IC9eW1xdLDp7fVxzXSokLywNCiAgICAgICAgICAgIHJ2YWxpZGJyYWNlcyA9IC8oPzpefDp8LCkoPzpccypcWykrL2csDQogICAgICAgICAgICBydmFsaWRlc2NhcGUgPSAvXFwoPzpbIlxcXC9iZm5ydF18dVtcZGEtZkEtRl17NH0pL2csDQogICAgICAgICAgICBydmFsaWR0b2tlbnMgPSAvIlteIlxcXHJcbl0qInx0cnVlfGZhbHNlfG51bGx8LT8oPzpcZCtcLnwpXGQrKD86W2VFXVsrLV0/XGQrfCkvZywNCiAgICAgICAgDQogICAgICAgICAgICAvLyBNYXRjaGVzIGRhc2hlZCBzdHJpbmcgZm9yIGNhbWVsaXppbmcNCiAgICAgICAgICAgIHJtc1ByZWZpeCA9IC9eLW1zLS8sDQogICAgICAgICAgICByZGFzaEFscGhhID0gLy0oW1xkYS16XSkvZ2ksDQogICAgICAgIA0KICAgICAgICAgICAgLy8gVXNlZCBieSBqUXVlcnkuY2FtZWxDYXNlIGFzIGNhbGxiYWNrIHRvIHJlcGxhY2UoKQ0KICAgICAgICAgICAgZmNhbWVsQ2FzZSA9IGZ1bmN0aW9uKCBhbGwsIGxldHRlciApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyLnRvVXBwZXJDYXNlKCk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIC8vIFRoZSByZWFkeSBldmVudCBoYW5kbGVyDQogICAgICAgICAgICBjb21wbGV0ZWQgPSBmdW5jdGlvbiggZXZlbnQgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIgaXMgZ29vZCBlbm91Z2ggZm9yIHVzIHRvIGNhbGwgdGhlIGRvbSByZWFkeSBpbiBvbGRJRQ0KICAgICAgICAgICAgICAgIGlmICggZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciB8fCBldmVudC50eXBlID09PSAibG9hZCIgfHwgZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiApIHsNCiAgICAgICAgICAgICAgICAgICAgZGV0YWNoKCk7DQogICAgICAgICAgICAgICAgICAgIGpRdWVyeS5yZWFkeSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvLyBDbGVhbi11cCBtZXRob2QgZm9yIGRvbSByZWFkeSBldmVudHMNCiAgICAgICAgICAgIGRldGFjaCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGlmICggZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciApIHsNCiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggIkRPTUNvbnRlbnRMb2FkZWQiLCBjb21wbGV0ZWQsIGZhbHNlICk7DQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCAibG9hZCIsIGNvbXBsZXRlZCwgZmFsc2UgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZGV0YWNoRXZlbnQoICJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBjb21wbGV0ZWQgKTsNCiAgICAgICAgICAgICAgICAgICAgd2luZG93LmRldGFjaEV2ZW50KCAib25sb2FkIiwgY29tcGxldGVkICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIGpRdWVyeS5mbiA9IGpRdWVyeS5wcm90b3R5cGUgPSB7DQogICAgICAgICAgICAvLyBUaGUgY3VycmVudCB2ZXJzaW9uIG9mIGpRdWVyeSBiZWluZyB1c2VkDQogICAgICAgICAgICBqcXVlcnk6IGNvcmVfdmVyc2lvbiwNCiAgICAgICAgDQogICAgICAgICAgICBjb25zdHJ1Y3RvcjogalF1ZXJ5LA0KICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0LCByb290alF1ZXJ5ICkgew0KICAgICAgICAgICAgICAgIHZhciBtYXRjaCwgZWxlbTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gSEFORExFOiAkKCIiKSwgJChudWxsKSwgJCh1bmRlZmluZWQpLCAkKGZhbHNlKQ0KICAgICAgICAgICAgICAgIGlmICggIXNlbGVjdG9yICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBIVE1MIHN0cmluZ3MNCiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggc2VsZWN0b3IuY2hhckF0KDApID09PSAiPCIgJiYgc2VsZWN0b3IuY2hhckF0KCBzZWxlY3Rvci5sZW5ndGggLSAxICkgPT09ICI+IiAmJiBzZWxlY3Rvci5sZW5ndGggPj0gMyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFzc3VtZSB0aGF0IHN0cmluZ3MgdGhhdCBzdGFydCBhbmQgZW5kIHdpdGggPD4gYXJlIEhUTUwgYW5kIHNraXAgdGhlIHJlZ2V4IGNoZWNrDQogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IFsgbnVsbCwgc2VsZWN0b3IsIG51bGwgXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IHJxdWlja0V4cHIuZXhlYyggc2VsZWN0b3IgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gTWF0Y2ggaHRtbCBvciBtYWtlIHN1cmUgbm8gY29udGV4dCBpcyBzcGVjaWZpZWQgZm9yICNpZA0KICAgICAgICAgICAgICAgICAgICBpZiAoIG1hdGNoICYmIChtYXRjaFsxXSB8fCAhY29udGV4dCkgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSEFORExFOiAkKGh0bWwpIC0+ICQoYXJyYXkpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIG1hdGNoWzFdICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWNvbnRleHQgPSBjb250ZXh0IGluc3RhbmNlb2YgalF1ZXJ5ID8gY29udGV4dFswXSA6IGNvbnRleHQ7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIHNjcmlwdHMgaXMgdHJ1ZSBmb3IgYmFjay1jb21wYXQNCiAgICAgICAgICAgICAgICAgICAgICAgIAlqUXVlcnkubWVyZ2UoIHRoaXMsIGpRdWVyeS5wYXJzZUhUTUwoDQogICAgICAgICAgICAgICAgICAgICAgICAJCW1hdGNoWzFdLA0KICAgICAgICAgICAgICAgICAgICAgICAgCQljb250ZXh0ICYmIGNvbnRleHQubm9kZVR5cGUgPyBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCA6IGRvY3VtZW50LA0KICAgICAgICAgICAgICAgICAgICAgICAgCQl0cnVlDQogICAgICAgICAgICAgICAgICAgICAgICAJKSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBIQU5ETEU6ICQoaHRtbCwgcHJvcHMpDQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCByc2luZ2xlVGFnLnRlc3QoIG1hdGNoWzFdICkgJiYgalF1ZXJ5LmlzUGxhaW5PYmplY3QoIGNvbnRleHQgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZm9yICggbWF0Y2ggaW4gY29udGV4dCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCS8vIFByb3BlcnRpZXMgb2YgY29udGV4dCBhcmUgY2FsbGVkIGFzIG1ldGhvZHMgaWYgcG9zc2libGUNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHRoaXNbIG1hdGNoIF0gKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQl0aGlzWyBtYXRjaCBdKCBjb250ZXh0WyBtYXRjaCBdICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJLy8gLi4uYW5kIG90aGVyd2lzZSBzZXQgYXMgYXR0cmlidXRlcw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQl0aGlzLmF0dHIoIG1hdGNoLCBjb250ZXh0WyBtYXRjaCBdICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCXJldHVybiB0aGlzOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhBTkRMRTogJCgjaWQpDQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgCWVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggbWF0Y2hbMl0gKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gQ2hlY2sgcGFyZW50Tm9kZSB0byBjYXRjaCB3aGVuIEJsYWNrYmVycnkgNC42IHJldHVybnMNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBub2RlcyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIGRvY3VtZW50ICM2OTYzDQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBlbGVtICYmIGVsZW0ucGFyZW50Tm9kZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gSGFuZGxlIHRoZSBjYXNlIHdoZXJlIElFIGFuZCBPcGVyYSByZXR1cm4gaXRlbXMNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gYnkgbmFtZSBpbnN0ZWFkIG9mIElEDQogICAgICAgICAgICAgICAgICAgICAgICAJCWlmICggZWxlbS5pZCAhPT0gbWF0Y2hbMl0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQlyZXR1cm4gcm9vdGpRdWVyeS5maW5kKCBzZWxlY3RvciApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkvLyBPdGhlcndpc2UsIHdlIGluamVjdCB0aGUgZWxlbWVudCBkaXJlY3RseSBpbnRvIHRoZSBqUXVlcnkgb2JqZWN0DQogICAgICAgICAgICAgICAgICAgICAgICAJCXRoaXMubGVuZ3RoID0gMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJdGhpc1swXSA9IGVsZW07DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAl0aGlzLmNvbnRleHQgPSBkb2N1bWVudDsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3I7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIHRoaXM7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBIQU5ETEU6ICQoZXhwciwgJCguLi4pKQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCAhY29udGV4dCB8fCBjb250ZXh0LmpxdWVyeSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoIGNvbnRleHQgfHwgcm9vdGpRdWVyeSApLmZpbmQoIHNlbGVjdG9yICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBIQU5ETEU6ICQoZXhwciwgY29udGV4dCkNCiAgICAgICAgICAgICAgICAgICAgLy8gKHdoaWNoIGlzIGp1c3QgZXF1aXZhbGVudCB0bzogJChjb250ZXh0KS5maW5kKGV4cHIpDQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RvciggY29udGV4dCApLmZpbmQoIHNlbGVjdG9yICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gSEFORExFOiAkKERPTUVsZW1lbnQpDQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICggc2VsZWN0b3Iubm9kZVR5cGUgKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IHRoaXNbMF0gPSBzZWxlY3RvcjsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5sZW5ndGggPSAxOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gSEFORExFOiAkKGZ1bmN0aW9uKQ0KICAgICAgICAgICAgICAgIC8vIFNob3J0Y3V0IGZvciBkb2N1bWVudCByZWFkeQ0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBzZWxlY3RvciApICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm9vdGpRdWVyeS5yZWFkeSggc2VsZWN0b3IgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggc2VsZWN0b3Iuc2VsZWN0b3IgIT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RvciA9IHNlbGVjdG9yLnNlbGVjdG9yOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQgPSBzZWxlY3Rvci5jb250ZXh0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5tYWtlQXJyYXkoIHNlbGVjdG9yLCB0aGlzICk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIC8vIFN0YXJ0IHdpdGggYW4gZW1wdHkgc2VsZWN0b3INCiAgICAgICAgICAgIHNlbGVjdG9yOiAiIiwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBUaGUgZGVmYXVsdCBsZW5ndGggb2YgYSBqUXVlcnkgb2JqZWN0IGlzIDANCiAgICAgICAgICAgIGxlbmd0aDogMCwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBUaGUgbnVtYmVyIG9mIGVsZW1lbnRzIGNvbnRhaW5lZCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldA0KICAgICAgICAgICAgc2l6ZTogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGVuZ3RoOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICB0b0FycmF5OiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gY29yZV9zbGljZS5jYWxsKCB0aGlzICk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIC8vIEdldCB0aGUgTnRoIGVsZW1lbnQgaW4gdGhlIG1hdGNoZWQgZWxlbWVudCBzZXQgT1INCiAgICAgICAgICAgIC8vIEdldCB0aGUgd2hvbGUgbWF0Y2hlZCBlbGVtZW50IHNldCBhcyBhIGNsZWFuIGFycmF5DQogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBudW0gKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bSA9PSBudWxsID8NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBhICdjbGVhbicgYXJyYXkNCiAgICAgICAgICAgICAgICAgICAgdGhpcy50b0FycmF5KCkgOg0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIGp1c3QgdGhlIG9iamVjdA0KICAgICAgICAgICAgICAgICAgICAoIG51bSA8IDAgPyB0aGlzWyB0aGlzLmxlbmd0aCArIG51bSBdIDogdGhpc1sgbnVtIF0gKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgLy8gVGFrZSBhbiBhcnJheSBvZiBlbGVtZW50cyBhbmQgcHVzaCBpdCBvbnRvIHRoZSBzdGFjaw0KICAgICAgICAgICAgLy8gKHJldHVybmluZyB0aGUgbmV3IG1hdGNoZWQgZWxlbWVudCBzZXQpDQogICAgICAgICAgICBwdXNoU3RhY2s6IGZ1bmN0aW9uKCBlbGVtcyApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQnVpbGQgYSBuZXcgalF1ZXJ5IG1hdGNoZWQgZWxlbWVudCBzZXQNCiAgICAgICAgICAgICAgICB2YXIgcmV0ID0galF1ZXJ5Lm1lcmdlKCB0aGlzLmNvbnN0cnVjdG9yKCksIGVsZW1zICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgb2xkIG9iamVjdCBvbnRvIHRoZSBzdGFjayAoYXMgYSByZWZlcmVuY2UpDQogICAgICAgICAgICAgICAgcmV0LnByZXZPYmplY3QgPSB0aGlzOw0KICAgICAgICAgICAgICAgIHJldC5jb250ZXh0ID0gdGhpcy5jb250ZXh0Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdGhlIG5ld2x5LWZvcm1lZCBlbGVtZW50IHNldA0KICAgICAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIC8vIEV4ZWN1dGUgYSBjYWxsYmFjayBmb3IgZXZlcnkgZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBzZXQuDQogICAgICAgICAgICAvLyAoWW91IGNhbiBzZWVkIHRoZSBhcmd1bWVudHMgd2l0aCBhbiBhcnJheSBvZiBhcmdzLCBidXQgdGhpcyBpcw0KICAgICAgICAgICAgLy8gb25seSB1c2VkIGludGVybmFsbHkuKQ0KICAgICAgICAgICAgZWFjaDogZnVuY3Rpb24oIGNhbGxiYWNrLCBhcmdzICkgew0KICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZWFjaCggdGhpcywgY2FsbGJhY2ssIGFyZ3MgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgcmVhZHk6IGZ1bmN0aW9uKCBmbiApIHsNCiAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIGNhbGxiYWNrDQogICAgICAgICAgICAgICAgalF1ZXJ5LnJlYWR5LnByb21pc2UoKS5kb25lKCBmbiApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgc2xpY2U6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayggY29yZV9zbGljZS5hcHBseSggdGhpcywgYXJndW1lbnRzICkgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgZmlyc3Q6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVxKCAwICk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGxhc3Q6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVxKCAtMSApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBlcTogZnVuY3Rpb24oIGkgKSB7DQogICAgICAgICAgICAgICAgdmFyIGxlbiA9IHRoaXMubGVuZ3RoLA0KICAgICAgICAgICAgICAgICAgICBqID0gK2kgKyAoIGkgPCAwID8gbGVuIDogMCApOw0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayggaiA+PSAwICYmIGogPCBsZW4gPyBbIHRoaXNbal0gXSA6IFtdICk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIG1hcDogZnVuY3Rpb24oIGNhbGxiYWNrICkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayggalF1ZXJ5Lm1hcCh0aGlzLCBmdW5jdGlvbiggZWxlbSwgaSApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrLmNhbGwoIGVsZW0sIGksIGVsZW0gKTsNCiAgICAgICAgICAgICAgICB9KSk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGVuZDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJldk9iamVjdCB8fCB0aGlzLmNvbnN0cnVjdG9yKG51bGwpOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBGb3IgaW50ZXJuYWwgdXNlIG9ubHkuDQogICAgICAgICAgICAvLyBCZWhhdmVzIGxpa2UgYW4gQXJyYXkncyBtZXRob2QsIG5vdCBsaWtlIGEgalF1ZXJ5IG1ldGhvZC4NCiAgICAgICAgICAgIHB1c2g6IGNvcmVfcHVzaCwNCiAgICAgICAgICAgIHNvcnQ6IFtdLnNvcnQsDQogICAgICAgICAgICBzcGxpY2U6IFtdLnNwbGljZQ0KICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgLy8gR2l2ZSB0aGUgaW5pdCBmdW5jdGlvbiB0aGUgalF1ZXJ5IHByb3RvdHlwZSBmb3IgbGF0ZXIgaW5zdGFudGlhdGlvbg0KICAgICAgICBqUXVlcnkuZm4uaW5pdC5wcm90b3R5cGUgPSBqUXVlcnkuZm47DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZXh0ZW5kID0galF1ZXJ5LmZuLmV4dGVuZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgdmFyIHNyYywgY29weUlzQXJyYXksIGNvcHksIG5hbWUsIG9wdGlvbnMsIGNsb25lLA0KICAgICAgICAgICAgICAgIHRhcmdldCA9IGFyZ3VtZW50c1swXSB8fCB7fSwNCiAgICAgICAgICAgICAgICBpID0gMSwNCiAgICAgICAgICAgICAgICBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoLA0KICAgICAgICAgICAgICAgIGRlZXAgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBIYW5kbGUgYSBkZWVwIGNvcHkgc2l0dWF0aW9uDQogICAgICAgICAgICBpZiAoIHR5cGVvZiB0YXJnZXQgPT09ICJib29sZWFuIiApIHsNCiAgICAgICAgICAgICAgICBkZWVwID0gdGFyZ2V0Ow0KICAgICAgICAgICAgICAgIHRhcmdldCA9IGFyZ3VtZW50c1sxXSB8fCB7fTsNCiAgICAgICAgICAgICAgICAvLyBza2lwIHRoZSBib29sZWFuIGFuZCB0aGUgdGFyZ2V0DQogICAgICAgICAgICAgICAgaSA9IDI7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gSGFuZGxlIGNhc2Ugd2hlbiB0YXJnZXQgaXMgYSBzdHJpbmcgb3Igc29tZXRoaW5nIChwb3NzaWJsZSBpbiBkZWVwIGNvcHkpDQogICAgICAgICAgICBpZiAoIHR5cGVvZiB0YXJnZXQgIT09ICJvYmplY3QiICYmICFqUXVlcnkuaXNGdW5jdGlvbih0YXJnZXQpICkgew0KICAgICAgICAgICAgICAgIHRhcmdldCA9IHt9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIGV4dGVuZCBqUXVlcnkgaXRzZWxmIGlmIG9ubHkgb25lIGFyZ3VtZW50IGlzIHBhc3NlZA0KICAgICAgICAgICAgaWYgKCBsZW5ndGggPT09IGkgKSB7DQogICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGhpczsNCiAgICAgICAgICAgICAgICAtLWk7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7DQogICAgICAgICAgICAgICAgLy8gT25seSBkZWFsIHdpdGggbm9uLW51bGwvdW5kZWZpbmVkIHZhbHVlcw0KICAgICAgICAgICAgICAgIGlmICggKG9wdGlvbnMgPSBhcmd1bWVudHNbIGkgXSkgIT0gbnVsbCApIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gRXh0ZW5kIHRoZSBiYXNlIG9iamVjdA0KICAgICAgICAgICAgICAgICAgICBmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzcmMgPSB0YXJnZXRbIG5hbWUgXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvcHkgPSBvcHRpb25zWyBuYW1lIF07DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJldmVudCBuZXZlci1lbmRpbmcgbG9vcA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB0YXJnZXQgPT09IGNvcHkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJY29udGludWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVjdXJzZSBpZiB3ZSdyZSBtZXJnaW5nIHBsYWluIG9iamVjdHMgb3IgYXJyYXlzDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGRlZXAgJiYgY29weSAmJiAoIGpRdWVyeS5pc1BsYWluT2JqZWN0KGNvcHkpIHx8IChjb3B5SXNBcnJheSA9IGpRdWVyeS5pc0FycmF5KGNvcHkpKSApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggY29weUlzQXJyYXkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWNvcHlJc0FycmF5ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWNsb25lID0gc3JjICYmIGpRdWVyeS5pc0FycmF5KHNyYykgPyBzcmMgOiBbXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJY2xvbmUgPSBzcmMgJiYgalF1ZXJ5LmlzUGxhaW5PYmplY3Qoc3JjKSA/IHNyYyA6IHt9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gTmV2ZXIgbW92ZSBvcmlnaW5hbCBvYmplY3RzLCBjbG9uZSB0aGVtDQogICAgICAgICAgICAgICAgICAgICAgICAJdGFyZ2V0WyBuYW1lIF0gPSBqUXVlcnkuZXh0ZW5kKCBkZWVwLCBjbG9uZSwgY29weSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvbid0IGJyaW5nIGluIHVuZGVmaW5lZCB2YWx1ZXMNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIGNvcHkgIT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl0YXJnZXRbIG5hbWUgXSA9IGNvcHk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBtb2RpZmllZCBvYmplY3QNCiAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7DQogICAgICAgIH07DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZXh0ZW5kKHsNCiAgICAgICAgICAgIG5vQ29uZmxpY3Q6IGZ1bmN0aW9uKCBkZWVwICkgew0KICAgICAgICAgICAgICAgIGlmICggd2luZG93LiQgPT09IGpRdWVyeSApIHsNCiAgICAgICAgICAgICAgICAgICAgd2luZG93LiQgPSBfJDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggZGVlcCAmJiB3aW5kb3cualF1ZXJ5ID09PSBqUXVlcnkgKSB7DQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5qUXVlcnkgPSBfalF1ZXJ5Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgLy8gSXMgdGhlIERPTSByZWFkeSB0byBiZSB1c2VkPyBTZXQgdG8gdHJ1ZSBvbmNlIGl0IG9jY3Vycy4NCiAgICAgICAgICAgIGlzUmVhZHk6IGZhbHNlLA0KICAgICAgICANCiAgICAgICAgICAgIC8vIEEgY291bnRlciB0byB0cmFjayBob3cgbWFueSBpdGVtcyB0byB3YWl0IGZvciBiZWZvcmUNCiAgICAgICAgICAgIC8vIHRoZSByZWFkeSBldmVudCBmaXJlcy4gU2VlICM2NzgxDQogICAgICAgICAgICByZWFkeVdhaXQ6IDEsDQogICAgICAgIA0KICAgICAgICAgICAgLy8gSG9sZCAob3IgcmVsZWFzZSkgdGhlIHJlYWR5IGV2ZW50DQogICAgICAgICAgICBob2xkUmVhZHk6IGZ1bmN0aW9uKCBob2xkICkgew0KICAgICAgICAgICAgICAgIGlmICggaG9sZCApIHsNCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LnJlYWR5V2FpdCsrOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGpRdWVyeS5yZWFkeSggdHJ1ZSApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgLy8gSGFuZGxlIHdoZW4gdGhlIERPTSBpcyByZWFkeQ0KICAgICAgICAgICAgcmVhZHk6IGZ1bmN0aW9uKCB3YWl0ICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBBYm9ydCBpZiB0aGVyZSBhcmUgcGVuZGluZyBob2xkcyBvciB3ZSdyZSBhbHJlYWR5IHJlYWR5DQogICAgICAgICAgICAgICAgaWYgKCB3YWl0ID09PSB0cnVlID8gLS1qUXVlcnkucmVhZHlXYWl0IDogalF1ZXJ5LmlzUmVhZHkgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSBib2R5IGV4aXN0cywgYXQgbGVhc3QsIGluIGNhc2UgSUUgZ2V0cyBhIGxpdHRsZSBvdmVyemVhbG91cyAodGlja2V0ICM1NDQzKS4NCiAgICAgICAgICAgICAgICBpZiAoICFkb2N1bWVudC5ib2R5ICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2V0VGltZW91dCggalF1ZXJ5LnJlYWR5ICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBSZW1lbWJlciB0aGF0IHRoZSBET00gaXMgcmVhZHkNCiAgICAgICAgICAgICAgICBqUXVlcnkuaXNSZWFkeSA9IHRydWU7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIElmIGEgbm9ybWFsIERPTSBSZWFkeSBldmVudCBmaXJlZCwgZGVjcmVtZW50LCBhbmQgd2FpdCBpZiBuZWVkIGJlDQogICAgICAgICAgICAgICAgaWYgKCB3YWl0ICE9PSB0cnVlICYmIC0talF1ZXJ5LnJlYWR5V2FpdCA+IDAgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBmdW5jdGlvbnMgYm91bmQsIHRvIGV4ZWN1dGUNCiAgICAgICAgICAgICAgICByZWFkeUxpc3QucmVzb2x2ZVdpdGgoIGRvY3VtZW50LCBbIGpRdWVyeSBdICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFRyaWdnZXIgYW55IGJvdW5kIHJlYWR5IGV2ZW50cw0KICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LmZuLnRyaWdnZXIgKSB7DQogICAgICAgICAgICAgICAgICAgIGpRdWVyeSggZG9jdW1lbnQgKS50cmlnZ2VyKCJyZWFkeSIpLm9mZigicmVhZHkiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIC8vIFNlZSB0ZXN0L3VuaXQvY29yZS5qcyBmb3IgZGV0YWlscyBjb25jZXJuaW5nIGlzRnVuY3Rpb24uDQogICAgICAgICAgICAvLyBTaW5jZSB2ZXJzaW9uIDEuMywgRE9NIG1ldGhvZHMgYW5kIGZ1bmN0aW9ucyBsaWtlIGFsZXJ0DQogICAgICAgICAgICAvLyBhcmVuJ3Qgc3VwcG9ydGVkLiBUaGV5IHJldHVybiBmYWxzZSBvbiBJRSAoIzI5NjgpLg0KICAgICAgICAgICAgaXNGdW5jdGlvbjogZnVuY3Rpb24oIG9iaiApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LnR5cGUob2JqKSA9PT0gImZ1bmN0aW9uIjsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgaXNBcnJheTogQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiggb2JqICkgew0KICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkudHlwZShvYmopID09PSAiYXJyYXkiOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBpc1dpbmRvdzogZnVuY3Rpb24oIG9iaiApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gb2JqICE9IG51bGwgJiYgb2JqID09IG9iai53aW5kb3c7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGlzTnVtZXJpYzogZnVuY3Rpb24oIG9iaiApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gIWlzTmFOKCBwYXJzZUZsb2F0KG9iaikgKSAmJiBpc0Zpbml0ZSggb2JqICk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIHR5cGU6IGZ1bmN0aW9uKCBvYmogKSB7DQogICAgICAgICAgICAgICAgaWYgKCBvYmogPT0gbnVsbCApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZyggb2JqICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAib2JqZWN0IiB8fCB0eXBlb2Ygb2JqID09PSAiZnVuY3Rpb24iID8NCiAgICAgICAgICAgICAgICAgICAgY2xhc3MydHlwZVsgY29yZV90b1N0cmluZy5jYWxsKG9iaikgXSB8fCAib2JqZWN0IiA6DQogICAgICAgICAgICAgICAgICAgIHR5cGVvZiBvYmo7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGlzUGxhaW5PYmplY3Q6IGZ1bmN0aW9uKCBvYmogKSB7DQogICAgICAgICAgICAgICAgLy8gTXVzdCBiZSBhbiBPYmplY3QuDQogICAgICAgICAgICAgICAgLy8gQmVjYXVzZSBvZiBJRSwgd2UgYWxzbyBoYXZlIHRvIGNoZWNrIHRoZSBwcmVzZW5jZSBvZiB0aGUgY29uc3RydWN0b3IgcHJvcGVydHkuDQogICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgRE9NIG5vZGVzIGFuZCB3aW5kb3cgb2JqZWN0cyBkb24ndCBwYXNzIHRocm91Z2gsIGFzIHdlbGwNCiAgICAgICAgICAgICAgICBpZiAoICFvYmogfHwgalF1ZXJ5LnR5cGUob2JqKSAhPT0gIm9iamVjdCIgfHwgb2JqLm5vZGVUeXBlIHx8IGpRdWVyeS5pc1dpbmRvdyggb2JqICkgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIC8vIE5vdCBvd24gY29uc3RydWN0b3IgcHJvcGVydHkgbXVzdCBiZSBPYmplY3QNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBvYmouY29uc3RydWN0b3IgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgICFjb3JlX2hhc093bi5jYWxsKG9iaiwgImNvbnN0cnVjdG9yIikgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgICFjb3JlX2hhc093bi5jYWxsKG9iai5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsICJpc1Byb3RvdHlwZU9mIikgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGNhdGNoICggZSApIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gSUU4LDkgV2lsbCB0aHJvdyBleGNlcHRpb25zIG9uIGNlcnRhaW4gaG9zdCBvYmplY3RzICM5ODk3DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIE93biBwcm9wZXJ0aWVzIGFyZSBlbnVtZXJhdGVkIGZpcnN0bHksIHNvIHRvIHNwZWVkIHVwLA0KICAgICAgICAgICAgICAgIC8vIGlmIGxhc3Qgb25lIGlzIG93biwgdGhlbiBhbGwgcHJvcGVydGllcyBhcmUgb3duLg0KICAgICAgICANCiAgICAgICAgICAgICAgICB2YXIga2V5Ow0KICAgICAgICAgICAgICAgIGZvciAoIGtleSBpbiBvYmogKSB7fQ0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4ga2V5ID09PSB1bmRlZmluZWQgfHwgY29yZV9oYXNPd24uY2FsbCggb2JqLCBrZXkgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgaXNFbXB0eU9iamVjdDogZnVuY3Rpb24oIG9iaiApIHsNCiAgICAgICAgICAgICAgICB2YXIgbmFtZTsNCiAgICAgICAgICAgICAgICBmb3IgKCBuYW1lIGluIG9iaiApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCBtc2cgKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCBtc2cgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgLy8gZGF0YTogc3RyaW5nIG9mIGh0bWwNCiAgICAgICAgICAgIC8vIGNvbnRleHQgKG9wdGlvbmFsKTogSWYgc3BlY2lmaWVkLCB0aGUgZnJhZ21lbnQgd2lsbCBiZSBjcmVhdGVkIGluIHRoaXMgY29udGV4dCwgZGVmYXVsdHMgdG8gZG9jdW1lbnQNCiAgICAgICAgICAgIC8vIGtlZXBTY3JpcHRzIChvcHRpb25hbCk6IElmIHRydWUsIHdpbGwgaW5jbHVkZSBzY3JpcHRzIHBhc3NlZCBpbiB0aGUgaHRtbCBzdHJpbmcNCiAgICAgICAgICAgIHBhcnNlSFRNTDogZnVuY3Rpb24oIGRhdGEsIGNvbnRleHQsIGtlZXBTY3JpcHRzICkgew0KICAgICAgICAgICAgICAgIGlmICggIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICJzdHJpbmciICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgY29udGV4dCA9PT0gImJvb2xlYW4iICkgew0KICAgICAgICAgICAgICAgICAgICBrZWVwU2NyaXB0cyA9IGNvbnRleHQ7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29udGV4dCA9IGNvbnRleHQgfHwgZG9jdW1lbnQ7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHZhciBwYXJzZWQgPSByc2luZ2xlVGFnLmV4ZWMoIGRhdGEgKSwNCiAgICAgICAgICAgICAgICAgICAgc2NyaXB0cyA9ICFrZWVwU2NyaXB0cyAmJiBbXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gU2luZ2xlIHRhZw0KICAgICAgICAgICAgICAgIGlmICggcGFyc2VkICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWyBjb250ZXh0LmNyZWF0ZUVsZW1lbnQoIHBhcnNlZFsxXSApIF07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBwYXJzZWQgPSBqUXVlcnkuYnVpbGRGcmFnbWVudCggWyBkYXRhIF0sIGNvbnRleHQsIHNjcmlwdHMgKTsNCiAgICAgICAgICAgICAgICBpZiAoIHNjcmlwdHMgKSB7DQogICAgICAgICAgICAgICAgICAgIGpRdWVyeSggc2NyaXB0cyApLnJlbW92ZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5Lm1lcmdlKCBbXSwgcGFyc2VkLmNoaWxkTm9kZXMgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgcGFyc2VKU09OOiBmdW5jdGlvbiggZGF0YSApIHsNCiAgICAgICAgICAgICAgICAvLyBBdHRlbXB0IHRvIHBhcnNlIHVzaW5nIHRoZSBuYXRpdmUgSlNPTiBwYXJzZXIgZmlyc3QNCiAgICAgICAgICAgICAgICBpZiAoIHdpbmRvdy5KU09OICYmIHdpbmRvdy5KU09OLnBhcnNlICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2luZG93LkpTT04ucGFyc2UoIGRhdGEgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggZGF0YSA9PT0gbnVsbCApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBkYXRhID09PSAic3RyaW5nIiApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSBsZWFkaW5nL3RyYWlsaW5nIHdoaXRlc3BhY2UgaXMgcmVtb3ZlZCAoSUUgY2FuJ3QgaGFuZGxlIGl0KQ0KICAgICAgICAgICAgICAgICAgICBkYXRhID0galF1ZXJ5LnRyaW0oIGRhdGEgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmICggZGF0YSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgaW5jb21pbmcgZGF0YSBpcyBhY3R1YWwgSlNPTg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9naWMgYm9ycm93ZWQgZnJvbSBodHRwOi8vanNvbi5vcmcvanNvbjIuanMNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcnZhbGlkY2hhcnMudGVzdCggZGF0YS5yZXBsYWNlKCBydmFsaWRlc2NhcGUsICJAIiApDQogICAgICAgICAgICAgICAgICAgICAgICAJLnJlcGxhY2UoIHJ2YWxpZHRva2VucywgIl0iICkNCiAgICAgICAgICAgICAgICAgICAgICAgIAkucmVwbGFjZSggcnZhbGlkYnJhY2VzLCAiIikpICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZXR1cm4gKCBuZXcgRnVuY3Rpb24oICJyZXR1cm4gIiArIGRhdGEgKSApKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGpRdWVyeS5lcnJvciggIkludmFsaWQgSlNPTjogIiArIGRhdGEgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgLy8gQ3Jvc3MtYnJvd3NlciB4bWwgcGFyc2luZw0KICAgICAgICAgICAgcGFyc2VYTUw6IGZ1bmN0aW9uKCBkYXRhICkgew0KICAgICAgICAgICAgICAgIHZhciB4bWwsIHRtcDsNCiAgICAgICAgICAgICAgICBpZiAoICFkYXRhIHx8IHR5cGVvZiBkYXRhICE9PSAic3RyaW5nIiApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggd2luZG93LkRPTVBhcnNlciApIHsgLy8gU3RhbmRhcmQNCiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCA9IG5ldyBET01QYXJzZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHhtbCA9IHRtcC5wYXJzZUZyb21TdHJpbmcoIGRhdGEgLCAidGV4dC94bWwiICk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIElFDQogICAgICAgICAgICAgICAgICAgICAgICB4bWwgPSBuZXcgQWN0aXZlWE9iamVjdCggIk1pY3Jvc29mdC5YTUxET00iICk7DQogICAgICAgICAgICAgICAgICAgICAgICB4bWwuYXN5bmMgPSAiZmFsc2UiOw0KICAgICAgICAgICAgICAgICAgICAgICAgeG1sLmxvYWRYTUwoIGRhdGEgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gY2F0Y2goIGUgKSB7DQogICAgICAgICAgICAgICAgICAgIHhtbCA9IHVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCAheG1sIHx8ICF4bWwuZG9jdW1lbnRFbGVtZW50IHx8IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZSggInBhcnNlcmVycm9yIiApLmxlbmd0aCApIHsNCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmVycm9yKCAiSW52YWxpZCBYTUw6ICIgKyBkYXRhICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB4bWw7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIG5vb3A6IGZ1bmN0aW9uKCkge30sDQogICAgICAgIA0KICAgICAgICAgICAgLy8gRXZhbHVhdGVzIGEgc2NyaXB0IGluIGEgZ2xvYmFsIGNvbnRleHQNCiAgICAgICAgICAgIC8vIFdvcmthcm91bmRzIGJhc2VkIG9uIGZpbmRpbmdzIGJ5IEppbSBEcmlzY29sbA0KICAgICAgICAgICAgLy8gaHR0cDovL3dlYmxvZ3MuamF2YS5uZXQvYmxvZy9kcmlzY29sbC9hcmNoaXZlLzIwMDkvMDkvMDgvZXZhbC1qYXZhc2NyaXB0LWdsb2JhbC1jb250ZXh0DQogICAgICAgICAgICBnbG9iYWxFdmFsOiBmdW5jdGlvbiggZGF0YSApIHsNCiAgICAgICAgICAgICAgICBpZiAoIGRhdGEgJiYgalF1ZXJ5LnRyaW0oIGRhdGEgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgdXNlIGV4ZWNTY3JpcHQgb24gSW50ZXJuZXQgRXhwbG9yZXINCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgdXNlIGFuIGFub255bW91cyBmdW5jdGlvbiBzbyB0aGF0IGNvbnRleHQgaXMgd2luZG93DQogICAgICAgICAgICAgICAgICAgIC8vIHJhdGhlciB0aGFuIGpRdWVyeSBpbiBGaXJlZm94DQogICAgICAgICAgICAgICAgICAgICggd2luZG93LmV4ZWNTY3JpcHQgfHwgZnVuY3Rpb24oIGRhdGEgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3dbICJldmFsIiBdLmNhbGwoIHdpbmRvdywgZGF0YSApOw0KICAgICAgICAgICAgICAgICAgICB9ICkoIGRhdGEgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIC8vIENvbnZlcnQgZGFzaGVkIHRvIGNhbWVsQ2FzZTsgdXNlZCBieSB0aGUgY3NzIGFuZCBkYXRhIG1vZHVsZXMNCiAgICAgICAgICAgIC8vIE1pY3Jvc29mdCBmb3Jnb3QgdG8gaHVtcCB0aGVpciB2ZW5kb3IgcHJlZml4ICgjOTU3MikNCiAgICAgICAgICAgIGNhbWVsQ2FzZTogZnVuY3Rpb24oIHN0cmluZyApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoIHJtc1ByZWZpeCwgIm1zLSIgKS5yZXBsYWNlKCByZGFzaEFscGhhLCBmY2FtZWxDYXNlICk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIG5vZGVOYW1lOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5ub2RlTmFtZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUudG9Mb3dlckNhc2UoKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgLy8gYXJncyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQ0KICAgICAgICAgICAgZWFjaDogZnVuY3Rpb24oIG9iaiwgY2FsbGJhY2ssIGFyZ3MgKSB7DQogICAgICAgICAgICAgICAgdmFyIHZhbHVlLA0KICAgICAgICAgICAgICAgICAgICBpID0gMCwNCiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gb2JqLmxlbmd0aCwNCiAgICAgICAgICAgICAgICAgICAgaXNBcnJheSA9IGlzQXJyYXlsaWtlKCBvYmogKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCBhcmdzICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIGlzQXJyYXkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl2YWx1ZSA9IGNhbGxiYWNrLmFwcGx5KCBvYmpbIGkgXSwgYXJncyApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggaSBpbiBvYmogKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJdmFsdWUgPSBjYWxsYmFjay5hcHBseSggb2JqWyBpIF0sIGFyZ3MgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCB2YWx1ZSA9PT0gZmFsc2UgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBBIHNwZWNpYWwsIGZhc3QsIGNhc2UgZm9yIHRoZSBtb3N0IGNvbW1vbiB1c2Ugb2YgZWFjaA0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggaXNBcnJheSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCXZhbHVlID0gY2FsbGJhY2suY2FsbCggb2JqWyBpIF0sIGksIG9ialsgaSBdICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggdmFsdWUgPT09IGZhbHNlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCBpIGluIG9iaiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl2YWx1ZSA9IGNhbGxiYWNrLmNhbGwoIG9ialsgaSBdLCBpLCBvYmpbIGkgXSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBVc2UgbmF0aXZlIFN0cmluZy50cmltIGZ1bmN0aW9uIHdoZXJldmVyIHBvc3NpYmxlDQogICAgICAgICAgICB0cmltOiBjb3JlX3RyaW0gJiYgIWNvcmVfdHJpbS5jYWxsKCJcdUZFRkZceEEwIikgPw0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCB0ZXh0ICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGV4dCA9PSBudWxsID8NCiAgICAgICAgICAgICAgICAgICAgICAgICIiIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvcmVfdHJpbS5jYWxsKCB0ZXh0ICk7DQogICAgICAgICAgICAgICAgfSA6DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSB1c2Ugb3VyIG93biB0cmltbWluZyBmdW5jdGlvbmFsaXR5DQogICAgICAgICAgICAgICAgZnVuY3Rpb24oIHRleHQgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZXh0ID09IG51bGwgPw0KICAgICAgICAgICAgICAgICAgICAgICAgIiIgOg0KICAgICAgICAgICAgICAgICAgICAgICAgKCB0ZXh0ICsgIiIgKS5yZXBsYWNlKCBydHJpbSwgIiIgKTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIC8vIHJlc3VsdHMgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHkNCiAgICAgICAgICAgIG1ha2VBcnJheTogZnVuY3Rpb24oIGFyciwgcmVzdWx0cyApIHsNCiAgICAgICAgICAgICAgICB2YXIgcmV0ID0gcmVzdWx0cyB8fCBbXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCBhcnIgIT0gbnVsbCApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBpc0FycmF5bGlrZSggT2JqZWN0KGFycikgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5tZXJnZSggcmV0LA0KICAgICAgICAgICAgICAgICAgICAgICAgCXR5cGVvZiBhcnIgPT09ICJzdHJpbmciID8NCiAgICAgICAgICAgICAgICAgICAgICAgIAlbIGFyciBdIDogYXJyDQogICAgICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgY29yZV9wdXNoLmNhbGwoIHJldCwgYXJyICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGluQXJyYXk6IGZ1bmN0aW9uKCBlbGVtLCBhcnIsIGkgKSB7DQogICAgICAgICAgICAgICAgdmFyIGxlbjsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCBhcnIgKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggY29yZV9pbmRleE9mICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvcmVfaW5kZXhPZi5jYWxsKCBhcnIsIGVsZW0sIGkgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbGVuID0gYXJyLmxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgaSA9IGkgPyBpIDwgMCA/IE1hdGgubWF4KCAwLCBsZW4gKyBpICkgOiBpIDogMDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGZvciAoIDsgaSA8IGxlbjsgaSsrICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCBhY2Nlc3NpbmcgaW4gc3BhcnNlIGFycmF5cw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBpIGluIGFyciAmJiBhcnJbIGkgXSA9PT0gZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZXR1cm4gaTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBtZXJnZTogZnVuY3Rpb24oIGZpcnN0LCBzZWNvbmQgKSB7DQogICAgICAgICAgICAgICAgdmFyIGwgPSBzZWNvbmQubGVuZ3RoLA0KICAgICAgICAgICAgICAgICAgICBpID0gZmlyc3QubGVuZ3RoLA0KICAgICAgICAgICAgICAgICAgICBqID0gMDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgbCA9PT0gIm51bWJlciIgKSB7DQogICAgICAgICAgICAgICAgICAgIGZvciAoIDsgaiA8IGw7IGorKyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0WyBpKysgXSA9IHNlY29uZFsgaiBdOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCBzZWNvbmRbal0gIT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0WyBpKysgXSA9IHNlY29uZFsgaisrIF07DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGZpcnN0Lmxlbmd0aCA9IGk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBmaXJzdDsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgZ3JlcDogZnVuY3Rpb24oIGVsZW1zLCBjYWxsYmFjaywgaW52ICkgew0KICAgICAgICAgICAgICAgIHZhciByZXRWYWwsDQogICAgICAgICAgICAgICAgICAgIHJldCA9IFtdLA0KICAgICAgICAgICAgICAgICAgICBpID0gMCwNCiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gZWxlbXMubGVuZ3RoOw0KICAgICAgICAgICAgICAgIGludiA9ICEhaW52Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBHbyB0aHJvdWdoIHRoZSBhcnJheSwgb25seSBzYXZpbmcgdGhlIGl0ZW1zDQogICAgICAgICAgICAgICAgLy8gdGhhdCBwYXNzIHRoZSB2YWxpZGF0b3IgZnVuY3Rpb24NCiAgICAgICAgICAgICAgICBmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gISFjYWxsYmFjayggZWxlbXNbIGkgXSwgaSApOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIGludiAhPT0gcmV0VmFsICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2goIGVsZW1zWyBpIF0gKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgLy8gYXJnIGlzIGZvciBpbnRlcm5hbCB1c2FnZSBvbmx5DQogICAgICAgICAgICBtYXA6IGZ1bmN0aW9uKCBlbGVtcywgY2FsbGJhY2ssIGFyZyApIHsNCiAgICAgICAgICAgICAgICB2YXIgdmFsdWUsDQogICAgICAgICAgICAgICAgICAgIGkgPSAwLA0KICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSBlbGVtcy5sZW5ndGgsDQogICAgICAgICAgICAgICAgICAgIGlzQXJyYXkgPSBpc0FycmF5bGlrZSggZWxlbXMgKSwNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gW107DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEdvIHRocm91Z2ggdGhlIGFycmF5LCB0cmFuc2xhdGluZyBlYWNoIG9mIHRoZSBpdGVtcyB0byB0aGVpcg0KICAgICAgICAgICAgICAgIGlmICggaXNBcnJheSApIHsNCiAgICAgICAgICAgICAgICAgICAgZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNhbGxiYWNrKCBlbGVtc1sgaSBdLCBpLCBhcmcgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHZhbHVlICE9IG51bGwgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0WyByZXQubGVuZ3RoIF0gPSB2YWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBHbyB0aHJvdWdoIGV2ZXJ5IGtleSBvbiB0aGUgb2JqZWN0LA0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGZvciAoIGkgaW4gZWxlbXMgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNhbGxiYWNrKCBlbGVtc1sgaSBdLCBpLCBhcmcgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHZhbHVlICE9IG51bGwgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0WyByZXQubGVuZ3RoIF0gPSB2YWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gRmxhdHRlbiBhbnkgbmVzdGVkIGFycmF5cw0KICAgICAgICAgICAgICAgIHJldHVybiBjb3JlX2NvbmNhdC5hcHBseSggW10sIHJldCApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBBIGdsb2JhbCBHVUlEIGNvdW50ZXIgZm9yIG9iamVjdHMNCiAgICAgICAgICAgIGd1aWQ6IDEsDQogICAgICAgIA0KICAgICAgICAgICAgLy8gQmluZCBhIGZ1bmN0aW9uIHRvIGEgY29udGV4dCwgb3B0aW9uYWxseSBwYXJ0aWFsbHkgYXBwbHlpbmcgYW55DQogICAgICAgICAgICAvLyBhcmd1bWVudHMuDQogICAgICAgICAgICBwcm94eTogZnVuY3Rpb24oIGZuLCBjb250ZXh0ICkgew0KICAgICAgICAgICAgICAgIHZhciBhcmdzLCBwcm94eSwgdG1wOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBjb250ZXh0ID09PSAic3RyaW5nIiApIHsNCiAgICAgICAgICAgICAgICAgICAgdG1wID0gZm5bIGNvbnRleHQgXTsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dCA9IGZuOw0KICAgICAgICAgICAgICAgICAgICBmbiA9IHRtcDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFF1aWNrIGNoZWNrIHRvIGRldGVybWluZSBpZiB0YXJnZXQgaXMgY2FsbGFibGUsIGluIHRoZSBzcGVjDQogICAgICAgICAgICAgICAgLy8gdGhpcyB0aHJvd3MgYSBUeXBlRXJyb3IsIGJ1dCB3ZSB3aWxsIGp1c3QgcmV0dXJuIHVuZGVmaW5lZC4NCiAgICAgICAgICAgICAgICBpZiAoICFqUXVlcnkuaXNGdW5jdGlvbiggZm4gKSApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFNpbXVsYXRlZCBiaW5kDQogICAgICAgICAgICAgICAgYXJncyA9IGNvcmVfc2xpY2UuY2FsbCggYXJndW1lbnRzLCAyICk7DQogICAgICAgICAgICAgICAgcHJveHkgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZuLmFwcGx5KCBjb250ZXh0IHx8IHRoaXMsIGFyZ3MuY29uY2F0KCBjb3JlX3NsaWNlLmNhbGwoIGFyZ3VtZW50cyApICkgKTsNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGd1aWQgb2YgdW5pcXVlIGhhbmRsZXIgdG8gdGhlIHNhbWUgb2Ygb3JpZ2luYWwgaGFuZGxlciwgc28gaXQgY2FuIGJlIHJlbW92ZWQNCiAgICAgICAgICAgICAgICBwcm94eS5ndWlkID0gZm4uZ3VpZCA9IGZuLmd1aWQgfHwgalF1ZXJ5Lmd1aWQrKzsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIHByb3h5Ow0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBNdWx0aWZ1bmN0aW9uYWwgbWV0aG9kIHRvIGdldCBhbmQgc2V0IHZhbHVlcyBvZiBhIGNvbGxlY3Rpb24NCiAgICAgICAgICAgIC8vIFRoZSB2YWx1ZS9zIGNhbiBvcHRpb25hbGx5IGJlIGV4ZWN1dGVkIGlmIGl0J3MgYSBmdW5jdGlvbg0KICAgICAgICAgICAgYWNjZXNzOiBmdW5jdGlvbiggZWxlbXMsIGZuLCBrZXksIHZhbHVlLCBjaGFpbmFibGUsIGVtcHR5R2V0LCByYXcgKSB7DQogICAgICAgICAgICAgICAgdmFyIGkgPSAwLA0KICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSBlbGVtcy5sZW5ndGgsDQogICAgICAgICAgICAgICAgICAgIGJ1bGsgPSBrZXkgPT0gbnVsbDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gU2V0cyBtYW55IHZhbHVlcw0KICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LnR5cGUoIGtleSApID09PSAib2JqZWN0IiApIHsNCiAgICAgICAgICAgICAgICAgICAgY2hhaW5hYmxlID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgZm9yICggaSBpbiBrZXkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuYWNjZXNzKCBlbGVtcywgZm4sIGksIGtleVtpXSwgdHJ1ZSwgZW1wdHlHZXQsIHJhdyApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFNldHMgb25lIHZhbHVlDQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICAgICAgY2hhaW5hYmxlID0gdHJ1ZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmICggIWpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmF3ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCBidWxrICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQnVsayBvcGVyYXRpb25zIHJ1biBhZ2FpbnN0IHRoZSBlbnRpcmUgc2V0DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHJhdyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlmbi5jYWxsKCBlbGVtcywgdmFsdWUgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlmbiA9IG51bGw7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gLi4uZXhjZXB0IHdoZW4gZXhlY3V0aW5nIGZ1bmN0aW9uIHZhbHVlcw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlidWxrID0gZm47DQogICAgICAgICAgICAgICAgICAgICAgICAJZm4gPSBmdW5jdGlvbiggZWxlbSwga2V5LCB2YWx1ZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJcmV0dXJuIGJ1bGsuY2FsbCggalF1ZXJ5KCBlbGVtICksIHZhbHVlICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJfTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCBmbiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWZuKCBlbGVtc1tpXSwga2V5LCByYXcgPyB2YWx1ZSA6IHZhbHVlLmNhbGwoIGVsZW1zW2ldLCBpLCBmbiggZWxlbXNbaV0sIGtleSApICkgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIGNoYWluYWJsZSA/DQogICAgICAgICAgICAgICAgICAgIGVsZW1zIDoNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEdldHMNCiAgICAgICAgICAgICAgICAgICAgYnVsayA/DQogICAgICAgICAgICAgICAgICAgICAgICBmbi5jYWxsKCBlbGVtcyApIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aCA/IGZuKCBlbGVtc1swXSwga2V5ICkgOiBlbXB0eUdldDsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgbm93OiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gKCBuZXcgRGF0ZSgpICkuZ2V0VGltZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGpRdWVyeS5yZWFkeS5wcm9taXNlID0gZnVuY3Rpb24oIG9iaiApIHsNCiAgICAgICAgICAgIGlmICggIXJlYWR5TGlzdCApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmVhZHlMaXN0ID0galF1ZXJ5LkRlZmVycmVkKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIENhdGNoIGNhc2VzIHdoZXJlICQoZG9jdW1lbnQpLnJlYWR5KCkgaXMgY2FsbGVkIGFmdGVyIHRoZSBicm93c2VyIGV2ZW50IGhhcyBhbHJlYWR5IG9jY3VycmVkLg0KICAgICAgICAgICAgICAgIC8vIHdlIG9uY2UgdHJpZWQgdG8gdXNlIHJlYWR5U3RhdGUgImludGVyYWN0aXZlIiBoZXJlLCBidXQgaXQgY2F1c2VkIGlzc3VlcyBsaWtlIHRoZSBvbmUNCiAgICAgICAgICAgICAgICAvLyBkaXNjb3ZlcmVkIGJ5IENocmlzUyBoZXJlOiBodHRwOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC8xMjI4MiNjb21tZW50OjE1DQogICAgICAgICAgICAgICAgaWYgKCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgaXQgYXN5bmNocm9ub3VzbHkgdG8gYWxsb3cgc2NyaXB0cyB0aGUgb3Bwb3J0dW5pdHkgdG8gZGVsYXkgcmVhZHkNCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCggalF1ZXJ5LnJlYWR5ICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFN0YW5kYXJkcy1iYXNlZCBicm93c2VycyBzdXBwb3J0IERPTUNvbnRlbnRMb2FkZWQNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIGhhbmR5IGV2ZW50IGNhbGxiYWNrDQogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICJET01Db250ZW50TG9hZGVkIiwgY29tcGxldGVkLCBmYWxzZSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gQSBmYWxsYmFjayB0byB3aW5kb3cub25sb2FkLCB0aGF0IHdpbGwgYWx3YXlzIHdvcmsNCiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoICJsb2FkIiwgY29tcGxldGVkLCBmYWxzZSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBJZiBJRSBldmVudCBtb2RlbCBpcyB1c2VkDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gRW5zdXJlIGZpcmluZyBiZWZvcmUgb25sb2FkLCBtYXliZSBsYXRlIGJ1dCBzYWZlIGFsc28gZm9yIGlmcmFtZXMNCiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYXR0YWNoRXZlbnQoICJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBjb21wbGV0ZWQgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEEgZmFsbGJhY2sgdG8gd2luZG93Lm9ubG9hZCwgdGhhdCB3aWxsIGFsd2F5cyB3b3JrDQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hdHRhY2hFdmVudCggIm9ubG9hZCIsIGNvbXBsZXRlZCApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgSUUgYW5kIG5vdCBhIGZyYW1lDQogICAgICAgICAgICAgICAgICAgIC8vIGNvbnRpbnVhbGx5IGNoZWNrIHRvIHNlZSBpZiB0aGUgZG9jdW1lbnQgaXMgcmVhZHkNCiAgICAgICAgICAgICAgICAgICAgdmFyIHRvcCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcCA9IHdpbmRvdy5mcmFtZUVsZW1lbnQgPT0gbnVsbCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7DQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkge30NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmICggdG9wICYmIHRvcC5kb1Njcm9sbCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiBkb1Njcm9sbENoZWNrKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggIWpRdWVyeS5pc1JlYWR5ICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCS8vIFVzZSB0aGUgdHJpY2sgYnkgRGllZ28gUGVyaW5pDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkvLyBodHRwOi8vamF2YXNjcmlwdC5ud2JveC5jb20vSUVDb250ZW50TG9hZGVkLw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJdG9wLmRvU2Nyb2xsKCJsZWZ0Iik7DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0gY2F0Y2goZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJcmV0dXJuIHNldFRpbWVvdXQoIGRvU2Nyb2xsQ2hlY2ssIDUwICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIGRldGFjaCBhbGwgZG9tIHJlYWR5IGV2ZW50cw0KICAgICAgICAgICAgICAgICAgICAgICAgCQlkZXRhY2goKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIGFuZCBleGVjdXRlIGFueSB3YWl0aW5nIGZ1bmN0aW9ucw0KICAgICAgICAgICAgICAgICAgICAgICAgCQlqUXVlcnkucmVhZHkoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9KSgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHJlYWR5TGlzdC5wcm9taXNlKCBvYmogKTsNCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIC8vIFBvcHVsYXRlIHRoZSBjbGFzczJ0eXBlIG1hcA0KICAgICAgICBqUXVlcnkuZWFjaCgiQm9vbGVhbiBOdW1iZXIgU3RyaW5nIEZ1bmN0aW9uIEFycmF5IERhdGUgUmVnRXhwIE9iamVjdCBFcnJvciIuc3BsaXQoIiAiKSwgZnVuY3Rpb24oaSwgbmFtZSkgew0KICAgICAgICAgICAgY2xhc3MydHlwZVsgIltvYmplY3QgIiArIG5hbWUgKyAiXSIgXSA9IG5hbWUudG9Mb3dlckNhc2UoKTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBpc0FycmF5bGlrZSggb2JqICkgew0KICAgICAgICAgICAgdmFyIGxlbmd0aCA9IG9iai5sZW5ndGgsDQogICAgICAgICAgICAgICAgdHlwZSA9IGpRdWVyeS50eXBlKCBvYmogKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAoIGpRdWVyeS5pc1dpbmRvdyggb2JqICkgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmICggb2JqLm5vZGVUeXBlID09PSAxICYmIGxlbmd0aCApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gdHlwZSA9PT0gImFycmF5IiB8fCB0eXBlICE9PSAiZnVuY3Rpb24iICYmDQogICAgICAgICAgICAgICAgKCBsZW5ndGggPT09IDAgfHwNCiAgICAgICAgICAgICAgICB0eXBlb2YgbGVuZ3RoID09PSAibnVtYmVyIiAmJiBsZW5ndGggPiAwICYmICggbGVuZ3RoIC0gMSApIGluIG9iaiApOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBBbGwgalF1ZXJ5IG9iamVjdHMgc2hvdWxkIHBvaW50IGJhY2sgdG8gdGhlc2UNCiAgICAgICAgcm9vdGpRdWVyeSA9IGpRdWVyeShkb2N1bWVudCk7DQogICAgICAgIC8vIFN0cmluZyB0byBPYmplY3Qgb3B0aW9ucyBmb3JtYXQgY2FjaGUNCiAgICAgICAgdmFyIG9wdGlvbnNDYWNoZSA9IHt9Ow0KICAgICAgICANCiAgICAgICAgLy8gQ29udmVydCBTdHJpbmctZm9ybWF0dGVkIG9wdGlvbnMgaW50byBPYmplY3QtZm9ybWF0dGVkIG9uZXMgYW5kIHN0b3JlIGluIGNhY2hlDQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZU9wdGlvbnMoIG9wdGlvbnMgKSB7DQogICAgICAgICAgICB2YXIgb2JqZWN0ID0gb3B0aW9uc0NhY2hlWyBvcHRpb25zIF0gPSB7fTsNCiAgICAgICAgICAgIGpRdWVyeS5lYWNoKCBvcHRpb25zLm1hdGNoKCBjb3JlX3Jub3R3aGl0ZSApIHx8IFtdLCBmdW5jdGlvbiggXywgZmxhZyApIHsNCiAgICAgICAgICAgICAgICBvYmplY3RbIGZsYWcgXSA9IHRydWU7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHJldHVybiBvYmplY3Q7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8qDQogICAgICAgICAqIENyZWF0ZSBhIGNhbGxiYWNrIGxpc3QgdXNpbmcgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOg0KICAgICAgICAgKg0KICAgICAgICAgKglvcHRpb25zOiBhbiBvcHRpb25hbCBsaXN0IG9mIHNwYWNlLXNlcGFyYXRlZCBvcHRpb25zIHRoYXQgd2lsbCBjaGFuZ2UgaG93DQogICAgICAgICAqCQkJdGhlIGNhbGxiYWNrIGxpc3QgYmVoYXZlcyBvciBhIG1vcmUgdHJhZGl0aW9uYWwgb3B0aW9uIG9iamVjdA0KICAgICAgICAgKg0KICAgICAgICAgKiBCeSBkZWZhdWx0IGEgY2FsbGJhY2sgbGlzdCB3aWxsIGFjdCBsaWtlIGFuIGV2ZW50IGNhbGxiYWNrIGxpc3QgYW5kIGNhbiBiZQ0KICAgICAgICAgKiAiZmlyZWQiIG11bHRpcGxlIHRpbWVzLg0KICAgICAgICAgKg0KICAgICAgICAgKiBQb3NzaWJsZSBvcHRpb25zOg0KICAgICAgICAgKg0KICAgICAgICAgKglvbmNlOgkJCXdpbGwgZW5zdXJlIHRoZSBjYWxsYmFjayBsaXN0IGNhbiBvbmx5IGJlIGZpcmVkIG9uY2UgKGxpa2UgYSBEZWZlcnJlZCkNCiAgICAgICAgICoNCiAgICAgICAgICoJbWVtb3J5OgkJCXdpbGwga2VlcCB0cmFjayBvZiBwcmV2aW91cyB2YWx1ZXMgYW5kIHdpbGwgY2FsbCBhbnkgY2FsbGJhY2sgYWRkZWQNCiAgICAgICAgICoJCQkJCWFmdGVyIHRoZSBsaXN0IGhhcyBiZWVuIGZpcmVkIHJpZ2h0IGF3YXkgd2l0aCB0aGUgbGF0ZXN0ICJtZW1vcml6ZWQiDQogICAgICAgICAqCQkJCQl2YWx1ZXMgKGxpa2UgYSBEZWZlcnJlZCkNCiAgICAgICAgICoNCiAgICAgICAgICoJdW5pcXVlOgkJCXdpbGwgZW5zdXJlIGEgY2FsbGJhY2sgY2FuIG9ubHkgYmUgYWRkZWQgb25jZSAobm8gZHVwbGljYXRlIGluIHRoZSBsaXN0KQ0KICAgICAgICAgKg0KICAgICAgICAgKglzdG9wT25GYWxzZToJaW50ZXJydXB0IGNhbGxpbmdzIHdoZW4gYSBjYWxsYmFjayByZXR1cm5zIGZhbHNlDQogICAgICAgICAqDQogICAgICAgICAqLw0KICAgICAgICBqUXVlcnkuQ2FsbGJhY2tzID0gZnVuY3Rpb24oIG9wdGlvbnMgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gQ29udmVydCBvcHRpb25zIGZyb20gU3RyaW5nLWZvcm1hdHRlZCB0byBPYmplY3QtZm9ybWF0dGVkIGlmIG5lZWRlZA0KICAgICAgICAgICAgLy8gKHdlIGNoZWNrIGluIGNhY2hlIGZpcnN0KQ0KICAgICAgICAgICAgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb25zID09PSAic3RyaW5nIiA/DQogICAgICAgICAgICAgICAgKCBvcHRpb25zQ2FjaGVbIG9wdGlvbnMgXSB8fCBjcmVhdGVPcHRpb25zKCBvcHRpb25zICkgKSA6DQogICAgICAgICAgICAgICAgalF1ZXJ5LmV4dGVuZCgge30sIG9wdGlvbnMgKTsNCiAgICAgICAgDQogICAgICAgICAgICB2YXIgLy8gRmxhZyB0byBrbm93IGlmIGxpc3QgaXMgY3VycmVudGx5IGZpcmluZw0KICAgICAgICAgICAgICAgIGZpcmluZywNCiAgICAgICAgICAgICAgICAvLyBMYXN0IGZpcmUgdmFsdWUgKGZvciBub24tZm9yZ2V0dGFibGUgbGlzdHMpDQogICAgICAgICAgICAgICAgbWVtb3J5LA0KICAgICAgICAgICAgICAgIC8vIEZsYWcgdG8ga25vdyBpZiBsaXN0IHdhcyBhbHJlYWR5IGZpcmVkDQogICAgICAgICAgICAgICAgZmlyZWQsDQogICAgICAgICAgICAgICAgLy8gRW5kIG9mIHRoZSBsb29wIHdoZW4gZmlyaW5nDQogICAgICAgICAgICAgICAgZmlyaW5nTGVuZ3RoLA0KICAgICAgICAgICAgICAgIC8vIEluZGV4IG9mIGN1cnJlbnRseSBmaXJpbmcgY2FsbGJhY2sgKG1vZGlmaWVkIGJ5IHJlbW92ZSBpZiBuZWVkZWQpDQogICAgICAgICAgICAgICAgZmlyaW5nSW5kZXgsDQogICAgICAgICAgICAgICAgLy8gRmlyc3QgY2FsbGJhY2sgdG8gZmlyZSAodXNlZCBpbnRlcm5hbGx5IGJ5IGFkZCBhbmQgZmlyZVdpdGgpDQogICAgICAgICAgICAgICAgZmlyaW5nU3RhcnQsDQogICAgICAgICAgICAgICAgLy8gQWN0dWFsIGNhbGxiYWNrIGxpc3QNCiAgICAgICAgICAgICAgICBsaXN0ID0gW10sDQogICAgICAgICAgICAgICAgLy8gU3RhY2sgb2YgZmlyZSBjYWxscyBmb3IgcmVwZWF0YWJsZSBsaXN0cw0KICAgICAgICAgICAgICAgIHN0YWNrID0gIW9wdGlvbnMub25jZSAmJiBbXSwNCiAgICAgICAgICAgICAgICAvLyBGaXJlIGNhbGxiYWNrcw0KICAgICAgICAgICAgICAgIGZpcmUgPSBmdW5jdGlvbiggZGF0YSApIHsNCiAgICAgICAgICAgICAgICAgICAgbWVtb3J5ID0gb3B0aW9ucy5tZW1vcnkgJiYgZGF0YTsNCiAgICAgICAgICAgICAgICAgICAgZmlyZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBmaXJpbmdJbmRleCA9IGZpcmluZ1N0YXJ0IHx8IDA7DQogICAgICAgICAgICAgICAgICAgIGZpcmluZ1N0YXJ0ID0gMDsNCiAgICAgICAgICAgICAgICAgICAgZmlyaW5nTGVuZ3RoID0gbGlzdC5sZW5ndGg7DQogICAgICAgICAgICAgICAgICAgIGZpcmluZyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIGZvciAoIDsgbGlzdCAmJiBmaXJpbmdJbmRleCA8IGZpcmluZ0xlbmd0aDsgZmlyaW5nSW5kZXgrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggbGlzdFsgZmlyaW5nSW5kZXggXS5hcHBseSggZGF0YVsgMCBdLCBkYXRhWyAxIF0gKSA9PT0gZmFsc2UgJiYgb3B0aW9ucy5zdG9wT25GYWxzZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAltZW1vcnkgPSBmYWxzZTsgLy8gVG8gcHJldmVudCBmdXJ0aGVyIGNhbGxzIHVzaW5nIGFkZA0KICAgICAgICAgICAgICAgICAgICAgICAgCWJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGZpcmluZyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIGxpc3QgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHN0YWNrICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggc3RhY2subGVuZ3RoICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlmaXJlKCBzdGFjay5zaGlmdCgpICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggbWVtb3J5ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWxpc3QgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJc2VsZi5kaXNhYmxlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIC8vIEFjdHVhbCBDYWxsYmFja3Mgb2JqZWN0DQogICAgICAgICAgICAgICAgc2VsZiA9IHsNCiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGEgY2FsbGJhY2sgb3IgYSBjb2xsZWN0aW9uIG9mIGNhbGxiYWNrcyB0byB0aGUgbGlzdA0KICAgICAgICAgICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBsaXN0ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIEZpcnN0LCB3ZSBzYXZlIHRoZSBjdXJyZW50IGxlbmd0aA0KICAgICAgICAgICAgICAgICAgICAgICAgCXZhciBzdGFydCA9IGxpc3QubGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICAgICAgCShmdW5jdGlvbiBhZGQoIGFyZ3MgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWpRdWVyeS5lYWNoKCBhcmdzLCBmdW5jdGlvbiggXywgYXJnICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJdmFyIHR5cGUgPSBqUXVlcnkudHlwZSggYXJnICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQlpZiAoIHR5cGUgPT09ICJmdW5jdGlvbiIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJaWYgKCAhb3B0aW9ucy51bmlxdWUgfHwgIXNlbGYuaGFzKCBhcmcgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJbGlzdC5wdXNoKCBhcmcgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl9IGVsc2UgaWYgKCBhcmcgJiYgYXJnLmxlbmd0aCAmJiB0eXBlICE9PSAic3RyaW5nIiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkvLyBJbnNwZWN0IHJlY3Vyc2l2ZWx5DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJYWRkKCBhcmcgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAJfSkoIGFyZ3VtZW50cyApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIERvIHdlIG5lZWQgdG8gYWRkIHRoZSBjYWxsYmFja3MgdG8gdGhlDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gY3VycmVudCBmaXJpbmcgYmF0Y2g/DQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBmaXJpbmcgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWZpcmluZ0xlbmd0aCA9IGxpc3QubGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIFdpdGggbWVtb3J5LCBpZiB3ZSdyZSBub3QgZmlyaW5nIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyB3ZSBzaG91bGQgY2FsbCByaWdodCBhd2F5DQogICAgICAgICAgICAgICAgICAgICAgICAJfSBlbHNlIGlmICggbWVtb3J5ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlmaXJpbmdTdGFydCA9IHN0YXJ0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgCQlmaXJlKCBtZW1vcnkgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGEgY2FsbGJhY2sgZnJvbSB0aGUgbGlzdA0KICAgICAgICAgICAgICAgICAgICByZW1vdmU6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBsaXN0ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWpRdWVyeS5lYWNoKCBhcmd1bWVudHMsIGZ1bmN0aW9uKCBfLCBhcmcgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCXZhciBpbmRleDsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJd2hpbGUoICggaW5kZXggPSBqUXVlcnkuaW5BcnJheSggYXJnLCBsaXN0LCBpbmRleCApICkgPiAtMSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWxpc3Quc3BsaWNlKCBpbmRleCwgMSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJLy8gSGFuZGxlIGZpcmluZyBpbmRleGVzDQogICAgICAgICAgICAgICAgICAgICAgICAJCQlpZiAoIGZpcmluZyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQlpZiAoIGluZGV4IDw9IGZpcmluZ0xlbmd0aCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJZmlyaW5nTGVuZ3RoLS07DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCWlmICggaW5kZXggPD0gZmlyaW5nSW5kZXggKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCWZpcmluZ0luZGV4LS07DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJfSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYSBnaXZlbiBjYWxsYmFjayBpcyBpbiB0aGUgbGlzdC4NCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgbm8gYXJndW1lbnQgaXMgZ2l2ZW4sIHJldHVybiB3aGV0aGVyIG9yIG5vdCBsaXN0IGhhcyBjYWxsYmFja3MgYXR0YWNoZWQuDQogICAgICAgICAgICAgICAgICAgIGhhczogZnVuY3Rpb24oIGZuICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZuID8galF1ZXJ5LmluQXJyYXkoIGZuLCBsaXN0ICkgPiAtMSA6ICEhKCBsaXN0ICYmIGxpc3QubGVuZ3RoICk7DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBhbGwgY2FsbGJhY2tzIGZyb20gdGhlIGxpc3QNCiAgICAgICAgICAgICAgICAgICAgZW1wdHk6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGlzdCA9IFtdOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIC8vIEhhdmUgdGhlIGxpc3QgZG8gbm90aGluZyBhbnltb3JlDQogICAgICAgICAgICAgICAgICAgIGRpc2FibGU6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGlzdCA9IHN0YWNrID0gbWVtb3J5ID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIC8vIElzIGl0IGRpc2FibGVkPw0KICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWxpc3Q7DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIC8vIExvY2sgdGhlIGxpc3QgaW4gaXRzIGN1cnJlbnQgc3RhdGUNCiAgICAgICAgICAgICAgICAgICAgbG9jazogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzdGFjayA9IHVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIW1lbW9yeSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlzZWxmLmRpc2FibGUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAvLyBJcyBpdCBsb2NrZWQ/DQogICAgICAgICAgICAgICAgICAgIGxvY2tlZDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIXN0YWNrOw0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAvLyBDYWxsIGFsbCBjYWxsYmFja3Mgd2l0aCB0aGUgZ2l2ZW4gY29udGV4dCBhbmQgYXJndW1lbnRzDQogICAgICAgICAgICAgICAgICAgIGZpcmVXaXRoOiBmdW5jdGlvbiggY29udGV4dCwgYXJncyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBhcmdzIHx8IFtdOw0KICAgICAgICAgICAgICAgICAgICAgICAgYXJncyA9IFsgY29udGV4dCwgYXJncy5zbGljZSA/IGFyZ3Muc2xpY2UoKSA6IGFyZ3MgXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggbGlzdCAmJiAoICFmaXJlZCB8fCBzdGFjayApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggZmlyaW5nICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlzdGFjay5wdXNoKCBhcmdzICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZmlyZSggYXJncyApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAvLyBDYWxsIGFsbCB0aGUgY2FsbGJhY2tzIHdpdGggdGhlIGdpdmVuIGFyZ3VtZW50cw0KICAgICAgICAgICAgICAgICAgICBmaXJlOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZmlyZVdpdGgoIHRoaXMsIGFyZ3VtZW50cyApOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIC8vIFRvIGtub3cgaWYgdGhlIGNhbGxiYWNrcyBoYXZlIGFscmVhZHkgYmVlbiBjYWxsZWQgYXQgbGVhc3Qgb25jZQ0KICAgICAgICAgICAgICAgICAgICBmaXJlZDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gISFmaXJlZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIH07DQogICAgICAgIGpRdWVyeS5leHRlbmQoew0KICAgICAgICANCiAgICAgICAgICAgIERlZmVycmVkOiBmdW5jdGlvbiggZnVuYyApIHsNCiAgICAgICAgICAgICAgICB2YXIgdHVwbGVzID0gWw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWN0aW9uLCBhZGQgbGlzdGVuZXIsIGxpc3RlbmVyIGxpc3QsIGZpbmFsIHN0YXRlDQogICAgICAgICAgICAgICAgICAgICAgICBbICJyZXNvbHZlIiwgImRvbmUiLCBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCAicmVzb2x2ZWQiIF0sDQogICAgICAgICAgICAgICAgICAgICAgICBbICJyZWplY3QiLCAiZmFpbCIsIGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksICJyZWplY3RlZCIgXSwNCiAgICAgICAgICAgICAgICAgICAgICAgIFsgIm5vdGlmeSIsICJwcm9ncmVzcyIsIGpRdWVyeS5DYWxsYmFja3MoIm1lbW9yeSIpIF0NCiAgICAgICAgICAgICAgICAgICAgXSwNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSAicGVuZGluZyIsDQogICAgICAgICAgICAgICAgICAgIHByb21pc2UgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIHN0YXRlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGFsd2F5czogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJZGVmZXJyZWQuZG9uZSggYXJndW1lbnRzICkuZmFpbCggYXJndW1lbnRzICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIHRoaXM7DQogICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgdGhlbjogZnVuY3Rpb24oIC8qIGZuRG9uZSwgZm5GYWlsLCBmblByb2dyZXNzICovICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCXZhciBmbnMgPSBhcmd1bWVudHM7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIGpRdWVyeS5EZWZlcnJlZChmdW5jdGlvbiggbmV3RGVmZXIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWpRdWVyeS5lYWNoKCB0dXBsZXMsIGZ1bmN0aW9uKCBpLCB0dXBsZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCXZhciBhY3Rpb24gPSB0dXBsZVsgMCBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCWZuID0galF1ZXJ5LmlzRnVuY3Rpb24oIGZuc1sgaSBdICkgJiYgZm5zWyBpIF07DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkvLyBkZWZlcnJlZFsgZG9uZSB8IGZhaWwgfCBwcm9ncmVzcyBdIGZvciBmb3J3YXJkaW5nIGFjdGlvbnMgdG8gbmV3RGVmZXINCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWRlZmVycmVkWyB0dXBsZVsxXSBdKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCXZhciByZXR1cm5lZCA9IGZuICYmIGZuLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQlpZiAoIHJldHVybmVkICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCByZXR1cm5lZC5wcm9taXNlICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCXJldHVybmVkLnByb21pc2UoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQkJLmRvbmUoIG5ld0RlZmVyLnJlc29sdmUgKQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQkJLmZhaWwoIG5ld0RlZmVyLnJlamVjdCApDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCQkucHJvZ3Jlc3MoIG5ld0RlZmVyLm5vdGlmeSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCX0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCW5ld0RlZmVyWyBhY3Rpb24gKyAiV2l0aCIgXSggdGhpcyA9PT0gcHJvbWlzZSA/IG5ld0RlZmVyLnByb21pc2UoKSA6IHRoaXMsIGZuID8gWyByZXR1cm5lZCBdIDogYXJndW1lbnRzICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQlmbnMgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0pLnByb21pc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBHZXQgYSBwcm9taXNlIGZvciB0aGlzIGRlZmVycmVkDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBvYmogaXMgcHJvdmlkZWQsIHRoZSBwcm9taXNlIGFzcGVjdCBpcyBhZGRlZCB0byB0aGUgb2JqZWN0DQogICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlOiBmdW5jdGlvbiggb2JqICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCXJldHVybiBvYmogIT0gbnVsbCA/IGpRdWVyeS5leHRlbmQoIG9iaiwgcHJvbWlzZSApIDogcHJvbWlzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQgPSB7fTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gS2VlcCBwaXBlIGZvciBiYWNrLWNvbXBhdA0KICAgICAgICAgICAgICAgIHByb21pc2UucGlwZSA9IHByb21pc2UudGhlbjsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQWRkIGxpc3Qtc3BlY2lmaWMgbWV0aG9kcw0KICAgICAgICAgICAgICAgIGpRdWVyeS5lYWNoKCB0dXBsZXMsIGZ1bmN0aW9uKCBpLCB0dXBsZSApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGxpc3QgPSB0dXBsZVsgMiBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVTdHJpbmcgPSB0dXBsZVsgMyBdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gcHJvbWlzZVsgZG9uZSB8IGZhaWwgfCBwcm9ncmVzcyBdID0gbGlzdC5hZGQNCiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZVsgdHVwbGVbMV0gXSA9IGxpc3QuYWRkOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIHN0YXRlDQogICAgICAgICAgICAgICAgICAgIGlmICggc3RhdGVTdHJpbmcgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBsaXN0LmFkZChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBzdGF0ZSA9IFsgcmVzb2x2ZWQgfCByZWplY3RlZCBdDQogICAgICAgICAgICAgICAgICAgICAgICAJc3RhdGUgPSBzdGF0ZVN0cmluZzsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBbIHJlamVjdF9saXN0IHwgcmVzb2x2ZV9saXN0IF0uZGlzYWJsZTsgcHJvZ3Jlc3NfbGlzdC5sb2NrDQogICAgICAgICAgICAgICAgICAgICAgICB9LCB0dXBsZXNbIGkgXiAxIF1bIDIgXS5kaXNhYmxlLCB0dXBsZXNbIDIgXVsgMiBdLmxvY2sgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gZGVmZXJyZWRbIHJlc29sdmUgfCByZWplY3QgfCBub3RpZnkgXQ0KICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZFsgdHVwbGVbMF0gXSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWRbIHR1cGxlWzBdICsgIldpdGgiIF0oIHRoaXMgPT09IGRlZmVycmVkID8gcHJvbWlzZSA6IHRoaXMsIGFyZ3VtZW50cyApOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIGRlZmVycmVkWyB0dXBsZVswXSArICJXaXRoIiBdID0gbGlzdC5maXJlV2l0aDsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gTWFrZSB0aGUgZGVmZXJyZWQgYSBwcm9taXNlDQogICAgICAgICAgICAgICAgcHJvbWlzZS5wcm9taXNlKCBkZWZlcnJlZCApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBDYWxsIGdpdmVuIGZ1bmMgaWYgYW55DQogICAgICAgICAgICAgICAgaWYgKCBmdW5jICkgew0KICAgICAgICAgICAgICAgICAgICBmdW5jLmNhbGwoIGRlZmVycmVkLCBkZWZlcnJlZCApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQWxsIGRvbmUhDQogICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBEZWZlcnJlZCBoZWxwZXINCiAgICAgICAgICAgIHdoZW46IGZ1bmN0aW9uKCBzdWJvcmRpbmF0ZSAvKiAsIC4uLiwgc3Vib3JkaW5hdGVOICovICkgew0KICAgICAgICAgICAgICAgIHZhciBpID0gMCwNCiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZVZhbHVlcyA9IGNvcmVfc2xpY2UuY2FsbCggYXJndW1lbnRzICksDQogICAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IHJlc29sdmVWYWx1ZXMubGVuZ3RoLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGNvdW50IG9mIHVuY29tcGxldGVkIHN1Ym9yZGluYXRlcw0KICAgICAgICAgICAgICAgICAgICByZW1haW5pbmcgPSBsZW5ndGggIT09IDEgfHwgKCBzdWJvcmRpbmF0ZSAmJiBqUXVlcnkuaXNGdW5jdGlvbiggc3Vib3JkaW5hdGUucHJvbWlzZSApICkgPyBsZW5ndGggOiAwLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIG1hc3RlciBEZWZlcnJlZC4gSWYgcmVzb2x2ZVZhbHVlcyBjb25zaXN0IG9mIG9ubHkgYSBzaW5nbGUgRGVmZXJyZWQsIGp1c3QgdXNlIHRoYXQuDQogICAgICAgICAgICAgICAgICAgIGRlZmVycmVkID0gcmVtYWluaW5nID09PSAxID8gc3Vib3JkaW5hdGUgOiBqUXVlcnkuRGVmZXJyZWQoKSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBmdW5jdGlvbiBmb3IgYm90aCByZXNvbHZlIGFuZCBwcm9ncmVzcyB2YWx1ZXMNCiAgICAgICAgICAgICAgICAgICAgdXBkYXRlRnVuYyA9IGZ1bmN0aW9uKCBpLCBjb250ZXh0cywgdmFsdWVzICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCB2YWx1ZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAljb250ZXh0c1sgaSBdID0gdGhpczsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl2YWx1ZXNbIGkgXSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gY29yZV9zbGljZS5jYWxsKCBhcmd1bWVudHMgKSA6IHZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmKCB2YWx1ZXMgPT09IHByb2dyZXNzVmFsdWVzICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlkZWZlcnJlZC5ub3RpZnlXaXRoKCBjb250ZXh0cywgdmFsdWVzICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJfSBlbHNlIGlmICggISggLS1yZW1haW5pbmcgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZGVmZXJyZWQucmVzb2x2ZVdpdGgoIGNvbnRleHRzLCB2YWx1ZXMgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NWYWx1ZXMsIHByb2dyZXNzQ29udGV4dHMsIHJlc29sdmVDb250ZXh0czsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gYWRkIGxpc3RlbmVycyB0byBEZWZlcnJlZCBzdWJvcmRpbmF0ZXM7IHRyZWF0IG90aGVycyBhcyByZXNvbHZlZA0KICAgICAgICAgICAgICAgIGlmICggbGVuZ3RoID4gMSApIHsNCiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NWYWx1ZXMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOw0KICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0NvbnRleHRzID0gbmV3IEFycmF5KCBsZW5ndGggKTsNCiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZUNvbnRleHRzID0gbmV3IEFycmF5KCBsZW5ndGggKTsNCiAgICAgICAgICAgICAgICAgICAgZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHJlc29sdmVWYWx1ZXNbIGkgXSAmJiBqUXVlcnkuaXNGdW5jdGlvbiggcmVzb2x2ZVZhbHVlc1sgaSBdLnByb21pc2UgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZXNvbHZlVmFsdWVzWyBpIF0ucHJvbWlzZSgpDQogICAgICAgICAgICAgICAgICAgICAgICAJCS5kb25lKCB1cGRhdGVGdW5jKCBpLCByZXNvbHZlQ29udGV4dHMsIHJlc29sdmVWYWx1ZXMgKSApDQogICAgICAgICAgICAgICAgICAgICAgICAJCS5mYWlsKCBkZWZlcnJlZC5yZWplY3QgKQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQkucHJvZ3Jlc3MoIHVwZGF0ZUZ1bmMoIGksIHByb2dyZXNzQ29udGV4dHMsIHByb2dyZXNzVmFsdWVzICkgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJLS1yZW1haW5pbmc7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIG5vdCB3YWl0aW5nIG9uIGFueXRoaW5nLCByZXNvbHZlIHRoZSBtYXN0ZXINCiAgICAgICAgICAgICAgICBpZiAoICFyZW1haW5pbmcgKSB7DQogICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmVXaXRoKCByZXNvbHZlQ29udGV4dHMsIHJlc29sdmVWYWx1ZXMgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBqUXVlcnkuc3VwcG9ydCA9IChmdW5jdGlvbigpIHsNCiAgICAgICAgDQogICAgICAgICAgICB2YXIgc3VwcG9ydCwgYWxsLCBhLA0KICAgICAgICAgICAgICAgIGlucHV0LCBzZWxlY3QsIGZyYWdtZW50LA0KICAgICAgICAgICAgICAgIG9wdCwgZXZlbnROYW1lLCBpc1N1cHBvcnRlZCwgaSwNCiAgICAgICAgICAgICAgICBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBTZXR1cA0KICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSggImNsYXNzTmFtZSIsICJ0IiApOw0KICAgICAgICAgICAgZGl2LmlubmVySFRNTCA9ICIgIDxsaW5rLz48dGFibGU+PC90YWJsZT48YSBocmVmPScvYSc+YTwvYT48aW5wdXQgdHlwZT0nY2hlY2tib3gnLz4iOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIFN1cHBvcnQgdGVzdHMgd29uJ3QgcnVuIGluIHNvbWUgbGltaXRlZCBvciBub24tYnJvd3NlciBlbnZpcm9ubWVudHMNCiAgICAgICAgICAgIGFsbCA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpOw0KICAgICAgICAgICAgYSA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYSIpWyAwIF07DQogICAgICAgICAgICBpZiAoICFhbGwgfHwgIWEgfHwgIWFsbC5sZW5ndGggKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHt9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIEZpcnN0IGJhdGNoIG9mIHRlc3RzDQogICAgICAgICAgICBzZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKTsNCiAgICAgICAgICAgIG9wdCA9IHNlbGVjdC5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIikgKTsNCiAgICAgICAgICAgIGlucHV0ID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpbnB1dCIpWyAwIF07DQogICAgICAgIA0KICAgICAgICAgICAgYS5zdHlsZS5jc3NUZXh0ID0gInRvcDoxcHg7ZmxvYXQ6bGVmdDtvcGFjaXR5Oi41IjsNCiAgICAgICAgICAgIHN1cHBvcnQgPSB7DQogICAgICAgICAgICAgICAgLy8gVGVzdCBzZXRBdHRyaWJ1dGUgb24gY2FtZWxDYXNlIGNsYXNzLiBJZiBpdCB3b3Jrcywgd2UgbmVlZCBhdHRyRml4ZXMgd2hlbiBkb2luZyBnZXQvc2V0QXR0cmlidXRlIChpZTYvNykNCiAgICAgICAgICAgICAgICBnZXRTZXRBdHRyaWJ1dGU6IGRpdi5jbGFzc05hbWUgIT09ICJ0IiwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gSUUgc3RyaXBzIGxlYWRpbmcgd2hpdGVzcGFjZSB3aGVuIC5pbm5lckhUTUwgaXMgdXNlZA0KICAgICAgICAgICAgICAgIGxlYWRpbmdXaGl0ZXNwYWNlOiBkaXYuZmlyc3RDaGlsZC5ub2RlVHlwZSA9PT0gMywNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgdGJvZHkgZWxlbWVudHMgYXJlbid0IGF1dG9tYXRpY2FsbHkgaW5zZXJ0ZWQNCiAgICAgICAgICAgICAgICAvLyBJRSB3aWxsIGluc2VydCB0aGVtIGludG8gZW1wdHkgdGFibGVzDQogICAgICAgICAgICAgICAgdGJvZHk6ICFkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRib2R5IikubGVuZ3RoLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCBsaW5rIGVsZW1lbnRzIGdldCBzZXJpYWxpemVkIGNvcnJlY3RseSBieSBpbm5lckhUTUwNCiAgICAgICAgICAgICAgICAvLyBUaGlzIHJlcXVpcmVzIGEgd3JhcHBlciBlbGVtZW50IGluIElFDQogICAgICAgICAgICAgICAgaHRtbFNlcmlhbGl6ZTogISFkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImxpbmsiKS5sZW5ndGgsDQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgc3R5bGUgaW5mb3JtYXRpb24gZnJvbSBnZXRBdHRyaWJ1dGUNCiAgICAgICAgICAgICAgICAvLyAoSUUgdXNlcyAuY3NzVGV4dCBpbnN0ZWFkKQ0KICAgICAgICAgICAgICAgIHN0eWxlOiAvdG9wLy50ZXN0KCBhLmdldEF0dHJpYnV0ZSgic3R5bGUiKSApLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCBVUkxzIGFyZW4ndCBtYW5pcHVsYXRlZA0KICAgICAgICAgICAgICAgIC8vIChJRSBub3JtYWxpemVzIGl0IGJ5IGRlZmF1bHQpDQogICAgICAgICAgICAgICAgaHJlZk5vcm1hbGl6ZWQ6IGEuZ2V0QXR0cmlidXRlKCJocmVmIikgPT09ICIvYSIsDQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IGVsZW1lbnQgb3BhY2l0eSBleGlzdHMNCiAgICAgICAgICAgICAgICAvLyAoSUUgdXNlcyBmaWx0ZXIgaW5zdGVhZCkNCiAgICAgICAgICAgICAgICAvLyBVc2UgYSByZWdleCB0byB3b3JrIGFyb3VuZCBhIFdlYktpdCBpc3N1ZS4gU2VlICM1MTQ1DQogICAgICAgICAgICAgICAgb3BhY2l0eTogL14wLjUvLnRlc3QoIGEuc3R5bGUub3BhY2l0eSApLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBWZXJpZnkgc3R5bGUgZmxvYXQgZXhpc3RlbmNlDQogICAgICAgICAgICAgICAgLy8gKElFIHVzZXMgc3R5bGVGbG9hdCBpbnN0ZWFkIG9mIGNzc0Zsb2F0KQ0KICAgICAgICAgICAgICAgIGNzc0Zsb2F0OiAhIWEuc3R5bGUuY3NzRmxvYXQsDQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIENoZWNrIHRoZSBkZWZhdWx0IGNoZWNrYm94L3JhZGlvIHZhbHVlICgiIiBvbiBXZWJLaXQ7ICJvbiIgZWxzZXdoZXJlKQ0KICAgICAgICAgICAgICAgIGNoZWNrT246ICEhaW5wdXQudmFsdWUsDQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IGEgc2VsZWN0ZWQtYnktZGVmYXVsdCBvcHRpb24gaGFzIGEgd29ya2luZyBzZWxlY3RlZCBwcm9wZXJ0eS4NCiAgICAgICAgICAgICAgICAvLyAoV2ViS2l0IGRlZmF1bHRzIHRvIGZhbHNlIGluc3RlYWQgb2YgdHJ1ZSwgSUUgdG9vLCBpZiBpdCdzIGluIGFuIG9wdGdyb3VwKQ0KICAgICAgICAgICAgICAgIG9wdFNlbGVjdGVkOiBvcHQuc2VsZWN0ZWQsDQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFRlc3RzIGZvciBlbmN0eXBlIHN1cHBvcnQgb24gYSBmb3JtICgjNjc0MykNCiAgICAgICAgICAgICAgICBlbmN0eXBlOiAhIWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImZvcm0iKS5lbmN0eXBlLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBNYWtlcyBzdXJlIGNsb25pbmcgYW4gaHRtbDUgZWxlbWVudCBkb2VzIG5vdCBjYXVzZSBwcm9ibGVtcw0KICAgICAgICAgICAgICAgIC8vIFdoZXJlIG91dGVySFRNTCBpcyB1bmRlZmluZWQsIHRoaXMgc3RpbGwgd29ya3MNCiAgICAgICAgICAgICAgICBodG1sNUNsb25lOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJuYXYiKS5jbG9uZU5vZGUoIHRydWUgKS5vdXRlckhUTUwgIT09ICI8Om5hdj48LzpuYXY+IiwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8galF1ZXJ5LnN1cHBvcnQuYm94TW9kZWwgREVQUkVDQVRFRCBpbiAxLjggc2luY2Ugd2UgZG9uJ3Qgc3VwcG9ydCBRdWlya3MgTW9kZQ0KICAgICAgICAgICAgICAgIGJveE1vZGVsOiBkb2N1bWVudC5jb21wYXRNb2RlID09PSAiQ1NTMUNvbXBhdCIsDQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFdpbGwgYmUgZGVmaW5lZCBsYXRlcg0KICAgICAgICAgICAgICAgIGRlbGV0ZUV4cGFuZG86IHRydWUsDQogICAgICAgICAgICAgICAgbm9DbG9uZUV2ZW50OiB0cnVlLA0KICAgICAgICAgICAgICAgIGlubGluZUJsb2NrTmVlZHNMYXlvdXQ6IGZhbHNlLA0KICAgICAgICAgICAgICAgIHNocmlua1dyYXBCbG9ja3M6IGZhbHNlLA0KICAgICAgICAgICAgICAgIHJlbGlhYmxlTWFyZ2luUmlnaHQ6IHRydWUsDQogICAgICAgICAgICAgICAgYm94U2l6aW5nUmVsaWFibGU6IHRydWUsDQogICAgICAgICAgICAgICAgcGl4ZWxQb3NpdGlvbjogZmFsc2UNCiAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAgICAgLy8gTWFrZSBzdXJlIGNoZWNrZWQgc3RhdHVzIGlzIHByb3Blcmx5IGNsb25lZA0KICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IHRydWU7DQogICAgICAgICAgICBzdXBwb3J0Lm5vQ2xvbmVDaGVja2VkID0gaW5wdXQuY2xvbmVOb2RlKCB0cnVlICkuY2hlY2tlZDsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0aGUgb3B0aW9ucyBpbnNpZGUgZGlzYWJsZWQgc2VsZWN0cyBhcmVuJ3QgbWFya2VkIGFzIGRpc2FibGVkDQogICAgICAgICAgICAvLyAoV2ViS2l0IG1hcmtzIHRoZW0gYXMgZGlzYWJsZWQpDQogICAgICAgICAgICBzZWxlY3QuZGlzYWJsZWQgPSB0cnVlOw0KICAgICAgICAgICAgc3VwcG9ydC5vcHREaXNhYmxlZCA9ICFvcHQuZGlzYWJsZWQ7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gU3VwcG9ydDogSUU8OQ0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBkZWxldGUgZGl2LnRlc3Q7DQogICAgICAgICAgICB9IGNhdGNoKCBlICkgew0KICAgICAgICAgICAgICAgIHN1cHBvcnQuZGVsZXRlRXhwYW5kbyA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIENoZWNrIGlmIHdlIGNhbiB0cnVzdCBnZXRBdHRyaWJ1dGUoInZhbHVlIikNCiAgICAgICAgICAgIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsNCiAgICAgICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZSggInZhbHVlIiwgIiIgKTsNCiAgICAgICAgICAgIHN1cHBvcnQuaW5wdXQgPSBpbnB1dC5nZXRBdHRyaWJ1dGUoICJ2YWx1ZSIgKSA9PT0gIiI7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYW4gaW5wdXQgbWFpbnRhaW5zIGl0cyB2YWx1ZSBhZnRlciBiZWNvbWluZyBhIHJhZGlvDQogICAgICAgICAgICBpbnB1dC52YWx1ZSA9ICJ0IjsNCiAgICAgICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZSggInR5cGUiLCAicmFkaW8iICk7DQogICAgICAgICAgICBzdXBwb3J0LnJhZGlvVmFsdWUgPSBpbnB1dC52YWx1ZSA9PT0gInQiOw0KICAgICAgICANCiAgICAgICAgICAgIC8vICMxMTIxNyAtIFdlYktpdCBsb3NlcyBjaGVjayB3aGVuIHRoZSBuYW1lIGlzIGFmdGVyIHRoZSBjaGVja2VkIGF0dHJpYnV0ZQ0KICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKCAiY2hlY2tlZCIsICJ0IiApOw0KICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKCAibmFtZSIsICJ0IiApOw0KICAgICAgICANCiAgICAgICAgICAgIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoIGlucHV0ICk7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYSBkaXNjb25uZWN0ZWQgY2hlY2tib3ggd2lsbCByZXRhaW4gaXRzIGNoZWNrZWQNCiAgICAgICAgICAgIC8vIHZhbHVlIG9mIHRydWUgYWZ0ZXIgYXBwZW5kZWQgdG8gdGhlIERPTSAoSUU2LzcpDQogICAgICAgICAgICBzdXBwb3J0LmFwcGVuZENoZWNrZWQgPSBpbnB1dC5jaGVja2VkOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIFdlYktpdCBkb2Vzbid0IGNsb25lIGNoZWNrZWQgc3RhdGUgY29ycmVjdGx5IGluIGZyYWdtZW50cw0KICAgICAgICAgICAgc3VwcG9ydC5jaGVja0Nsb25lID0gZnJhZ21lbnQuY2xvbmVOb2RlKCB0cnVlICkuY2xvbmVOb2RlKCB0cnVlICkubGFzdENoaWxkLmNoZWNrZWQ7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gU3VwcG9ydDogSUU8OQ0KICAgICAgICAgICAgLy8gT3BlcmEgZG9lcyBub3QgY2xvbmUgZXZlbnRzIChhbmQgdHlwZW9mIGRpdi5hdHRhY2hFdmVudCA9PT0gdW5kZWZpbmVkKS4NCiAgICAgICAgICAgIC8vIElFOS0xMCBjbG9uZXMgZXZlbnRzIGJvdW5kIHZpYSBhdHRhY2hFdmVudCwgYnV0IHRoZXkgZG9uJ3QgdHJpZ2dlciB3aXRoIC5jbGljaygpDQogICAgICAgICAgICBpZiAoIGRpdi5hdHRhY2hFdmVudCApIHsNCiAgICAgICAgICAgICAgICBkaXYuYXR0YWNoRXZlbnQoICJvbmNsaWNrIiwgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIHN1cHBvcnQubm9DbG9uZUV2ZW50ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGRpdi5jbG9uZU5vZGUoIHRydWUgKS5jbGljaygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIFN1cHBvcnQ6IElFPDkgKGxhY2sgc3VibWl0L2NoYW5nZSBidWJibGUpLCBGaXJlZm94IDE3KyAobGFjayBmb2N1c2luIGV2ZW50KQ0KICAgICAgICAgICAgLy8gQmV3YXJlIG9mIENTUCByZXN0cmljdGlvbnMgKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL1NlY3VyaXR5L0NTUCksIHRlc3QvY3NwLnBocA0KICAgICAgICAgICAgZm9yICggaSBpbiB7IHN1Ym1pdDogdHJ1ZSwgY2hhbmdlOiB0cnVlLCBmb2N1c2luOiB0cnVlIH0pIHsNCiAgICAgICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCBldmVudE5hbWUgPSAib24iICsgaSwgInQiICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHN1cHBvcnRbIGkgKyAiQnViYmxlcyIgXSA9IGV2ZW50TmFtZSBpbiB3aW5kb3cgfHwgZGl2LmF0dHJpYnV0ZXNbIGV2ZW50TmFtZSBdLmV4cGFuZG8gPT09IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGRpdi5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9ICJjb250ZW50LWJveCI7DQogICAgICAgICAgICBkaXYuY2xvbmVOb2RlKCB0cnVlICkuc3R5bGUuYmFja2dyb3VuZENsaXAgPSAiIjsNCiAgICAgICAgICAgIHN1cHBvcnQuY2xlYXJDbG9uZVN0eWxlID0gZGl2LnN0eWxlLmJhY2tncm91bmRDbGlwID09PSAiY29udGVudC1ib3giOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIFJ1biB0ZXN0cyB0aGF0IG5lZWQgYSBib2R5IGF0IGRvYyByZWFkeQ0KICAgICAgICAgICAgalF1ZXJ5KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIsIG1hcmdpbkRpdiwgdGRzLA0KICAgICAgICAgICAgICAgICAgICBkaXZSZXNldCA9ICJwYWRkaW5nOjA7bWFyZ2luOjA7Ym9yZGVyOjA7ZGlzcGxheTpibG9jaztib3gtc2l6aW5nOmNvbnRlbnQtYm94Oy1tb3otYm94LXNpemluZzpjb250ZW50LWJveDstd2Via2l0LWJveC1zaXppbmc6Y29udGVudC1ib3g7IiwNCiAgICAgICAgICAgICAgICAgICAgYm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF07DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggIWJvZHkgKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBmb3IgZnJhbWVzZXQgZG9jcyB0aGF0IGRvbid0IGhhdmUgYSBib2R5DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS5jc3NUZXh0ID0gImJvcmRlcjowO3dpZHRoOjA7aGVpZ2h0OjA7cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDotOTk5OXB4O21hcmdpbi10b3A6MXB4IjsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYm9keS5hcHBlbmRDaGlsZCggY29udGFpbmVyICkuYXBwZW5kQ2hpbGQoIGRpdiApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBTdXBwb3J0OiBJRTgNCiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0YWJsZSBjZWxscyBzdGlsbCBoYXZlIG9mZnNldFdpZHRoL0hlaWdodCB3aGVuIHRoZXkgYXJlIHNldA0KICAgICAgICAgICAgICAgIC8vIHRvIGRpc3BsYXk6bm9uZSBhbmQgdGhlcmUgYXJlIHN0aWxsIG90aGVyIHZpc2libGUgdGFibGUgY2VsbHMgaW4gYQ0KICAgICAgICAgICAgICAgIC8vIHRhYmxlIHJvdzsgaWYgc28sIG9mZnNldFdpZHRoL0hlaWdodCBhcmUgbm90IHJlbGlhYmxlIGZvciB1c2Ugd2hlbg0KICAgICAgICAgICAgICAgIC8vIGRldGVybWluaW5nIGlmIGFuIGVsZW1lbnQgaGFzIGJlZW4gaGlkZGVuIGRpcmVjdGx5IHVzaW5nDQogICAgICAgICAgICAgICAgLy8gZGlzcGxheTpub25lIChpdCBpcyBzdGlsbCBzYWZlIHRvIHVzZSBvZmZzZXRzIGlmIGEgcGFyZW50IGVsZW1lbnQgaXMNCiAgICAgICAgICAgICAgICAvLyBoaWRkZW47IGRvbiBzYWZldHkgZ29nZ2xlcyBhbmQgc2VlIGJ1ZyAjNDUxMiBmb3IgbW9yZSBpbmZvcm1hdGlvbikuDQogICAgICAgICAgICAgICAgZGl2LmlubmVySFRNTCA9ICI8dGFibGU+PHRyPjx0ZD48L3RkPjx0ZD50PC90ZD48L3RyPjwvdGFibGU+IjsNCiAgICAgICAgICAgICAgICB0ZHMgPSBkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRkIik7DQogICAgICAgICAgICAgICAgdGRzWyAwIF0uc3R5bGUuY3NzVGV4dCA9ICJwYWRkaW5nOjA7bWFyZ2luOjA7Ym9yZGVyOjA7ZGlzcGxheTpub25lIjsNCiAgICAgICAgICAgICAgICBpc1N1cHBvcnRlZCA9ICggdGRzWyAwIF0ub2Zmc2V0SGVpZ2h0ID09PSAwICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRkc1sgMCBdLnN0eWxlLmRpc3BsYXkgPSAiIjsNCiAgICAgICAgICAgICAgICB0ZHNbIDEgXS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBTdXBwb3J0OiBJRTgNCiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBlbXB0eSB0YWJsZSBjZWxscyBzdGlsbCBoYXZlIG9mZnNldFdpZHRoL0hlaWdodA0KICAgICAgICAgICAgICAgIHN1cHBvcnQucmVsaWFibGVIaWRkZW5PZmZzZXRzID0gaXNTdXBwb3J0ZWQgJiYgKCB0ZHNbIDAgXS5vZmZzZXRIZWlnaHQgPT09IDAgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQ2hlY2sgYm94LXNpemluZyBhbmQgbWFyZ2luIGJlaGF2aW9yDQogICAgICAgICAgICAgICAgZGl2LmlubmVySFRNTCA9ICIiOw0KICAgICAgICAgICAgICAgIGRpdi5zdHlsZS5jc3NUZXh0ID0gImJveC1zaXppbmc6Ym9yZGVyLWJveDstbW96LWJveC1zaXppbmc6Ym9yZGVyLWJveDstd2Via2l0LWJveC1zaXppbmc6Ym9yZGVyLWJveDtwYWRkaW5nOjFweDtib3JkZXI6MXB4O2Rpc3BsYXk6YmxvY2s7d2lkdGg6NHB4O21hcmdpbi10b3A6MSU7cG9zaXRpb246YWJzb2x1dGU7dG9wOjElOyI7DQogICAgICAgICAgICAgICAgc3VwcG9ydC5ib3hTaXppbmcgPSAoIGRpdi5vZmZzZXRXaWR0aCA9PT0gNCApOw0KICAgICAgICAgICAgICAgIHN1cHBvcnQuZG9lc05vdEluY2x1ZGVNYXJnaW5JbkJvZHlPZmZzZXQgPSAoIGJvZHkub2Zmc2V0VG9wICE9PSAxICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFVzZSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSBiZWNhdXNlIGpzZG9tIG9uIG5vZGUuanMgd2lsbCBicmVhayB3aXRob3V0IGl0Lg0KICAgICAgICAgICAgICAgIGlmICggd2luZG93LmdldENvbXB1dGVkU3R5bGUgKSB7DQogICAgICAgICAgICAgICAgICAgIHN1cHBvcnQucGl4ZWxQb3NpdGlvbiA9ICggd2luZG93LmdldENvbXB1dGVkU3R5bGUoIGRpdiwgbnVsbCApIHx8IHt9ICkudG9wICE9PSAiMSUiOw0KICAgICAgICAgICAgICAgICAgICBzdXBwb3J0LmJveFNpemluZ1JlbGlhYmxlID0gKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSggZGl2LCBudWxsICkgfHwgeyB3aWR0aDogIjRweCIgfSApLndpZHRoID09PSAiNHB4IjsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGRpdiB3aXRoIGV4cGxpY2l0IHdpZHRoIGFuZCBubyBtYXJnaW4tcmlnaHQgaW5jb3JyZWN0bHkNCiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0cyBjb21wdXRlZCBtYXJnaW4tcmlnaHQgYmFzZWQgb24gd2lkdGggb2YgY29udGFpbmVyLiAoIzMzMzMpDQogICAgICAgICAgICAgICAgICAgIC8vIEZhaWxzIGluIFdlYktpdCBiZWZvcmUgRmViIDIwMTEgbmlnaHRsaWVzDQogICAgICAgICAgICAgICAgICAgIC8vIFdlYktpdCBCdWcgMTMzNDMgLSBnZXRDb21wdXRlZFN0eWxlIHJldHVybnMgd3JvbmcgdmFsdWUgZm9yIG1hcmdpbi1yaWdodA0KICAgICAgICAgICAgICAgICAgICBtYXJnaW5EaXYgPSBkaXYuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpICk7DQogICAgICAgICAgICAgICAgICAgIG1hcmdpbkRpdi5zdHlsZS5jc3NUZXh0ID0gZGl2LnN0eWxlLmNzc1RleHQgPSBkaXZSZXNldDsNCiAgICAgICAgICAgICAgICAgICAgbWFyZ2luRGl2LnN0eWxlLm1hcmdpblJpZ2h0ID0gbWFyZ2luRGl2LnN0eWxlLndpZHRoID0gIjAiOw0KICAgICAgICAgICAgICAgICAgICBkaXYuc3R5bGUud2lkdGggPSAiMXB4IjsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodCA9DQogICAgICAgICAgICAgICAgICAgICAgICAhcGFyc2VGbG9hdCggKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSggbWFyZ2luRGl2LCBudWxsICkgfHwge30gKS5tYXJnaW5SaWdodCApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgZGl2LnN0eWxlLnpvb20gIT09IGNvcmVfc3RydW5kZWZpbmVkICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBTdXBwb3J0OiBJRTw4DQogICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIG5hdGl2ZWx5IGJsb2NrLWxldmVsIGVsZW1lbnRzIGFjdCBsaWtlIGlubGluZS1ibG9jaw0KICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50cyB3aGVuIHNldHRpbmcgdGhlaXIgZGlzcGxheSB0byAnaW5saW5lJyBhbmQgZ2l2aW5nDQogICAgICAgICAgICAgICAgICAgIC8vIHRoZW0gbGF5b3V0DQogICAgICAgICAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSAiIjsNCiAgICAgICAgICAgICAgICAgICAgZGl2LnN0eWxlLmNzc1RleHQgPSBkaXZSZXNldCArICJ3aWR0aDoxcHg7cGFkZGluZzoxcHg7ZGlzcGxheTppbmxpbmU7em9vbToxIjsNCiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydC5pbmxpbmVCbG9ja05lZWRzTGF5b3V0ID0gKCBkaXYub2Zmc2V0V2lkdGggPT09IDMgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQ6IElFNg0KICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBlbGVtZW50cyB3aXRoIGxheW91dCBzaHJpbmstd3JhcCB0aGVpciBjaGlsZHJlbg0KICAgICAgICAgICAgICAgICAgICBkaXYuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQogICAgICAgICAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSAiPGRpdj48L2Rpdj4iOw0KICAgICAgICAgICAgICAgICAgICBkaXYuZmlyc3RDaGlsZC5zdHlsZS53aWR0aCA9ICI1cHgiOw0KICAgICAgICAgICAgICAgICAgICBzdXBwb3J0LnNocmlua1dyYXBCbG9ja3MgPSAoIGRpdi5vZmZzZXRXaWR0aCAhPT0gMyApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCBzdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBQcmV2ZW50IElFIDYgZnJvbSBhZmZlY3RpbmcgbGF5b3V0IGZvciBwb3NpdGlvbmVkIGVsZW1lbnRzICMxMTA0OA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJldmVudCBJRSBmcm9tIHNocmlua2luZyB0aGUgYm9keSBpbiBJRSA3IG1vZGUgIzEyODY5DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdXBwb3J0OiBJRTw4DQogICAgICAgICAgICAgICAgICAgICAgICBib2R5LnN0eWxlLnpvb20gPSAxOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBib2R5LnJlbW92ZUNoaWxkKCBjb250YWluZXIgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gTnVsbCBlbGVtZW50cyB0byBhdm9pZCBsZWFrcyBpbiBJRQ0KICAgICAgICAgICAgICAgIGNvbnRhaW5lciA9IGRpdiA9IHRkcyA9IG1hcmdpbkRpdiA9IG51bGw7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBOdWxsIGVsZW1lbnRzIHRvIGF2b2lkIGxlYWtzIGluIElFDQogICAgICAgICAgICBhbGwgPSBzZWxlY3QgPSBmcmFnbWVudCA9IG9wdCA9IGEgPSBpbnB1dCA9IG51bGw7DQogICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnQ7DQogICAgICAgIH0pKCk7DQogICAgICAgIA0KICAgICAgICB2YXIgcmJyYWNlID0gLyg/Olx7W1xzXFNdKlx9fFxbW1xzXFNdKlxdKSQvLA0KICAgICAgICAgICAgcm11bHRpRGFzaCA9IC8oW0EtWl0pL2c7DQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBpbnRlcm5hbERhdGEoIGVsZW0sIG5hbWUsIGRhdGEsIHB2dCAvKiBJbnRlcm5hbCBVc2UgT25seSAqLyApew0KICAgICAgICAgICAgaWYgKCAhalF1ZXJ5LmFjY2VwdERhdGEoIGVsZW0gKSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgdmFyIHRoaXNDYWNoZSwgcmV0LA0KICAgICAgICAgICAgICAgIGludGVybmFsS2V5ID0galF1ZXJ5LmV4cGFuZG8sDQogICAgICAgICAgICAgICAgZ2V0QnlOYW1lID0gdHlwZW9mIG5hbWUgPT09ICJzdHJpbmciLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIHRvIGhhbmRsZSBET00gbm9kZXMgYW5kIEpTIG9iamVjdHMgZGlmZmVyZW50bHkgYmVjYXVzZSBJRTYtNw0KICAgICAgICAgICAgICAgIC8vIGNhbid0IEdDIG9iamVjdCByZWZlcmVuY2VzIHByb3Blcmx5IGFjcm9zcyB0aGUgRE9NLUpTIGJvdW5kYXJ5DQogICAgICAgICAgICAgICAgaXNOb2RlID0gZWxlbS5ub2RlVHlwZSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gT25seSBET00gbm9kZXMgbmVlZCB0aGUgZ2xvYmFsIGpRdWVyeSBjYWNoZTsgSlMgb2JqZWN0IGRhdGEgaXMNCiAgICAgICAgICAgICAgICAvLyBhdHRhY2hlZCBkaXJlY3RseSB0byB0aGUgb2JqZWN0IHNvIEdDIGNhbiBvY2N1ciBhdXRvbWF0aWNhbGx5DQogICAgICAgICAgICAgICAgY2FjaGUgPSBpc05vZGUgPyBqUXVlcnkuY2FjaGUgOiBlbGVtLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBPbmx5IGRlZmluaW5nIGFuIElEIGZvciBKUyBvYmplY3RzIGlmIGl0cyBjYWNoZSBhbHJlYWR5IGV4aXN0cyBhbGxvd3MNCiAgICAgICAgICAgICAgICAvLyB0aGUgY29kZSB0byBzaG9ydGN1dCBvbiB0aGUgc2FtZSBwYXRoIGFzIGEgRE9NIG5vZGUgd2l0aCBubyBjYWNoZQ0KICAgICAgICAgICAgICAgIGlkID0gaXNOb2RlID8gZWxlbVsgaW50ZXJuYWxLZXkgXSA6IGVsZW1bIGludGVybmFsS2V5IF0gJiYgaW50ZXJuYWxLZXk7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gQXZvaWQgZG9pbmcgYW55IG1vcmUgd29yayB0aGFuIHdlIG5lZWQgdG8gd2hlbiB0cnlpbmcgdG8gZ2V0IGRhdGEgb24gYW4NCiAgICAgICAgICAgIC8vIG9iamVjdCB0aGF0IGhhcyBubyBkYXRhIGF0IGFsbA0KICAgICAgICAgICAgaWYgKCAoIWlkIHx8ICFjYWNoZVtpZF0gfHwgKCFwdnQgJiYgIWNhY2hlW2lkXS5kYXRhKSkgJiYgZ2V0QnlOYW1lICYmIGRhdGEgPT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYgKCAhaWQgKSB7DQogICAgICAgICAgICAgICAgLy8gT25seSBET00gbm9kZXMgbmVlZCBhIG5ldyB1bmlxdWUgSUQgZm9yIGVhY2ggZWxlbWVudCBzaW5jZSB0aGVpciBkYXRhDQogICAgICAgICAgICAgICAgLy8gZW5kcyB1cCBpbiB0aGUgZ2xvYmFsIGNhY2hlDQogICAgICAgICAgICAgICAgaWYgKCBpc05vZGUgKSB7DQogICAgICAgICAgICAgICAgICAgIGVsZW1bIGludGVybmFsS2V5IF0gPSBpZCA9IGNvcmVfZGVsZXRlZElkcy5wb3AoKSB8fCBqUXVlcnkuZ3VpZCsrOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGlkID0gaW50ZXJuYWxLZXk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmICggIWNhY2hlWyBpZCBdICkgew0KICAgICAgICAgICAgICAgIGNhY2hlWyBpZCBdID0ge307DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEF2b2lkcyBleHBvc2luZyBqUXVlcnkgbWV0YWRhdGEgb24gcGxhaW4gSlMgb2JqZWN0cyB3aGVuIHRoZSBvYmplY3QNCiAgICAgICAgICAgICAgICAvLyBpcyBzZXJpYWxpemVkIHVzaW5nIEpTT04uc3RyaW5naWZ5DQogICAgICAgICAgICAgICAgaWYgKCAhaXNOb2RlICkgew0KICAgICAgICAgICAgICAgICAgICBjYWNoZVsgaWQgXS50b0pTT04gPSBqUXVlcnkubm9vcDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gQW4gb2JqZWN0IGNhbiBiZSBwYXNzZWQgdG8galF1ZXJ5LmRhdGEgaW5zdGVhZCBvZiBhIGtleS92YWx1ZSBwYWlyOyB0aGlzIGdldHMNCiAgICAgICAgICAgIC8vIHNoYWxsb3cgY29waWVkIG92ZXIgb250byB0aGUgZXhpc3RpbmcgY2FjaGUNCiAgICAgICAgICAgIGlmICggdHlwZW9mIG5hbWUgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBuYW1lID09PSAiZnVuY3Rpb24iICkgew0KICAgICAgICAgICAgICAgIGlmICggcHZ0ICkgew0KICAgICAgICAgICAgICAgICAgICBjYWNoZVsgaWQgXSA9IGpRdWVyeS5leHRlbmQoIGNhY2hlWyBpZCBdLCBuYW1lICk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY2FjaGVbIGlkIF0uZGF0YSA9IGpRdWVyeS5leHRlbmQoIGNhY2hlWyBpZCBdLmRhdGEsIG5hbWUgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgdGhpc0NhY2hlID0gY2FjaGVbIGlkIF07DQogICAgICAgIA0KICAgICAgICAgICAgLy8galF1ZXJ5IGRhdGEoKSBpcyBzdG9yZWQgaW4gYSBzZXBhcmF0ZSBvYmplY3QgaW5zaWRlIHRoZSBvYmplY3QncyBpbnRlcm5hbCBkYXRhDQogICAgICAgICAgICAvLyBjYWNoZSBpbiBvcmRlciB0byBhdm9pZCBrZXkgY29sbGlzaW9ucyBiZXR3ZWVuIGludGVybmFsIGRhdGEgYW5kIHVzZXItZGVmaW5lZA0KICAgICAgICAgICAgLy8gZGF0YS4NCiAgICAgICAgICAgIGlmICggIXB2dCApIHsNCiAgICAgICAgICAgICAgICBpZiAoICF0aGlzQ2FjaGUuZGF0YSApIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpc0NhY2hlLmRhdGEgPSB7fTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXNDYWNoZSA9IHRoaXNDYWNoZS5kYXRhOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmICggZGF0YSAhPT0gdW5kZWZpbmVkICkgew0KICAgICAgICAgICAgICAgIHRoaXNDYWNoZVsgalF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApIF0gPSBkYXRhOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIENoZWNrIGZvciBib3RoIGNvbnZlcnRlZC10by1jYW1lbCBhbmQgbm9uLWNvbnZlcnRlZCBkYXRhIHByb3BlcnR5IG5hbWVzDQogICAgICAgICAgICAvLyBJZiBhIGRhdGEgcHJvcGVydHkgd2FzIHNwZWNpZmllZA0KICAgICAgICAgICAgaWYgKCBnZXRCeU5hbWUgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEZpcnN0IFRyeSB0byBmaW5kIGFzLWlzIHByb3BlcnR5IGRhdGENCiAgICAgICAgICAgICAgICByZXQgPSB0aGlzQ2FjaGVbIG5hbWUgXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gVGVzdCBmb3IgbnVsbHx1bmRlZmluZWQgcHJvcGVydHkgZGF0YQ0KICAgICAgICAgICAgICAgIGlmICggcmV0ID09IG51bGwgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBUcnkgdG8gZmluZCB0aGUgY2FtZWxDYXNlZCBwcm9wZXJ0eQ0KICAgICAgICAgICAgICAgICAgICByZXQgPSB0aGlzQ2FjaGVbIGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKSBdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0ID0gdGhpc0NhY2hlOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIGludGVybmFsUmVtb3ZlRGF0YSggZWxlbSwgbmFtZSwgcHZ0ICkgew0KICAgICAgICAgICAgaWYgKCAhalF1ZXJ5LmFjY2VwdERhdGEoIGVsZW0gKSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgdmFyIGksIGwsIHRoaXNDYWNoZSwNCiAgICAgICAgICAgICAgICBpc05vZGUgPSBlbGVtLm5vZGVUeXBlLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBTZWUgalF1ZXJ5LmRhdGEgZm9yIG1vcmUgaW5mb3JtYXRpb24NCiAgICAgICAgICAgICAgICBjYWNoZSA9IGlzTm9kZSA/IGpRdWVyeS5jYWNoZSA6IGVsZW0sDQogICAgICAgICAgICAgICAgaWQgPSBpc05vZGUgPyBlbGVtWyBqUXVlcnkuZXhwYW5kbyBdIDogalF1ZXJ5LmV4cGFuZG87DQogICAgICAgIA0KICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgYWxyZWFkeSBubyBjYWNoZSBlbnRyeSBmb3IgdGhpcyBvYmplY3QsIHRoZXJlIGlzIG5vDQogICAgICAgICAgICAvLyBwdXJwb3NlIGluIGNvbnRpbnVpbmcNCiAgICAgICAgICAgIGlmICggIWNhY2hlWyBpZCBdICkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZiAoIG5hbWUgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXNDYWNoZSA9IHB2dCA/IGNhY2hlWyBpZCBdIDogY2FjaGVbIGlkIF0uZGF0YTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCB0aGlzQ2FjaGUgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBTdXBwb3J0IGFycmF5IG9yIHNwYWNlIHNlcGFyYXRlZCBzdHJpbmcgbmFtZXMgZm9yIGRhdGEga2V5cw0KICAgICAgICAgICAgICAgICAgICBpZiAoICFqUXVlcnkuaXNBcnJheSggbmFtZSApICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRyeSB0aGUgc3RyaW5nIGFzIGEga2V5IGJlZm9yZSBhbnkgbWFuaXB1bGF0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIG5hbWUgaW4gdGhpc0NhY2hlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCW5hbWUgPSBbIG5hbWUgXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIHNwbGl0IHRoZSBjYW1lbCBjYXNlZCB2ZXJzaW9uIGJ5IHNwYWNlcyB1bmxlc3MgYSBrZXkgd2l0aCB0aGUgc3BhY2VzIGV4aXN0cw0KICAgICAgICAgICAgICAgICAgICAgICAgCW5hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKCBuYW1lICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBuYW1lIGluIHRoaXNDYWNoZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJbmFtZSA9IFsgbmFtZSBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCW5hbWUgPSBuYW1lLnNwbGl0KCIgIik7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgIm5hbWUiIGlzIGFuIGFycmF5IG9mIGtleXMuLi4NCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdoZW4gZGF0YSBpcyBpbml0aWFsbHkgY3JlYXRlZCwgdmlhICgia2V5IiwgInZhbCIpIHNpZ25hdHVyZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGtleXMgd2lsbCBiZSBjb252ZXJ0ZWQgdG8gY2FtZWxDYXNlLg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2luY2UgdGhlcmUgaXMgbm8gd2F5IHRvIHRlbGwgX2hvd18gYSBrZXkgd2FzIGFkZGVkLCByZW1vdmUNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJvdGggcGxhaW4ga2V5IGFuZCBjYW1lbENhc2Uga2V5LiAjMTI3ODYNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgd2lsbCBvbmx5IHBlbmFsaXplIHRoZSBhcnJheSBhcmd1bWVudCBwYXRoLg0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUuY29uY2F0KCBqUXVlcnkubWFwKCBuYW1lLCBqUXVlcnkuY2FtZWxDYXNlICkgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZm9yICggaSA9IDAsIGwgPSBuYW1lLmxlbmd0aDsgaSA8IGw7IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzQ2FjaGVbIG5hbWVbaV0gXTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gZGF0YSBsZWZ0IGluIHRoZSBjYWNoZSwgd2Ugd2FudCB0byBjb250aW51ZQ0KICAgICAgICAgICAgICAgICAgICAvLyBhbmQgbGV0IHRoZSBjYWNoZSBvYmplY3QgaXRzZWxmIGdldCBkZXN0cm95ZWQNCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhKCBwdnQgPyBpc0VtcHR5RGF0YU9iamVjdCA6IGpRdWVyeS5pc0VtcHR5T2JqZWN0ICkoIHRoaXNDYWNoZSApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIFNlZSBqUXVlcnkuZGF0YSBmb3IgbW9yZSBpbmZvcm1hdGlvbg0KICAgICAgICAgICAgaWYgKCAhcHZ0ICkgew0KICAgICAgICAgICAgICAgIGRlbGV0ZSBjYWNoZVsgaWQgXS5kYXRhOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBEb24ndCBkZXN0cm95IHRoZSBwYXJlbnQgY2FjaGUgdW5sZXNzIHRoZSBpbnRlcm5hbCBkYXRhIG9iamVjdA0KICAgICAgICAgICAgICAgIC8vIGhhZCBiZWVuIHRoZSBvbmx5IHRoaW5nIGxlZnQgaW4gaXQNCiAgICAgICAgICAgICAgICBpZiAoICFpc0VtcHR5RGF0YU9iamVjdCggY2FjaGVbIGlkIF0gKSApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAvLyBEZXN0cm95IHRoZSBjYWNoZQ0KICAgICAgICAgICAgaWYgKCBpc05vZGUgKSB7DQogICAgICAgICAgICAgICAgalF1ZXJ5LmNsZWFuRGF0YSggWyBlbGVtIF0sIHRydWUgKTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBVc2UgZGVsZXRlIHdoZW4gc3VwcG9ydGVkIGZvciBleHBhbmRvcyBvciBgY2FjaGVgIGlzIG5vdCBhIHdpbmRvdyBwZXIgaXNXaW5kb3cgKCMxMDA4MCkNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoIGpRdWVyeS5zdXBwb3J0LmRlbGV0ZUV4cGFuZG8gfHwgY2FjaGUgIT0gY2FjaGUud2luZG93ICkgew0KICAgICAgICAgICAgICAgIGRlbGV0ZSBjYWNoZVsgaWQgXTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBXaGVuIGFsbCBlbHNlIGZhaWxzLCBudWxsDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNhY2hlWyBpZCBdID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgalF1ZXJ5LmV4dGVuZCh7DQogICAgICAgICAgICBjYWNoZToge30sDQogICAgICAgIA0KICAgICAgICAgICAgLy8gVW5pcXVlIGZvciBlYWNoIGNvcHkgb2YgalF1ZXJ5IG9uIHRoZSBwYWdlDQogICAgICAgICAgICAvLyBOb24tZGlnaXRzIHJlbW92ZWQgdG8gbWF0Y2ggcmlubGluZWpRdWVyeQ0KICAgICAgICAgICAgZXhwYW5kbzogImpRdWVyeSIgKyAoIGNvcmVfdmVyc2lvbiArIE1hdGgucmFuZG9tKCkgKS5yZXBsYWNlKCAvXEQvZywgIiIgKSwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGVsZW1lbnRzIHRocm93IHVuY2F0Y2hhYmxlIGV4Y2VwdGlvbnMgaWYgeW91DQogICAgICAgICAgICAvLyBhdHRlbXB0IHRvIGFkZCBleHBhbmRvIHByb3BlcnRpZXMgdG8gdGhlbS4NCiAgICAgICAgICAgIG5vRGF0YTogew0KICAgICAgICAgICAgICAgICJlbWJlZCI6IHRydWUsDQogICAgICAgICAgICAgICAgLy8gQmFuIGFsbCBvYmplY3RzIGV4Y2VwdCBmb3IgRmxhc2ggKHdoaWNoIGhhbmRsZSBleHBhbmRvcykNCiAgICAgICAgICAgICAgICAib2JqZWN0IjogImNsc2lkOkQyN0NEQjZFLUFFNkQtMTFjZi05NkI4LTQ0NDU1MzU0MDAwMCIsDQogICAgICAgICAgICAgICAgImFwcGxldCI6IHRydWUNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgaGFzRGF0YTogZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgZWxlbSA9IGVsZW0ubm9kZVR5cGUgPyBqUXVlcnkuY2FjaGVbIGVsZW1balF1ZXJ5LmV4cGFuZG9dIF0gOiBlbGVtWyBqUXVlcnkuZXhwYW5kbyBdOw0KICAgICAgICAgICAgICAgIHJldHVybiAhIWVsZW0gJiYgIWlzRW1wdHlEYXRhT2JqZWN0KCBlbGVtICk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBkYXRhICkgew0KICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcm5hbERhdGEoIGVsZW0sIG5hbWUsIGRhdGEgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGludGVybmFsUmVtb3ZlRGF0YSggZWxlbSwgbmFtZSApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBGb3IgaW50ZXJuYWwgdXNlIG9ubHkuDQogICAgICAgICAgICBfZGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGRhdGEgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGludGVybmFsRGF0YSggZWxlbSwgbmFtZSwgZGF0YSwgdHJ1ZSApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBfcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGludGVybmFsUmVtb3ZlRGF0YSggZWxlbSwgbmFtZSwgdHJ1ZSApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBBIG1ldGhvZCBmb3IgZGV0ZXJtaW5pbmcgaWYgYSBET00gbm9kZSBjYW4gaGFuZGxlIHRoZSBkYXRhIGV4cGFuZG8NCiAgICAgICAgICAgIGFjY2VwdERhdGE6IGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgIC8vIERvIG5vdCBzZXQgZGF0YSBvbiBub24tZWxlbWVudCBiZWNhdXNlIGl0IHdpbGwgbm90IGJlIGNsZWFyZWQgKCM4MzM1KS4NCiAgICAgICAgICAgICAgICBpZiAoIGVsZW0ubm9kZVR5cGUgJiYgZWxlbS5ub2RlVHlwZSAhPT0gMSAmJiBlbGVtLm5vZGVUeXBlICE9PSA5ICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICB2YXIgbm9EYXRhID0gZWxlbS5ub2RlTmFtZSAmJiBqUXVlcnkubm9EYXRhWyBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gbm9kZXMgYWNjZXB0IGRhdGEgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQ7IHJlamVjdGlvbiBjYW4gYmUgY29uZGl0aW9uYWwNCiAgICAgICAgICAgICAgICByZXR1cm4gIW5vRGF0YSB8fCBub0RhdGEgIT09IHRydWUgJiYgZWxlbS5nZXRBdHRyaWJ1dGUoImNsYXNzaWQiKSA9PT0gbm9EYXRhOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGpRdWVyeS5mbi5leHRlbmQoew0KICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7DQogICAgICAgICAgICAgICAgdmFyIGF0dHJzLCBuYW1lLA0KICAgICAgICAgICAgICAgICAgICBlbGVtID0gdGhpc1swXSwNCiAgICAgICAgICAgICAgICAgICAgaSA9IDAsDQogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBudWxsOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBHZXRzIGFsbCB2YWx1ZXMNCiAgICAgICAgICAgICAgICBpZiAoIGtleSA9PT0gdW5kZWZpbmVkICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIHRoaXMubGVuZ3RoICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGpRdWVyeS5kYXRhKCBlbGVtICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmICFqUXVlcnkuX2RhdGEoIGVsZW0sICJwYXJzZWRBdHRycyIgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlhdHRycyA9IGVsZW0uYXR0cmlidXRlczsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlmb3IgKCA7IGkgPCBhdHRycy5sZW5ndGg7IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJbmFtZSA9IGF0dHJzW2ldLm5hbWU7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQlpZiAoICFuYW1lLmluZGV4T2YoICJkYXRhLSIgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCW5hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKCBuYW1lLnNsaWNlKDUpICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJZGF0YUF0dHIoIGVsZW0sIG5hbWUsIGRhdGFbIG5hbWUgXSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCWpRdWVyeS5fZGF0YSggZWxlbSwgInBhcnNlZEF0dHJzIiwgdHJ1ZSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFNldHMgbXVsdGlwbGUgdmFsdWVzDQogICAgICAgICAgICAgICAgaWYgKCB0eXBlb2Yga2V5ID09PSAib2JqZWN0IiApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5kYXRhKCB0aGlzLCBrZXkgKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgZnVuY3Rpb24oIHZhbHVlICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCB2YWx1ZSA9PT0gdW5kZWZpbmVkICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGZldGNoIGFueSBpbnRlcm5hbGx5IHN0b3JlZCBkYXRhIGZpcnN0DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbSA/IGRhdGFBdHRyKCBlbGVtLCBrZXksIGpRdWVyeS5kYXRhKCBlbGVtLCBrZXkgKSApIDogbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmRhdGEoIHRoaXMsIGtleSwgdmFsdWUgKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfSwgbnVsbCwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggPiAxLCBudWxsLCB0cnVlICk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIHJlbW92ZURhdGE6IGZ1bmN0aW9uKCBrZXkgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LnJlbW92ZURhdGEoIHRoaXMsIGtleSApOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIGRhdGFBdHRyKCBlbGVtLCBrZXksIGRhdGEgKSB7DQogICAgICAgICAgICAvLyBJZiBub3RoaW5nIHdhcyBmb3VuZCBpbnRlcm5hbGx5LCB0cnkgdG8gZmV0Y2ggYW55DQogICAgICAgICAgICAvLyBkYXRhIGZyb20gdGhlIEhUTUw1IGRhdGEtKiBhdHRyaWJ1dGUNCiAgICAgICAgICAgIGlmICggZGF0YSA9PT0gdW5kZWZpbmVkICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHZhciBuYW1lID0gImRhdGEtIiArIGtleS5yZXBsYWNlKCBybXVsdGlEYXNoLCAiLSQxIiApLnRvTG93ZXJDYXNlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGRhdGEgPSBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBkYXRhID09PSAic3RyaW5nIiApIHsNCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhID09PSAidHJ1ZSIgPyB0cnVlIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAlkYXRhID09PSAiZmFsc2UiID8gZmFsc2UgOg0KICAgICAgICAgICAgICAgICAgICAgICAgCWRhdGEgPT09ICJudWxsIiA/IG51bGwgOg0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIE9ubHkgY29udmVydCB0byBhIG51bWJlciBpZiBpdCBkb2Vzbid0IGNoYW5nZSB0aGUgc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAJK2RhdGEgKyAiIiA9PT0gZGF0YSA/ICtkYXRhIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAlyYnJhY2UudGVzdCggZGF0YSApID8galF1ZXJ5LnBhcnNlSlNPTiggZGF0YSApIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZGF0YTsNCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCggZSApIHt9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgd2Ugc2V0IHRoZSBkYXRhIHNvIGl0IGlzbid0IGNoYW5nZWQgbGF0ZXINCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmRhdGEoIGVsZW0sIGtleSwgZGF0YSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBkYXRhID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gZGF0YTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gY2hlY2tzIGEgY2FjaGUgb2JqZWN0IGZvciBlbXB0aW5lc3MNCiAgICAgICAgZnVuY3Rpb24gaXNFbXB0eURhdGFPYmplY3QoIG9iaiApIHsNCiAgICAgICAgICAgIHZhciBuYW1lOw0KICAgICAgICAgICAgZm9yICggbmFtZSBpbiBvYmogKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBwdWJsaWMgZGF0YSBvYmplY3QgaXMgZW1wdHksIHRoZSBwcml2YXRlIGlzIHN0aWxsIGVtcHR5DQogICAgICAgICAgICAgICAgaWYgKCBuYW1lID09PSAiZGF0YSIgJiYgalF1ZXJ5LmlzRW1wdHlPYmplY3QoIG9ialtuYW1lXSApICkgew0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCBuYW1lICE9PSAidG9KU09OIiApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBqUXVlcnkuZXh0ZW5kKHsNCiAgICAgICAgICAgIHF1ZXVlOiBmdW5jdGlvbiggZWxlbSwgdHlwZSwgZGF0YSApIHsNCiAgICAgICAgICAgICAgICB2YXIgcXVldWU7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICggdHlwZSB8fCAiZngiICkgKyAicXVldWUiOw0KICAgICAgICAgICAgICAgICAgICBxdWV1ZSA9IGpRdWVyeS5fZGF0YSggZWxlbSwgdHlwZSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gU3BlZWQgdXAgZGVxdWV1ZSBieSBnZXR0aW5nIG91dCBxdWlja2x5IGlmIHRoaXMgaXMganVzdCBhIGxvb2t1cA0KICAgICAgICAgICAgICAgICAgICBpZiAoIGRhdGEgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFxdWV1ZSB8fCBqUXVlcnkuaXNBcnJheShkYXRhKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlxdWV1ZSA9IGpRdWVyeS5fZGF0YSggZWxlbSwgdHlwZSwgalF1ZXJ5Lm1ha2VBcnJheShkYXRhKSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlxdWV1ZS5wdXNoKCBkYXRhICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXVlIHx8IFtdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgZGVxdWV1ZTogZnVuY3Rpb24oIGVsZW0sIHR5cGUgKSB7DQogICAgICAgICAgICAgICAgdHlwZSA9IHR5cGUgfHwgImZ4IjsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdmFyIHF1ZXVlID0galF1ZXJ5LnF1ZXVlKCBlbGVtLCB0eXBlICksDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0TGVuZ3RoID0gcXVldWUubGVuZ3RoLA0KICAgICAgICAgICAgICAgICAgICBmbiA9IHF1ZXVlLnNoaWZ0KCksDQogICAgICAgICAgICAgICAgICAgIGhvb2tzID0galF1ZXJ5Ll9xdWV1ZUhvb2tzKCBlbGVtLCB0eXBlICksDQogICAgICAgICAgICAgICAgICAgIG5leHQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5kZXF1ZXVlKCBlbGVtLCB0eXBlICk7DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIElmIHRoZSBmeCBxdWV1ZSBpcyBkZXF1ZXVlZCwgYWx3YXlzIHJlbW92ZSB0aGUgcHJvZ3Jlc3Mgc2VudGluZWwNCiAgICAgICAgICAgICAgICBpZiAoIGZuID09PSAiaW5wcm9ncmVzcyIgKSB7DQogICAgICAgICAgICAgICAgICAgIGZuID0gcXVldWUuc2hpZnQoKTsNCiAgICAgICAgICAgICAgICAgICAgc3RhcnRMZW5ndGgtLTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGhvb2tzLmN1ciA9IGZuOw0KICAgICAgICAgICAgICAgIGlmICggZm4gKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBBZGQgYSBwcm9ncmVzcyBzZW50aW5lbCB0byBwcmV2ZW50IHRoZSBmeCBxdWV1ZSBmcm9tIGJlaW5nDQogICAgICAgICAgICAgICAgICAgIC8vIGF1dG9tYXRpY2FsbHkgZGVxdWV1ZWQNCiAgICAgICAgICAgICAgICAgICAgaWYgKCB0eXBlID09PSAiZngiICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcXVldWUudW5zaGlmdCggImlucHJvZ3Jlc3MiICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIGNsZWFyIHVwIHRoZSBsYXN0IHF1ZXVlIHN0b3AgZnVuY3Rpb24NCiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGhvb2tzLnN0b3A7DQogICAgICAgICAgICAgICAgICAgIGZuLmNhbGwoIGVsZW0sIG5leHQsIGhvb2tzICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoICFzdGFydExlbmd0aCAmJiBob29rcyApIHsNCiAgICAgICAgICAgICAgICAgICAgaG9va3MuZW1wdHkuZmlyZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgLy8gbm90IGludGVuZGVkIGZvciBwdWJsaWMgY29uc3VtcHRpb24gLSBnZW5lcmF0ZXMgYSBxdWV1ZUhvb2tzIG9iamVjdCwgb3IgcmV0dXJucyB0aGUgY3VycmVudCBvbmUNCiAgICAgICAgICAgIF9xdWV1ZUhvb2tzOiBmdW5jdGlvbiggZWxlbSwgdHlwZSApIHsNCiAgICAgICAgICAgICAgICB2YXIga2V5ID0gdHlwZSArICJxdWV1ZUhvb2tzIjsNCiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5Ll9kYXRhKCBlbGVtLCBrZXkgKSB8fCBqUXVlcnkuX2RhdGEoIGVsZW0sIGtleSwgew0KICAgICAgICAgICAgICAgICAgICBlbXB0eTogalF1ZXJ5LkNhbGxiYWNrcygib25jZSBtZW1vcnkiKS5hZGQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuX3JlbW92ZURhdGEoIGVsZW0sIHR5cGUgKyAicXVldWUiICk7DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuX3JlbW92ZURhdGEoIGVsZW0sIGtleSApOw0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGpRdWVyeS5mbi5leHRlbmQoew0KICAgICAgICAgICAgcXVldWU6IGZ1bmN0aW9uKCB0eXBlLCBkYXRhICkgew0KICAgICAgICAgICAgICAgIHZhciBzZXR0ZXIgPSAyOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiB0eXBlICE9PSAic3RyaW5nIiApIHsNCiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHR5cGU7DQogICAgICAgICAgICAgICAgICAgIHR5cGUgPSAiZngiOw0KICAgICAgICAgICAgICAgICAgICBzZXR0ZXItLTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCA8IHNldHRlciApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5xdWV1ZSggdGhpc1swXSwgdHlwZSApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEgPT09IHVuZGVmaW5lZCA/DQogICAgICAgICAgICAgICAgICAgIHRoaXMgOg0KICAgICAgICAgICAgICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcXVldWUgPSBqUXVlcnkucXVldWUoIHRoaXMsIHR5cGUsIGRhdGEgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBlbnN1cmUgYSBob29rcyBmb3IgdGhpcyBxdWV1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5Ll9xdWV1ZUhvb2tzKCB0aGlzLCB0eXBlICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB0eXBlID09PSAiZngiICYmIHF1ZXVlWzBdICE9PSAiaW5wcm9ncmVzcyIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJalF1ZXJ5LmRlcXVldWUoIHRoaXMsIHR5cGUgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZGVxdWV1ZTogZnVuY3Rpb24oIHR5cGUgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmRlcXVldWUoIHRoaXMsIHR5cGUgKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvLyBCYXNlZCBvZmYgb2YgdGhlIHBsdWdpbiBieSBDbGludCBIZWxmZXJzLCB3aXRoIHBlcm1pc3Npb24uDQogICAgICAgICAgICAvLyBodHRwOi8vYmxpbmRzaWduYWxzLmNvbS9pbmRleC5waHAvMjAwOS8wNy9qcXVlcnktZGVsYXkvDQogICAgICAgICAgICBkZWxheTogZnVuY3Rpb24oIHRpbWUsIHR5cGUgKSB7DQogICAgICAgICAgICAgICAgdGltZSA9IGpRdWVyeS5meCA/IGpRdWVyeS5meC5zcGVlZHNbIHRpbWUgXSB8fCB0aW1lIDogdGltZTsNCiAgICAgICAgICAgICAgICB0eXBlID0gdHlwZSB8fCAiZngiOw0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5xdWV1ZSggdHlwZSwgZnVuY3Rpb24oIG5leHQsIGhvb2tzICkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgdGltZW91dCA9IHNldFRpbWVvdXQoIG5leHQsIHRpbWUgKTsNCiAgICAgICAgICAgICAgICAgICAgaG9va3Muc3RvcCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KCB0aW1lb3V0ICk7DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgY2xlYXJRdWV1ZTogZnVuY3Rpb24oIHR5cGUgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucXVldWUoIHR5cGUgfHwgImZ4IiwgW10gKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvLyBHZXQgYSBwcm9taXNlIHJlc29sdmVkIHdoZW4gcXVldWVzIG9mIGEgY2VydGFpbiB0eXBlDQogICAgICAgICAgICAvLyBhcmUgZW1wdGllZCAoZnggaXMgdGhlIHR5cGUgYnkgZGVmYXVsdCkNCiAgICAgICAgICAgIHByb21pc2U6IGZ1bmN0aW9uKCB0eXBlLCBvYmogKSB7DQogICAgICAgICAgICAgICAgdmFyIHRtcCwNCiAgICAgICAgICAgICAgICAgICAgY291bnQgPSAxLA0KICAgICAgICAgICAgICAgICAgICBkZWZlciA9IGpRdWVyeS5EZWZlcnJlZCgpLA0KICAgICAgICAgICAgICAgICAgICBlbGVtZW50cyA9IHRoaXMsDQogICAgICAgICAgICAgICAgICAgIGkgPSB0aGlzLmxlbmd0aCwNCiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhKCAtLWNvdW50ICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJZGVmZXIucmVzb2x2ZVdpdGgoIGVsZW1lbnRzLCBbIGVsZW1lbnRzIF0gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIgKSB7DQogICAgICAgICAgICAgICAgICAgIG9iaiA9IHR5cGU7DQogICAgICAgICAgICAgICAgICAgIHR5cGUgPSB1bmRlZmluZWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHR5cGUgPSB0eXBlIHx8ICJmeCI7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHdoaWxlKCBpLS0gKSB7DQogICAgICAgICAgICAgICAgICAgIHRtcCA9IGpRdWVyeS5fZGF0YSggZWxlbWVudHNbIGkgXSwgdHlwZSArICJxdWV1ZUhvb2tzIiApOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIHRtcCAmJiB0bXAuZW1wdHkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb3VudCsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgdG1wLmVtcHR5LmFkZCggcmVzb2x2ZSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJlc29sdmUoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZSggb2JqICk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICB2YXIgbm9kZUhvb2ssIGJvb2xIb29rLA0KICAgICAgICAgICAgcmNsYXNzID0gL1tcdFxyXG5dL2csDQogICAgICAgICAgICBycmV0dXJuID0gL1xyL2csDQogICAgICAgICAgICByZm9jdXNhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9ufG9iamVjdCkkL2ksDQogICAgICAgICAgICByY2xpY2thYmxlID0gL14oPzphfGFyZWEpJC9pLA0KICAgICAgICAgICAgcmJvb2xlYW4gPSAvXig/OmNoZWNrZWR8c2VsZWN0ZWR8YXV0b2ZvY3VzfGF1dG9wbGF5fGFzeW5jfGNvbnRyb2xzfGRlZmVyfGRpc2FibGVkfGhpZGRlbnxsb29wfG11bHRpcGxlfG9wZW58cmVhZG9ubHl8cmVxdWlyZWR8c2NvcGVkKSQvaSwNCiAgICAgICAgICAgIHJ1c2VEZWZhdWx0ID0gL14oPzpjaGVja2VkfHNlbGVjdGVkKSQvaSwNCiAgICAgICAgICAgIGdldFNldEF0dHJpYnV0ZSA9IGpRdWVyeS5zdXBwb3J0LmdldFNldEF0dHJpYnV0ZSwNCiAgICAgICAgICAgIGdldFNldElucHV0ID0galF1ZXJ5LnN1cHBvcnQuaW5wdXQ7DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZm4uZXh0ZW5kKHsNCiAgICAgICAgICAgIGF0dHI6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgalF1ZXJ5LmF0dHIsIG5hbWUsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoID4gMSApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICByZW1vdmVBdHRyOiBmdW5jdGlvbiggbmFtZSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBqUXVlcnkucmVtb3ZlQXR0ciggdGhpcywgbmFtZSApOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBwcm9wOiBmdW5jdGlvbiggbmFtZSwgdmFsdWUgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5hY2Nlc3MoIHRoaXMsIGpRdWVyeS5wcm9wLCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgcmVtb3ZlUHJvcDogZnVuY3Rpb24oIG5hbWUgKSB7DQogICAgICAgICAgICAgICAgbmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAvLyB0cnkvY2F0Y2ggaGFuZGxlcyBjYXNlcyB3aGVyZSBJRSBiYWxrcyAoc3VjaCBhcyByZW1vdmluZyBhIHByb3BlcnR5IG9uIHdpbmRvdykNCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNbIG5hbWUgXSA9IHVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzWyBuYW1lIF07DQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2goIGUgKSB7fQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBhZGRDbGFzczogZnVuY3Rpb24oIHZhbHVlICkgew0KICAgICAgICAgICAgICAgIHZhciBjbGFzc2VzLCBlbGVtLCBjdXIsIGNsYXp6LCBqLA0KICAgICAgICAgICAgICAgICAgICBpID0gMCwNCiAgICAgICAgICAgICAgICAgICAgbGVuID0gdGhpcy5sZW5ndGgsDQogICAgICAgICAgICAgICAgICAgIHByb2NlZWQgPSB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICYmIHZhbHVlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBqICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCB0aGlzICkuYWRkQ2xhc3MoIHZhbHVlLmNhbGwoIHRoaXMsIGosIHRoaXMuY2xhc3NOYW1lICkgKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIHByb2NlZWQgKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFRoZSBkaXNqdW5jdGlvbiBoZXJlIGlzIGZvciBiZXR0ZXIgY29tcHJlc3NpYmlsaXR5IChzZWUgcmVtb3ZlQ2xhc3MpDQogICAgICAgICAgICAgICAgICAgIGNsYXNzZXMgPSAoIHZhbHVlIHx8ICIiICkubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgW107DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0gPSB0aGlzWyBpIF07DQogICAgICAgICAgICAgICAgICAgICAgICBjdXIgPSBlbGVtLm5vZGVUeXBlID09PSAxICYmICggZWxlbS5jbGFzc05hbWUgPw0KICAgICAgICAgICAgICAgICAgICAgICAgCSggIiAiICsgZWxlbS5jbGFzc05hbWUgKyAiICIgKS5yZXBsYWNlKCByY2xhc3MsICIgIiApIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAkiICINCiAgICAgICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBjdXIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJaiA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAJd2hpbGUgKCAoY2xhenogPSBjbGFzc2VzW2orK10pICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlpZiAoIGN1ci5pbmRleE9mKCAiICIgKyBjbGF6eiArICIgIiApIDwgMCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWN1ciArPSBjbGF6eiArICIgIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAllbGVtLmNsYXNzTmFtZSA9IGpRdWVyeS50cmltKCBjdXIgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICByZW1vdmVDbGFzczogZnVuY3Rpb24oIHZhbHVlICkgew0KICAgICAgICAgICAgICAgIHZhciBjbGFzc2VzLCBlbGVtLCBjdXIsIGNsYXp6LCBqLA0KICAgICAgICAgICAgICAgICAgICBpID0gMCwNCiAgICAgICAgICAgICAgICAgICAgbGVuID0gdGhpcy5sZW5ndGgsDQogICAgICAgICAgICAgICAgICAgIHByb2NlZWQgPSBhcmd1bWVudHMubGVuZ3RoID09PSAwIHx8IHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgJiYgdmFsdWU7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGogKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIHRoaXMgKS5yZW1vdmVDbGFzcyggdmFsdWUuY2FsbCggdGhpcywgaiwgdGhpcy5jbGFzc05hbWUgKSApOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCBwcm9jZWVkICkgew0KICAgICAgICAgICAgICAgICAgICBjbGFzc2VzID0gKCB2YWx1ZSB8fCAiIiApLm1hdGNoKCBjb3JlX3Jub3R3aGl0ZSApIHx8IFtdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZm9yICggOyBpIDwgbGVuOyBpKysgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBlbGVtID0gdGhpc1sgaSBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBleHByZXNzaW9uIGlzIGhlcmUgZm9yIGJldHRlciBjb21wcmVzc2liaWxpdHkgKHNlZSBhZGRDbGFzcykNCiAgICAgICAgICAgICAgICAgICAgICAgIGN1ciA9IGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgKCBlbGVtLmNsYXNzTmFtZSA/DQogICAgICAgICAgICAgICAgICAgICAgICAJKCAiICIgKyBlbGVtLmNsYXNzTmFtZSArICIgIiApLnJlcGxhY2UoIHJjbGFzcywgIiAiICkgOg0KICAgICAgICAgICAgICAgICAgICAgICAgCSIiDQogICAgICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggY3VyICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWogPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgCXdoaWxlICggKGNsYXp6ID0gY2xhc3Nlc1tqKytdKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gUmVtb3ZlICphbGwqIGluc3RhbmNlcw0KICAgICAgICAgICAgICAgICAgICAgICAgCQl3aGlsZSAoIGN1ci5pbmRleE9mKCAiICIgKyBjbGF6eiArICIgIiApID49IDAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQljdXIgPSBjdXIucmVwbGFjZSggIiAiICsgY2xhenogKyAiICIsICIgIiApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCWVsZW0uY2xhc3NOYW1lID0gdmFsdWUgPyBqUXVlcnkudHJpbSggY3VyICkgOiAiIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIHRvZ2dsZUNsYXNzOiBmdW5jdGlvbiggdmFsdWUsIHN0YXRlVmFsICkgew0KICAgICAgICAgICAgICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlLA0KICAgICAgICAgICAgICAgICAgICBpc0Jvb2wgPSB0eXBlb2Ygc3RhdGVWYWwgPT09ICJib29sZWFuIjsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeSggdGhpcyApLnRvZ2dsZUNsYXNzKCB2YWx1ZS5jYWxsKHRoaXMsIGksIHRoaXMuY2xhc3NOYW1lLCBzdGF0ZVZhbCksIHN0YXRlVmFsICk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCB0eXBlID09PSAic3RyaW5nIiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRvZ2dsZSBpbmRpdmlkdWFsIGNsYXNzIG5hbWVzDQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgCWkgPSAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgCXNlbGYgPSBqUXVlcnkoIHRoaXMgKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIAlzdGF0ZSA9IHN0YXRlVmFsLA0KICAgICAgICAgICAgICAgICAgICAgICAgCWNsYXNzTmFtZXMgPSB2YWx1ZS5tYXRjaCggY29yZV9ybm90d2hpdGUgKSB8fCBbXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIChjbGFzc05hbWUgPSBjbGFzc05hbWVzWyBpKysgXSkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gY2hlY2sgZWFjaCBjbGFzc05hbWUgZ2l2ZW4sIHNwYWNlIHNlcGFyYXRlZCBsaXN0DQogICAgICAgICAgICAgICAgICAgICAgICAJc3RhdGUgPSBpc0Jvb2wgPyBzdGF0ZSA6ICFzZWxmLmhhc0NsYXNzKCBjbGFzc05hbWUgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlzZWxmWyBzdGF0ZSA/ICJhZGRDbGFzcyIgOiAicmVtb3ZlQ2xhc3MiIF0oIGNsYXNzTmFtZSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gVG9nZ2xlIHdob2xlIGNsYXNzIG5hbWUNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggdHlwZSA9PT0gY29yZV9zdHJ1bmRlZmluZWQgfHwgdHlwZSA9PT0gImJvb2xlYW4iICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB0aGlzLmNsYXNzTmFtZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBzdG9yZSBjbGFzc05hbWUgaWYgc2V0DQogICAgICAgICAgICAgICAgICAgICAgICAJalF1ZXJ5Ll9kYXRhKCB0aGlzLCAiX19jbGFzc05hbWVfXyIsIHRoaXMuY2xhc3NOYW1lICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGVsZW1lbnQgaGFzIGEgY2xhc3MgbmFtZSBvciBpZiB3ZSdyZSBwYXNzZWQgImZhbHNlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZW4gcmVtb3ZlIHRoZSB3aG9sZSBjbGFzc25hbWUgKGlmIHRoZXJlIHdhcyBvbmUsIHRoZSBhYm92ZSBzYXZlZCBpdCkuDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UgYnJpbmcgYmFjayB3aGF0ZXZlciB3YXMgcHJldmlvdXNseSBzYXZlZCAoaWYgYW55dGhpbmcpLA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmFsbGluZyBiYWNrIHRvIHRoZSBlbXB0eSBzdHJpbmcgaWYgbm90aGluZyB3YXMgc3RvcmVkLg0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc05hbWUgPSB0aGlzLmNsYXNzTmFtZSB8fCB2YWx1ZSA9PT0gZmFsc2UgPyAiIiA6IGpRdWVyeS5fZGF0YSggdGhpcywgIl9fY2xhc3NOYW1lX18iICkgfHwgIiI7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgaGFzQ2xhc3M6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsNCiAgICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gIiAiICsgc2VsZWN0b3IgKyAiICIsDQogICAgICAgICAgICAgICAgICAgIGkgPSAwLA0KICAgICAgICAgICAgICAgICAgICBsID0gdGhpcy5sZW5ndGg7DQogICAgICAgICAgICAgICAgZm9yICggOyBpIDwgbDsgaSsrICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIHRoaXNbaV0ubm9kZVR5cGUgPT09IDEgJiYgKCIgIiArIHRoaXNbaV0uY2xhc3NOYW1lICsgIiAiKS5yZXBsYWNlKHJjbGFzcywgIiAiKS5pbmRleE9mKCBjbGFzc05hbWUgKSA+PSAwICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgdmFsOiBmdW5jdGlvbiggdmFsdWUgKSB7DQogICAgICAgICAgICAgICAgdmFyIHJldCwgaG9va3MsIGlzRnVuY3Rpb24sDQogICAgICAgICAgICAgICAgICAgIGVsZW0gPSB0aGlzWzBdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoICFhcmd1bWVudHMubGVuZ3RoICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBob29rcyA9IGpRdWVyeS52YWxIb29rc1sgZWxlbS50eXBlIF0gfHwgalF1ZXJ5LnZhbEhvb2tzWyBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGhvb2tzICYmICJnZXQiIGluIGhvb2tzICYmIChyZXQgPSBob29rcy5nZXQoIGVsZW0sICJ2YWx1ZSIgKSkgIT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZXR1cm4gcmV0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IGVsZW0udmFsdWU7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiByZXQgPT09ICJzdHJpbmciID8NCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBoYW5kbGUgbW9zdCBjb21tb24gc3RyaW5nIGNhc2VzDQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0LnJlcGxhY2UocnJldHVybiwgIiIpIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBoYW5kbGUgY2FzZXMgd2hlcmUgdmFsdWUgaXMgbnVsbC91bmRlZiBvciBudW1iZXINCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZXQgPT0gbnVsbCA/ICIiIDogcmV0Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpc0Z1bmN0aW9uID0galF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGkgKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciB2YWwsDQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmID0galF1ZXJ5KHRoaXMpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCB0aGlzLm5vZGVUeXBlICE9PSAxICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoIGlzRnVuY3Rpb24gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSB2YWx1ZS5jYWxsKCB0aGlzLCBpLCBzZWxmLnZhbCgpICk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSB2YWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gVHJlYXQgbnVsbC91bmRlZmluZWQgYXMgIiI7IGNvbnZlcnQgbnVtYmVycyB0byBzdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgaWYgKCB2YWwgPT0gbnVsbCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9ICIiOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCB0eXBlb2YgdmFsID09PSAibnVtYmVyIiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCArPSAiIjsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbCApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0galF1ZXJ5Lm1hcCh2YWwsIGZ1bmN0aW9uICggdmFsdWUgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVlICsgIiI7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaG9va3MgPSBqUXVlcnkudmFsSG9va3NbIHRoaXMudHlwZSBdIHx8IGpRdWVyeS52YWxIb29rc1sgdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpIF07DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBJZiBzZXQgcmV0dXJucyB1bmRlZmluZWQsIGZhbGwgYmFjayB0byBub3JtYWwgc2V0dGluZw0KICAgICAgICAgICAgICAgICAgICBpZiAoICFob29rcyB8fCAhKCJzZXQiIGluIGhvb2tzKSB8fCBob29rcy5zZXQoIHRoaXMsIHZhbCwgInZhbHVlIiApID09PSB1bmRlZmluZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgalF1ZXJ5LmV4dGVuZCh7DQogICAgICAgICAgICB2YWxIb29rczogew0KICAgICAgICAgICAgICAgIG9wdGlvbjogew0KICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXR0cmlidXRlcy52YWx1ZSBpcyB1bmRlZmluZWQgaW4gQmxhY2tiZXJyeSA0LjcgYnV0DQogICAgICAgICAgICAgICAgICAgICAgICAvLyB1c2VzIC52YWx1ZS4gU2VlICM2OTMyDQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gZWxlbS5hdHRyaWJ1dGVzLnZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICF2YWwgfHwgdmFsLnNwZWNpZmllZCA/IGVsZW0udmFsdWUgOiBlbGVtLnRleHQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHNlbGVjdDogew0KICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlLCBvcHRpb24sDQogICAgICAgICAgICAgICAgICAgICAgICAJb3B0aW9ucyA9IGVsZW0ub3B0aW9ucywNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpbmRleCA9IGVsZW0uc2VsZWN0ZWRJbmRleCwNCiAgICAgICAgICAgICAgICAgICAgICAgIAlvbmUgPSBlbGVtLnR5cGUgPT09ICJzZWxlY3Qtb25lIiB8fCBpbmRleCA8IDAsDQogICAgICAgICAgICAgICAgICAgICAgICAJdmFsdWVzID0gb25lID8gbnVsbCA6IFtdLA0KICAgICAgICAgICAgICAgICAgICAgICAgCW1heCA9IG9uZSA/IGluZGV4ICsgMSA6IG9wdGlvbnMubGVuZ3RoLA0KICAgICAgICAgICAgICAgICAgICAgICAgCWkgPSBpbmRleCA8IDAgPw0KICAgICAgICAgICAgICAgICAgICAgICAgCQltYXggOg0KICAgICAgICAgICAgICAgICAgICAgICAgCQlvbmUgPyBpbmRleCA6IDA7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGFsbCB0aGUgc2VsZWN0ZWQgb3B0aW9ucw0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggOyBpIDwgbWF4OyBpKysgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJb3B0aW9uID0gb3B0aW9uc1sgaSBdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBvbGRJRSBkb2Vzbid0IHVwZGF0ZSBzZWxlY3RlZCBhZnRlciBmb3JtIHJlc2V0ICgjMjU1MSkNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoICggb3B0aW9uLnNlbGVjdGVkIHx8IGkgPT09IGluZGV4ICkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCS8vIERvbid0IHJldHVybiBvcHRpb25zIHRoYXQgYXJlIGRpc2FibGVkIG9yIGluIGEgZGlzYWJsZWQgb3B0Z3JvdXANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCSggalF1ZXJ5LnN1cHBvcnQub3B0RGlzYWJsZWQgPyAhb3B0aW9uLmRpc2FibGVkIDogb3B0aW9uLmdldEF0dHJpYnV0ZSgiZGlzYWJsZWQiKSA9PT0gbnVsbCApICYmDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkoICFvcHRpb24ucGFyZW50Tm9kZS5kaXNhYmxlZCB8fCAhalF1ZXJ5Lm5vZGVOYW1lKCBvcHRpb24ucGFyZW50Tm9kZSwgIm9wdGdyb3VwIiApICkgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkvLyBHZXQgdGhlIHNwZWNpZmljIHZhbHVlIGZvciB0aGUgb3B0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICAJCXZhbHVlID0galF1ZXJ5KCBvcHRpb24gKS52YWwoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIFdlIGRvbid0IG5lZWQgYW4gYXJyYXkgZm9yIG9uZSBzZWxlY3RzDQogICAgICAgICAgICAgICAgICAgICAgICAJCWlmICggb25lICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJcmV0dXJuIHZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkvLyBNdWx0aS1TZWxlY3RzIHJldHVybiBhbiBhcnJheQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQl2YWx1ZXMucHVzaCggdmFsdWUgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlczsNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlcyA9IGpRdWVyeS5tYWtlQXJyYXkoIHZhbHVlICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KGVsZW0pLmZpbmQoIm9wdGlvbiIpLmVhY2goZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJdGhpcy5zZWxlY3RlZCA9IGpRdWVyeS5pbkFycmF5KCBqUXVlcnkodGhpcykudmFsKCksIHZhbHVlcyApID49IDA7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICF2YWx1ZXMubGVuZ3RoICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWVsZW0uc2VsZWN0ZWRJbmRleCA9IC0xOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlczsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgYXR0cjogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgew0KICAgICAgICAgICAgICAgIHZhciBob29rcywgbm90eG1sLCByZXQsDQogICAgICAgICAgICAgICAgICAgIG5UeXBlID0gZWxlbS5ub2RlVHlwZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gZG9uJ3QgZ2V0L3NldCBhdHRyaWJ1dGVzIG9uIHRleHQsIGNvbW1lbnQgYW5kIGF0dHJpYnV0ZSBub2Rlcw0KICAgICAgICAgICAgICAgIGlmICggIWVsZW0gfHwgblR5cGUgPT09IDMgfHwgblR5cGUgPT09IDggfHwgblR5cGUgPT09IDIgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIHByb3Agd2hlbiBhdHRyaWJ1dGVzIGFyZSBub3Qgc3VwcG9ydGVkDQogICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGUgPT09IGNvcmVfc3RydW5kZWZpbmVkICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LnByb3AoIGVsZW0sIG5hbWUsIHZhbHVlICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBub3R4bWwgPSBuVHlwZSAhPT0gMSB8fCAhalF1ZXJ5LmlzWE1MRG9jKCBlbGVtICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEFsbCBhdHRyaWJ1dGVzIGFyZSBsb3dlcmNhc2UNCiAgICAgICAgICAgICAgICAvLyBHcmFiIG5lY2Vzc2FyeSBob29rIGlmIG9uZSBpcyBkZWZpbmVkDQogICAgICAgICAgICAgICAgaWYgKCBub3R4bWwgKSB7DQogICAgICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgICAgIGhvb2tzID0galF1ZXJ5LmF0dHJIb29rc1sgbmFtZSBdIHx8ICggcmJvb2xlYW4udGVzdCggbmFtZSApID8gYm9vbEhvb2sgOiBub2RlSG9vayApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCB2YWx1ZSA9PT0gbnVsbCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5yZW1vdmVBdHRyKCBlbGVtLCBuYW1lICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBob29rcyAmJiBub3R4bWwgJiYgInNldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIG5hbWUgKSkgIT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5zZXRBdHRyaWJ1dGUoIG5hbWUsIHZhbHVlICsgIiIgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBob29rcyAmJiBub3R4bWwgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgbmFtZSApKSAhPT0gbnVsbCApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEluIElFOSssIEZsYXNoIG9iamVjdHMgZG9uJ3QgaGF2ZSAuZ2V0QXR0cmlidXRlICgjMTI5NDUpDQogICAgICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQ6IElFOSsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGUgIT09IGNvcmVfc3RydW5kZWZpbmVkICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gIGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIE5vbi1leGlzdGVudCBhdHRyaWJ1dGVzIHJldHVybiBudWxsLCB3ZSBub3JtYWxpemUgdG8gdW5kZWZpbmVkDQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQgPT0gbnVsbCA/DQogICAgICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQgOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgcmVtb3ZlQXR0cjogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgew0KICAgICAgICAgICAgICAgIHZhciBuYW1lLCBwcm9wTmFtZSwNCiAgICAgICAgICAgICAgICAgICAgaSA9IDAsDQogICAgICAgICAgICAgICAgICAgIGF0dHJOYW1lcyA9IHZhbHVlICYmIHZhbHVlLm1hdGNoKCBjb3JlX3Jub3R3aGl0ZSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIGF0dHJOYW1lcyAmJiBlbGVtLm5vZGVUeXBlID09PSAxICkgew0KICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIChuYW1lID0gYXR0ck5hbWVzW2krK10pICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcHJvcE5hbWUgPSBqUXVlcnkucHJvcEZpeFsgbmFtZSBdIHx8IG5hbWU7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQm9vbGVhbiBhdHRyaWJ1dGVzIGdldCBzcGVjaWFsIHRyZWF0bWVudCAoIzEwODcwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCByYm9vbGVhbi50ZXN0KCBuYW1lICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gU2V0IGNvcnJlc3BvbmRpbmcgcHJvcGVydHkgdG8gZmFsc2UgZm9yIGJvb2xlYW4gYXR0cmlidXRlcw0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIEFsc28gY2xlYXIgZGVmYXVsdENoZWNrZWQvZGVmYXVsdFNlbGVjdGVkIChpZiBhcHByb3ByaWF0ZSkgZm9yIElFPDgNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoICFnZXRTZXRBdHRyaWJ1dGUgJiYgcnVzZURlZmF1bHQudGVzdCggbmFtZSApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQllbGVtWyBqUXVlcnkuY2FtZWxDYXNlKCAiZGVmYXVsdC0iICsgbmFtZSApIF0gPQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJZWxlbVsgcHJvcE5hbWUgXSA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWVsZW1bIHByb3BOYW1lIF0gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2VlICM5Njk5IGZvciBleHBsYW5hdGlvbiBvZiB0aGlzIGFwcHJvYWNoIChzZXR0aW5nIGZpcnN0LCB0aGVuIHJlbW92YWwpDQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgCWpRdWVyeS5hdHRyKCBlbGVtLCBuYW1lLCAiIiApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0ucmVtb3ZlQXR0cmlidXRlKCBnZXRTZXRBdHRyaWJ1dGUgPyBuYW1lIDogcHJvcE5hbWUgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgYXR0ckhvb2tzOiB7DQogICAgICAgICAgICAgICAgdHlwZTogew0KICAgICAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIWpRdWVyeS5zdXBwb3J0LnJhZGlvVmFsdWUgJiYgdmFsdWUgPT09ICJyYWRpbyIgJiYgalF1ZXJ5Lm5vZGVOYW1lKGVsZW0sICJpbnB1dCIpICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIFNldHRpbmcgdGhlIHR5cGUgb24gYSByYWRpbyBidXR0b24gYWZ0ZXIgdGhlIHZhbHVlIHJlc2V0cyB0aGUgdmFsdWUgaW4gSUU2LTkNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBSZXNldCB2YWx1ZSB0byBkZWZhdWx0IGluIGNhc2UgdHlwZSBpcyBzZXQgYWZ0ZXIgdmFsdWUgZHVyaW5nIGNyZWF0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICAJdmFyIHZhbCA9IGVsZW0udmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICAJZWxlbS5zZXRBdHRyaWJ1dGUoICJ0eXBlIiwgdmFsdWUgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIHZhbCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZWxlbS52YWx1ZSA9IHZhbDsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIHZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBwcm9wRml4OiB7DQogICAgICAgICAgICAgICAgdGFiaW5kZXg6ICJ0YWJJbmRleCIsDQogICAgICAgICAgICAgICAgcmVhZG9ubHk6ICJyZWFkT25seSIsDQogICAgICAgICAgICAgICAgImZvciI6ICJodG1sRm9yIiwNCiAgICAgICAgICAgICAgICAiY2xhc3MiOiAiY2xhc3NOYW1lIiwNCiAgICAgICAgICAgICAgICBtYXhsZW5ndGg6ICJtYXhMZW5ndGgiLA0KICAgICAgICAgICAgICAgIGNlbGxzcGFjaW5nOiAiY2VsbFNwYWNpbmciLA0KICAgICAgICAgICAgICAgIGNlbGxwYWRkaW5nOiAiY2VsbFBhZGRpbmciLA0KICAgICAgICAgICAgICAgIHJvd3NwYW46ICJyb3dTcGFuIiwNCiAgICAgICAgICAgICAgICBjb2xzcGFuOiAiY29sU3BhbiIsDQogICAgICAgICAgICAgICAgdXNlbWFwOiAidXNlTWFwIiwNCiAgICAgICAgICAgICAgICBmcmFtZWJvcmRlcjogImZyYW1lQm9yZGVyIiwNCiAgICAgICAgICAgICAgICBjb250ZW50ZWRpdGFibGU6ICJjb250ZW50RWRpdGFibGUiDQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIHByb3A6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCB2YWx1ZSApIHsNCiAgICAgICAgICAgICAgICB2YXIgcmV0LCBob29rcywgbm90eG1sLA0KICAgICAgICAgICAgICAgICAgICBuVHlwZSA9IGVsZW0ubm9kZVR5cGU7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIGRvbid0IGdldC9zZXQgcHJvcGVydGllcyBvbiB0ZXh0LCBjb21tZW50IGFuZCBhdHRyaWJ1dGUgbm9kZXMNCiAgICAgICAgICAgICAgICBpZiAoICFlbGVtIHx8IG5UeXBlID09PSAzIHx8IG5UeXBlID09PSA4IHx8IG5UeXBlID09PSAyICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBub3R4bWwgPSBuVHlwZSAhPT0gMSB8fCAhalF1ZXJ5LmlzWE1MRG9jKCBlbGVtICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggbm90eG1sICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBGaXggbmFtZSBhbmQgYXR0YWNoIGhvb2tzDQogICAgICAgICAgICAgICAgICAgIG5hbWUgPSBqUXVlcnkucHJvcEZpeFsgbmFtZSBdIHx8IG5hbWU7DQogICAgICAgICAgICAgICAgICAgIGhvb2tzID0galF1ZXJ5LnByb3BIb29rc1sgbmFtZSBdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIGhvb2tzICYmICJzZXQiIGluIGhvb2tzICYmIChyZXQgPSBob29rcy5zZXQoIGVsZW0sIHZhbHVlLCBuYW1lICkpICE9PSB1bmRlZmluZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoIGVsZW1bIG5hbWUgXSA9IHZhbHVlICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBuYW1lICkpICE9PSBudWxsICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbVsgbmFtZSBdOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBwcm9wSG9va3M6IHsNCiAgICAgICAgICAgICAgICB0YWJJbmRleDogew0KICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gZWxlbS50YWJJbmRleCBkb2Vzbid0IGFsd2F5cyByZXR1cm4gdGhlIGNvcnJlY3QgdmFsdWUgd2hlbiBpdCBoYXNuJ3QgYmVlbiBleHBsaWNpdGx5IHNldA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gaHR0cDovL2ZsdWlkcHJvamVjdC5vcmcvYmxvZy8yMDA4LzAxLzA5L2dldHRpbmctc2V0dGluZy1hbmQtcmVtb3ZpbmctdGFiaW5kZXgtdmFsdWVzLXdpdGgtamF2YXNjcmlwdC8NCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGVOb2RlID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCJ0YWJpbmRleCIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhdHRyaWJ1dGVOb2RlICYmIGF0dHJpYnV0ZU5vZGUuc3BlY2lmaWVkID8NCiAgICAgICAgICAgICAgICAgICAgICAgIAlwYXJzZUludCggYXR0cmlidXRlTm9kZS52YWx1ZSwgMTAgKSA6DQogICAgICAgICAgICAgICAgICAgICAgICAJcmZvY3VzYWJsZS50ZXN0KCBlbGVtLm5vZGVOYW1lICkgfHwgcmNsaWNrYWJsZS50ZXN0KCBlbGVtLm5vZGVOYW1lICkgJiYgZWxlbS5ocmVmID8NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJMCA6DQogICAgICAgICAgICAgICAgICAgICAgICAJCXVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAvLyBIb29rIGZvciBib29sZWFuIGF0dHJpYnV0ZXMNCiAgICAgICAgYm9vbEhvb2sgPSB7DQogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgew0KICAgICAgICAgICAgICAgIHZhcg0KICAgICAgICAgICAgICAgICAgICAvLyBVc2UgLnByb3AgdG8gZGV0ZXJtaW5lIGlmIHRoaXMgYXR0cmlidXRlIGlzIHVuZGVyc3Rvb2QgYXMgYm9vbGVhbg0KICAgICAgICAgICAgICAgICAgICBwcm9wID0galF1ZXJ5LnByb3AoIGVsZW0sIG5hbWUgKSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEZldGNoIGl0IGFjY29yZGluZ2x5DQogICAgICAgICAgICAgICAgICAgIGF0dHIgPSB0eXBlb2YgcHJvcCA9PT0gImJvb2xlYW4iICYmIGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICksDQogICAgICAgICAgICAgICAgICAgIGRldGFpbCA9IHR5cGVvZiBwcm9wID09PSAiYm9vbGVhbiIgPw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGdldFNldElucHV0ICYmIGdldFNldEF0dHJpYnV0ZSA/DQogICAgICAgICAgICAgICAgICAgICAgICAJYXR0ciAhPSBudWxsIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBvbGRJRSBmYWJyaWNhdGVzIGFuIGVtcHR5IHN0cmluZyBmb3IgbWlzc2luZyBib29sZWFuIGF0dHJpYnV0ZXMNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBhbmQgY29uZmxhdGVzIGNoZWNrZWQvc2VsZWN0ZWQgaW50byBhdHRyb3BlcnRpZXMNCiAgICAgICAgICAgICAgICAgICAgICAgIAlydXNlRGVmYXVsdC50ZXN0KCBuYW1lICkgPw0KICAgICAgICAgICAgICAgICAgICAgICAgCQllbGVtWyBqUXVlcnkuY2FtZWxDYXNlKCAiZGVmYXVsdC0iICsgbmFtZSApIF0gOg0KICAgICAgICAgICAgICAgICAgICAgICAgCQkhIWF0dHIgOg0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZldGNoIGFuIGF0dHJpYnV0ZSBub2RlIGZvciBwcm9wZXJ0aWVzIG5vdCByZWNvZ25pemVkIGFzIGJvb2xlYW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gZGV0YWlsICYmIGRldGFpbC52YWx1ZSAhPT0gZmFsc2UgPw0KICAgICAgICAgICAgICAgICAgICBuYW1lLnRvTG93ZXJDYXNlKCkgOg0KICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQ7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIG5hbWUgKSB7DQogICAgICAgICAgICAgICAgaWYgKCB2YWx1ZSA9PT0gZmFsc2UgKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBib29sZWFuIGF0dHJpYnV0ZXMgd2hlbiBzZXQgdG8gZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LnJlbW92ZUF0dHIoIGVsZW0sIG5hbWUgKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBnZXRTZXRJbnB1dCAmJiBnZXRTZXRBdHRyaWJ1dGUgfHwgIXJ1c2VEZWZhdWx0LnRlc3QoIG5hbWUgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gSUU8OCBuZWVkcyB0aGUgKnByb3BlcnR5KiBuYW1lDQogICAgICAgICAgICAgICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCAhZ2V0U2V0QXR0cmlidXRlICYmIGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZSwgbmFtZSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBVc2UgZGVmYXVsdENoZWNrZWQgYW5kIGRlZmF1bHRTZWxlY3RlZCBmb3Igb2xkSUUNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBlbGVtWyBqUXVlcnkuY2FtZWxDYXNlKCAiZGVmYXVsdC0iICsgbmFtZSApIF0gPSBlbGVtWyBuYW1lIF0gPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIG5hbWU7DQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAvLyBmaXggb2xkSUUgdmFsdWUgYXR0cm9wZXJ0eQ0KICAgICAgICBpZiAoICFnZXRTZXRJbnB1dCB8fCAhZ2V0U2V0QXR0cmlidXRlICkgew0KICAgICAgICAgICAgalF1ZXJ5LmF0dHJIb29rcy52YWx1ZSA9IHsNCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgcmV0ID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCBuYW1lICk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpbnB1dCIgKSA/DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIHRoZSB2YWx1ZSAqcHJvcGVydHkqIGJ5IHVzaW5nIGRlZmF1bHRWYWx1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5kZWZhdWx0VmFsdWUgOg0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHJldCAmJiByZXQuc3BlY2lmaWVkID8gcmV0LnZhbHVlIDogdW5kZWZpbmVkOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIG5hbWUgKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCAiaW5wdXQiICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBEb2VzIG5vdCByZXR1cm4gc28gdGhhdCBzZXRBdHRyaWJ1dGUgaXMgYWxzbyB1c2VkDQogICAgICAgICAgICAgICAgICAgICAgICBlbGVtLmRlZmF1bHRWYWx1ZSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXNlIG5vZGVIb29rIGlmIGRlZmluZWQgKCMxOTU0KTsgb3RoZXJ3aXNlIHNldEF0dHJpYnV0ZSBpcyBmaW5lDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9kZUhvb2sgJiYgbm9kZUhvb2suc2V0KCBlbGVtLCB2YWx1ZSwgbmFtZSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gSUU2LzcgZG8gbm90IHN1cHBvcnQgZ2V0dGluZy9zZXR0aW5nIHNvbWUgYXR0cmlidXRlcyB3aXRoIGdldC9zZXRBdHRyaWJ1dGUNCiAgICAgICAgaWYgKCAhZ2V0U2V0QXR0cmlidXRlICkgew0KICAgICAgICANCiAgICAgICAgICAgIC8vIFVzZSB0aGlzIGZvciBhbnkgYXR0cmlidXRlIGluIElFNi83DQogICAgICAgICAgICAvLyBUaGlzIGZpeGVzIGFsbW9zdCBldmVyeSBJRTYvNyBpc3N1ZQ0KICAgICAgICAgICAgbm9kZUhvb2sgPSBqUXVlcnkudmFsSG9va3MuYnV0dG9uID0gew0KICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciByZXQgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldCAmJiAoIG5hbWUgPT09ICJpZCIgfHwgbmFtZSA9PT0gIm5hbWUiIHx8IG5hbWUgPT09ICJjb29yZHMiID8gcmV0LnZhbHVlICE9PSAiIiA6IHJldC5zcGVjaWZpZWQgKSA/DQogICAgICAgICAgICAgICAgICAgICAgICByZXQudmFsdWUgOg0KICAgICAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIG5hbWUgKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgZXhpc3Rpbmcgb3IgY3JlYXRlIGEgbmV3IGF0dHJpYnV0ZSBub2RlDQogICAgICAgICAgICAgICAgICAgIHZhciByZXQgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhcmV0ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5zZXRBdHRyaWJ1dGVOb2RlKA0KICAgICAgICAgICAgICAgICAgICAgICAgCShyZXQgPSBlbGVtLm93bmVyRG9jdW1lbnQuY3JlYXRlQXR0cmlidXRlKCBuYW1lICkpDQogICAgICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXQudmFsdWUgPSB2YWx1ZSArPSAiIjsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEJyZWFrIGFzc29jaWF0aW9uIHdpdGggY2xvbmVkIGVsZW1lbnRzIGJ5IGFsc28gdXNpbmcgc2V0QXR0cmlidXRlICgjOTY0NikNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hbWUgPT09ICJ2YWx1ZSIgfHwgdmFsdWUgPT09IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICkgPw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgOg0KICAgICAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAgICAgLy8gU2V0IGNvbnRlbnRlZGl0YWJsZSB0byBmYWxzZSBvbiByZW1vdmFscygjMTA0MjkpDQogICAgICAgICAgICAvLyBTZXR0aW5nIHRvIGVtcHR5IHN0cmluZyB0aHJvd3MgYW4gZXJyb3IgYXMgYW4gaW52YWxpZCB2YWx1ZQ0KICAgICAgICAgICAgalF1ZXJ5LmF0dHJIb29rcy5jb250ZW50ZWRpdGFibGUgPSB7DQogICAgICAgICAgICAgICAgZ2V0OiBub2RlSG9vay5nZXQsDQogICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIG5hbWUgKSB7DQogICAgICAgICAgICAgICAgICAgIG5vZGVIb29rLnNldCggZWxlbSwgdmFsdWUgPT09ICIiID8gZmFsc2UgOiB2YWx1ZSwgbmFtZSApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAgICAgLy8gU2V0IHdpZHRoIGFuZCBoZWlnaHQgdG8gYXV0byBpbnN0ZWFkIG9mIDAgb24gZW1wdHkgc3RyaW5nKCBCdWcgIzgxNTAgKQ0KICAgICAgICAgICAgLy8gVGhpcyBpcyBmb3IgcmVtb3ZhbHMNCiAgICAgICAgICAgIGpRdWVyeS5lYWNoKFsgIndpZHRoIiwgImhlaWdodCIgXSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7DQogICAgICAgICAgICAgICAgalF1ZXJ5LmF0dHJIb29rc1sgbmFtZSBdID0galF1ZXJ5LmV4dGVuZCggalF1ZXJ5LmF0dHJIb29rc1sgbmFtZSBdLCB7DQogICAgICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB2YWx1ZSA9PT0gIiIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJZWxlbS5zZXRBdHRyaWJ1dGUoIG5hbWUsICJhdXRvIiApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCXJldHVybiB2YWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICAvLyBTb21lIGF0dHJpYnV0ZXMgcmVxdWlyZSBhIHNwZWNpYWwgY2FsbCBvbiBJRQ0KICAgICAgICAvLyBodHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvbXM1MzY0MjklMjhWUy44NSUyOS5hc3B4DQogICAgICAgIGlmICggIWpRdWVyeS5zdXBwb3J0LmhyZWZOb3JtYWxpemVkICkgew0KICAgICAgICAgICAgalF1ZXJ5LmVhY2goWyAiaHJlZiIsICJzcmMiLCAid2lkdGgiLCAiaGVpZ2h0IiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsNCiAgICAgICAgICAgICAgICBqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0gPSBqUXVlcnkuZXh0ZW5kKCBqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0sIHsNCiAgICAgICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXQgPSBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSwgMiApOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldCA9PSBudWxsID8gdW5kZWZpbmVkIDogcmV0Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBocmVmL3NyYyBwcm9wZXJ0eSBzaG91bGQgZ2V0IHRoZSBmdWxsIG5vcm1hbGl6ZWQgVVJMICgjMTAyOTkvIzEyOTE1KQ0KICAgICAgICAgICAgalF1ZXJ5LmVhY2goWyAiaHJlZiIsICJzcmMiIF0sIGZ1bmN0aW9uKCBpLCBuYW1lICkgew0KICAgICAgICAgICAgICAgIGpRdWVyeS5wcm9wSG9va3NbIG5hbWUgXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSwgNCApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC5zdHlsZSApIHsNCiAgICAgICAgICAgIGpRdWVyeS5hdHRySG9va3Muc3R5bGUgPSB7DQogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHVuZGVmaW5lZCBpbiB0aGUgY2FzZSBvZiBlbXB0eSBzdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgLy8gTm90ZTogSUUgdXBwZXJjYXNlcyBjc3MgcHJvcGVydHkgbmFtZXMsIGJ1dCBpZiB3ZSB3ZXJlIHRvIC50b0xvd2VyQ2FzZSgpDQogICAgICAgICAgICAgICAgICAgIC8vIC5jc3NUZXh0LCB0aGF0IHdvdWxkIGRlc3Ryb3kgY2FzZSBzZW5zdGl0aXZpdHkgaW4gVVJMJ3MsIGxpa2UgaW4gImJhY2tncm91bmQiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLnN0eWxlLmNzc1RleHQgfHwgdW5kZWZpbmVkOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoIGVsZW0uc3R5bGUuY3NzVGV4dCA9IHZhbHVlICsgIiIgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBTYWZhcmkgbWlzLXJlcG9ydHMgdGhlIGRlZmF1bHQgc2VsZWN0ZWQgcHJvcGVydHkgb2YgYW4gb3B0aW9uDQogICAgICAgIC8vIEFjY2Vzc2luZyB0aGUgcGFyZW50J3Mgc2VsZWN0ZWRJbmRleCBwcm9wZXJ0eSBmaXhlcyBpdA0KICAgICAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC5vcHRTZWxlY3RlZCApIHsNCiAgICAgICAgICAgIGpRdWVyeS5wcm9wSG9va3Muc2VsZWN0ZWQgPSBqUXVlcnkuZXh0ZW5kKCBqUXVlcnkucHJvcEhvb2tzLnNlbGVjdGVkLCB7DQogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IGVsZW0ucGFyZW50Tm9kZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmICggcGFyZW50ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LnNlbGVjdGVkSW5kZXg7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgaXQgYWxzbyB3b3JrcyB3aXRoIG9wdGdyb3Vwcywgc2VlICM1NzAxDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHBhcmVudC5wYXJlbnROb2RlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCXBhcmVudC5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXg7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIElFNi83IGNhbGwgZW5jdHlwZSBlbmNvZGluZw0KICAgICAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC5lbmN0eXBlICkgew0KICAgICAgICAgICAgalF1ZXJ5LnByb3BGaXguZW5jdHlwZSA9ICJlbmNvZGluZyI7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIFJhZGlvcyBhbmQgY2hlY2tib3hlcyBnZXR0ZXIvc2V0dGVyDQogICAgICAgIGlmICggIWpRdWVyeS5zdXBwb3J0LmNoZWNrT24gKSB7DQogICAgICAgICAgICBqUXVlcnkuZWFjaChbICJyYWRpbyIsICJjaGVja2JveCIgXSwgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgalF1ZXJ5LnZhbEhvb2tzWyB0aGlzIF0gPSB7DQogICAgICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgaW4gV2Via2l0ICIiIGlzIHJldHVybmVkIGluc3RlYWQgb2YgIm9uIiBpZiBhIHZhbHVlIGlzbid0IHNwZWNpZmllZA0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpID09PSBudWxsID8gIm9uIiA6IGVsZW0udmFsdWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgalF1ZXJ5LmVhY2goWyAicmFkaW8iLCAiY2hlY2tib3giIF0sIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgalF1ZXJ5LnZhbEhvb2tzWyB0aGlzIF0gPSBqUXVlcnkuZXh0ZW5kKCBqUXVlcnkudmFsSG9va3NbIHRoaXMgXSwgew0KICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5pc0FycmF5KCB2YWx1ZSApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICggZWxlbS5jaGVja2VkID0galF1ZXJ5LmluQXJyYXkoIGpRdWVyeShlbGVtKS52YWwoKSwgdmFsdWUgKSA+PSAwICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgICAgIHZhciByZm9ybUVsZW1zID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWEpJC9pLA0KICAgICAgICAgICAgcmtleUV2ZW50ID0gL15rZXkvLA0KICAgICAgICAgICAgcm1vdXNlRXZlbnQgPSAvXig/Om1vdXNlfGNvbnRleHRtZW51KXxjbGljay8sDQogICAgICAgICAgICByZm9jdXNNb3JwaCA9IC9eKD86Zm9jdXNpbmZvY3VzfGZvY3Vzb3V0Ymx1cikkLywNCiAgICAgICAgICAgIHJ0eXBlbmFtZXNwYWNlID0gL14oW14uXSopKD86XC4oLispfCkkLzsNCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIHJldHVyblRydWUoKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gcmV0dXJuRmFsc2UoKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8qDQogICAgICAgICAqIEhlbHBlciBmdW5jdGlvbnMgZm9yIG1hbmFnaW5nIGV2ZW50cyAtLSBub3QgcGFydCBvZiB0aGUgcHVibGljIGludGVyZmFjZS4NCiAgICAgICAgICogUHJvcHMgdG8gRGVhbiBFZHdhcmRzJyBhZGRFdmVudCBsaWJyYXJ5IGZvciBtYW55IG9mIHRoZSBpZGVhcy4NCiAgICAgICAgICovDQogICAgICAgIGpRdWVyeS5ldmVudCA9IHsNCiAgICAgICAgDQogICAgICAgICAgICBnbG9iYWw6IHt9LA0KICAgICAgICANCiAgICAgICAgICAgIGFkZDogZnVuY3Rpb24oIGVsZW0sIHR5cGVzLCBoYW5kbGVyLCBkYXRhLCBzZWxlY3RvciApIHsNCiAgICAgICAgICAgICAgICB2YXIgdG1wLCBldmVudHMsIHQsIGhhbmRsZU9iakluLA0KICAgICAgICAgICAgICAgICAgICBzcGVjaWFsLCBldmVudEhhbmRsZSwgaGFuZGxlT2JqLA0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVycywgdHlwZSwgbmFtZXNwYWNlcywgb3JpZ1R5cGUsDQogICAgICAgICAgICAgICAgICAgIGVsZW1EYXRhID0galF1ZXJ5Ll9kYXRhKCBlbGVtICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIERvbid0IGF0dGFjaCBldmVudHMgdG8gbm9EYXRhIG9yIHRleHQvY29tbWVudCBub2RlcyAoYnV0IGFsbG93IHBsYWluIG9iamVjdHMpDQogICAgICAgICAgICAgICAgaWYgKCAhZWxlbURhdGEgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIENhbGxlciBjYW4gcGFzcyBpbiBhbiBvYmplY3Qgb2YgY3VzdG9tIGRhdGEgaW4gbGlldSBvZiB0aGUgaGFuZGxlcg0KICAgICAgICAgICAgICAgIGlmICggaGFuZGxlci5oYW5kbGVyICkgew0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVPYmpJbiA9IGhhbmRsZXI7DQogICAgICAgICAgICAgICAgICAgIGhhbmRsZXIgPSBoYW5kbGVPYmpJbi5oYW5kbGVyOw0KICAgICAgICAgICAgICAgICAgICBzZWxlY3RvciA9IGhhbmRsZU9iakluLnNlbGVjdG9yOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgdGhlIGhhbmRsZXIgaGFzIGEgdW5pcXVlIElELCB1c2VkIHRvIGZpbmQvcmVtb3ZlIGl0IGxhdGVyDQogICAgICAgICAgICAgICAgaWYgKCAhaGFuZGxlci5ndWlkICkgew0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmd1aWQgPSBqUXVlcnkuZ3VpZCsrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gSW5pdCB0aGUgZWxlbWVudCdzIGV2ZW50IHN0cnVjdHVyZSBhbmQgbWFpbiBoYW5kbGVyLCBpZiB0aGlzIGlzIHRoZSBmaXJzdA0KICAgICAgICAgICAgICAgIGlmICggIShldmVudHMgPSBlbGVtRGF0YS5ldmVudHMpICkgew0KICAgICAgICAgICAgICAgICAgICBldmVudHMgPSBlbGVtRGF0YS5ldmVudHMgPSB7fTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCAhKGV2ZW50SGFuZGxlID0gZWxlbURhdGEuaGFuZGxlKSApIHsNCiAgICAgICAgICAgICAgICAgICAgZXZlbnRIYW5kbGUgPSBlbGVtRGF0YS5oYW5kbGUgPSBmdW5jdGlvbiggZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERpc2NhcmQgdGhlIHNlY29uZCBldmVudCBvZiBhIGpRdWVyeS5ldmVudC50cmlnZ2VyKCkgYW5kDQogICAgICAgICAgICAgICAgICAgICAgICAvLyB3aGVuIGFuIGV2ZW50IGlzIGNhbGxlZCBhZnRlciBhIHBhZ2UgaGFzIHVubG9hZGVkDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIGpRdWVyeSAhPT0gY29yZV9zdHJ1bmRlZmluZWQgJiYgKCFlIHx8IGpRdWVyeS5ldmVudC50cmlnZ2VyZWQgIT09IGUudHlwZSkgPw0KICAgICAgICAgICAgICAgICAgICAgICAgCWpRdWVyeS5ldmVudC5kaXNwYXRjaC5hcHBseSggZXZlbnRIYW5kbGUuZWxlbSwgYXJndW1lbnRzICkgOg0KICAgICAgICAgICAgICAgICAgICAgICAgCXVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGVsZW0gYXMgYSBwcm9wZXJ0eSBvZiB0aGUgaGFuZGxlIGZuIHRvIHByZXZlbnQgYSBtZW1vcnkgbGVhayB3aXRoIElFIG5vbi1uYXRpdmUgZXZlbnRzDQogICAgICAgICAgICAgICAgICAgIGV2ZW50SGFuZGxlLmVsZW0gPSBlbGVtOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gSGFuZGxlIG11bHRpcGxlIGV2ZW50cyBzZXBhcmF0ZWQgYnkgYSBzcGFjZQ0KICAgICAgICAgICAgICAgIC8vIGpRdWVyeSguLi4pLmJpbmQoIm1vdXNlb3ZlciBtb3VzZW91dCIsIGZuKTsNCiAgICAgICAgICAgICAgICB0eXBlcyA9ICggdHlwZXMgfHwgIiIgKS5tYXRjaCggY29yZV9ybm90d2hpdGUgKSB8fCBbIiJdOw0KICAgICAgICAgICAgICAgIHQgPSB0eXBlcy5sZW5ndGg7DQogICAgICAgICAgICAgICAgd2hpbGUgKCB0LS0gKSB7DQogICAgICAgICAgICAgICAgICAgIHRtcCA9IHJ0eXBlbmFtZXNwYWNlLmV4ZWMoIHR5cGVzW3RdICkgfHwgW107DQogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBvcmlnVHlwZSA9IHRtcFsxXTsNCiAgICAgICAgICAgICAgICAgICAgbmFtZXNwYWNlcyA9ICggdG1wWzJdIHx8ICIiICkuc3BsaXQoICIuIiApLnNvcnQoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIElmIGV2ZW50IGNoYW5nZXMgaXRzIHR5cGUsIHVzZSB0aGUgc3BlY2lhbCBldmVudCBoYW5kbGVycyBmb3IgdGhlIGNoYW5nZWQgdHlwZQ0KICAgICAgICAgICAgICAgICAgICBzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIElmIHNlbGVjdG9yIGRlZmluZWQsIGRldGVybWluZSBzcGVjaWFsIGV2ZW50IGFwaSB0eXBlLCBvdGhlcndpc2UgZ2l2ZW4gdHlwZQ0KICAgICAgICAgICAgICAgICAgICB0eXBlID0gKCBzZWxlY3RvciA/IHNwZWNpYWwuZGVsZWdhdGVUeXBlIDogc3BlY2lhbC5iaW5kVHlwZSApIHx8IHR5cGU7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgc3BlY2lhbCBiYXNlZCBvbiBuZXdseSByZXNldCB0eXBlDQogICAgICAgICAgICAgICAgICAgIHNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgdHlwZSBdIHx8IHt9Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlT2JqIGlzIHBhc3NlZCB0byBhbGwgZXZlbnQgaGFuZGxlcnMNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlT2JqID0galF1ZXJ5LmV4dGVuZCh7DQogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLA0KICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ1R5cGU6IG9yaWdUeXBlLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXI6IGhhbmRsZXIsDQogICAgICAgICAgICAgICAgICAgICAgICBndWlkOiBoYW5kbGVyLmd1aWQsDQogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rvcjogc2VsZWN0b3IsDQogICAgICAgICAgICAgICAgICAgICAgICBuZWVkc0NvbnRleHQ6IHNlbGVjdG9yICYmIGpRdWVyeS5leHByLm1hdGNoLm5lZWRzQ29udGV4dC50ZXN0KCBzZWxlY3RvciApLA0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXNwYWNlOiBuYW1lc3BhY2VzLmpvaW4oIi4iKQ0KICAgICAgICAgICAgICAgICAgICB9LCBoYW5kbGVPYmpJbiApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gSW5pdCB0aGUgZXZlbnQgaGFuZGxlciBxdWV1ZSBpZiB3ZSdyZSB0aGUgZmlyc3QNCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhKGhhbmRsZXJzID0gZXZlbnRzWyB0eXBlIF0pICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlcnMgPSBldmVudHNbIHR5cGUgXSA9IFtdOw0KICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlcnMuZGVsZWdhdGVDb3VudCA9IDA7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gT25seSB1c2UgYWRkRXZlbnRMaXN0ZW5lci9hdHRhY2hFdmVudCBpZiB0aGUgc3BlY2lhbCBldmVudHMgaGFuZGxlciByZXR1cm5zIGZhbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFzcGVjaWFsLnNldHVwIHx8IHNwZWNpYWwuc2V0dXAuY2FsbCggZWxlbSwgZGF0YSwgbmFtZXNwYWNlcywgZXZlbnRIYW5kbGUgKSA9PT0gZmFsc2UgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gQmluZCB0aGUgZ2xvYmFsIGV2ZW50IGhhbmRsZXIgdG8gdGhlIGVsZW1lbnQNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIGVsZW0uYWRkRXZlbnRMaXN0ZW5lciApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZWxlbS5hZGRFdmVudExpc3RlbmVyKCB0eXBlLCBldmVudEhhbmRsZSwgZmFsc2UgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJfSBlbHNlIGlmICggZWxlbS5hdHRhY2hFdmVudCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZWxlbS5hdHRhY2hFdmVudCggIm9uIiArIHR5cGUsIGV2ZW50SGFuZGxlICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoIHNwZWNpYWwuYWRkICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc3BlY2lhbC5hZGQuY2FsbCggZWxlbSwgaGFuZGxlT2JqICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhaGFuZGxlT2JqLmhhbmRsZXIuZ3VpZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAloYW5kbGVPYmouaGFuZGxlci5ndWlkID0gaGFuZGxlci5ndWlkOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdG8gdGhlIGVsZW1lbnQncyBoYW5kbGVyIGxpc3QsIGRlbGVnYXRlcyBpbiBmcm9udA0KICAgICAgICAgICAgICAgICAgICBpZiAoIHNlbGVjdG9yICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlcnMuc3BsaWNlKCBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50KyssIDAsIGhhbmRsZU9iaiApOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlcnMucHVzaCggaGFuZGxlT2JqICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEtlZXAgdHJhY2sgb2Ygd2hpY2ggZXZlbnRzIGhhdmUgZXZlciBiZWVuIHVzZWQsIGZvciBldmVudCBvcHRpbWl6YXRpb24NCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50Lmdsb2JhbFsgdHlwZSBdID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIE51bGxpZnkgZWxlbSB0byBwcmV2ZW50IG1lbW9yeSBsZWFrcyBpbiBJRQ0KICAgICAgICAgICAgICAgIGVsZW0gPSBudWxsOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBEZXRhY2ggYW4gZXZlbnQgb3Igc2V0IG9mIGV2ZW50cyBmcm9tIGFuIGVsZW1lbnQNCiAgICAgICAgICAgIHJlbW92ZTogZnVuY3Rpb24oIGVsZW0sIHR5cGVzLCBoYW5kbGVyLCBzZWxlY3RvciwgbWFwcGVkVHlwZXMgKSB7DQogICAgICAgICAgICAgICAgdmFyIGosIGhhbmRsZU9iaiwgdG1wLA0KICAgICAgICAgICAgICAgICAgICBvcmlnQ291bnQsIHQsIGV2ZW50cywNCiAgICAgICAgICAgICAgICAgICAgc3BlY2lhbCwgaGFuZGxlcnMsIHR5cGUsDQogICAgICAgICAgICAgICAgICAgIG5hbWVzcGFjZXMsIG9yaWdUeXBlLA0KICAgICAgICAgICAgICAgICAgICBlbGVtRGF0YSA9IGpRdWVyeS5oYXNEYXRhKCBlbGVtICkgJiYgalF1ZXJ5Ll9kYXRhKCBlbGVtICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggIWVsZW1EYXRhIHx8ICEoZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzKSApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gT25jZSBmb3IgZWFjaCB0eXBlLm5hbWVzcGFjZSBpbiB0eXBlczsgdHlwZSBtYXkgYmUgb21pdHRlZA0KICAgICAgICAgICAgICAgIHR5cGVzID0gKCB0eXBlcyB8fCAiIiApLm1hdGNoKCBjb3JlX3Jub3R3aGl0ZSApIHx8IFsiIl07DQogICAgICAgICAgICAgICAgdCA9IHR5cGVzLmxlbmd0aDsNCiAgICAgICAgICAgICAgICB3aGlsZSAoIHQtLSApIHsNCiAgICAgICAgICAgICAgICAgICAgdG1wID0gcnR5cGVuYW1lc3BhY2UuZXhlYyggdHlwZXNbdF0gKSB8fCBbXTsNCiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IG9yaWdUeXBlID0gdG1wWzFdOw0KICAgICAgICAgICAgICAgICAgICBuYW1lc3BhY2VzID0gKCB0bXBbMl0gfHwgIiIgKS5zcGxpdCggIi4iICkuc29ydCgpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gVW5iaW5kIGFsbCBldmVudHMgKG9uIHRoaXMgbmFtZXNwYWNlLCBpZiBwcm92aWRlZCkgZm9yIHRoZSBlbGVtZW50DQogICAgICAgICAgICAgICAgICAgIGlmICggIXR5cGUgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCB0eXBlIGluIGV2ZW50cyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlqUXVlcnkuZXZlbnQucmVtb3ZlKCBlbGVtLCB0eXBlICsgdHlwZXNbIHQgXSwgaGFuZGxlciwgc2VsZWN0b3IsIHRydWUgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsNCiAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICggc2VsZWN0b3IgPyBzcGVjaWFsLmRlbGVnYXRlVHlwZSA6IHNwZWNpYWwuYmluZFR5cGUgKSB8fCB0eXBlOw0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVycyA9IGV2ZW50c1sgdHlwZSBdIHx8IFtdOw0KICAgICAgICAgICAgICAgICAgICB0bXAgPSB0bXBbMl0gJiYgbmV3IFJlZ0V4cCggIihefFxcLikiICsgbmFtZXNwYWNlcy5qb2luKCJcXC4oPzouKlxcLnwpIikgKyAiKFxcLnwkKSIgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBtYXRjaGluZyBldmVudHMNCiAgICAgICAgICAgICAgICAgICAgb3JpZ0NvdW50ID0gaiA9IGhhbmRsZXJzLmxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCBqLS0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVPYmogPSBoYW5kbGVyc1sgaiBdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggKCBtYXBwZWRUeXBlcyB8fCBvcmlnVHlwZSA9PT0gaGFuZGxlT2JqLm9yaWdUeXBlICkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIAkoICFoYW5kbGVyIHx8IGhhbmRsZXIuZ3VpZCA9PT0gaGFuZGxlT2JqLmd1aWQgKSAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgCSggIXRtcCB8fCB0bXAudGVzdCggaGFuZGxlT2JqLm5hbWVzcGFjZSApICkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIAkoICFzZWxlY3RvciB8fCBzZWxlY3RvciA9PT0gaGFuZGxlT2JqLnNlbGVjdG9yIHx8IHNlbGVjdG9yID09PSAiKioiICYmIGhhbmRsZU9iai5zZWxlY3RvciApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWhhbmRsZXJzLnNwbGljZSggaiwgMSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIGhhbmRsZU9iai5zZWxlY3RvciApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJaGFuZGxlcnMuZGVsZWdhdGVDb3VudC0tOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIHNwZWNpYWwucmVtb3ZlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlzcGVjaWFsLnJlbW92ZS5jYWxsKCBlbGVtLCBoYW5kbGVPYmogKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBnZW5lcmljIGV2ZW50IGhhbmRsZXIgaWYgd2UgcmVtb3ZlZCBzb21ldGhpbmcgYW5kIG5vIG1vcmUgaGFuZGxlcnMgZXhpc3QNCiAgICAgICAgICAgICAgICAgICAgLy8gKGF2b2lkcyBwb3RlbnRpYWwgZm9yIGVuZGxlc3MgcmVjdXJzaW9uIGR1cmluZyByZW1vdmFsIG9mIHNwZWNpYWwgZXZlbnQgaGFuZGxlcnMpDQogICAgICAgICAgICAgICAgICAgIGlmICggb3JpZ0NvdW50ICYmICFoYW5kbGVycy5sZW5ndGggKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFzcGVjaWFsLnRlYXJkb3duIHx8IHNwZWNpYWwudGVhcmRvd24uY2FsbCggZWxlbSwgbmFtZXNwYWNlcywgZWxlbURhdGEuaGFuZGxlICkgPT09IGZhbHNlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWpRdWVyeS5yZW1vdmVFdmVudCggZWxlbSwgdHlwZSwgZWxlbURhdGEuaGFuZGxlICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGV2ZW50c1sgdHlwZSBdOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGV4cGFuZG8gaWYgaXQncyBubyBsb25nZXIgdXNlZA0KICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRW1wdHlPYmplY3QoIGV2ZW50cyApICkgew0KICAgICAgICAgICAgICAgICAgICBkZWxldGUgZWxlbURhdGEuaGFuZGxlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlRGF0YSBhbHNvIGNoZWNrcyBmb3IgZW1wdGluZXNzIGFuZCBjbGVhcnMgdGhlIGV4cGFuZG8gaWYgZW1wdHkNCiAgICAgICAgICAgICAgICAgICAgLy8gc28gdXNlIGl0IGluc3RlYWQgb2YgZGVsZXRlDQogICAgICAgICAgICAgICAgICAgIGpRdWVyeS5fcmVtb3ZlRGF0YSggZWxlbSwgImV2ZW50cyIgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIHRyaWdnZXI6IGZ1bmN0aW9uKCBldmVudCwgZGF0YSwgZWxlbSwgb25seUhhbmRsZXJzICkgew0KICAgICAgICAgICAgICAgIHZhciBoYW5kbGUsIG9udHlwZSwgY3VyLA0KICAgICAgICAgICAgICAgICAgICBidWJibGVUeXBlLCBzcGVjaWFsLCB0bXAsIGksDQogICAgICAgICAgICAgICAgICAgIGV2ZW50UGF0aCA9IFsgZWxlbSB8fCBkb2N1bWVudCBdLA0KICAgICAgICAgICAgICAgICAgICB0eXBlID0gY29yZV9oYXNPd24uY2FsbCggZXZlbnQsICJ0eXBlIiApID8gZXZlbnQudHlwZSA6IGV2ZW50LA0KICAgICAgICAgICAgICAgICAgICBuYW1lc3BhY2VzID0gY29yZV9oYXNPd24uY2FsbCggZXZlbnQsICJuYW1lc3BhY2UiICkgPyBldmVudC5uYW1lc3BhY2Uuc3BsaXQoIi4iKSA6IFtdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBjdXIgPSB0bXAgPSBlbGVtID0gZWxlbSB8fCBkb2N1bWVudDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gRG9uJ3QgZG8gZXZlbnRzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMNCiAgICAgICAgICAgICAgICBpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gOCApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gZm9jdXMvYmx1ciBtb3JwaHMgdG8gZm9jdXNpbi9vdXQ7IGVuc3VyZSB3ZSdyZSBub3QgZmlyaW5nIHRoZW0gcmlnaHQgbm93DQogICAgICAgICAgICAgICAgaWYgKCByZm9jdXNNb3JwaC50ZXN0KCB0eXBlICsgalF1ZXJ5LmV2ZW50LnRyaWdnZXJlZCApICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIHR5cGUuaW5kZXhPZigiLiIpID49IDAgKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIE5hbWVzcGFjZWQgdHJpZ2dlcjsgY3JlYXRlIGEgcmVnZXhwIHRvIG1hdGNoIGV2ZW50IHR5cGUgaW4gaGFuZGxlKCkNCiAgICAgICAgICAgICAgICAgICAgbmFtZXNwYWNlcyA9IHR5cGUuc3BsaXQoIi4iKTsNCiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IG5hbWVzcGFjZXMuc2hpZnQoKTsNCiAgICAgICAgICAgICAgICAgICAgbmFtZXNwYWNlcy5zb3J0KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG9udHlwZSA9IHR5cGUuaW5kZXhPZigiOiIpIDwgMCAmJiAib24iICsgdHlwZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQ2FsbGVyIGNhbiBwYXNzIGluIGEgalF1ZXJ5LkV2ZW50IG9iamVjdCwgT2JqZWN0LCBvciBqdXN0IGFuIGV2ZW50IHR5cGUgc3RyaW5nDQogICAgICAgICAgICAgICAgZXZlbnQgPSBldmVudFsgalF1ZXJ5LmV4cGFuZG8gXSA/DQogICAgICAgICAgICAgICAgICAgIGV2ZW50IDoNCiAgICAgICAgICAgICAgICAgICAgbmV3IGpRdWVyeS5FdmVudCggdHlwZSwgdHlwZW9mIGV2ZW50ID09PSAib2JqZWN0IiAmJiBldmVudCApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBldmVudC5pc1RyaWdnZXIgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGV2ZW50Lm5hbWVzcGFjZSA9IG5hbWVzcGFjZXMuam9pbigiLiIpOw0KICAgICAgICAgICAgICAgIGV2ZW50Lm5hbWVzcGFjZV9yZSA9IGV2ZW50Lm5hbWVzcGFjZSA/DQogICAgICAgICAgICAgICAgICAgIG5ldyBSZWdFeHAoICIoXnxcXC4pIiArIG5hbWVzcGFjZXMuam9pbigiXFwuKD86LipcXC58KSIpICsgIihcXC58JCkiICkgOg0KICAgICAgICAgICAgICAgICAgICBudWxsOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBDbGVhbiB1cCB0aGUgZXZlbnQgaW4gY2FzZSBpdCBpcyBiZWluZyByZXVzZWQNCiAgICAgICAgICAgICAgICBldmVudC5yZXN1bHQgPSB1bmRlZmluZWQ7DQogICAgICAgICAgICAgICAgaWYgKCAhZXZlbnQudGFyZ2V0ICkgew0KICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQgPSBlbGVtOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQ2xvbmUgYW55IGluY29taW5nIGRhdGEgYW5kIHByZXBlbmQgdGhlIGV2ZW50LCBjcmVhdGluZyB0aGUgaGFuZGxlciBhcmcgbGlzdA0KICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhID09IG51bGwgPw0KICAgICAgICAgICAgICAgICAgICBbIGV2ZW50IF0gOg0KICAgICAgICAgICAgICAgICAgICBqUXVlcnkubWFrZUFycmF5KCBkYXRhLCBbIGV2ZW50IF0gKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQWxsb3cgc3BlY2lhbCBldmVudHMgdG8gZHJhdyBvdXRzaWRlIHRoZSBsaW5lcw0KICAgICAgICAgICAgICAgIHNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgdHlwZSBdIHx8IHt9Ow0KICAgICAgICAgICAgICAgIGlmICggIW9ubHlIYW5kbGVycyAmJiBzcGVjaWFsLnRyaWdnZXIgJiYgc3BlY2lhbC50cmlnZ2VyLmFwcGx5KCBlbGVtLCBkYXRhICkgPT09IGZhbHNlICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBEZXRlcm1pbmUgZXZlbnQgcHJvcGFnYXRpb24gcGF0aCBpbiBhZHZhbmNlLCBwZXIgVzNDIGV2ZW50cyBzcGVjICgjOTk1MSkNCiAgICAgICAgICAgICAgICAvLyBCdWJibGUgdXAgdG8gZG9jdW1lbnQsIHRoZW4gdG8gd2luZG93OyB3YXRjaCBmb3IgYSBnbG9iYWwgb3duZXJEb2N1bWVudCB2YXIgKCM5NzI0KQ0KICAgICAgICAgICAgICAgIGlmICggIW9ubHlIYW5kbGVycyAmJiAhc3BlY2lhbC5ub0J1YmJsZSAmJiAhalF1ZXJ5LmlzV2luZG93KCBlbGVtICkgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBidWJibGVUeXBlID0gc3BlY2lhbC5kZWxlZ2F0ZVR5cGUgfHwgdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhcmZvY3VzTW9ycGgudGVzdCggYnViYmxlVHlwZSArIHR5cGUgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGN1ciA9IGN1ci5wYXJlbnROb2RlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGZvciAoIDsgY3VyOyBjdXIgPSBjdXIucGFyZW50Tm9kZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50UGF0aC5wdXNoKCBjdXIgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCA9IGN1cjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBhZGQgd2luZG93IGlmIHdlIGdvdCB0byBkb2N1bWVudCAoZS5nLiwgbm90IHBsYWluIG9iaiBvciBkZXRhY2hlZCBET00pDQogICAgICAgICAgICAgICAgICAgIGlmICggdG1wID09PSAoZWxlbS5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50KSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50UGF0aC5wdXNoKCB0bXAuZGVmYXVsdFZpZXcgfHwgdG1wLnBhcmVudFdpbmRvdyB8fCB3aW5kb3cgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gRmlyZSBoYW5kbGVycyBvbiB0aGUgZXZlbnQgcGF0aA0KICAgICAgICAgICAgICAgIGkgPSAwOw0KICAgICAgICAgICAgICAgIHdoaWxlICggKGN1ciA9IGV2ZW50UGF0aFtpKytdKSAmJiAhZXZlbnQuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGV2ZW50LnR5cGUgPSBpID4gMSA/DQogICAgICAgICAgICAgICAgICAgICAgICBidWJibGVUeXBlIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHNwZWNpYWwuYmluZFR5cGUgfHwgdHlwZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIGpRdWVyeSBoYW5kbGVyDQogICAgICAgICAgICAgICAgICAgIGhhbmRsZSA9ICggalF1ZXJ5Ll9kYXRhKCBjdXIsICJldmVudHMiICkgfHwge30gKVsgZXZlbnQudHlwZSBdICYmIGpRdWVyeS5fZGF0YSggY3VyLCAiaGFuZGxlIiApOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIGhhbmRsZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZS5hcHBseSggY3VyLCBkYXRhICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIE5hdGl2ZSBoYW5kbGVyDQogICAgICAgICAgICAgICAgICAgIGhhbmRsZSA9IG9udHlwZSAmJiBjdXJbIG9udHlwZSBdOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIGhhbmRsZSAmJiBqUXVlcnkuYWNjZXB0RGF0YSggY3VyICkgJiYgaGFuZGxlLmFwcGx5ICYmIGhhbmRsZS5hcHBseSggY3VyLCBkYXRhICkgPT09IGZhbHNlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBldmVudC50eXBlID0gdHlwZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gSWYgbm9ib2R5IHByZXZlbnRlZCB0aGUgZGVmYXVsdCBhY3Rpb24sIGRvIGl0IG5vdw0KICAgICAgICAgICAgICAgIGlmICggIW9ubHlIYW5kbGVycyAmJiAhZXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoICghc3BlY2lhbC5fZGVmYXVsdCB8fCBzcGVjaWFsLl9kZWZhdWx0LmFwcGx5KCBlbGVtLm93bmVyRG9jdW1lbnQsIGRhdGEgKSA9PT0gZmFsc2UpICYmDQogICAgICAgICAgICAgICAgICAgICAgICAhKHR5cGUgPT09ICJjbGljayIgJiYgalF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCAiYSIgKSkgJiYgalF1ZXJ5LmFjY2VwdERhdGEoIGVsZW0gKSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBDYWxsIGEgbmF0aXZlIERPTSBtZXRob2Qgb24gdGhlIHRhcmdldCB3aXRoIHRoZSBzYW1lIG5hbWUgbmFtZSBhcyB0aGUgZXZlbnQuDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBDYW4ndCB1c2UgYW4gLmlzRnVuY3Rpb24oKSBjaGVjayBoZXJlIGJlY2F1c2UgSUU2LzcgZmFpbHMgdGhhdCB0ZXN0Lg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG9uJ3QgZG8gZGVmYXVsdCBhY3Rpb25zIG9uIHdpbmRvdywgdGhhdCdzIHdoZXJlIGdsb2JhbCB2YXJpYWJsZXMgYmUgKCM2MTcwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBvbnR5cGUgJiYgZWxlbVsgdHlwZSBdICYmICFqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gRG9uJ3QgcmUtdHJpZ2dlciBhbiBvbkZPTyBldmVudCB3aGVuIHdlIGNhbGwgaXRzIEZPTygpIG1ldGhvZA0KICAgICAgICAgICAgICAgICAgICAgICAgCXRtcCA9IGVsZW1bIG9udHlwZSBdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIHRtcCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZWxlbVsgb250eXBlIF0gPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gUHJldmVudCByZS10cmlnZ2VyaW5nIG9mIHRoZSBzYW1lIGV2ZW50LCBzaW5jZSB3ZSBhbHJlYWR5IGJ1YmJsZWQgaXQgYWJvdmUNCiAgICAgICAgICAgICAgICAgICAgICAgIAlqUXVlcnkuZXZlbnQudHJpZ2dlcmVkID0gdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQllbGVtWyB0eXBlIF0oKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9IGNhdGNoICggZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gSUU8OSBkaWVzIG9uIGZvY3VzL2JsdXIgdG8gaGlkZGVuIGVsZW1lbnQgKCMxNDg2LCMxMjUxOCkNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gb25seSByZXByb2R1Y2libGUgb24gd2luWFAgSUU4IG5hdGl2ZSwgbm90IElFOSBpbiBJRTggbW9kZQ0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAlqUXVlcnkuZXZlbnQudHJpZ2dlcmVkID0gdW5kZWZpbmVkOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIHRtcCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZWxlbVsgb250eXBlIF0gPSB0bXA7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnQucmVzdWx0Ow0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBkaXNwYXRjaDogZnVuY3Rpb24oIGV2ZW50ICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBNYWtlIGEgd3JpdGFibGUgalF1ZXJ5LkV2ZW50IGZyb20gdGhlIG5hdGl2ZSBldmVudCBvYmplY3QNCiAgICAgICAgICAgICAgICBldmVudCA9IGpRdWVyeS5ldmVudC5maXgoIGV2ZW50ICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHZhciBpLCByZXQsIGhhbmRsZU9iaiwgbWF0Y2hlZCwgaiwNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlclF1ZXVlID0gW10sDQogICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBjb3JlX3NsaWNlLmNhbGwoIGFyZ3VtZW50cyApLA0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVycyA9ICggalF1ZXJ5Ll9kYXRhKCB0aGlzLCAiZXZlbnRzIiApIHx8IHt9IClbIGV2ZW50LnR5cGUgXSB8fCBbXSwNCiAgICAgICAgICAgICAgICAgICAgc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyBldmVudC50eXBlIF0gfHwge307DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgZml4LWVkIGpRdWVyeS5FdmVudCByYXRoZXIgdGhhbiB0aGUgKHJlYWQtb25seSkgbmF0aXZlIGV2ZW50DQogICAgICAgICAgICAgICAgYXJnc1swXSA9IGV2ZW50Ow0KICAgICAgICAgICAgICAgIGV2ZW50LmRlbGVnYXRlVGFyZ2V0ID0gdGhpczsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQ2FsbCB0aGUgcHJlRGlzcGF0Y2ggaG9vayBmb3IgdGhlIG1hcHBlZCB0eXBlLCBhbmQgbGV0IGl0IGJhaWwgaWYgZGVzaXJlZA0KICAgICAgICAgICAgICAgIGlmICggc3BlY2lhbC5wcmVEaXNwYXRjaCAmJiBzcGVjaWFsLnByZURpc3BhdGNoLmNhbGwoIHRoaXMsIGV2ZW50ICkgPT09IGZhbHNlICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBEZXRlcm1pbmUgaGFuZGxlcnMNCiAgICAgICAgICAgICAgICBoYW5kbGVyUXVldWUgPSBqUXVlcnkuZXZlbnQuaGFuZGxlcnMuY2FsbCggdGhpcywgZXZlbnQsIGhhbmRsZXJzICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFJ1biBkZWxlZ2F0ZXMgZmlyc3Q7IHRoZXkgbWF5IHdhbnQgdG8gc3RvcCBwcm9wYWdhdGlvbiBiZW5lYXRoIHVzDQogICAgICAgICAgICAgICAgaSA9IDA7DQogICAgICAgICAgICAgICAgd2hpbGUgKCAobWF0Y2hlZCA9IGhhbmRsZXJRdWV1ZVsgaSsrIF0pICYmICFldmVudC5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpICkgew0KICAgICAgICAgICAgICAgICAgICBldmVudC5jdXJyZW50VGFyZ2V0ID0gbWF0Y2hlZC5lbGVtOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaiA9IDA7DQogICAgICAgICAgICAgICAgICAgIHdoaWxlICggKGhhbmRsZU9iaiA9IG1hdGNoZWQuaGFuZGxlcnNbIGorKyBdKSAmJiAhZXZlbnQuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBUcmlnZ2VyZWQgZXZlbnQgbXVzdCBlaXRoZXIgMSkgaGF2ZSBubyBuYW1lc3BhY2UsIG9yDQogICAgICAgICAgICAgICAgICAgICAgICAvLyAyKSBoYXZlIG5hbWVzcGFjZShzKSBhIHN1YnNldCBvciBlcXVhbCB0byB0aG9zZSBpbiB0aGUgYm91bmQgZXZlbnQgKGJvdGggY2FuIGhhdmUgbm8gbmFtZXNwYWNlKS4NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIWV2ZW50Lm5hbWVzcGFjZV9yZSB8fCBldmVudC5uYW1lc3BhY2VfcmUudGVzdCggaGFuZGxlT2JqLm5hbWVzcGFjZSApICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAlldmVudC5oYW5kbGVPYmogPSBoYW5kbGVPYmo7DQogICAgICAgICAgICAgICAgICAgICAgICAJZXZlbnQuZGF0YSA9IGhhbmRsZU9iai5kYXRhOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZXQgPSAoIChqUXVlcnkuZXZlbnQuc3BlY2lhbFsgaGFuZGxlT2JqLm9yaWdUeXBlIF0gfHwge30pLmhhbmRsZSB8fCBoYW5kbGVPYmouaGFuZGxlciApDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkuYXBwbHkoIG1hdGNoZWQuZWxlbSwgYXJncyApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIHJldCAhPT0gdW5kZWZpbmVkICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlpZiAoIChldmVudC5yZXN1bHQgPSByZXQpID09PSBmYWxzZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQlldmVudC5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQ2FsbCB0aGUgcG9zdERpc3BhdGNoIGhvb2sgZm9yIHRoZSBtYXBwZWQgdHlwZQ0KICAgICAgICAgICAgICAgIGlmICggc3BlY2lhbC5wb3N0RGlzcGF0Y2ggKSB7DQogICAgICAgICAgICAgICAgICAgIHNwZWNpYWwucG9zdERpc3BhdGNoLmNhbGwoIHRoaXMsIGV2ZW50ICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnQucmVzdWx0Ow0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBoYW5kbGVyczogZnVuY3Rpb24oIGV2ZW50LCBoYW5kbGVycyApIHsNCiAgICAgICAgICAgICAgICB2YXIgc2VsLCBoYW5kbGVPYmosIG1hdGNoZXMsIGksDQogICAgICAgICAgICAgICAgICAgIGhhbmRsZXJRdWV1ZSA9IFtdLA0KICAgICAgICAgICAgICAgICAgICBkZWxlZ2F0ZUNvdW50ID0gaGFuZGxlcnMuZGVsZWdhdGVDb3VudCwNCiAgICAgICAgICAgICAgICAgICAgY3VyID0gZXZlbnQudGFyZ2V0Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBGaW5kIGRlbGVnYXRlIGhhbmRsZXJzDQogICAgICAgICAgICAgICAgLy8gQmxhY2staG9sZSBTVkcgPHVzZT4gaW5zdGFuY2UgdHJlZXMgKCMxMzE4MCkNCiAgICAgICAgICAgICAgICAvLyBBdm9pZCBub24tbGVmdC1jbGljayBidWJibGluZyBpbiBGaXJlZm94ICgjMzg2MSkNCiAgICAgICAgICAgICAgICBpZiAoIGRlbGVnYXRlQ291bnQgJiYgY3VyLm5vZGVUeXBlICYmICghZXZlbnQuYnV0dG9uIHx8IGV2ZW50LnR5cGUgIT09ICJjbGljayIpICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZm9yICggOyBjdXIgIT0gdGhpczsgY3VyID0gY3VyLnBhcmVudE5vZGUgfHwgdGhpcyApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBEb24ndCBjaGVjayBub24tZWxlbWVudHMgKCMxMzIwOCkNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvbid0IHByb2Nlc3MgY2xpY2tzIG9uIGRpc2FibGVkIGVsZW1lbnRzICgjNjkxMSwgIzgxNjUsICMxMTM4MiwgIzExNzY0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBjdXIubm9kZVR5cGUgPT09IDEgJiYgKGN1ci5kaXNhYmxlZCAhPT0gdHJ1ZSB8fCBldmVudC50eXBlICE9PSAiY2xpY2siKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAltYXRjaGVzID0gW107DQogICAgICAgICAgICAgICAgICAgICAgICAJZm9yICggaSA9IDA7IGkgPCBkZWxlZ2F0ZUNvdW50OyBpKysgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWhhbmRsZU9iaiA9IGhhbmRsZXJzWyBpIF07DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkvLyBEb24ndCBjb25mbGljdCB3aXRoIE9iamVjdC5wcm90b3R5cGUgcHJvcGVydGllcyAoIzEzMjAzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQlzZWwgPSBoYW5kbGVPYmouc2VsZWN0b3IgKyAiICI7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQlpZiAoIG1hdGNoZXNbIHNlbCBdID09PSB1bmRlZmluZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQltYXRjaGVzWyBzZWwgXSA9IGhhbmRsZU9iai5uZWVkc0NvbnRleHQgPw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCWpRdWVyeSggc2VsLCB0aGlzICkuaW5kZXgoIGN1ciApID49IDAgOg0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCWpRdWVyeS5maW5kKCBzZWwsIHRoaXMsIG51bGwsIFsgY3VyIF0gKS5sZW5ndGg7DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJaWYgKCBtYXRjaGVzWyBzZWwgXSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCW1hdGNoZXMucHVzaCggaGFuZGxlT2JqICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBtYXRjaGVzLmxlbmd0aCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJaGFuZGxlclF1ZXVlLnB1c2goeyBlbGVtOiBjdXIsIGhhbmRsZXJzOiBtYXRjaGVzIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQWRkIHRoZSByZW1haW5pbmcgKGRpcmVjdGx5LWJvdW5kKSBoYW5kbGVycw0KICAgICAgICAgICAgICAgIGlmICggZGVsZWdhdGVDb3VudCA8IGhhbmRsZXJzLmxlbmd0aCApIHsNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlclF1ZXVlLnB1c2goeyBlbGVtOiB0aGlzLCBoYW5kbGVyczogaGFuZGxlcnMuc2xpY2UoIGRlbGVnYXRlQ291bnQgKSB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyUXVldWU7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGZpeDogZnVuY3Rpb24oIGV2ZW50ICkgew0KICAgICAgICAgICAgICAgIGlmICggZXZlbnRbIGpRdWVyeS5leHBhbmRvIF0gKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBldmVudDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhIHdyaXRhYmxlIGNvcHkgb2YgdGhlIGV2ZW50IG9iamVjdCBhbmQgbm9ybWFsaXplIHNvbWUgcHJvcGVydGllcw0KICAgICAgICAgICAgICAgIHZhciBpLCBwcm9wLCBjb3B5LA0KICAgICAgICAgICAgICAgICAgICB0eXBlID0gZXZlbnQudHlwZSwNCiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxFdmVudCA9IGV2ZW50LA0KICAgICAgICAgICAgICAgICAgICBmaXhIb29rID0gdGhpcy5maXhIb29rc1sgdHlwZSBdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoICFmaXhIb29rICkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLmZpeEhvb2tzWyB0eXBlIF0gPSBmaXhIb29rID0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJtb3VzZUV2ZW50LnRlc3QoIHR5cGUgKSA/IHRoaXMubW91c2VIb29rcyA6DQogICAgICAgICAgICAgICAgICAgICAgICBya2V5RXZlbnQudGVzdCggdHlwZSApID8gdGhpcy5rZXlIb29rcyA6DQogICAgICAgICAgICAgICAgICAgICAgICB7fTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29weSA9IGZpeEhvb2sucHJvcHMgPyB0aGlzLnByb3BzLmNvbmNhdCggZml4SG9vay5wcm9wcyApIDogdGhpcy5wcm9wczsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgZXZlbnQgPSBuZXcgalF1ZXJ5LkV2ZW50KCBvcmlnaW5hbEV2ZW50ICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGkgPSBjb3B5Lmxlbmd0aDsNCiAgICAgICAgICAgICAgICB3aGlsZSAoIGktLSApIHsNCiAgICAgICAgICAgICAgICAgICAgcHJvcCA9IGNvcHlbIGkgXTsNCiAgICAgICAgICAgICAgICAgICAgZXZlbnRbIHByb3AgXSA9IG9yaWdpbmFsRXZlbnRbIHByb3AgXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQ6IElFPDkNCiAgICAgICAgICAgICAgICAvLyBGaXggdGFyZ2V0IHByb3BlcnR5ICgjMTkyNSkNCiAgICAgICAgICAgICAgICBpZiAoICFldmVudC50YXJnZXQgKSB7DQogICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldCA9IG9yaWdpbmFsRXZlbnQuc3JjRWxlbWVudCB8fCBkb2N1bWVudDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQ6IENocm9tZSAyMyssIFNhZmFyaT8NCiAgICAgICAgICAgICAgICAvLyBUYXJnZXQgc2hvdWxkIG5vdCBiZSBhIHRleHQgbm9kZSAoIzUwNCwgIzEzMTQzKQ0KICAgICAgICAgICAgICAgIGlmICggZXZlbnQudGFyZ2V0Lm5vZGVUeXBlID09PSAzICkgew0KICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQgPSBldmVudC50YXJnZXQucGFyZW50Tm9kZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQ6IElFPDkNCiAgICAgICAgICAgICAgICAvLyBGb3IgbW91c2Uva2V5IGV2ZW50cywgbWV0YUtleT09ZmFsc2UgaWYgaXQncyB1bmRlZmluZWQgKCMzMzY4LCAjMTEzMjgpDQogICAgICAgICAgICAgICAgZXZlbnQubWV0YUtleSA9ICEhZXZlbnQubWV0YUtleTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIGZpeEhvb2suZmlsdGVyID8gZml4SG9vay5maWx0ZXIoIGV2ZW50LCBvcmlnaW5hbEV2ZW50ICkgOiBldmVudDsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgLy8gSW5jbHVkZXMgc29tZSBldmVudCBwcm9wcyBzaGFyZWQgYnkgS2V5RXZlbnQgYW5kIE1vdXNlRXZlbnQNCiAgICAgICAgICAgIHByb3BzOiAiYWx0S2V5IGJ1YmJsZXMgY2FuY2VsYWJsZSBjdHJsS2V5IGN1cnJlbnRUYXJnZXQgZXZlbnRQaGFzZSBtZXRhS2V5IHJlbGF0ZWRUYXJnZXQgc2hpZnRLZXkgdGFyZ2V0IHRpbWVTdGFtcCB2aWV3IHdoaWNoIi5zcGxpdCgiICIpLA0KICAgICAgICANCiAgICAgICAgICAgIGZpeEhvb2tzOiB7fSwNCiAgICAgICAgDQogICAgICAgICAgICBrZXlIb29rczogew0KICAgICAgICAgICAgICAgIHByb3BzOiAiY2hhciBjaGFyQ29kZSBrZXkga2V5Q29kZSIuc3BsaXQoIiAiKSwNCiAgICAgICAgICAgICAgICBmaWx0ZXI6IGZ1bmN0aW9uKCBldmVudCwgb3JpZ2luYWwgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBBZGQgd2hpY2ggZm9yIGtleSBldmVudHMNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBldmVudC53aGljaCA9PSBudWxsICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQud2hpY2ggPSBvcmlnaW5hbC5jaGFyQ29kZSAhPSBudWxsID8gb3JpZ2luYWwuY2hhckNvZGUgOiBvcmlnaW5hbC5rZXlDb2RlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBtb3VzZUhvb2tzOiB7DQogICAgICAgICAgICAgICAgcHJvcHM6ICJidXR0b24gYnV0dG9ucyBjbGllbnRYIGNsaWVudFkgZnJvbUVsZW1lbnQgb2Zmc2V0WCBvZmZzZXRZIHBhZ2VYIHBhZ2VZIHNjcmVlblggc2NyZWVuWSB0b0VsZW1lbnQiLnNwbGl0KCIgIiksDQogICAgICAgICAgICAgICAgZmlsdGVyOiBmdW5jdGlvbiggZXZlbnQsIG9yaWdpbmFsICkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgYm9keSwgZXZlbnREb2MsIGRvYywNCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IG9yaWdpbmFsLmJ1dHRvbiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGZyb21FbGVtZW50ID0gb3JpZ2luYWwuZnJvbUVsZW1lbnQ7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgcGFnZVgvWSBpZiBtaXNzaW5nIGFuZCBjbGllbnRYL1kgYXZhaWxhYmxlDQogICAgICAgICAgICAgICAgICAgIGlmICggZXZlbnQucGFnZVggPT0gbnVsbCAmJiBvcmlnaW5hbC5jbGllbnRYICE9IG51bGwgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBldmVudERvYyA9IGV2ZW50LnRhcmdldC5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50Ow0KICAgICAgICAgICAgICAgICAgICAgICAgZG9jID0gZXZlbnREb2MuZG9jdW1lbnRFbGVtZW50Ow0KICAgICAgICAgICAgICAgICAgICAgICAgYm9keSA9IGV2ZW50RG9jLmJvZHk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucGFnZVggPSBvcmlnaW5hbC5jbGllbnRYICsgKCBkb2MgJiYgZG9jLnNjcm9sbExlZnQgfHwgYm9keSAmJiBib2R5LnNjcm9sbExlZnQgfHwgMCApIC0gKCBkb2MgJiYgZG9jLmNsaWVudExlZnQgfHwgYm9keSAmJiBib2R5LmNsaWVudExlZnQgfHwgMCApOw0KICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucGFnZVkgPSBvcmlnaW5hbC5jbGllbnRZICsgKCBkb2MgJiYgZG9jLnNjcm9sbFRvcCAgfHwgYm9keSAmJiBib2R5LnNjcm9sbFRvcCAgfHwgMCApIC0gKCBkb2MgJiYgZG9jLmNsaWVudFRvcCAgfHwgYm9keSAmJiBib2R5LmNsaWVudFRvcCAgfHwgMCApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBBZGQgcmVsYXRlZFRhcmdldCwgaWYgbmVjZXNzYXJ5DQogICAgICAgICAgICAgICAgICAgIGlmICggIWV2ZW50LnJlbGF0ZWRUYXJnZXQgJiYgZnJvbUVsZW1lbnQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBldmVudC5yZWxhdGVkVGFyZ2V0ID0gZnJvbUVsZW1lbnQgPT09IGV2ZW50LnRhcmdldCA/IG9yaWdpbmFsLnRvRWxlbWVudCA6IGZyb21FbGVtZW50Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBBZGQgd2hpY2ggZm9yIGNsaWNrOiAxID09PSBsZWZ0OyAyID09PSBtaWRkbGU7IDMgPT09IHJpZ2h0DQogICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IGJ1dHRvbiBpcyBub3Qgbm9ybWFsaXplZCwgc28gZG9uJ3QgdXNlIGl0DQogICAgICAgICAgICAgICAgICAgIGlmICggIWV2ZW50LndoaWNoICYmIGJ1dHRvbiAhPT0gdW5kZWZpbmVkICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQud2hpY2ggPSAoIGJ1dHRvbiAmIDEgPyAxIDogKCBidXR0b24gJiAyID8gMyA6ICggYnV0dG9uICYgNCA/IDIgOiAwICkgKSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBzcGVjaWFsOiB7DQogICAgICAgICAgICAgICAgbG9hZDogew0KICAgICAgICAgICAgICAgICAgICAvLyBQcmV2ZW50IHRyaWdnZXJlZCBpbWFnZS5sb2FkIGV2ZW50cyBmcm9tIGJ1YmJsaW5nIHRvIHdpbmRvdy5sb2FkDQogICAgICAgICAgICAgICAgICAgIG5vQnViYmxlOiB0cnVlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBjbGljazogew0KICAgICAgICAgICAgICAgICAgICAvLyBGb3IgY2hlY2tib3gsIGZpcmUgbmF0aXZlIGV2ZW50IHNvIGNoZWNrZWQgc3RhdGUgd2lsbCBiZSByaWdodA0KICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiaW5wdXQiICkgJiYgdGhpcy50eXBlID09PSAiY2hlY2tib3giICYmIHRoaXMuY2xpY2sgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJdGhpcy5jbGljaygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgCXJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgZm9jdXM6IHsNCiAgICAgICAgICAgICAgICAgICAgLy8gRmlyZSBuYXRpdmUgZXZlbnQgaWYgcG9zc2libGUgc28gYmx1ci9mb2N1cyBzZXF1ZW5jZSBpcyBjb3JyZWN0DQogICAgICAgICAgICAgICAgICAgIHRyaWdnZXI6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB0aGlzICE9PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmIHRoaXMuZm9jdXMgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJdGhpcy5mb2N1cygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQlyZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICAJfSBjYXRjaCAoIGUgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIFN1cHBvcnQ6IElFPDkNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gSWYgd2UgZXJyb3Igb24gZm9jdXMgdG8gaGlkZGVuIGVsZW1lbnQgKCMxNDg2LCAjMTI1MTgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkvLyBsZXQgLnRyaWdnZXIoKSBydW4gdGhlIGhhbmRsZXJzDQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBkZWxlZ2F0ZVR5cGU6ICJmb2N1c2luIg0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgYmx1cjogew0KICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdGhpcyA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAmJiB0aGlzLmJsdXIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJdGhpcy5ibHVyKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBkZWxlZ2F0ZVR5cGU6ICJmb2N1c291dCINCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICBiZWZvcmV1bmxvYWQ6IHsNCiAgICAgICAgICAgICAgICAgICAgcG9zdERpc3BhdGNoOiBmdW5jdGlvbiggZXZlbnQgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXZlbiB3aGVuIHJldHVyblZhbHVlIGVxdWFscyB0byB1bmRlZmluZWQgRmlyZWZveCB3aWxsIHN0aWxsIHNob3cgYWxlcnQNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZXZlbnQucmVzdWx0ICE9PSB1bmRlZmluZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJZXZlbnQub3JpZ2luYWxFdmVudC5yZXR1cm5WYWx1ZSA9IGV2ZW50LnJlc3VsdDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgc2ltdWxhdGU6IGZ1bmN0aW9uKCB0eXBlLCBlbGVtLCBldmVudCwgYnViYmxlICkgew0KICAgICAgICAgICAgICAgIC8vIFBpZ2d5YmFjayBvbiBhIGRvbm9yIGV2ZW50IHRvIHNpbXVsYXRlIGEgZGlmZmVyZW50IG9uZS4NCiAgICAgICAgICAgICAgICAvLyBGYWtlIG9yaWdpbmFsRXZlbnQgdG8gYXZvaWQgZG9ub3IncyBzdG9wUHJvcGFnYXRpb24sIGJ1dCBpZiB0aGUNCiAgICAgICAgICAgICAgICAvLyBzaW11bGF0ZWQgZXZlbnQgcHJldmVudHMgZGVmYXVsdCB0aGVuIHdlIGRvIHRoZSBzYW1lIG9uIHRoZSBkb25vci4NCiAgICAgICAgICAgICAgICB2YXIgZSA9IGpRdWVyeS5leHRlbmQoDQogICAgICAgICAgICAgICAgICAgIG5ldyBqUXVlcnkuRXZlbnQoKSwNCiAgICAgICAgICAgICAgICAgICAgZXZlbnQsDQogICAgICAgICAgICAgICAgICAgIHsgdHlwZTogdHlwZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGlzU2ltdWxhdGVkOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxFdmVudDoge30NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgaWYgKCBidWJibGUgKSB7DQogICAgICAgICAgICAgICAgICAgIGpRdWVyeS5ldmVudC50cmlnZ2VyKCBlLCBudWxsLCBlbGVtICk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LmRpc3BhdGNoLmNhbGwoIGVsZW0sIGUgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCBlLmlzRGVmYXVsdFByZXZlbnRlZCgpICkgew0KICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIGpRdWVyeS5yZW1vdmVFdmVudCA9IGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIgPw0KICAgICAgICAgICAgZnVuY3Rpb24oIGVsZW0sIHR5cGUsIGhhbmRsZSApIHsNCiAgICAgICAgICAgICAgICBpZiAoIGVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lciApIHsNCiAgICAgICAgICAgICAgICAgICAgZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyKCB0eXBlLCBoYW5kbGUsIGZhbHNlICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSA6DQogICAgICAgICAgICBmdW5jdGlvbiggZWxlbSwgdHlwZSwgaGFuZGxlICkgew0KICAgICAgICAgICAgICAgIHZhciBuYW1lID0gIm9uIiArIHR5cGU7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggZWxlbS5kZXRhY2hFdmVudCApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vICM4NTQ1LCAjNzA1NCwgcHJldmVudGluZyBtZW1vcnkgbGVha3MgZm9yIGN1c3RvbSBldmVudHMgaW4gSUU2LTgNCiAgICAgICAgICAgICAgICAgICAgLy8gZGV0YWNoRXZlbnQgbmVlZGVkIHByb3BlcnR5IG9uIGVsZW1lbnQsIGJ5IG5hbWUgb2YgdGhhdCBldmVudCwgdG8gcHJvcGVybHkgZXhwb3NlIGl0IHRvIEdDDQogICAgICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIGVsZW1bIG5hbWUgXSA9PT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBlbGVtWyBuYW1lIF0gPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBlbGVtLmRldGFjaEV2ZW50KCBuYW1lLCBoYW5kbGUgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgalF1ZXJ5LkV2ZW50ID0gZnVuY3Rpb24oIHNyYywgcHJvcHMgKSB7DQogICAgICAgICAgICAvLyBBbGxvdyBpbnN0YW50aWF0aW9uIHdpdGhvdXQgdGhlICduZXcnIGtleXdvcmQNCiAgICAgICAgICAgIGlmICggISh0aGlzIGluc3RhbmNlb2YgalF1ZXJ5LkV2ZW50KSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGpRdWVyeS5FdmVudCggc3JjLCBwcm9wcyApOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIEV2ZW50IG9iamVjdA0KICAgICAgICAgICAgaWYgKCBzcmMgJiYgc3JjLnR5cGUgKSB7DQogICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbEV2ZW50ID0gc3JjOw0KICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9IHNyYy50eXBlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBFdmVudHMgYnViYmxpbmcgdXAgdGhlIGRvY3VtZW50IG1heSBoYXZlIGJlZW4gbWFya2VkIGFzIHByZXZlbnRlZA0KICAgICAgICAgICAgICAgIC8vIGJ5IGEgaGFuZGxlciBsb3dlciBkb3duIHRoZSB0cmVlOyByZWZsZWN0IHRoZSBjb3JyZWN0IHZhbHVlLg0KICAgICAgICAgICAgICAgIHRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gKCBzcmMuZGVmYXVsdFByZXZlbnRlZCB8fCBzcmMucmV0dXJuVmFsdWUgPT09IGZhbHNlIHx8DQogICAgICAgICAgICAgICAgICAgIHNyYy5nZXRQcmV2ZW50RGVmYXVsdCAmJiBzcmMuZ2V0UHJldmVudERlZmF1bHQoKSApID8gcmV0dXJuVHJ1ZSA6IHJldHVybkZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIEV2ZW50IHR5cGUNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdGhpcy50eXBlID0gc3JjOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIFB1dCBleHBsaWNpdGx5IHByb3ZpZGVkIHByb3BlcnRpZXMgb250byB0aGUgZXZlbnQgb2JqZWN0DQogICAgICAgICAgICBpZiAoIHByb3BzICkgew0KICAgICAgICAgICAgICAgIGpRdWVyeS5leHRlbmQoIHRoaXMsIHByb3BzICk7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gQ3JlYXRlIGEgdGltZXN0YW1wIGlmIGluY29taW5nIGV2ZW50IGRvZXNuJ3QgaGF2ZSBvbmUNCiAgICAgICAgICAgIHRoaXMudGltZVN0YW1wID0gc3JjICYmIHNyYy50aW1lU3RhbXAgfHwgalF1ZXJ5Lm5vdygpOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIE1hcmsgaXQgYXMgZml4ZWQNCiAgICAgICAgICAgIHRoaXNbIGpRdWVyeS5leHBhbmRvIF0gPSB0cnVlOw0KICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgLy8galF1ZXJ5LkV2ZW50IGlzIGJhc2VkIG9uIERPTTMgRXZlbnRzIGFzIHNwZWNpZmllZCBieSB0aGUgRUNNQVNjcmlwdCBMYW5ndWFnZSBCaW5kaW5nDQogICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMDMvV0QtRE9NLUxldmVsLTMtRXZlbnRzLTIwMDMwMzMxL2VjbWEtc2NyaXB0LWJpbmRpbmcuaHRtbA0KICAgICAgICBqUXVlcnkuRXZlbnQucHJvdG90eXBlID0gew0KICAgICAgICAgICAgaXNEZWZhdWx0UHJldmVudGVkOiByZXR1cm5GYWxzZSwNCiAgICAgICAgICAgIGlzUHJvcGFnYXRpb25TdG9wcGVkOiByZXR1cm5GYWxzZSwNCiAgICAgICAgICAgIGlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOiByZXR1cm5GYWxzZSwNCiAgICAgICAgDQogICAgICAgICAgICBwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLm9yaWdpbmFsRXZlbnQ7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gcmV0dXJuVHJ1ZTsNCiAgICAgICAgICAgICAgICBpZiAoICFlICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBJZiBwcmV2ZW50RGVmYXVsdCBleGlzdHMsIHJ1biBpdCBvbiB0aGUgb3JpZ2luYWwgZXZlbnQNCiAgICAgICAgICAgICAgICBpZiAoIGUucHJldmVudERlZmF1bHQgKSB7DQogICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gU3VwcG9ydDogSUUNCiAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2Ugc2V0IHRoZSByZXR1cm5WYWx1ZSBwcm9wZXJ0eSBvZiB0aGUgb3JpZ2luYWwgZXZlbnQgdG8gZmFsc2UNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBlLnJldHVyblZhbHVlID0gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHN0b3BQcm9wYWdhdGlvbjogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLm9yaWdpbmFsRXZlbnQ7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQgPSByZXR1cm5UcnVlOw0KICAgICAgICAgICAgICAgIGlmICggIWUgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gSWYgc3RvcFByb3BhZ2F0aW9uIGV4aXN0cywgcnVuIGl0IG9uIHRoZSBvcmlnaW5hbCBldmVudA0KICAgICAgICAgICAgICAgIGlmICggZS5zdG9wUHJvcGFnYXRpb24gKSB7DQogICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBTdXBwb3J0OiBJRQ0KICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgY2FuY2VsQnViYmxlIHByb3BlcnR5IG9mIHRoZSBvcmlnaW5hbCBldmVudCB0byB0cnVlDQogICAgICAgICAgICAgICAgZS5jYW5jZWxCdWJibGUgPSB0cnVlOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbjogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgdGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7DQogICAgICAgICAgICAgICAgdGhpcy5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIC8vIENyZWF0ZSBtb3VzZWVudGVyL2xlYXZlIGV2ZW50cyB1c2luZyBtb3VzZW92ZXIvb3V0IGFuZCBldmVudC10aW1lIGNoZWNrcw0KICAgICAgICBqUXVlcnkuZWFjaCh7DQogICAgICAgICAgICBtb3VzZWVudGVyOiAibW91c2VvdmVyIiwNCiAgICAgICAgICAgIG1vdXNlbGVhdmU6ICJtb3VzZW91dCINCiAgICAgICAgfSwgZnVuY3Rpb24oIG9yaWcsIGZpeCApIHsNCiAgICAgICAgICAgIGpRdWVyeS5ldmVudC5zcGVjaWFsWyBvcmlnIF0gPSB7DQogICAgICAgICAgICAgICAgZGVsZWdhdGVUeXBlOiBmaXgsDQogICAgICAgICAgICAgICAgYmluZFR5cGU6IGZpeCwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaGFuZGxlOiBmdW5jdGlvbiggZXZlbnQgKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciByZXQsDQogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLA0KICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRlZCA9IGV2ZW50LnJlbGF0ZWRUYXJnZXQsDQogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVPYmogPSBldmVudC5oYW5kbGVPYmo7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBGb3IgbW91c2VudGVyL2xlYXZlIGNhbGwgdGhlIGhhbmRsZXIgaWYgcmVsYXRlZCBpcyBvdXRzaWRlIHRoZSB0YXJnZXQuDQogICAgICAgICAgICAgICAgICAgIC8vIE5COiBObyByZWxhdGVkVGFyZ2V0IGlmIHRoZSBtb3VzZSBsZWZ0L2VudGVyZWQgdGhlIGJyb3dzZXIgd2luZG93DQogICAgICAgICAgICAgICAgICAgIGlmICggIXJlbGF0ZWQgfHwgKHJlbGF0ZWQgIT09IHRhcmdldCAmJiAhalF1ZXJ5LmNvbnRhaW5zKCB0YXJnZXQsIHJlbGF0ZWQgKSkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBldmVudC50eXBlID0gaGFuZGxlT2JqLm9yaWdUeXBlOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOw0KICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQudHlwZSA9IGZpeDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgLy8gSUUgc3VibWl0IGRlbGVnYXRpb24NCiAgICAgICAgaWYgKCAhalF1ZXJ5LnN1cHBvcnQuc3VibWl0QnViYmxlcyApIHsNCiAgICAgICAgDQogICAgICAgICAgICBqUXVlcnkuZXZlbnQuc3BlY2lhbC5zdWJtaXQgPSB7DQogICAgICAgICAgICAgICAgc2V0dXA6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBPbmx5IG5lZWQgdGhpcyBmb3IgZGVsZWdhdGVkIGZvcm0gc3VibWl0IGV2ZW50cw0KICAgICAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5ub2RlTmFtZSggdGhpcywgImZvcm0iICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIExhenktYWRkIGEgc3VibWl0IGhhbmRsZXIgd2hlbiBhIGRlc2NlbmRhbnQgZm9ybSBtYXkgcG90ZW50aWFsbHkgYmUgc3VibWl0dGVkDQogICAgICAgICAgICAgICAgICAgIGpRdWVyeS5ldmVudC5hZGQoIHRoaXMsICJjbGljay5fc3VibWl0IGtleXByZXNzLl9zdWJtaXQiLCBmdW5jdGlvbiggZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vZGUgbmFtZSBjaGVjayBhdm9pZHMgYSBWTUwtcmVsYXRlZCBjcmFzaCBpbiBJRSAoIzk4MDcpDQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IGUudGFyZ2V0LA0KICAgICAgICAgICAgICAgICAgICAgICAgCWZvcm0gPSBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpbnB1dCIgKSB8fCBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJidXR0b24iICkgPyBlbGVtLmZvcm0gOiB1bmRlZmluZWQ7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGZvcm0gJiYgIWpRdWVyeS5fZGF0YSggZm9ybSwgInN1Ym1pdEJ1YmJsZXMiICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJalF1ZXJ5LmV2ZW50LmFkZCggZm9ybSwgInN1Ym1pdC5fc3VibWl0IiwgZnVuY3Rpb24oIGV2ZW50ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlldmVudC5fc3VibWl0X2J1YmJsZSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAJfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAJalF1ZXJ5Ll9kYXRhKCBmb3JtLCAic3VibWl0QnViYmxlcyIsIHRydWUgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIC8vIHJldHVybiB1bmRlZmluZWQgc2luY2Ugd2UgZG9uJ3QgbmVlZCBhbiBldmVudCBsaXN0ZW5lcg0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgICAgIHBvc3REaXNwYXRjaDogZnVuY3Rpb24oIGV2ZW50ICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBJZiBmb3JtIHdhcyBzdWJtaXR0ZWQgYnkgdGhlIHVzZXIsIGJ1YmJsZSB0aGUgZXZlbnQgdXAgdGhlIHRyZWUNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBldmVudC5fc3VibWl0X2J1YmJsZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBldmVudC5fc3VibWl0X2J1YmJsZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdGhpcy5wYXJlbnROb2RlICYmICFldmVudC5pc1RyaWdnZXIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCAic3VibWl0IiwgdGhpcy5wYXJlbnROb2RlLCBldmVudCwgdHJ1ZSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdGVhcmRvd246IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBPbmx5IG5lZWQgdGhpcyBmb3IgZGVsZWdhdGVkIGZvcm0gc3VibWl0IGV2ZW50cw0KICAgICAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5ub2RlTmFtZSggdGhpcywgImZvcm0iICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBkZWxlZ2F0ZWQgaGFuZGxlcnM7IGNsZWFuRGF0YSBldmVudHVhbGx5IHJlYXBzIHN1Ym1pdCBoYW5kbGVycyBhdHRhY2hlZCBhYm92ZQ0KICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQucmVtb3ZlKCB0aGlzLCAiLl9zdWJtaXQiICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gSUUgY2hhbmdlIGRlbGVnYXRpb24gYW5kIGNoZWNrYm94L3JhZGlvIGZpeA0KICAgICAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC5jaGFuZ2VCdWJibGVzICkgew0KICAgICAgICANCiAgICAgICAgICAgIGpRdWVyeS5ldmVudC5zcGVjaWFsLmNoYW5nZSA9IHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgc2V0dXA6IGZ1bmN0aW9uKCkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCByZm9ybUVsZW1zLnRlc3QoIHRoaXMubm9kZU5hbWUgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElFIGRvZXNuJ3QgZmlyZSBjaGFuZ2Ugb24gYSBjaGVjay9yYWRpbyB1bnRpbCBibHVyOyB0cmlnZ2VyIGl0IG9uIGNsaWNrDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBhZnRlciBhIHByb3BlcnR5Y2hhbmdlLiBFYXQgdGhlIGJsdXItY2hhbmdlIGluIHNwZWNpYWwuY2hhbmdlLmhhbmRsZS4NCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgc3RpbGwgZmlyZXMgb25jaGFuZ2UgYSBzZWNvbmQgdGltZSBmb3IgY2hlY2svcmFkaW8gYWZ0ZXIgYmx1ci4NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdGhpcy50eXBlID09PSAiY2hlY2tib3giIHx8IHRoaXMudHlwZSA9PT0gInJhZGlvIiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlqUXVlcnkuZXZlbnQuYWRkKCB0aGlzLCAicHJvcGVydHljaGFuZ2UuX2NoYW5nZSIsIGZ1bmN0aW9uKCBldmVudCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJaWYgKCBldmVudC5vcmlnaW5hbEV2ZW50LnByb3BlcnR5TmFtZSA9PT0gImNoZWNrZWQiICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJdGhpcy5fanVzdF9jaGFuZ2VkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCX0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsICJjbGljay5fY2hhbmdlIiwgZnVuY3Rpb24oIGV2ZW50ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlpZiAoIHRoaXMuX2p1c3RfY2hhbmdlZCAmJiAhZXZlbnQuaXNUcmlnZ2VyICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJdGhpcy5fanVzdF9jaGFuZ2VkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gQWxsb3cgdHJpZ2dlcmVkLCBzaW11bGF0ZWQgY2hhbmdlIGV2ZW50cyAoIzExNTAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQlqUXVlcnkuZXZlbnQuc2ltdWxhdGUoICJjaGFuZ2UiLCB0aGlzLCBldmVudCwgdHJ1ZSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIC8vIERlbGVnYXRlZCBldmVudDsgbGF6eS1hZGQgYSBjaGFuZ2UgaGFuZGxlciBvbiBkZXNjZW5kYW50IGlucHV0cw0KICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQuYWRkKCB0aGlzLCAiYmVmb3JlYWN0aXZhdGUuX2NoYW5nZSIsIGZ1bmN0aW9uKCBlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW0gPSBlLnRhcmdldDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHJmb3JtRWxlbXMudGVzdCggZWxlbS5ub2RlTmFtZSApICYmICFqUXVlcnkuX2RhdGEoIGVsZW0sICJjaGFuZ2VCdWJibGVzIiApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWpRdWVyeS5ldmVudC5hZGQoIGVsZW0sICJjaGFuZ2UuX2NoYW5nZSIsIGZ1bmN0aW9uKCBldmVudCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJaWYgKCB0aGlzLnBhcmVudE5vZGUgJiYgIWV2ZW50LmlzU2ltdWxhdGVkICYmICFldmVudC5pc1RyaWdnZXIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQlqUXVlcnkuZXZlbnQuc2ltdWxhdGUoICJjaGFuZ2UiLCB0aGlzLnBhcmVudE5vZGUsIGV2ZW50LCB0cnVlICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAl9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlqUXVlcnkuX2RhdGEoIGVsZW0sICJjaGFuZ2VCdWJibGVzIiwgdHJ1ZSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICBoYW5kbGU6IGZ1bmN0aW9uKCBldmVudCApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW0gPSBldmVudC50YXJnZXQ7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBTd2FsbG93IG5hdGl2ZSBjaGFuZ2UgZXZlbnRzIGZyb20gY2hlY2tib3gvcmFkaW8sIHdlIGFscmVhZHkgdHJpZ2dlcmVkIHRoZW0gYWJvdmUNCiAgICAgICAgICAgICAgICAgICAgaWYgKCB0aGlzICE9PSBlbGVtIHx8IGV2ZW50LmlzU2ltdWxhdGVkIHx8IGV2ZW50LmlzVHJpZ2dlciB8fCAoZWxlbS50eXBlICE9PSAicmFkaW8iICYmIGVsZW0udHlwZSAhPT0gImNoZWNrYm94IikgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnQuaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdGVhcmRvd246IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQucmVtb3ZlKCB0aGlzLCAiLl9jaGFuZ2UiICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gIXJmb3JtRWxlbXMudGVzdCggdGhpcy5ub2RlTmFtZSApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIENyZWF0ZSAiYnViYmxpbmciIGZvY3VzIGFuZCBibHVyIGV2ZW50cw0KICAgICAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC5mb2N1c2luQnViYmxlcyApIHsNCiAgICAgICAgICAgIGpRdWVyeS5lYWNoKHsgZm9jdXM6ICJmb2N1c2luIiwgYmx1cjogImZvY3Vzb3V0IiB9LCBmdW5jdGlvbiggb3JpZywgZml4ICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBBdHRhY2ggYSBzaW5nbGUgY2FwdHVyaW5nIGhhbmRsZXIgd2hpbGUgc29tZW9uZSB3YW50cyBmb2N1c2luL2ZvY3Vzb3V0DQogICAgICAgICAgICAgICAgdmFyIGF0dGFjaGVzID0gMCwNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlciA9IGZ1bmN0aW9uKCBldmVudCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5ldmVudC5zaW11bGF0ZSggZml4LCBldmVudC50YXJnZXQsIGpRdWVyeS5ldmVudC5maXgoIGV2ZW50ICksIHRydWUgKTsNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LnNwZWNpYWxbIGZpeCBdID0gew0KICAgICAgICAgICAgICAgICAgICBzZXR1cDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGF0dGFjaGVzKysgPT09IDAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggb3JpZywgaGFuZGxlciwgdHJ1ZSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB0ZWFyZG93bjogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIC0tYXR0YWNoZXMgPT09IDAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggb3JpZywgaGFuZGxlciwgdHJ1ZSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZm4uZXh0ZW5kKHsNCiAgICAgICAgDQogICAgICAgICAgICBvbjogZnVuY3Rpb24oIHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4sIC8qSU5URVJOQUwqLyBvbmUgKSB7DQogICAgICAgICAgICAgICAgdmFyIHR5cGUsIG9yaWdGbjsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gVHlwZXMgY2FuIGJlIGEgbWFwIG9mIHR5cGVzL2hhbmRsZXJzDQogICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgdHlwZXMgPT09ICJvYmplY3QiICkgew0KICAgICAgICAgICAgICAgICAgICAvLyAoIHR5cGVzLU9iamVjdCwgc2VsZWN0b3IsIGRhdGEgKQ0KICAgICAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBzZWxlY3RvciAhPT0gInN0cmluZyIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyAoIHR5cGVzLU9iamVjdCwgZGF0YSApDQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gZGF0YSB8fCBzZWxlY3RvcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGZvciAoIHR5cGUgaW4gdHlwZXMgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uKCB0eXBlLCBzZWxlY3RvciwgZGF0YSwgdHlwZXNbIHR5cGUgXSwgb25lICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIGRhdGEgPT0gbnVsbCAmJiBmbiA9PSBudWxsICkgew0KICAgICAgICAgICAgICAgICAgICAvLyAoIHR5cGVzLCBmbiApDQogICAgICAgICAgICAgICAgICAgIGZuID0gc2VsZWN0b3I7DQogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBzZWxlY3RvciA9IHVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBmbiA9PSBudWxsICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyAoIHR5cGVzLCBzZWxlY3RvciwgZm4gKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZm4gPSBkYXRhOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICggdHlwZXMsIGRhdGEsIGZuICkNCiAgICAgICAgICAgICAgICAgICAgICAgIGZuID0gZGF0YTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBzZWxlY3RvcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICggZm4gPT09IGZhbHNlICkgew0KICAgICAgICAgICAgICAgICAgICBmbiA9IHJldHVybkZhbHNlOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoICFmbiApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIG9uZSA9PT0gMSApIHsNCiAgICAgICAgICAgICAgICAgICAgb3JpZ0ZuID0gZm47DQogICAgICAgICAgICAgICAgICAgIGZuID0gZnVuY3Rpb24oIGV2ZW50ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FuIHVzZSBhbiBlbXB0eSBzZXQsIHNpbmNlIGV2ZW50IGNvbnRhaW5zIHRoZSBpbmZvDQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoKS5vZmYoIGV2ZW50ICk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ0ZuLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHNhbWUgZ3VpZCBzbyBjYWxsZXIgY2FuIHJlbW92ZSB1c2luZyBvcmlnRm4NCiAgICAgICAgICAgICAgICAgICAgZm4uZ3VpZCA9IG9yaWdGbi5ndWlkIHx8ICggb3JpZ0ZuLmd1aWQgPSBqUXVlcnkuZ3VpZCsrICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQuYWRkKCB0aGlzLCB0eXBlcywgZm4sIGRhdGEsIHNlbGVjdG9yICk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgb25lOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vbiggdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiwgMSApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIG9mZjogZnVuY3Rpb24oIHR5cGVzLCBzZWxlY3RvciwgZm4gKSB7DQogICAgICAgICAgICAgICAgdmFyIGhhbmRsZU9iaiwgdHlwZTsNCiAgICAgICAgICAgICAgICBpZiAoIHR5cGVzICYmIHR5cGVzLnByZXZlbnREZWZhdWx0ICYmIHR5cGVzLmhhbmRsZU9iaiApIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gKCBldmVudCApICBkaXNwYXRjaGVkIGpRdWVyeS5FdmVudA0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVPYmogPSB0eXBlcy5oYW5kbGVPYmo7DQogICAgICAgICAgICAgICAgICAgIGpRdWVyeSggdHlwZXMuZGVsZWdhdGVUYXJnZXQgKS5vZmYoDQogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVPYmoubmFtZXNwYWNlID8gaGFuZGxlT2JqLm9yaWdUeXBlICsgIi4iICsgaGFuZGxlT2JqLm5hbWVzcGFjZSA6IGhhbmRsZU9iai5vcmlnVHlwZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZU9iai5zZWxlY3RvciwNCiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZU9iai5oYW5kbGVyDQogICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiB0eXBlcyA9PT0gIm9iamVjdCIgKSB7DQogICAgICAgICAgICAgICAgICAgIC8vICggdHlwZXMtb2JqZWN0IFssIHNlbGVjdG9yXSApDQogICAgICAgICAgICAgICAgICAgIGZvciAoIHR5cGUgaW4gdHlwZXMgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9mZiggdHlwZSwgc2VsZWN0b3IsIHR5cGVzWyB0eXBlIF0gKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCBzZWxlY3RvciA9PT0gZmFsc2UgfHwgdHlwZW9mIHNlbGVjdG9yID09PSAiZnVuY3Rpb24iICkgew0KICAgICAgICAgICAgICAgICAgICAvLyAoIHR5cGVzIFssIGZuXSApDQogICAgICAgICAgICAgICAgICAgIGZuID0gc2VsZWN0b3I7DQogICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIGZuID09PSBmYWxzZSApIHsNCiAgICAgICAgICAgICAgICAgICAgZm4gPSByZXR1cm5GYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LnJlbW92ZSggdGhpcywgdHlwZXMsIGZuLCBzZWxlY3RvciApOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBiaW5kOiBmdW5jdGlvbiggdHlwZXMsIGRhdGEsIGZuICkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9uKCB0eXBlcywgbnVsbCwgZGF0YSwgZm4gKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB1bmJpbmQ6IGZ1bmN0aW9uKCB0eXBlcywgZm4gKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMub2ZmKCB0eXBlcywgbnVsbCwgZm4gKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgZGVsZWdhdGU6IGZ1bmN0aW9uKCBzZWxlY3RvciwgdHlwZXMsIGRhdGEsIGZuICkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgdW5kZWxlZ2F0ZTogZnVuY3Rpb24oIHNlbGVjdG9yLCB0eXBlcywgZm4gKSB7DQogICAgICAgICAgICAgICAgLy8gKCBuYW1lc3BhY2UgKSBvciAoIHNlbGVjdG9yLCB0eXBlcyBbLCBmbl0gKQ0KICAgICAgICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gdGhpcy5vZmYoIHNlbGVjdG9yLCAiKioiICkgOiB0aGlzLm9mZiggdHlwZXMsIHNlbGVjdG9yIHx8ICIqKiIsIGZuICk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIHRyaWdnZXI6IGZ1bmN0aW9uKCB0eXBlLCBkYXRhICkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIGpRdWVyeS5ldmVudC50cmlnZ2VyKCB0eXBlLCBkYXRhLCB0aGlzICk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgdHJpZ2dlckhhbmRsZXI6IGZ1bmN0aW9uKCB0eXBlLCBkYXRhICkgew0KICAgICAgICAgICAgICAgIHZhciBlbGVtID0gdGhpc1swXTsNCiAgICAgICAgICAgICAgICBpZiAoIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZXZlbnQudHJpZ2dlciggdHlwZSwgZGF0YSwgZWxlbSwgdHJ1ZSApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIC8qIQ0KICAgICAgICAgKiBTaXp6bGUgQ1NTIFNlbGVjdG9yIEVuZ2luZQ0KICAgICAgICAgKiBDb3B5cmlnaHQgMjAxMiBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzDQogICAgICAgICAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZQ0KICAgICAgICAgKiBodHRwOi8vc2l6emxlanMuY29tLw0KICAgICAgICAgKi8NCiAgICAgICAgKGZ1bmN0aW9uKCB3aW5kb3csIHVuZGVmaW5lZCApIHsNCiAgICAgICAgDQogICAgICAgIHZhciBpLA0KICAgICAgICAgICAgY2FjaGVkcnVucywNCiAgICAgICAgICAgIEV4cHIsDQogICAgICAgICAgICBnZXRUZXh0LA0KICAgICAgICAgICAgaXNYTUwsDQogICAgICAgICAgICBjb21waWxlLA0KICAgICAgICAgICAgaGFzRHVwbGljYXRlLA0KICAgICAgICAgICAgb3V0ZXJtb3N0Q29udGV4dCwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBMb2NhbCBkb2N1bWVudCB2YXJzDQogICAgICAgICAgICBzZXREb2N1bWVudCwNCiAgICAgICAgICAgIGRvY3VtZW50LA0KICAgICAgICAgICAgZG9jRWxlbSwNCiAgICAgICAgICAgIGRvY3VtZW50SXNYTUwsDQogICAgICAgICAgICByYnVnZ3lRU0EsDQogICAgICAgICAgICByYnVnZ3lNYXRjaGVzLA0KICAgICAgICAgICAgbWF0Y2hlcywNCiAgICAgICAgICAgIGNvbnRhaW5zLA0KICAgICAgICAgICAgc29ydE9yZGVyLA0KICAgICAgICANCiAgICAgICAgICAgIC8vIEluc3RhbmNlLXNwZWNpZmljIGRhdGENCiAgICAgICAgICAgIGV4cGFuZG8gPSAic2l6emxlIiArIC0obmV3IERhdGUoKSksDQogICAgICAgICAgICBwcmVmZXJyZWREb2MgPSB3aW5kb3cuZG9jdW1lbnQsDQogICAgICAgICAgICBzdXBwb3J0ID0ge30sDQogICAgICAgICAgICBkaXJydW5zID0gMCwNCiAgICAgICAgICAgIGRvbmUgPSAwLA0KICAgICAgICAgICAgY2xhc3NDYWNoZSA9IGNyZWF0ZUNhY2hlKCksDQogICAgICAgICAgICB0b2tlbkNhY2hlID0gY3JlYXRlQ2FjaGUoKSwNCiAgICAgICAgICAgIGNvbXBpbGVyQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLA0KICAgICAgICANCiAgICAgICAgICAgIC8vIEdlbmVyYWwtcHVycG9zZSBjb25zdGFudHMNCiAgICAgICAgICAgIHN0cnVuZGVmaW5lZCA9IHR5cGVvZiB1bmRlZmluZWQsDQogICAgICAgICAgICBNQVhfTkVHQVRJVkUgPSAxIDw8IDMxLA0KICAgICAgICANCiAgICAgICAgICAgIC8vIEFycmF5IG1ldGhvZHMNCiAgICAgICAgICAgIGFyciA9IFtdLA0KICAgICAgICAgICAgcG9wID0gYXJyLnBvcCwNCiAgICAgICAgICAgIHB1c2ggPSBhcnIucHVzaCwNCiAgICAgICAgICAgIHNsaWNlID0gYXJyLnNsaWNlLA0KICAgICAgICAgICAgLy8gVXNlIGEgc3RyaXBwZWQtZG93biBpbmRleE9mIGlmIHdlIGNhbid0IHVzZSBhIG5hdGl2ZSBvbmUNCiAgICAgICAgICAgIGluZGV4T2YgPSBhcnIuaW5kZXhPZiB8fCBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICB2YXIgaSA9IDAsDQogICAgICAgICAgICAgICAgICAgIGxlbiA9IHRoaXMubGVuZ3RoOw0KICAgICAgICAgICAgICAgIGZvciAoIDsgaSA8IGxlbjsgaSsrICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIHRoaXNbaV0gPT09IGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgDQogICAgICAgICAgICAvLyBSZWd1bGFyIGV4cHJlc3Npb25zDQogICAgICAgIA0KICAgICAgICAgICAgLy8gV2hpdGVzcGFjZSBjaGFyYWN0ZXJzIGh0dHA6Ly93d3cudzMub3JnL1RSL2NzczMtc2VsZWN0b3JzLyN3aGl0ZXNwYWNlDQogICAgICAgICAgICB3aGl0ZXNwYWNlID0gIltcXHgyMFxcdFxcclxcblxcZl0iLA0KICAgICAgICAgICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1zeW50YXgvI2NoYXJhY3RlcnMNCiAgICAgICAgICAgIGNoYXJhY3RlckVuY29kaW5nID0gIig/OlxcXFwufFtcXHctXXxbXlxceDAwLVxceGEwXSkrIiwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBMb29zZWx5IG1vZGVsZWQgb24gQ1NTIGlkZW50aWZpZXIgY2hhcmFjdGVycw0KICAgICAgICAgICAgLy8gQW4gdW5xdW90ZWQgdmFsdWUgc2hvdWxkIGJlIGEgQ1NTIGlkZW50aWZpZXIgaHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1zZWxlY3RvcnMvI2F0dHJpYnV0ZS1zZWxlY3RvcnMNCiAgICAgICAgICAgIC8vIFByb3BlciBzeW50YXg6IGh0dHA6Ly93d3cudzMub3JnL1RSL0NTUzIxL3N5bmRhdGEuaHRtbCN2YWx1ZS1kZWYtaWRlbnRpZmllcg0KICAgICAgICAgICAgaWRlbnRpZmllciA9IGNoYXJhY3RlckVuY29kaW5nLnJlcGxhY2UoICJ3IiwgIncjIiApLA0KICAgICAgICANCiAgICAgICAgICAgIC8vIEFjY2VwdGFibGUgb3BlcmF0b3JzIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jYXR0cmlidXRlLXNlbGVjdG9ycw0KICAgICAgICAgICAgb3BlcmF0b3JzID0gIihbKl4kfCF+XT89KSIsDQogICAgICAgICAgICBhdHRyaWJ1dGVzID0gIlxcWyIgKyB3aGl0ZXNwYWNlICsgIiooIiArIGNoYXJhY3RlckVuY29kaW5nICsgIikiICsgd2hpdGVzcGFjZSArDQogICAgICAgICAgICAgICAgIiooPzoiICsgb3BlcmF0b3JzICsgd2hpdGVzcGFjZSArICIqKD86KFsnXCJdKSgoPzpcXFxcLnxbXlxcXFxdKSo/KVxcM3woIiArIGlkZW50aWZpZXIgKyAiKXwpfCkiICsgd2hpdGVzcGFjZSArICIqXFxdIiwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBQcmVmZXIgYXJndW1lbnRzIHF1b3RlZCwNCiAgICAgICAgICAgIC8vICAgdGhlbiBub3QgY29udGFpbmluZyBwc2V1ZG9zL2JyYWNrZXRzLA0KICAgICAgICAgICAgLy8gICB0aGVuIGF0dHJpYnV0ZSBzZWxlY3RvcnMvbm9uLXBhcmVudGhldGljYWwgZXhwcmVzc2lvbnMsDQogICAgICAgICAgICAvLyAgIHRoZW4gYW55dGhpbmcgZWxzZQ0KICAgICAgICAgICAgLy8gVGhlc2UgcHJlZmVyZW5jZXMgYXJlIGhlcmUgdG8gcmVkdWNlIHRoZSBudW1iZXIgb2Ygc2VsZWN0b3JzDQogICAgICAgICAgICAvLyAgIG5lZWRpbmcgdG9rZW5pemUgaW4gdGhlIFBTRVVETyBwcmVGaWx0ZXINCiAgICAgICAgICAgIHBzZXVkb3MgPSAiOigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSg/OlxcKCgoWydcIl0pKCg/OlxcXFwufFteXFxcXF0pKj8pXFwzfCgoPzpcXFxcLnxbXlxcXFwoKVtcXF1dfCIgKyBhdHRyaWJ1dGVzLnJlcGxhY2UoIDMsIDggKSArICIpKil8LiopXFwpfCkiLA0KICAgICAgICANCiAgICAgICAgICAgIC8vIExlYWRpbmcgYW5kIG5vbi1lc2NhcGVkIHRyYWlsaW5nIHdoaXRlc3BhY2UsIGNhcHR1cmluZyBzb21lIG5vbi13aGl0ZXNwYWNlIGNoYXJhY3RlcnMgcHJlY2VkaW5nIHRoZSBsYXR0ZXINCiAgICAgICAgICAgIHJ0cmltID0gbmV3IFJlZ0V4cCggIl4iICsgd2hpdGVzcGFjZSArICIrfCgoPzpefFteXFxcXF0pKD86XFxcXC4pKikiICsgd2hpdGVzcGFjZSArICIrJCIsICJnIiApLA0KICAgICAgICANCiAgICAgICAgICAgIHJjb21tYSA9IG5ldyBSZWdFeHAoICJeIiArIHdoaXRlc3BhY2UgKyAiKiwiICsgd2hpdGVzcGFjZSArICIqIiApLA0KICAgICAgICAgICAgcmNvbWJpbmF0b3JzID0gbmV3IFJlZ0V4cCggIl4iICsgd2hpdGVzcGFjZSArICIqKFtcXHgyMFxcdFxcclxcblxcZj4rfl0pIiArIHdoaXRlc3BhY2UgKyAiKiIgKSwNCiAgICAgICAgICAgIHJwc2V1ZG8gPSBuZXcgUmVnRXhwKCBwc2V1ZG9zICksDQogICAgICAgICAgICByaWRlbnRpZmllciA9IG5ldyBSZWdFeHAoICJeIiArIGlkZW50aWZpZXIgKyAiJCIgKSwNCiAgICAgICAgDQogICAgICAgICAgICBtYXRjaEV4cHIgPSB7DQogICAgICAgICAgICAgICAgIklEIjogbmV3IFJlZ0V4cCggIl4jKCIgKyBjaGFyYWN0ZXJFbmNvZGluZyArICIpIiApLA0KICAgICAgICAgICAgICAgICJDTEFTUyI6IG5ldyBSZWdFeHAoICJeXFwuKCIgKyBjaGFyYWN0ZXJFbmNvZGluZyArICIpIiApLA0KICAgICAgICAgICAgICAgICJOQU1FIjogbmV3IFJlZ0V4cCggIl5cXFtuYW1lPVsnXCJdPygiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKVsnXCJdP1xcXSIgKSwNCiAgICAgICAgICAgICAgICAiVEFHIjogbmV3IFJlZ0V4cCggIl4oIiArIGNoYXJhY3RlckVuY29kaW5nLnJlcGxhY2UoICJ3IiwgIncqIiApICsgIikiICksDQogICAgICAgICAgICAgICAgIkFUVFIiOiBuZXcgUmVnRXhwKCAiXiIgKyBhdHRyaWJ1dGVzICksDQogICAgICAgICAgICAgICAgIlBTRVVETyI6IG5ldyBSZWdFeHAoICJeIiArIHBzZXVkb3MgKSwNCiAgICAgICAgICAgICAgICAiQ0hJTEQiOiBuZXcgUmVnRXhwKCAiXjoob25seXxmaXJzdHxsYXN0fG50aHxudGgtbGFzdCktKGNoaWxkfG9mLXR5cGUpKD86XFwoIiArIHdoaXRlc3BhY2UgKw0KICAgICAgICAgICAgICAgICAgICAiKihldmVufG9kZHwoKFsrLV18KShcXGQqKW58KSIgKyB3aGl0ZXNwYWNlICsgIiooPzooWystXXwpIiArIHdoaXRlc3BhY2UgKw0KICAgICAgICAgICAgICAgICAgICAiKihcXGQrKXwpKSIgKyB3aGl0ZXNwYWNlICsgIipcXCl8KSIsICJpIiApLA0KICAgICAgICAgICAgICAgIC8vIEZvciB1c2UgaW4gbGlicmFyaWVzIGltcGxlbWVudGluZyAuaXMoKQ0KICAgICAgICAgICAgICAgIC8vIFdlIHVzZSB0aGlzIGZvciBQT1MgbWF0Y2hpbmcgaW4gYHNlbGVjdGANCiAgICAgICAgICAgICAgICAibmVlZHNDb250ZXh0IjogbmV3IFJlZ0V4cCggIl4iICsgd2hpdGVzcGFjZSArICIqWz4rfl18OihldmVufG9kZHxlcXxndHxsdHxudGh8Zmlyc3R8bGFzdCkoPzpcXCgiICsNCiAgICAgICAgICAgICAgICAgICAgd2hpdGVzcGFjZSArICIqKCg/Oi1cXGQpP1xcZCopIiArIHdoaXRlc3BhY2UgKyAiKlxcKXwpKD89W14tXXwkKSIsICJpIiApDQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIHJzaWJsaW5nID0gL1tceDIwXHRcclxuXGZdKlsrfl0vLA0KICAgICAgICANCiAgICAgICAgICAgIHJuYXRpdmUgPSAvXltee10rXHtccypcW25hdGl2ZSBjb2RlLywNCiAgICAgICAgDQogICAgICAgICAgICAvLyBFYXNpbHktcGFyc2VhYmxlL3JldHJpZXZhYmxlIElEIG9yIFRBRyBvciBDTEFTUyBzZWxlY3RvcnMNCiAgICAgICAgICAgIHJxdWlja0V4cHIgPSAvXig/OiMoW1x3LV0rKXwoXHcrKXxcLihbXHctXSspKSQvLA0KICAgICAgICANCiAgICAgICAgICAgIHJpbnB1dHMgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24pJC9pLA0KICAgICAgICAgICAgcmhlYWRlciA9IC9eaFxkJC9pLA0KICAgICAgICANCiAgICAgICAgICAgIHJlc2NhcGUgPSAvJ3xcXC9nLA0KICAgICAgICAgICAgcmF0dHJpYnV0ZVF1b3RlcyA9IC9cPVtceDIwXHRcclxuXGZdKihbXiciXF1dKilbXHgyMFx0XHJcblxmXSpcXS9nLA0KICAgICAgICANCiAgICAgICAgICAgIC8vIENTUyBlc2NhcGVzIGh0dHA6Ly93d3cudzMub3JnL1RSL0NTUzIxL3N5bmRhdGEuaHRtbCNlc2NhcGVkLWNoYXJhY3RlcnMNCiAgICAgICAgICAgIHJ1bmVzY2FwZSA9IC9cXChbXGRhLWZBLUZdezEsNn1bXHgyMFx0XHJcblxmXT98LikvZywNCiAgICAgICAgICAgIGZ1bmVzY2FwZSA9IGZ1bmN0aW9uKCBfLCBlc2NhcGVkICkgew0KICAgICAgICAgICAgICAgIHZhciBoaWdoID0gIjB4IiArIGVzY2FwZWQgLSAweDEwMDAwOw0KICAgICAgICAgICAgICAgIC8vIE5hTiBtZWFucyBub24tY29kZXBvaW50DQogICAgICAgICAgICAgICAgcmV0dXJuIGhpZ2ggIT09IGhpZ2ggPw0KICAgICAgICAgICAgICAgICAgICBlc2NhcGVkIDoNCiAgICAgICAgICAgICAgICAgICAgLy8gQk1QIGNvZGVwb2ludA0KICAgICAgICAgICAgICAgICAgICBoaWdoIDwgMCA/DQogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcuZnJvbUNoYXJDb2RlKCBoaWdoICsgMHgxMDAwMCApIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN1cHBsZW1lbnRhbCBQbGFuZSBjb2RlcG9pbnQgKHN1cnJvZ2F0ZSBwYWlyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nLmZyb21DaGFyQ29kZSggaGlnaCA+PiAxMCB8IDB4RDgwMCwgaGlnaCAmIDB4M0ZGIHwgMHhEQzAwICk7DQogICAgICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgLy8gVXNlIGEgc3RyaXBwZWQtZG93biBzbGljZSBpZiB3ZSBjYW4ndCB1c2UgYSBuYXRpdmUgb25lDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBzbGljZS5jYWxsKCBwcmVmZXJyZWREb2MuZG9jdW1lbnRFbGVtZW50LmNoaWxkTm9kZXMsIDAgKVswXS5ub2RlVHlwZTsNCiAgICAgICAgfSBjYXRjaCAoIGUgKSB7DQogICAgICAgICAgICBzbGljZSA9IGZ1bmN0aW9uKCBpICkgew0KICAgICAgICAgICAgICAgIHZhciBlbGVtLA0KICAgICAgICAgICAgICAgICAgICByZXN1bHRzID0gW107DQogICAgICAgICAgICAgICAgd2hpbGUgKCAoZWxlbSA9IHRoaXNbaSsrXSkgKSB7DQogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaCggZWxlbSApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0czsNCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8qKg0KICAgICAgICAgKiBGb3IgZmVhdHVyZSBkZXRlY3Rpb24NCiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGZ1bmN0aW9uIHRvIHRlc3QgZm9yIG5hdGl2ZSBzdXBwb3J0DQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBpc05hdGl2ZSggZm4gKSB7DQogICAgICAgICAgICByZXR1cm4gcm5hdGl2ZS50ZXN0KCBmbiArICIiICk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDcmVhdGUga2V5LXZhbHVlIGNhY2hlcyBvZiBsaW1pdGVkIHNpemUNCiAgICAgICAgICogQHJldHVybnMge0Z1bmN0aW9uKHN0cmluZywgT2JqZWN0KX0gUmV0dXJucyB0aGUgT2JqZWN0IGRhdGEgYWZ0ZXIgc3RvcmluZyBpdCBvbiBpdHNlbGYgd2l0aA0KICAgICAgICAgKglwcm9wZXJ0eSBuYW1lIHRoZSAoc3BhY2Utc3VmZml4ZWQpIHN0cmluZyBhbmQgKGlmIHRoZSBjYWNoZSBpcyBsYXJnZXIgdGhhbiBFeHByLmNhY2hlTGVuZ3RoKQ0KICAgICAgICAgKglkZWxldGluZyB0aGUgb2xkZXN0IGVudHJ5DQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVDYWNoZSgpIHsNCiAgICAgICAgICAgIHZhciBjYWNoZSwNCiAgICAgICAgICAgICAgICBrZXlzID0gW107DQogICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIChjYWNoZSA9IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgew0KICAgICAgICAgICAgICAgIC8vIFVzZSAoa2V5ICsgIiAiKSB0byBhdm9pZCBjb2xsaXNpb24gd2l0aCBuYXRpdmUgcHJvdG90eXBlIHByb3BlcnRpZXMgKHNlZSBJc3N1ZSAjMTU3KQ0KICAgICAgICAgICAgICAgIGlmICgga2V5cy5wdXNoKCBrZXkgKz0gIiAiICkgPiBFeHByLmNhY2hlTGVuZ3RoICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBPbmx5IGtlZXAgdGhlIG1vc3QgcmVjZW50IGVudHJpZXMNCiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNhY2hlWyBrZXlzLnNoaWZ0KCkgXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIChjYWNoZVsga2V5IF0gPSB2YWx1ZSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLyoqDQogICAgICAgICAqIE1hcmsgYSBmdW5jdGlvbiBmb3Igc3BlY2lhbCB1c2UgYnkgU2l6emxlDQogICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFRoZSBmdW5jdGlvbiB0byBtYXJrDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBtYXJrRnVuY3Rpb24oIGZuICkgew0KICAgICAgICAgICAgZm5bIGV4cGFuZG8gXSA9IHRydWU7DQogICAgICAgICAgICByZXR1cm4gZm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8qKg0KICAgICAgICAgKiBTdXBwb3J0IHRlc3RpbmcgdXNpbmcgYW4gZWxlbWVudA0KICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBQYXNzZWQgdGhlIGNyZWF0ZWQgZGl2IGFuZCBleHBlY3RzIGEgYm9vbGVhbiByZXN1bHQNCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGFzc2VydCggZm4gKSB7DQogICAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgIA0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZm4oIGRpdiApOw0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICAgICAgLy8gcmVsZWFzZSBtZW1vcnkgaW4gSUUNCiAgICAgICAgICAgICAgICBkaXYgPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBTaXp6bGUoIHNlbGVjdG9yLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICkgew0KICAgICAgICAgICAgdmFyIG1hdGNoLCBlbGVtLCBtLCBub2RlVHlwZSwNCiAgICAgICAgICAgICAgICAvLyBRU0EgdmFycw0KICAgICAgICAgICAgICAgIGksIGdyb3Vwcywgb2xkLCBuaWQsIG5ld0NvbnRleHQsIG5ld1NlbGVjdG9yOw0KICAgICAgICANCiAgICAgICAgICAgIGlmICggKCBjb250ZXh0ID8gY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgOiBwcmVmZXJyZWREb2MgKSAhPT0gZG9jdW1lbnQgKSB7DQogICAgICAgICAgICAgICAgc2V0RG9jdW1lbnQoIGNvbnRleHQgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBjb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDsNCiAgICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzIHx8IFtdOw0KICAgICAgICANCiAgICAgICAgICAgIGlmICggIXNlbGVjdG9yIHx8IHR5cGVvZiBzZWxlY3RvciAhPT0gInN0cmluZyIgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYgKCAobm9kZVR5cGUgPSBjb250ZXh0Lm5vZGVUeXBlKSAhPT0gMSAmJiBub2RlVHlwZSAhPT0gOSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gW107DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYgKCAhZG9jdW1lbnRJc1hNTCAmJiAhc2VlZCApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gU2hvcnRjdXRzDQogICAgICAgICAgICAgICAgaWYgKCAobWF0Y2ggPSBycXVpY2tFeHByLmV4ZWMoIHNlbGVjdG9yICkpICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBTcGVlZC11cDogU2l6emxlKCIjSUQiKQ0KICAgICAgICAgICAgICAgICAgICBpZiAoIChtID0gbWF0Y2hbMV0pICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBub2RlVHlwZSA9PT0gOSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAllbGVtID0gY29udGV4dC5nZXRFbGVtZW50QnlJZCggbSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIENoZWNrIHBhcmVudE5vZGUgdG8gY2F0Y2ggd2hlbiBCbGFja2JlcnJ5IDQuNiByZXR1cm5zDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gbm9kZXMgdGhhdCBhcmUgbm8gbG9uZ2VyIGluIHRoZSBkb2N1bWVudCAjNjk2Mw0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggZWxlbSAmJiBlbGVtLnBhcmVudE5vZGUgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIEhhbmRsZSB0aGUgY2FzZSB3aGVyZSBJRSwgT3BlcmEsIGFuZCBXZWJraXQgcmV0dXJuIGl0ZW1zDQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIGJ5IG5hbWUgaW5zdGVhZCBvZiBJRA0KICAgICAgICAgICAgICAgICAgICAgICAgCQlpZiAoIGVsZW0uaWQgPT09IG0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQlyZXN1bHRzLnB1c2goIGVsZW0gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCXJldHVybiByZXN1bHRzOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJcmV0dXJuIHJlc3VsdHM7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBDb250ZXh0IGlzIG5vdCBhIGRvY3VtZW50DQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBjb250ZXh0Lm93bmVyRG9jdW1lbnQgJiYgKGVsZW0gPSBjb250ZXh0Lm93bmVyRG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIG0gKSkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJY29udGFpbnMoIGNvbnRleHQsIGVsZW0gKSAmJiBlbGVtLmlkID09PSBtICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlyZXN1bHRzLnB1c2goIGVsZW0gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJcmV0dXJuIHJlc3VsdHM7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gU3BlZWQtdXA6IFNpenpsZSgiVEFHIikNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggbWF0Y2hbMl0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBwdXNoLmFwcGx5KCByZXN1bHRzLCBzbGljZS5jYWxsKGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHNlbGVjdG9yICksIDApICk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0czsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFNwZWVkLXVwOiBTaXp6bGUoIi5DTEFTUyIpDQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIChtID0gbWF0Y2hbM10pICYmIHN1cHBvcnQuZ2V0QnlDbGFzc05hbWUgJiYgY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcHVzaC5hcHBseSggcmVzdWx0cywgc2xpY2UuY2FsbChjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIG0gKSwgMCkgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBRU0EgcGF0aA0KICAgICAgICAgICAgICAgIGlmICggc3VwcG9ydC5xc2EgJiYgIXJidWdneVFTQS50ZXN0KHNlbGVjdG9yKSApIHsNCiAgICAgICAgICAgICAgICAgICAgb2xkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgbmlkID0gZXhwYW5kbzsNCiAgICAgICAgICAgICAgICAgICAgbmV3Q29udGV4dCA9IGNvbnRleHQ7DQogICAgICAgICAgICAgICAgICAgIG5ld1NlbGVjdG9yID0gbm9kZVR5cGUgPT09IDkgJiYgc2VsZWN0b3I7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBxU0Egd29ya3Mgc3RyYW5nZWx5IG9uIEVsZW1lbnQtcm9vdGVkIHF1ZXJpZXMNCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgY2FuIHdvcmsgYXJvdW5kIHRoaXMgYnkgc3BlY2lmeWluZyBhbiBleHRyYSBJRCBvbiB0aGUgcm9vdA0KICAgICAgICAgICAgICAgICAgICAvLyBhbmQgd29ya2luZyB1cCBmcm9tIHRoZXJlIChUaGFua3MgdG8gQW5kcmV3IER1cG9udCBmb3IgdGhlIHRlY2huaXF1ZSkNCiAgICAgICAgICAgICAgICAgICAgLy8gSUUgOCBkb2Vzbid0IHdvcmsgb24gb2JqZWN0IGVsZW1lbnRzDQogICAgICAgICAgICAgICAgICAgIGlmICggbm9kZVR5cGUgPT09IDEgJiYgY29udGV4dC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAib2JqZWN0IiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwcyA9IHRva2VuaXplKCBzZWxlY3RvciApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggKG9sZCA9IGNvbnRleHQuZ2V0QXR0cmlidXRlKCJpZCIpKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAluaWQgPSBvbGQucmVwbGFjZSggcmVzY2FwZSwgIlxcJCYiICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgCWNvbnRleHQuc2V0QXR0cmlidXRlKCAiaWQiLCBuaWQgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIG5pZCA9ICJbaWQ9JyIgKyBuaWQgKyAiJ10gIjsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpID0gZ3JvdXBzLmxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICggaS0tICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWdyb3Vwc1tpXSA9IG5pZCArIHRvU2VsZWN0b3IoIGdyb3Vwc1tpXSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q29udGV4dCA9IHJzaWJsaW5nLnRlc3QoIHNlbGVjdG9yICkgJiYgY29udGV4dC5wYXJlbnROb2RlIHx8IGNvbnRleHQ7DQogICAgICAgICAgICAgICAgICAgICAgICBuZXdTZWxlY3RvciA9IGdyb3Vwcy5qb2luKCIsIik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmICggbmV3U2VsZWN0b3IgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCXB1c2guYXBwbHkoIHJlc3VsdHMsIHNsaWNlLmNhbGwoIG5ld0NvbnRleHQucXVlcnlTZWxlY3RvckFsbCgNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJbmV3U2VsZWN0b3INCiAgICAgICAgICAgICAgICAgICAgICAgIAkpLCAwICkgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZXR1cm4gcmVzdWx0czsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gocXNhRXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCAhb2xkICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQljb250ZXh0LnJlbW92ZUF0dHJpYnV0ZSgiaWQiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gQWxsIG90aGVycw0KICAgICAgICAgICAgcmV0dXJuIHNlbGVjdCggc2VsZWN0b3IucmVwbGFjZSggcnRyaW0sICIkMSIgKSwgY29udGV4dCwgcmVzdWx0cywgc2VlZCApOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvKioNCiAgICAgICAgICogRGV0ZWN0IHhtbA0KICAgICAgICAgKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBlbGVtIEFuIGVsZW1lbnQgb3IgYSBkb2N1bWVudA0KICAgICAgICAgKi8NCiAgICAgICAgaXNYTUwgPSBTaXp6bGUuaXNYTUwgPSBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgIC8vIGRvY3VtZW50RWxlbWVudCBpcyB2ZXJpZmllZCBmb3IgY2FzZXMgd2hlcmUgaXQgZG9lc24ndCB5ZXQgZXhpc3QNCiAgICAgICAgICAgIC8vIChzdWNoIGFzIGxvYWRpbmcgaWZyYW1lcyBpbiBJRSAtICM0ODMzKQ0KICAgICAgICAgICAgdmFyIGRvY3VtZW50RWxlbWVudCA9IGVsZW0gJiYgKGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtKS5kb2N1bWVudEVsZW1lbnQ7DQogICAgICAgICAgICByZXR1cm4gZG9jdW1lbnRFbGVtZW50ID8gZG9jdW1lbnRFbGVtZW50Lm5vZGVOYW1lICE9PSAiSFRNTCIgOiBmYWxzZTsNCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIC8qKg0KICAgICAgICAgKiBTZXRzIGRvY3VtZW50LXJlbGF0ZWQgdmFyaWFibGVzIG9uY2UgYmFzZWQgb24gdGhlIGN1cnJlbnQgZG9jdW1lbnQNCiAgICAgICAgICogQHBhcmFtIHtFbGVtZW50fE9iamVjdH0gW2RvY10gQW4gZWxlbWVudCBvciBkb2N1bWVudCBvYmplY3QgdG8gdXNlIHRvIHNldCB0aGUgZG9jdW1lbnQNCiAgICAgICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY3VycmVudCBkb2N1bWVudA0KICAgICAgICAgKi8NCiAgICAgICAgc2V0RG9jdW1lbnQgPSBTaXp6bGUuc2V0RG9jdW1lbnQgPSBmdW5jdGlvbiggbm9kZSApIHsNCiAgICAgICAgICAgIHZhciBkb2MgPSBub2RlID8gbm9kZS5vd25lckRvY3VtZW50IHx8IG5vZGUgOiBwcmVmZXJyZWREb2M7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gSWYgbm8gZG9jdW1lbnQgYW5kIGRvY3VtZW50RWxlbWVudCBpcyBhdmFpbGFibGUsIHJldHVybg0KICAgICAgICAgICAgaWYgKCBkb2MgPT09IGRvY3VtZW50IHx8IGRvYy5ub2RlVHlwZSAhPT0gOSB8fCAhZG9jLmRvY3VtZW50RWxlbWVudCApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQ7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gU2V0IG91ciBkb2N1bWVudA0KICAgICAgICAgICAgZG9jdW1lbnQgPSBkb2M7DQogICAgICAgICAgICBkb2NFbGVtID0gZG9jLmRvY3VtZW50RWxlbWVudDsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBTdXBwb3J0IHRlc3RzDQogICAgICAgICAgICBkb2N1bWVudElzWE1MID0gaXNYTUwoIGRvYyApOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIENoZWNrIGlmIGdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikgcmV0dXJucyBvbmx5IGVsZW1lbnRzDQogICAgICAgICAgICBzdXBwb3J0LnRhZ05hbWVOb0NvbW1lbnRzID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7DQogICAgICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKCBkb2MuY3JlYXRlQ29tbWVudCgiIikgKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aDsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIENoZWNrIGlmIGF0dHJpYnV0ZXMgc2hvdWxkIGJlIHJldHJpZXZlZCBieSBhdHRyaWJ1dGUgbm9kZXMNCiAgICAgICAgICAgIHN1cHBvcnQuYXR0cmlidXRlcyA9IGFzc2VydChmdW5jdGlvbiggZGl2ICkgew0KICAgICAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSAiPHNlbGVjdD48L3NlbGVjdD4iOw0KICAgICAgICAgICAgICAgIHZhciB0eXBlID0gdHlwZW9mIGRpdi5sYXN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJtdWx0aXBsZSIpOw0KICAgICAgICAgICAgICAgIC8vIElFOCByZXR1cm5zIGEgc3RyaW5nIGZvciBzb21lIGF0dHJpYnV0ZXMgZXZlbiB3aGVuIG5vdCBwcmVzZW50DQogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGUgIT09ICJib29sZWFuIiAmJiB0eXBlICE9PSAic3RyaW5nIjsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIENoZWNrIGlmIGdldEVsZW1lbnRzQnlDbGFzc05hbWUgY2FuIGJlIHRydXN0ZWQNCiAgICAgICAgICAgIHN1cHBvcnQuZ2V0QnlDbGFzc05hbWUgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsNCiAgICAgICAgICAgICAgICAvLyBPcGVyYSBjYW4ndCBmaW5kIGEgc2Vjb25kIGNsYXNzbmFtZSAoaW4gOS42KQ0KICAgICAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSAiPGRpdiBjbGFzcz0naGlkZGVuIGUnPjwvZGl2PjxkaXYgY2xhc3M9J2hpZGRlbic+PC9kaXY+IjsNCiAgICAgICAgICAgICAgICBpZiAoICFkaXYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSB8fCAhZGl2LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImUiKS5sZW5ndGggKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFNhZmFyaSAzLjIgY2FjaGVzIGNsYXNzIGF0dHJpYnV0ZXMgYW5kIGRvZXNuJ3QgY2F0Y2ggY2hhbmdlcw0KICAgICAgICAgICAgICAgIGRpdi5sYXN0Q2hpbGQuY2xhc3NOYW1lID0gImUiOw0KICAgICAgICAgICAgICAgIHJldHVybiBkaXYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiZSIpLmxlbmd0aCA9PT0gMjsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIENoZWNrIGlmIGdldEVsZW1lbnRCeUlkIHJldHVybnMgZWxlbWVudHMgYnkgbmFtZQ0KICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudHNCeU5hbWUgcHJpdmlsZWdlcyBmb3JtIGNvbnRyb2xzIG9yIHJldHVybnMgZWxlbWVudHMgYnkgSUQNCiAgICAgICAgICAgIHN1cHBvcnQuZ2V0QnlOYW1lID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7DQogICAgICAgICAgICAgICAgLy8gSW5qZWN0IGNvbnRlbnQNCiAgICAgICAgICAgICAgICBkaXYuaWQgPSBleHBhbmRvICsgMDsNCiAgICAgICAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gIjxhIG5hbWU9JyIgKyBleHBhbmRvICsgIic+PC9hPjxkaXYgbmFtZT0nIiArIGV4cGFuZG8gKyAiJz48L2Rpdj4iOw0KICAgICAgICAgICAgICAgIGRvY0VsZW0uaW5zZXJ0QmVmb3JlKCBkaXYsIGRvY0VsZW0uZmlyc3RDaGlsZCApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBUZXN0DQogICAgICAgICAgICAgICAgdmFyIHBhc3MgPSBkb2MuZ2V0RWxlbWVudHNCeU5hbWUgJiYNCiAgICAgICAgICAgICAgICAgICAgLy8gYnVnZ3kgYnJvd3NlcnMgd2lsbCByZXR1cm4gZmV3ZXIgdGhhbiB0aGUgY29ycmVjdCAyDQogICAgICAgICAgICAgICAgICAgIGRvYy5nZXRFbGVtZW50c0J5TmFtZSggZXhwYW5kbyApLmxlbmd0aCA9PT0gMiArDQogICAgICAgICAgICAgICAgICAgIC8vIGJ1Z2d5IGJyb3dzZXJzIHdpbGwgcmV0dXJuIG1vcmUgdGhhbiB0aGUgY29ycmVjdCAwDQogICAgICAgICAgICAgICAgICAgIGRvYy5nZXRFbGVtZW50c0J5TmFtZSggZXhwYW5kbyArIDAgKS5sZW5ndGg7DQogICAgICAgICAgICAgICAgc3VwcG9ydC5nZXRJZE5vdE5hbWUgPSAhZG9jLmdldEVsZW1lbnRCeUlkKCBleHBhbmRvICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIENsZWFudXANCiAgICAgICAgICAgICAgICBkb2NFbGVtLnJlbW92ZUNoaWxkKCBkaXYgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIHBhc3M7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBJRTYvNyByZXR1cm4gbW9kaWZpZWQgYXR0cmlidXRlcw0KICAgICAgICAgICAgRXhwci5hdHRySGFuZGxlID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7DQogICAgICAgICAgICAgICAgZGl2LmlubmVySFRNTCA9ICI8YSBocmVmPScjJz48L2E+IjsNCiAgICAgICAgICAgICAgICByZXR1cm4gZGl2LmZpcnN0Q2hpbGQgJiYgdHlwZW9mIGRpdi5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSAhPT0gc3RydW5kZWZpbmVkICYmDQogICAgICAgICAgICAgICAgICAgIGRpdi5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgiaHJlZiIpID09PSAiIyI7DQogICAgICAgICAgICB9KSA/DQogICAgICAgICAgICAgICAge30gOg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgImhyZWYiOiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggImhyZWYiLCAyICk7DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoInR5cGUiKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAgICAgLy8gSUQgZmluZCBhbmQgZmlsdGVyDQogICAgICAgICAgICBpZiAoIHN1cHBvcnQuZ2V0SWROb3ROYW1lICkgew0KICAgICAgICAgICAgICAgIEV4cHIuZmluZFsiSUQiXSA9IGZ1bmN0aW9uKCBpZCwgY29udGV4dCApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50QnlJZCAhPT0gc3RydW5kZWZpbmVkICYmICFkb2N1bWVudElzWE1MICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKCBpZCApOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgcGFyZW50Tm9kZSB0byBjYXRjaCB3aGVuIEJsYWNrYmVycnkgNC42IHJldHVybnMNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgIzY5NjMNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtICYmIG0ucGFyZW50Tm9kZSA/IFttXSA6IFtdOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBFeHByLmZpbHRlclsiSUQiXSA9IGZ1bmN0aW9uKCBpZCApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJJZCA9IGlkLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSgiaWQiKSA9PT0gYXR0cklkOw0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIEV4cHIuZmluZFsiSUQiXSA9IGZ1bmN0aW9uKCBpZCwgY29udGV4dCApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50QnlJZCAhPT0gc3RydW5kZWZpbmVkICYmICFkb2N1bWVudElzWE1MICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKCBpZCApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtID8NCiAgICAgICAgICAgICAgICAgICAgICAgIAltLmlkID09PSBpZCB8fCB0eXBlb2YgbS5nZXRBdHRyaWJ1dGVOb2RlICE9PSBzdHJ1bmRlZmluZWQgJiYgbS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpLnZhbHVlID09PSBpZCA/DQogICAgICAgICAgICAgICAgICAgICAgICAJCVttXSA6DQogICAgICAgICAgICAgICAgICAgICAgICAJCXVuZGVmaW5lZCA6DQogICAgICAgICAgICAgICAgICAgICAgICAJW107DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIEV4cHIuZmlsdGVyWyJJRCJdID0gIGZ1bmN0aW9uKCBpZCApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJJZCA9IGlkLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBub2RlID0gdHlwZW9mIGVsZW0uZ2V0QXR0cmlidXRlTm9kZSAhPT0gc3RydW5kZWZpbmVkICYmIGVsZW0uZ2V0QXR0cmlidXRlTm9kZSgiaWQiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBub2RlICYmIG5vZGUudmFsdWUgPT09IGF0dHJJZDsNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIFRhZw0KICAgICAgICAgICAgRXhwci5maW5kWyJUQUciXSA9IHN1cHBvcnQudGFnTmFtZU5vQ29tbWVudHMgPw0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCB0YWcsIGNvbnRleHQgKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUgIT09IHN0cnVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCB0YWcgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gOg0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCB0YWcsIGNvbnRleHQgKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBlbGVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgdG1wID0gW10sDQogICAgICAgICAgICAgICAgICAgICAgICBpID0gMCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMgPSBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCB0YWcgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEZpbHRlciBvdXQgcG9zc2libGUgY29tbWVudHMNCiAgICAgICAgICAgICAgICAgICAgaWYgKCB0YWcgPT09ICIqIiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICggKGVsZW0gPSByZXN1bHRzW2krK10pICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJdG1wLnB1c2goIGVsZW0gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRtcDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0czsNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgICAgIC8vIE5hbWUNCiAgICAgICAgICAgIEV4cHIuZmluZFsiTkFNRSJdID0gc3VwcG9ydC5nZXRCeU5hbWUgJiYgZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHsNCiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlOYW1lICE9PSBzdHJ1bmRlZmluZWQgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmdldEVsZW1lbnRzQnlOYW1lKCBuYW1lICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBDbGFzcw0KICAgICAgICAgICAgRXhwci5maW5kWyJDTEFTUyJdID0gc3VwcG9ydC5nZXRCeUNsYXNzTmFtZSAmJiBmdW5jdGlvbiggY2xhc3NOYW1lLCBjb250ZXh0ICkgew0KICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAhPT0gc3RydW5kZWZpbmVkICYmICFkb2N1bWVudElzWE1MICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCBjbGFzc05hbWUgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgICAgIC8vIFFTQSBhbmQgbWF0Y2hlc1NlbGVjdG9yIHN1cHBvcnQNCiAgICAgICAgDQogICAgICAgICAgICAvLyBtYXRjaGVzU2VsZWN0b3IoOmFjdGl2ZSkgcmVwb3J0cyBmYWxzZSB3aGVuIHRydWUgKElFOS9PcGVyYSAxMS41KQ0KICAgICAgICAgICAgcmJ1Z2d5TWF0Y2hlcyA9IFtdOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIHFTYSg6Zm9jdXMpIHJlcG9ydHMgZmFsc2Ugd2hlbiB0cnVlIChDaHJvbWUgMjEpLA0KICAgICAgICAgICAgLy8gbm8gbmVlZCB0byBhbHNvIGFkZCB0byBidWdneU1hdGNoZXMgc2luY2UgbWF0Y2hlcyBjaGVja3MgYnVnZ3lRU0ENCiAgICAgICAgICAgIC8vIEEgc3VwcG9ydCB0ZXN0IHdvdWxkIHJlcXVpcmUgdG9vIG11Y2ggY29kZSAod291bGQgaW5jbHVkZSBkb2N1bWVudCByZWFkeSkNCiAgICAgICAgICAgIHJidWdneVFTQSA9IFsgIjpmb2N1cyIgXTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAoIChzdXBwb3J0LnFzYSA9IGlzTmF0aXZlKGRvYy5xdWVyeVNlbGVjdG9yQWxsKSkgKSB7DQogICAgICAgICAgICAgICAgLy8gQnVpbGQgUVNBIHJlZ2V4DQogICAgICAgICAgICAgICAgLy8gUmVnZXggc3RyYXRlZ3kgYWRvcHRlZCBmcm9tIERpZWdvIFBlcmluaQ0KICAgICAgICAgICAgICAgIGFzc2VydChmdW5jdGlvbiggZGl2ICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBTZWxlY3QgaXMgc2V0IHRvIGVtcHR5IHN0cmluZyBvbiBwdXJwb3NlDQogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdG8gdGVzdCBJRSdzIHRyZWF0bWVudCBvZiBub3QgZXhwbGljdGx5DQogICAgICAgICAgICAgICAgICAgIC8vIHNldHRpbmcgYSBib29sZWFuIGNvbnRlbnQgYXR0cmlidXRlLA0KICAgICAgICAgICAgICAgICAgICAvLyBzaW5jZSBpdHMgcHJlc2VuY2Ugc2hvdWxkIGJlIGVub3VnaA0KICAgICAgICAgICAgICAgICAgICAvLyBodHRwOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC8xMjM1OQ0KICAgICAgICAgICAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gIjxzZWxlY3Q+PG9wdGlvbiBzZWxlY3RlZD0nJz48L29wdGlvbj48L3NlbGVjdD4iOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gSUU4IC0gU29tZSBib29sZWFuIGF0dHJpYnV0ZXMgYXJlIG5vdCB0cmVhdGVkIGNvcnJlY3RseQ0KICAgICAgICAgICAgICAgICAgICBpZiAoICFkaXYucXVlcnlTZWxlY3RvckFsbCgiW3NlbGVjdGVkXSIpLmxlbmd0aCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJidWdneVFTQS5wdXNoKCAiXFxbIiArIHdoaXRlc3BhY2UgKyAiKig/OmNoZWNrZWR8ZGlzYWJsZWR8aXNtYXB8bXVsdGlwbGV8cmVhZG9ubHl8c2VsZWN0ZWR8dmFsdWUpIiApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBXZWJraXQvT3BlcmEgLSA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIHNlbGVjdGVkIG9wdGlvbiBlbGVtZW50cw0KICAgICAgICAgICAgICAgICAgICAvLyBodHRwOi8vd3d3LnczLm9yZy9UUi8yMDExL1JFQy1jc3MzLXNlbGVjdG9ycy0yMDExMDkyOS8jY2hlY2tlZA0KICAgICAgICAgICAgICAgICAgICAvLyBJRTggdGhyb3dzIGVycm9yIGhlcmUgYW5kIHdpbGwgbm90IHNlZSBsYXRlciB0ZXN0cw0KICAgICAgICAgICAgICAgICAgICBpZiAoICFkaXYucXVlcnlTZWxlY3RvckFsbCgiOmNoZWNrZWQiKS5sZW5ndGggKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByYnVnZ3lRU0EucHVzaCgiOmNoZWNrZWQiKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIE9wZXJhIDEwLTEyL0lFOCAtIF49ICQ9ICo9IGFuZCBlbXB0eSB2YWx1ZXMNCiAgICAgICAgICAgICAgICAgICAgLy8gU2hvdWxkIG5vdCBzZWxlY3QgYW55dGhpbmcNCiAgICAgICAgICAgICAgICAgICAgZGl2LmlubmVySFRNTCA9ICI8aW5wdXQgdHlwZT0naGlkZGVuJyBpPScnLz4iOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIGRpdi5xdWVyeVNlbGVjdG9yQWxsKCJbaV49JyddIikubGVuZ3RoICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goICJbKl4kXT0iICsgd2hpdGVzcGFjZSArICIqKD86XCJcInwnJykiICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEZGIDMuNSAtIDplbmFibGVkLzpkaXNhYmxlZCBhbmQgaGlkZGVuIGVsZW1lbnRzIChoaWRkZW4gZWxlbWVudHMgYXJlIHN0aWxsIGVuYWJsZWQpDQogICAgICAgICAgICAgICAgICAgIC8vIElFOCB0aHJvd3MgZXJyb3IgaGVyZSBhbmQgd2lsbCBub3Qgc2VlIGxhdGVyIHRlc3RzDQogICAgICAgICAgICAgICAgICAgIGlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCI6ZW5hYmxlZCIpLmxlbmd0aCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJidWdneVFTQS5wdXNoKCAiOmVuYWJsZWQiLCAiOmRpc2FibGVkIiApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBPcGVyYSAxMC0xMSBkb2VzIG5vdCB0aHJvdyBvbiBwb3N0LWNvbW1hIGludmFsaWQgcHNldWRvcw0KICAgICAgICAgICAgICAgICAgICBkaXYucXVlcnlTZWxlY3RvckFsbCgiKiw6eCIpOw0KICAgICAgICAgICAgICAgICAgICByYnVnZ3lRU0EucHVzaCgiLC4qOiIpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmICggKHN1cHBvcnQubWF0Y2hlc1NlbGVjdG9yID0gaXNOYXRpdmUoIChtYXRjaGVzID0gZG9jRWxlbS5tYXRjaGVzU2VsZWN0b3IgfHwNCiAgICAgICAgICAgICAgICBkb2NFbGVtLm1vek1hdGNoZXNTZWxlY3RvciB8fA0KICAgICAgICAgICAgICAgIGRvY0VsZW0ud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8DQogICAgICAgICAgICAgICAgZG9jRWxlbS5vTWF0Y2hlc1NlbGVjdG9yIHx8DQogICAgICAgICAgICAgICAgZG9jRWxlbS5tc01hdGNoZXNTZWxlY3RvcikgKSkgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFzc2VydChmdW5jdGlvbiggZGl2ICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgaXQncyBwb3NzaWJsZSB0byBkbyBtYXRjaGVzU2VsZWN0b3INCiAgICAgICAgICAgICAgICAgICAgLy8gb24gYSBkaXNjb25uZWN0ZWQgbm9kZSAoSUUgOSkNCiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydC5kaXNjb25uZWN0ZWRNYXRjaCA9IG1hdGNoZXMuY2FsbCggZGl2LCAiZGl2IiApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBzaG91bGQgZmFpbCB3aXRoIGFuIGV4Y2VwdGlvbg0KICAgICAgICAgICAgICAgICAgICAvLyBHZWNrbyBkb2VzIG5vdCBlcnJvciwgcmV0dXJucyBmYWxzZSBpbnN0ZWFkDQogICAgICAgICAgICAgICAgICAgIG1hdGNoZXMuY2FsbCggZGl2LCAiW3MhPScnXTp4IiApOw0KICAgICAgICAgICAgICAgICAgICByYnVnZ3lNYXRjaGVzLnB1c2goICIhPSIsIHBzZXVkb3MgKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICByYnVnZ3lRU0EgPSBuZXcgUmVnRXhwKCByYnVnZ3lRU0Euam9pbigifCIpICk7DQogICAgICAgICAgICByYnVnZ3lNYXRjaGVzID0gbmV3IFJlZ0V4cCggcmJ1Z2d5TWF0Y2hlcy5qb2luKCJ8IikgKTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBFbGVtZW50IGNvbnRhaW5zIGFub3RoZXINCiAgICAgICAgICAgIC8vIFB1cnBvc2VmdWxseSBkb2VzIG5vdCBpbXBsZW1lbnQgaW5jbHVzaXZlIGRlc2NlbmRlbnQNCiAgICAgICAgICAgIC8vIEFzIGluLCBhbiBlbGVtZW50IGRvZXMgbm90IGNvbnRhaW4gaXRzZWxmDQogICAgICAgICAgICBjb250YWlucyA9IGlzTmF0aXZlKGRvY0VsZW0uY29udGFpbnMpIHx8IGRvY0VsZW0uY29tcGFyZURvY3VtZW50UG9zaXRpb24gPw0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCBhLCBiICkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgYWRvd24gPSBhLm5vZGVUeXBlID09PSA5ID8gYS5kb2N1bWVudEVsZW1lbnQgOiBhLA0KICAgICAgICAgICAgICAgICAgICAgICAgYnVwID0gYiAmJiBiLnBhcmVudE5vZGU7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBhID09PSBidXAgfHwgISEoIGJ1cCAmJiBidXAubm9kZVR5cGUgPT09IDEgJiYgKA0KICAgICAgICAgICAgICAgICAgICAgICAgYWRvd24uY29udGFpbnMgPw0KICAgICAgICAgICAgICAgICAgICAgICAgCWFkb3duLmNvbnRhaW5zKCBidXAgKSA6DQogICAgICAgICAgICAgICAgICAgICAgICAJYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAmJiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKCBidXAgKSAmIDE2DQogICAgICAgICAgICAgICAgICAgICkpOw0KICAgICAgICAgICAgICAgIH0gOg0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCBhLCBiICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIGIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIChiID0gYi5wYXJlbnROb2RlKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIGIgPT09IGEgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCXJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBEb2N1bWVudCBvcmRlciBzb3J0aW5nDQogICAgICAgICAgICBzb3J0T3JkZXIgPSBkb2NFbGVtLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uID8NCiAgICAgICAgICAgIGZ1bmN0aW9uKCBhLCBiICkgew0KICAgICAgICAgICAgICAgIHZhciBjb21wYXJlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIGEgPT09IGIgKSB7DQogICAgICAgICAgICAgICAgICAgIGhhc0R1cGxpY2F0ZSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCAoY29tcGFyZSA9IGIuY29tcGFyZURvY3VtZW50UG9zaXRpb24gJiYgYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAmJiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKCBiICkpICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIGNvbXBhcmUgJiAxIHx8IGEucGFyZW50Tm9kZSAmJiBhLnBhcmVudE5vZGUubm9kZVR5cGUgPT09IDExICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBhID09PSBkb2MgfHwgY29udGFpbnMoIHByZWZlcnJlZERvYywgYSApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCXJldHVybiAtMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggYiA9PT0gZG9jIHx8IGNvbnRhaW5zKCBwcmVmZXJyZWREb2MsIGIgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZXR1cm4gMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wYXJlICYgNCA/IC0xIDogMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uID8gLTEgOiAxOw0KICAgICAgICAgICAgfSA6DQogICAgICAgICAgICBmdW5jdGlvbiggYSwgYiApIHsNCiAgICAgICAgICAgICAgICB2YXIgY3VyLA0KICAgICAgICAgICAgICAgICAgICBpID0gMCwNCiAgICAgICAgICAgICAgICAgICAgYXVwID0gYS5wYXJlbnROb2RlLA0KICAgICAgICAgICAgICAgICAgICBidXAgPSBiLnBhcmVudE5vZGUsDQogICAgICAgICAgICAgICAgICAgIGFwID0gWyBhIF0sDQogICAgICAgICAgICAgICAgICAgIGJwID0gWyBiIF07DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEV4aXQgZWFybHkgaWYgdGhlIG5vZGVzIGFyZSBpZGVudGljYWwNCiAgICAgICAgICAgICAgICBpZiAoIGEgPT09IGIgKSB7DQogICAgICAgICAgICAgICAgICAgIGhhc0R1cGxpY2F0ZSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBQYXJlbnRsZXNzIG5vZGVzIGFyZSBlaXRoZXIgZG9jdW1lbnRzIG9yIGRpc2Nvbm5lY3RlZA0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoICFhdXAgfHwgIWJ1cCApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEgPT09IGRvYyA/IC0xIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGIgPT09IGRvYyA/IDEgOg0KICAgICAgICAgICAgICAgICAgICAgICAgYXVwID8gLTEgOg0KICAgICAgICAgICAgICAgICAgICAgICAgYnVwID8gMSA6DQogICAgICAgICAgICAgICAgICAgICAgICAwOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbm9kZXMgYXJlIHNpYmxpbmdzLCB3ZSBjYW4gZG8gYSBxdWljayBjaGVjaw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIGF1cCA9PT0gYnVwICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2libGluZ0NoZWNrKCBhLCBiICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2Ugd2UgbmVlZCBmdWxsIGxpc3RzIG9mIHRoZWlyIGFuY2VzdG9ycyBmb3IgY29tcGFyaXNvbg0KICAgICAgICAgICAgICAgIGN1ciA9IGE7DQogICAgICAgICAgICAgICAgd2hpbGUgKCAoY3VyID0gY3VyLnBhcmVudE5vZGUpICkgew0KICAgICAgICAgICAgICAgICAgICBhcC51bnNoaWZ0KCBjdXIgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY3VyID0gYjsNCiAgICAgICAgICAgICAgICB3aGlsZSAoIChjdXIgPSBjdXIucGFyZW50Tm9kZSkgKSB7DQogICAgICAgICAgICAgICAgICAgIGJwLnVuc2hpZnQoIGN1ciApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gV2FsayBkb3duIHRoZSB0cmVlIGxvb2tpbmcgZm9yIGEgZGlzY3JlcGFuY3kNCiAgICAgICAgICAgICAgICB3aGlsZSAoIGFwW2ldID09PSBicFtpXSApIHsNCiAgICAgICAgICAgICAgICAgICAgaSsrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIGkgPw0KICAgICAgICAgICAgICAgICAgICAvLyBEbyBhIHNpYmxpbmcgY2hlY2sgaWYgdGhlIG5vZGVzIGhhdmUgYSBjb21tb24gYW5jZXN0b3INCiAgICAgICAgICAgICAgICAgICAgc2libGluZ0NoZWNrKCBhcFtpXSwgYnBbaV0gKSA6DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2Ugbm9kZXMgaW4gb3VyIGRvY3VtZW50IHNvcnQgZmlyc3QNCiAgICAgICAgICAgICAgICAgICAgYXBbaV0gPT09IHByZWZlcnJlZERvYyA/IC0xIDoNCiAgICAgICAgICAgICAgICAgICAgYnBbaV0gPT09IHByZWZlcnJlZERvYyA/IDEgOg0KICAgICAgICAgICAgICAgICAgICAwOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBBbHdheXMgYXNzdW1lIHRoZSBwcmVzZW5jZSBvZiBkdXBsaWNhdGVzIGlmIHNvcnQgZG9lc24ndA0KICAgICAgICAgICAgLy8gcGFzcyB0aGVtIHRvIG91ciBjb21wYXJpc29uIGZ1bmN0aW9uIChhcyBpbiBHb29nbGUgQ2hyb21lKS4NCiAgICAgICAgICAgIGhhc0R1cGxpY2F0ZSA9IGZhbHNlOw0KICAgICAgICAgICAgWzAsIDBdLnNvcnQoIHNvcnRPcmRlciApOw0KICAgICAgICAgICAgc3VwcG9ydC5kZXRlY3REdXBsaWNhdGVzID0gaGFzRHVwbGljYXRlOw0KICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudDsNCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIFNpenpsZS5tYXRjaGVzID0gZnVuY3Rpb24oIGV4cHIsIGVsZW1lbnRzICkgew0KICAgICAgICAgICAgcmV0dXJuIFNpenpsZSggZXhwciwgbnVsbCwgbnVsbCwgZWxlbWVudHMgKTsNCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIFNpenpsZS5tYXRjaGVzU2VsZWN0b3IgPSBmdW5jdGlvbiggZWxlbSwgZXhwciApIHsNCiAgICAgICAgICAgIC8vIFNldCBkb2N1bWVudCB2YXJzIGlmIG5lZWRlZA0KICAgICAgICAgICAgaWYgKCAoIGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtICkgIT09IGRvY3VtZW50ICkgew0KICAgICAgICAgICAgICAgIHNldERvY3VtZW50KCBlbGVtICk7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgYXR0cmlidXRlIHNlbGVjdG9ycyBhcmUgcXVvdGVkDQogICAgICAgICAgICBleHByID0gZXhwci5yZXBsYWNlKCByYXR0cmlidXRlUXVvdGVzLCAiPSckMSddIiApOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIHJidWdneVFTQSBhbHdheXMgY29udGFpbnMgOmZvY3VzLCBzbyBubyBuZWVkIGZvciBhbiBleGlzdGVuY2UgY2hlY2sNCiAgICAgICAgICAgIGlmICggc3VwcG9ydC5tYXRjaGVzU2VsZWN0b3IgJiYgIWRvY3VtZW50SXNYTUwgJiYgKCFyYnVnZ3lNYXRjaGVzIHx8ICFyYnVnZ3lNYXRjaGVzLnRlc3QoZXhwcikpICYmICFyYnVnZ3lRU0EudGVzdChleHByKSApIHsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgcmV0ID0gbWF0Y2hlcy5jYWxsKCBlbGVtLCBleHByICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBJRSA5J3MgbWF0Y2hlc1NlbGVjdG9yIHJldHVybnMgZmFsc2Ugb24gZGlzY29ubmVjdGVkIG5vZGVzDQogICAgICAgICAgICAgICAgICAgIGlmICggcmV0IHx8IHN1cHBvcnQuZGlzY29ubmVjdGVkTWF0Y2ggfHwNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBBcyB3ZWxsLCBkaXNjb25uZWN0ZWQgbm9kZXMgYXJlIHNhaWQgdG8gYmUgaW4gYSBkb2N1bWVudA0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIGZyYWdtZW50IGluIElFIDkNCiAgICAgICAgICAgICAgICAgICAgICAgIAllbGVtLmRvY3VtZW50ICYmIGVsZW0uZG9jdW1lbnQubm9kZVR5cGUgIT09IDExICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkge30NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gU2l6emxlKCBleHByLCBkb2N1bWVudCwgbnVsbCwgW2VsZW1dICkubGVuZ3RoID4gMDsNCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIFNpenpsZS5jb250YWlucyA9IGZ1bmN0aW9uKCBjb250ZXh0LCBlbGVtICkgew0KICAgICAgICAgICAgLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkDQogICAgICAgICAgICBpZiAoICggY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgKSAhPT0gZG9jdW1lbnQgKSB7DQogICAgICAgICAgICAgICAgc2V0RG9jdW1lbnQoIGNvbnRleHQgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBjb250YWlucyggY29udGV4dCwgZWxlbSApOw0KICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgU2l6emxlLmF0dHIgPSBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsNCiAgICAgICAgICAgIHZhciB2YWw7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkDQogICAgICAgICAgICBpZiAoICggZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0gKSAhPT0gZG9jdW1lbnQgKSB7DQogICAgICAgICAgICAgICAgc2V0RG9jdW1lbnQoIGVsZW0gKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZiAoICFkb2N1bWVudElzWE1MICkgew0KICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoICh2YWwgPSBFeHByLmF0dHJIYW5kbGVbIG5hbWUgXSkgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHZhbCggZWxlbSApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCBkb2N1bWVudElzWE1MIHx8IHN1cHBvcnQuYXR0cmlidXRlcyApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAoICh2YWwgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKSkgfHwgZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKSApICYmIGVsZW1bIG5hbWUgXSA9PT0gdHJ1ZSA/DQogICAgICAgICAgICAgICAgbmFtZSA6DQogICAgICAgICAgICAgICAgdmFsICYmIHZhbC5zcGVjaWZpZWQgPyB2YWwudmFsdWUgOiBudWxsOw0KICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgU2l6emxlLmVycm9yID0gZnVuY3Rpb24oIG1zZyApIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciggIlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246ICIgKyBtc2cgKTsNCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIC8vIERvY3VtZW50IHNvcnRpbmcgYW5kIHJlbW92aW5nIGR1cGxpY2F0ZXMNCiAgICAgICAgU2l6emxlLnVuaXF1ZVNvcnQgPSBmdW5jdGlvbiggcmVzdWx0cyApIHsNCiAgICAgICAgICAgIHZhciBlbGVtLA0KICAgICAgICAgICAgICAgIGR1cGxpY2F0ZXMgPSBbXSwNCiAgICAgICAgICAgICAgICBpID0gMSwNCiAgICAgICAgICAgICAgICBqID0gMDsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBVbmxlc3Mgd2UgKmtub3cqIHdlIGNhbiBkZXRlY3QgZHVwbGljYXRlcywgYXNzdW1lIHRoZWlyIHByZXNlbmNlDQogICAgICAgICAgICBoYXNEdXBsaWNhdGUgPSAhc3VwcG9ydC5kZXRlY3REdXBsaWNhdGVzOw0KICAgICAgICAgICAgcmVzdWx0cy5zb3J0KCBzb3J0T3JkZXIgKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAoIGhhc0R1cGxpY2F0ZSApIHsNCiAgICAgICAgICAgICAgICBmb3IgKCA7IChlbGVtID0gcmVzdWx0c1tpXSk7IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBlbGVtID09PSByZXN1bHRzWyBpIC0gMSBdICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaiA9IGR1cGxpY2F0ZXMucHVzaCggaSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHdoaWxlICggai0tICkgew0KICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnNwbGljZSggZHVwbGljYXRlc1sgaiBdLCAxICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIHJldHVybiByZXN1bHRzOw0KICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gc2libGluZ0NoZWNrKCBhLCBiICkgew0KICAgICAgICAgICAgdmFyIGN1ciA9IGIgJiYgYSwNCiAgICAgICAgICAgICAgICBkaWZmID0gY3VyICYmICggfmIuc291cmNlSW5kZXggfHwgTUFYX05FR0FUSVZFICkgLSAoIH5hLnNvdXJjZUluZGV4IHx8IE1BWF9ORUdBVElWRSApOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIFVzZSBJRSBzb3VyY2VJbmRleCBpZiBhdmFpbGFibGUgb24gYm90aCBub2Rlcw0KICAgICAgICAgICAgaWYgKCBkaWZmICkgew0KICAgICAgICAgICAgICAgIHJldHVybiBkaWZmOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIENoZWNrIGlmIGIgZm9sbG93cyBhDQogICAgICAgICAgICBpZiAoIGN1ciApIHsNCiAgICAgICAgICAgICAgICB3aGlsZSAoIChjdXIgPSBjdXIubmV4dFNpYmxpbmcpICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIGN1ciA9PT0gYiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gYSA/IDEgOiAtMTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBpbnB1dCB0eXBlcw0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVJbnB1dFBzZXVkbyggdHlwZSApIHsNCiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gbmFtZSA9PT0gImlucHV0IiAmJiBlbGVtLnR5cGUgPT09IHR5cGU7DQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIGJ1dHRvbnMNCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQnV0dG9uUHNldWRvKCB0eXBlICkgew0KICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgIHZhciBuYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOw0KICAgICAgICAgICAgICAgIHJldHVybiAobmFtZSA9PT0gImlucHV0IiB8fCBuYW1lID09PSAiYnV0dG9uIikgJiYgZWxlbS50eXBlID09PSB0eXBlOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBwb3NpdGlvbmFscw0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKCBmbiApIHsNCiAgICAgICAgICAgIHJldHVybiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIGFyZ3VtZW50ICkgew0KICAgICAgICAgICAgICAgIGFyZ3VtZW50ID0gK2FyZ3VtZW50Ow0KICAgICAgICAgICAgICAgIHJldHVybiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlZWQsIG1hdGNoZXMgKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBqLA0KICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hJbmRleGVzID0gZm4oIFtdLCBzZWVkLmxlbmd0aCwgYXJndW1lbnQgKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBtYXRjaEluZGV4ZXMubGVuZ3RoOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gTWF0Y2ggZWxlbWVudHMgZm91bmQgYXQgdGhlIHNwZWNpZmllZCBpbmRleGVzDQogICAgICAgICAgICAgICAgICAgIHdoaWxlICggaS0tICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBzZWVkWyAoaiA9IG1hdGNoSW5kZXhlc1tpXSkgXSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlzZWVkW2pdID0gIShtYXRjaGVzW2pdID0gc2VlZFtqXSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvKioNCiAgICAgICAgICogVXRpbGl0eSBmdW5jdGlvbiBmb3IgcmV0cmlldmluZyB0aGUgdGV4dCB2YWx1ZSBvZiBhbiBhcnJheSBvZiBET00gbm9kZXMNCiAgICAgICAgICogQHBhcmFtIHtBcnJheXxFbGVtZW50fSBlbGVtDQogICAgICAgICAqLw0KICAgICAgICBnZXRUZXh0ID0gU2l6emxlLmdldFRleHQgPSBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgIHZhciBub2RlLA0KICAgICAgICAgICAgICAgIHJldCA9ICIiLA0KICAgICAgICAgICAgICAgIGkgPSAwLA0KICAgICAgICAgICAgICAgIG5vZGVUeXBlID0gZWxlbS5ub2RlVHlwZTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAoICFub2RlVHlwZSApIHsNCiAgICAgICAgICAgICAgICAvLyBJZiBubyBub2RlVHlwZSwgdGhpcyBpcyBleHBlY3RlZCB0byBiZSBhbiBhcnJheQ0KICAgICAgICAgICAgICAgIGZvciAoIDsgKG5vZGUgPSBlbGVtW2ldKTsgaSsrICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3QgdHJhdmVyc2UgY29tbWVudCBub2Rlcw0KICAgICAgICAgICAgICAgICAgICByZXQgKz0gZ2V0VGV4dCggbm9kZSApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSBpZiAoIG5vZGVUeXBlID09PSAxIHx8IG5vZGVUeXBlID09PSA5IHx8IG5vZGVUeXBlID09PSAxMSApIHsNCiAgICAgICAgICAgICAgICAvLyBVc2UgdGV4dENvbnRlbnQgZm9yIGVsZW1lbnRzDQogICAgICAgICAgICAgICAgLy8gaW5uZXJUZXh0IHVzYWdlIHJlbW92ZWQgZm9yIGNvbnNpc3RlbmN5IG9mIG5ldyBsaW5lcyAoc2VlICMxMTE1MykNCiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBlbGVtLnRleHRDb250ZW50ID09PSAic3RyaW5nIiApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0udGV4dENvbnRlbnQ7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gVHJhdmVyc2UgaXRzIGNoaWxkcmVuDQogICAgICAgICAgICAgICAgICAgIGZvciAoIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7IGVsZW07IGVsZW0gPSBlbGVtLm5leHRTaWJsaW5nICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ICs9IGdldFRleHQoIGVsZW0gKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSBpZiAoIG5vZGVUeXBlID09PSAzIHx8IG5vZGVUeXBlID09PSA0ICkgew0KICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLm5vZGVWYWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vIERvIG5vdCBpbmNsdWRlIGNvbW1lbnQgb3IgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbiBub2Rlcw0KICAgICAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH07DQogICAgICAgIA0KICAgICAgICBFeHByID0gU2l6emxlLnNlbGVjdG9ycyA9IHsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBDYW4gYmUgYWRqdXN0ZWQgYnkgdGhlIHVzZXINCiAgICAgICAgICAgIGNhY2hlTGVuZ3RoOiA1MCwNCiAgICAgICAgDQogICAgICAgICAgICBjcmVhdGVQc2V1ZG86IG1hcmtGdW5jdGlvbiwNCiAgICAgICAgDQogICAgICAgICAgICBtYXRjaDogbWF0Y2hFeHByLA0KICAgICAgICANCiAgICAgICAgICAgIGZpbmQ6IHt9LA0KICAgICAgICANCiAgICAgICAgICAgIHJlbGF0aXZlOiB7DQogICAgICAgICAgICAgICAgIj4iOiB7IGRpcjogInBhcmVudE5vZGUiLCBmaXJzdDogdHJ1ZSB9LA0KICAgICAgICAgICAgICAgICIgIjogeyBkaXI6ICJwYXJlbnROb2RlIiB9LA0KICAgICAgICAgICAgICAgICIrIjogeyBkaXI6ICJwcmV2aW91c1NpYmxpbmciLCBmaXJzdDogdHJ1ZSB9LA0KICAgICAgICAgICAgICAgICJ+IjogeyBkaXI6ICJwcmV2aW91c1NpYmxpbmciIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgcHJlRmlsdGVyOiB7DQogICAgICAgICAgICAgICAgIkFUVFIiOiBmdW5jdGlvbiggbWF0Y2ggKSB7DQogICAgICAgICAgICAgICAgICAgIG1hdGNoWzFdID0gbWF0Y2hbMV0ucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIE1vdmUgdGhlIGdpdmVuIHZhbHVlIHRvIG1hdGNoWzNdIHdoZXRoZXIgcXVvdGVkIG9yIHVucXVvdGVkDQogICAgICAgICAgICAgICAgICAgIG1hdGNoWzNdID0gKCBtYXRjaFs0XSB8fCBtYXRjaFs1XSB8fCAiIiApLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoIG1hdGNoWzJdID09PSAifj0iICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hbM10gPSAiICIgKyBtYXRjaFszXSArICIgIjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoLnNsaWNlKCAwLCA0ICk7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgIkNISUxEIjogZnVuY3Rpb24oIG1hdGNoICkgew0KICAgICAgICAgICAgICAgICAgICAvKiBtYXRjaGVzIGZyb20gbWF0Y2hFeHByWyJDSElMRCJdDQogICAgICAgICAgICAgICAgICAgICAgICAxIHR5cGUgKG9ubHl8bnRofC4uLikNCiAgICAgICAgICAgICAgICAgICAgICAgIDIgd2hhdCAoY2hpbGR8b2YtdHlwZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIDMgYXJndW1lbnQgKGV2ZW58b2RkfFxkKnxcZCpuKFsrLV1cZCspP3wuLi4pDQogICAgICAgICAgICAgICAgICAgICAgICA0IHhuLWNvbXBvbmVudCBvZiB4bit5IGFyZ3VtZW50IChbKy1dP1xkKm58KQ0KICAgICAgICAgICAgICAgICAgICAgICAgNSBzaWduIG9mIHhuLWNvbXBvbmVudA0KICAgICAgICAgICAgICAgICAgICAgICAgNiB4IG9mIHhuLWNvbXBvbmVudA0KICAgICAgICAgICAgICAgICAgICAgICAgNyBzaWduIG9mIHktY29tcG9uZW50DQogICAgICAgICAgICAgICAgICAgICAgICA4IHkgb2YgeS1jb21wb25lbnQNCiAgICAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICAgICAgbWF0Y2hbMV0gPSBtYXRjaFsxXS50b0xvd2VyQ2FzZSgpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCBtYXRjaFsxXS5zbGljZSggMCwgMyApID09PSAibnRoIiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG50aC0qIHJlcXVpcmVzIGFyZ3VtZW50DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFtYXRjaFszXSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlTaXp6bGUuZXJyb3IoIG1hdGNoWzBdICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gbnVtZXJpYyB4IGFuZCB5IHBhcmFtZXRlcnMgZm9yIEV4cHIuZmlsdGVyLkNISUxEDQogICAgICAgICAgICAgICAgICAgICAgICAvLyByZW1lbWJlciB0aGF0IGZhbHNlL3RydWUgY2FzdCByZXNwZWN0aXZlbHkgdG8gMC8xDQogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaFs0XSA9ICsoIG1hdGNoWzRdID8gbWF0Y2hbNV0gKyAobWF0Y2hbNl0gfHwgMSkgOiAyICogKCBtYXRjaFszXSA9PT0gImV2ZW4iIHx8IG1hdGNoWzNdID09PSAib2RkIiApICk7DQogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaFs1XSA9ICsoICggbWF0Y2hbN10gKyBtYXRjaFs4XSApIHx8IG1hdGNoWzNdID09PSAib2RkIiApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gb3RoZXIgdHlwZXMgcHJvaGliaXQgYXJndW1lbnRzDQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIG1hdGNoWzNdICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgU2l6emxlLmVycm9yKCBtYXRjaFswXSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2g7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgIlBTRVVETyI6IGZ1bmN0aW9uKCBtYXRjaCApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGV4Y2VzcywNCiAgICAgICAgICAgICAgICAgICAgICAgIHVucXVvdGVkID0gIW1hdGNoWzVdICYmIG1hdGNoWzJdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCBtYXRjaEV4cHJbIkNISUxEIl0udGVzdCggbWF0Y2hbMF0gKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBBY2NlcHQgcXVvdGVkIGFyZ3VtZW50cyBhcy1pcw0KICAgICAgICAgICAgICAgICAgICBpZiAoIG1hdGNoWzRdICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hbMl0gPSBtYXRjaFs0XTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFN0cmlwIGV4Y2VzcyBjaGFyYWN0ZXJzIGZyb20gdW5xdW90ZWQgYXJndW1lbnRzDQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIHVucXVvdGVkICYmIHJwc2V1ZG8udGVzdCggdW5xdW90ZWQgKSAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2V0IGV4Y2VzcyBmcm9tIHRva2VuaXplIChyZWN1cnNpdmVseSkNCiAgICAgICAgICAgICAgICAgICAgICAgIChleGNlc3MgPSB0b2tlbml6ZSggdW5xdW90ZWQsIHRydWUgKSkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkdmFuY2UgdG8gdGhlIG5leHQgY2xvc2luZyBwYXJlbnRoZXNpcw0KICAgICAgICAgICAgICAgICAgICAgICAgKGV4Y2VzcyA9IHVucXVvdGVkLmluZGV4T2YoICIpIiwgdW5xdW90ZWQubGVuZ3RoIC0gZXhjZXNzICkgLSB1bnF1b3RlZC5sZW5ndGgpICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGV4Y2VzcyBpcyBhIG5lZ2F0aXZlIGluZGV4DQogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaFswXSA9IG1hdGNoWzBdLnNsaWNlKCAwLCBleGNlc3MgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoWzJdID0gdW5xdW90ZWQuc2xpY2UoIDAsIGV4Y2VzcyApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gb25seSBjYXB0dXJlcyBuZWVkZWQgYnkgdGhlIHBzZXVkbyBmaWx0ZXIgbWV0aG9kICh0eXBlIGFuZCBhcmd1bWVudCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoLnNsaWNlKCAwLCAzICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBmaWx0ZXI6IHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgIlRBRyI6IGZ1bmN0aW9uKCBub2RlTmFtZSApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBub2RlTmFtZSA9PT0gIioiICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgeyByZXR1cm4gdHJ1ZTsgfTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbm9kZU5hbWUgPSBub2RlTmFtZS5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLm5vZGVOYW1lICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbm9kZU5hbWU7DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgIkNMQVNTIjogZnVuY3Rpb24oIGNsYXNzTmFtZSApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBjbGFzc0NhY2hlWyBjbGFzc05hbWUgKyAiICIgXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXR0ZXJuIHx8DQogICAgICAgICAgICAgICAgICAgICAgICAocGF0dGVybiA9IG5ldyBSZWdFeHAoICIoXnwiICsgd2hpdGVzcGFjZSArICIpIiArIGNsYXNzTmFtZSArICIoIiArIHdoaXRlc3BhY2UgKyAifCQpIiApKSAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NDYWNoZSggY2xhc3NOYW1lLCBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZXR1cm4gcGF0dGVybi50ZXN0KCBlbGVtLmNsYXNzTmFtZSB8fCAodHlwZW9mIGVsZW0uZ2V0QXR0cmlidXRlICE9PSBzdHJ1bmRlZmluZWQgJiYgZWxlbS5nZXRBdHRyaWJ1dGUoImNsYXNzIikpIHx8ICIiICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAiQVRUUiI6IGZ1bmN0aW9uKCBuYW1lLCBvcGVyYXRvciwgY2hlY2sgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBTaXp6bGUuYXR0ciggZWxlbSwgbmFtZSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcmVzdWx0ID09IG51bGwgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIG9wZXJhdG9yID09PSAiIT0iOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhb3BlcmF0b3IgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICIiOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcGVyYXRvciA9PT0gIj0iID8gcmVzdWx0ID09PSBjaGVjayA6DQogICAgICAgICAgICAgICAgICAgICAgICAJb3BlcmF0b3IgPT09ICIhPSIgPyByZXN1bHQgIT09IGNoZWNrIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAlvcGVyYXRvciA9PT0gIl49IiA/IGNoZWNrICYmIHJlc3VsdC5pbmRleE9mKCBjaGVjayApID09PSAwIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAlvcGVyYXRvciA9PT0gIio9IiA/IGNoZWNrICYmIHJlc3VsdC5pbmRleE9mKCBjaGVjayApID4gLTEgOg0KICAgICAgICAgICAgICAgICAgICAgICAgCW9wZXJhdG9yID09PSAiJD0iID8gY2hlY2sgJiYgcmVzdWx0LnNsaWNlKCAtY2hlY2subGVuZ3RoICkgPT09IGNoZWNrIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAlvcGVyYXRvciA9PT0gIn49IiA/ICggIiAiICsgcmVzdWx0ICsgIiAiICkuaW5kZXhPZiggY2hlY2sgKSA+IC0xIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAlvcGVyYXRvciA9PT0gInw9IiA/IHJlc3VsdCA9PT0gY2hlY2sgfHwgcmVzdWx0LnNsaWNlKCAwLCBjaGVjay5sZW5ndGggKyAxICkgPT09IGNoZWNrICsgIi0iIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAlmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAiQ0hJTEQiOiBmdW5jdGlvbiggdHlwZSwgd2hhdCwgYXJndW1lbnQsIGZpcnN0LCBsYXN0ICkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgc2ltcGxlID0gdHlwZS5zbGljZSggMCwgMyApICE9PSAibnRoIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcndhcmQgPSB0eXBlLnNsaWNlKCAtNCApICE9PSAibGFzdCIsDQogICAgICAgICAgICAgICAgICAgICAgICBvZlR5cGUgPSB3aGF0ID09PSAib2YtdHlwZSI7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmlyc3QgPT09IDEgJiYgbGFzdCA9PT0gMCA/DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2hvcnRjdXQgZm9yIDpudGgtKihuKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuICEhZWxlbS5wYXJlbnROb2RlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSA6DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl2YXIgY2FjaGUsIG91dGVyQ2FjaGUsIG5vZGUsIGRpZmYsIG5vZGVJbmRleCwgc3RhcnQsDQogICAgICAgICAgICAgICAgICAgICAgICAJCWRpciA9IHNpbXBsZSAhPT0gZm9yd2FyZCA/ICJuZXh0U2libGluZyIgOiAicHJldmlvdXNTaWJsaW5nIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlLA0KICAgICAgICAgICAgICAgICAgICAgICAgCQluYW1lID0gb2ZUeXBlICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJdXNlQ2FjaGUgPSAheG1sICYmICFvZlR5cGU7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggcGFyZW50ICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gOihmaXJzdHxsYXN0fG9ubHkpLShjaGlsZHxvZi10eXBlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQlpZiAoIHNpbXBsZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCXdoaWxlICggZGlyICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCW5vZGUgPSBlbGVtOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCXdoaWxlICggKG5vZGUgPSBub2RlWyBkaXIgXSkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCWlmICggb2ZUeXBlID8gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lIDogbm9kZS5ub2RlVHlwZSA9PT0gMSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJCXJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkvLyBSZXZlcnNlIGRpcmVjdGlvbiBmb3IgOm9ubHktKiAoaWYgd2UgaGF2ZW4ndCB5ZXQgZG9uZSBzbykNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQlzdGFydCA9IGRpciA9IHR5cGUgPT09ICJvbmx5IiAmJiAhc3RhcnQgJiYgIm5leHRTaWJsaW5nIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCXJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQlzdGFydCA9IFsgZm9yd2FyZCA/IHBhcmVudC5maXJzdENoaWxkIDogcGFyZW50Lmxhc3RDaGlsZCBdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gbm9uLXhtbCA6bnRoLWNoaWxkKC4uLikgc3RvcmVzIGNhY2hlIGRhdGEgb24gYHBhcmVudGANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJaWYgKCBmb3J3YXJkICYmIHVzZUNhY2hlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJLy8gU2VlayBgZWxlbWAgZnJvbSBhIHByZXZpb3VzbHktY2FjaGVkIGluZGV4DQogICAgICAgICAgICAgICAgICAgICAgICAJCQlvdXRlckNhY2hlID0gcGFyZW50WyBleHBhbmRvIF0gfHwgKHBhcmVudFsgZXhwYW5kbyBdID0ge30pOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJY2FjaGUgPSBvdXRlckNhY2hlWyB0eXBlIF0gfHwgW107DQogICAgICAgICAgICAgICAgICAgICAgICAJCQlub2RlSW5kZXggPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWRpZmYgPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsyXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCW5vZGUgPSBub2RlSW5kZXggJiYgcGFyZW50LmNoaWxkTm9kZXNbIG5vZGVJbmRleCBdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCXdoaWxlICggKG5vZGUgPSArK25vZGVJbmRleCAmJiBub2RlICYmIG5vZGVbIGRpciBdIHx8DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCS8vIEZhbGxiYWNrIHRvIHNlZWtpbmcgYGVsZW1gIGZyb20gdGhlIHN0YXJ0DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJKGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCS8vIFdoZW4gZm91bmQsIGNhY2hlIGluZGV4ZXMgb24gYHBhcmVudGAgYW5kIGJyZWFrDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJaWYgKCBub2RlLm5vZGVUeXBlID09PSAxICYmICsrZGlmZiAmJiBub2RlID09PSBlbGVtICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQlvdXRlckNhY2hlWyB0eXBlIF0gPSBbIGRpcnJ1bnMsIG5vZGVJbmRleCwgZGlmZiBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQlicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkvLyBVc2UgcHJldmlvdXNseS1jYWNoZWQgZWxlbWVudCBpbmRleCBpZiBhdmFpbGFibGUNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfSBlbHNlIGlmICggdXNlQ2FjaGUgJiYgKGNhY2hlID0gKGVsZW1bIGV4cGFuZG8gXSB8fCAoZWxlbVsgZXhwYW5kbyBdID0ge30pKVsgdHlwZSBdKSAmJiBjYWNoZVswXSA9PT0gZGlycnVucyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWRpZmYgPSBjYWNoZVsxXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIHhtbCA6bnRoLWNoaWxkKC4uLikgb3IgOm50aC1sYXN0LWNoaWxkKC4uLikgb3IgOm50aCgtbGFzdCk/LW9mLXR5cGUoLi4uKQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJLy8gVXNlIHRoZSBzYW1lIGxvb3AgYXMgYWJvdmUgdG8gc2VlayBgZWxlbWAgZnJvbSB0aGUgc3RhcnQNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCXdoaWxlICggKG5vZGUgPSArK25vZGVJbmRleCAmJiBub2RlICYmIG5vZGVbIGRpciBdIHx8DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJKGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCWlmICggKCBvZlR5cGUgPyBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUgOiBub2RlLm5vZGVUeXBlID09PSAxICkgJiYgKytkaWZmICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQkvLyBDYWNoZSB0aGUgaW5kZXggb2YgZWFjaCBlbmNvdW50ZXJlZCBlbGVtZW50DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCWlmICggdXNlQ2FjaGUgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCQkobm9kZVsgZXhwYW5kbyBdIHx8IChub2RlWyBleHBhbmRvIF0gPSB7fSkpWyB0eXBlIF0gPSBbIGRpcnJ1bnMsIGRpZmYgXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJaWYgKCBub2RlID09PSBlbGVtICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQkJYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIEluY29ycG9yYXRlIHRoZSBvZmZzZXQsIHRoZW4gY2hlY2sgYWdhaW5zdCBjeWNsZSBzaXplDQogICAgICAgICAgICAgICAgICAgICAgICAJCWRpZmYgLT0gbGFzdDsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJcmV0dXJuIGRpZmYgPT09IGZpcnN0IHx8ICggZGlmZiAlIGZpcnN0ID09PSAwICYmIGRpZmYgLyBmaXJzdCA+PSAwICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAiUFNFVURPIjogZnVuY3Rpb24oIHBzZXVkbywgYXJndW1lbnQgKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIHBzZXVkby1jbGFzcyBuYW1lcyBhcmUgY2FzZS1pbnNlbnNpdGl2ZQ0KICAgICAgICAgICAgICAgICAgICAvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI3BzZXVkby1jbGFzc2VzDQogICAgICAgICAgICAgICAgICAgIC8vIFByaW9yaXRpemUgYnkgY2FzZSBzZW5zaXRpdml0eSBpbiBjYXNlIGN1c3RvbSBwc2V1ZG9zIGFyZSBhZGRlZCB3aXRoIHVwcGVyY2FzZSBsZXR0ZXJzDQogICAgICAgICAgICAgICAgICAgIC8vIFJlbWVtYmVyIHRoYXQgc2V0RmlsdGVycyBpbmhlcml0cyBmcm9tIHBzZXVkb3MNCiAgICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MsDQogICAgICAgICAgICAgICAgICAgICAgICBmbiA9IEV4cHIucHNldWRvc1sgcHNldWRvIF0gfHwgRXhwci5zZXRGaWx0ZXJzWyBwc2V1ZG8udG9Mb3dlckNhc2UoKSBdIHx8DQogICAgICAgICAgICAgICAgICAgICAgICAJU2l6emxlLmVycm9yKCAidW5zdXBwb3J0ZWQgcHNldWRvOiAiICsgcHNldWRvICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBUaGUgdXNlciBtYXkgdXNlIGNyZWF0ZVBzZXVkbyB0byBpbmRpY2F0ZSB0aGF0DQogICAgICAgICAgICAgICAgICAgIC8vIGFyZ3VtZW50cyBhcmUgbmVlZGVkIHRvIGNyZWF0ZSB0aGUgZmlsdGVyIGZ1bmN0aW9uDQogICAgICAgICAgICAgICAgICAgIC8vIGp1c3QgYXMgU2l6emxlIGRvZXMNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBmblsgZXhwYW5kbyBdICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZuKCBhcmd1bWVudCApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBCdXQgbWFpbnRhaW4gc3VwcG9ydCBmb3Igb2xkIHNpZ25hdHVyZXMNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBmbi5sZW5ndGggPiAxICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYXJncyA9IFsgcHNldWRvLCBwc2V1ZG8sICIiLCBhcmd1bWVudCBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEV4cHIuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eSggcHNldWRvLnRvTG93ZXJDYXNlKCkgKSA/DQogICAgICAgICAgICAgICAgICAgICAgICAJbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQl2YXIgaWR4LA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJbWF0Y2hlZCA9IGZuKCBzZWVkLCBhcmd1bWVudCApLA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJaSA9IG1hdGNoZWQubGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQl3aGlsZSAoIGktLSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWlkeCA9IGluZGV4T2YuY2FsbCggc2VlZCwgbWF0Y2hlZFtpXSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJc2VlZFsgaWR4IF0gPSAhKCBtYXRjaGVzWyBpZHggXSA9IG1hdGNoZWRbaV0gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCX0pIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAlmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJcmV0dXJuIGZuKCBlbGVtLCAwLCBhcmdzICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJfTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgcHNldWRvczogew0KICAgICAgICAgICAgICAgIC8vIFBvdGVudGlhbGx5IGNvbXBsZXggcHNldWRvcw0KICAgICAgICAgICAgICAgICJub3QiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlbGVjdG9yICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBUcmltIHRoZSBzZWxlY3RvciBwYXNzZWQgdG8gY29tcGlsZQ0KICAgICAgICAgICAgICAgICAgICAvLyB0byBhdm9pZCB0cmVhdGluZyBsZWFkaW5nIGFuZCB0cmFpbGluZw0KICAgICAgICAgICAgICAgICAgICAvLyBzcGFjZXMgYXMgY29tYmluYXRvcnMNCiAgICAgICAgICAgICAgICAgICAgdmFyIGlucHV0ID0gW10sDQogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzID0gW10sDQogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVyID0gY29tcGlsZSggc2VsZWN0b3IucmVwbGFjZSggcnRyaW0sICIkMSIgKSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXJbIGV4cGFuZG8gXSA/DQogICAgICAgICAgICAgICAgICAgICAgICBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlZWQsIG1hdGNoZXMsIGNvbnRleHQsIHhtbCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl2YXIgZWxlbSwNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJdW5tYXRjaGVkID0gbWF0Y2hlciggc2VlZCwgbnVsbCwgeG1sLCBbXSApLA0KICAgICAgICAgICAgICAgICAgICAgICAgCQlpID0gc2VlZC5sZW5ndGg7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIE1hdGNoIGVsZW1lbnRzIHVubWF0Y2hlZCBieSBgbWF0Y2hlcmANCiAgICAgICAgICAgICAgICAgICAgICAgIAl3aGlsZSAoIGktLSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJaWYgKCAoZWxlbSA9IHVubWF0Y2hlZFtpXSkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQlzZWVkW2ldID0gIShtYXRjaGVzW2ldID0gZWxlbSk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9KSA6DQogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWlucHV0WzBdID0gZWxlbTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAltYXRjaGVyKCBpbnB1dCwgbnVsbCwgeG1sLCByZXN1bHRzICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuICFyZXN1bHRzLnBvcCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgImhhcyI6IG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VsZWN0b3IgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTaXp6bGUoIHNlbGVjdG9yLCBlbGVtICkubGVuZ3RoID4gMDsNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgImNvbnRhaW5zIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCB0ZXh0ICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCBlbGVtLnRleHRDb250ZW50IHx8IGVsZW0uaW5uZXJUZXh0IHx8IGdldFRleHQoIGVsZW0gKSApLmluZGV4T2YoIHRleHQgKSA+IC0xOw0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH0pLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyAiV2hldGhlciBhbiBlbGVtZW50IGlzIHJlcHJlc2VudGVkIGJ5IGEgOmxhbmcoKSBzZWxlY3Rvcg0KICAgICAgICAgICAgICAgIC8vIGlzIGJhc2VkIHNvbGVseSBvbiB0aGUgZWxlbWVudCdzIGxhbmd1YWdlIHZhbHVlDQogICAgICAgICAgICAgICAgLy8gYmVpbmcgZXF1YWwgdG8gdGhlIGlkZW50aWZpZXIgQywNCiAgICAgICAgICAgICAgICAvLyBvciBiZWdpbm5pbmcgd2l0aCB0aGUgaWRlbnRpZmllciBDIGltbWVkaWF0ZWx5IGZvbGxvd2VkIGJ5ICItIi4NCiAgICAgICAgICAgICAgICAvLyBUaGUgbWF0Y2hpbmcgb2YgQyBhZ2FpbnN0IHRoZSBlbGVtZW50J3MgbGFuZ3VhZ2UgdmFsdWUgaXMgcGVyZm9ybWVkIGNhc2UtaW5zZW5zaXRpdmVseS4NCiAgICAgICAgICAgICAgICAvLyBUaGUgaWRlbnRpZmllciBDIGRvZXMgbm90IGhhdmUgdG8gYmUgYSB2YWxpZCBsYW5ndWFnZSBuYW1lLiINCiAgICAgICAgICAgICAgICAvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI2xhbmctcHNldWRvDQogICAgICAgICAgICAgICAgImxhbmciOiBtYXJrRnVuY3Rpb24oIGZ1bmN0aW9uKCBsYW5nICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBsYW5nIHZhbHVlIG11c3QgYmUgYSB2YWxpZCBpZGVudGlmaWRlcg0KICAgICAgICAgICAgICAgICAgICBpZiAoICFyaWRlbnRpZmllci50ZXN0KGxhbmcgfHwgIiIpICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgU2l6emxlLmVycm9yKCAidW5zdXBwb3J0ZWQgbGFuZzogIiArIGxhbmcgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBsYW5nID0gbGFuZy5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbGVtTGFuZzsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRvIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIChlbGVtTGFuZyA9IGRvY3VtZW50SXNYTUwgPw0KICAgICAgICAgICAgICAgICAgICAgICAgCQllbGVtLmdldEF0dHJpYnV0ZSgieG1sOmxhbmciKSB8fCBlbGVtLmdldEF0dHJpYnV0ZSgibGFuZyIpIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZWxlbS5sYW5nKSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCWVsZW1MYW5nID0gZWxlbUxhbmcudG9Mb3dlckNhc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJcmV0dXJuIGVsZW1MYW5nID09PSBsYW5nIHx8IGVsZW1MYW5nLmluZGV4T2YoIGxhbmcgKyAiLSIgKSA9PT0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlICggKGVsZW0gPSBlbGVtLnBhcmVudE5vZGUpICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gTWlzY2VsbGFuZW91cw0KICAgICAgICAgICAgICAgICJ0YXJnZXQiOiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGhhc2ggPSB3aW5kb3cubG9jYXRpb24gJiYgd2luZG93LmxvY2F0aW9uLmhhc2g7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBoYXNoICYmIGhhc2guc2xpY2UoIDEgKSA9PT0gZWxlbS5pZDsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAicm9vdCI6IGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbSA9PT0gZG9jRWxlbTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAiZm9jdXMiOiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0gPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgKCFkb2N1bWVudC5oYXNGb2N1cyB8fCBkb2N1bWVudC5oYXNGb2N1cygpKSAmJiAhIShlbGVtLnR5cGUgfHwgZWxlbS5ocmVmIHx8IH5lbGVtLnRhYkluZGV4KTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBCb29sZWFuIHByb3BlcnRpZXMNCiAgICAgICAgICAgICAgICAiZW5hYmxlZCI6IGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gZmFsc2U7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgImRpc2FibGVkIjogZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLmRpc2FibGVkID09PSB0cnVlOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgICAgICJjaGVja2VkIjogZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIEluIENTUzMsIDpjaGVja2VkIHNob3VsZCByZXR1cm4gYm90aCBjaGVja2VkIGFuZCBzZWxlY3RlZCBlbGVtZW50cw0KICAgICAgICAgICAgICAgICAgICAvLyBodHRwOi8vd3d3LnczLm9yZy9UUi8yMDExL1JFQy1jc3MzLXNlbGVjdG9ycy0yMDExMDkyOS8jY2hlY2tlZA0KICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAobm9kZU5hbWUgPT09ICJpbnB1dCIgJiYgISFlbGVtLmNoZWNrZWQpIHx8IChub2RlTmFtZSA9PT0gIm9wdGlvbiIgJiYgISFlbGVtLnNlbGVjdGVkKTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAic2VsZWN0ZWQiOiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gQWNjZXNzaW5nIHRoaXMgcHJvcGVydHkgbWFrZXMgc2VsZWN0ZWQtYnktZGVmYXVsdA0KICAgICAgICAgICAgICAgICAgICAvLyBvcHRpb25zIGluIFNhZmFyaSB3b3JrIHByb3Blcmx5DQogICAgICAgICAgICAgICAgICAgIGlmICggZWxlbS5wYXJlbnROb2RlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXg7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLnNlbGVjdGVkID09PSB0cnVlOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIENvbnRlbnRzDQogICAgICAgICAgICAgICAgImVtcHR5IjogZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jZW1wdHktcHNldWRvDQogICAgICAgICAgICAgICAgICAgIC8vIDplbXB0eSBpcyBvbmx5IGFmZmVjdGVkIGJ5IGVsZW1lbnQgbm9kZXMgYW5kIGNvbnRlbnQgbm9kZXMoaW5jbHVkaW5nIHRleHQoMyksIGNkYXRhKDQpKSwNCiAgICAgICAgICAgICAgICAgICAgLy8gICBub3QgY29tbWVudCwgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbnMsIG9yIG90aGVycw0KICAgICAgICAgICAgICAgICAgICAvLyBUaGFua3MgdG8gRGllZ28gUGVyaW5pIGZvciB0aGUgbm9kZU5hbWUgc2hvcnRjdXQNCiAgICAgICAgICAgICAgICAgICAgLy8gICBHcmVhdGVyIHRoYW4gIkAiIG1lYW5zIGFscGhhIGNoYXJhY3RlcnMgKHNwZWNpZmljYWxseSBub3Qgc3RhcnRpbmcgd2l0aCAiIyIgb3IgIj8iKQ0KICAgICAgICAgICAgICAgICAgICBmb3IgKCBlbGVtID0gZWxlbS5maXJzdENoaWxkOyBlbGVtOyBlbGVtID0gZWxlbS5uZXh0U2libGluZyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZWxlbS5ub2RlTmFtZSA+ICJAIiB8fCBlbGVtLm5vZGVUeXBlID09PSAzIHx8IGVsZW0ubm9kZVR5cGUgPT09IDQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgICAgICJwYXJlbnQiOiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFFeHByLnBzZXVkb3NbImVtcHR5Il0oIGVsZW0gKTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBFbGVtZW50L2lucHV0IHR5cGVzDQogICAgICAgICAgICAgICAgImhlYWRlciI6IGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmhlYWRlci50ZXN0KCBlbGVtLm5vZGVOYW1lICk7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgImlucHV0IjogZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiByaW5wdXRzLnRlc3QoIGVsZW0ubm9kZU5hbWUgKTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAiYnV0dG9uIjogZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmFtZSA9PT0gImlucHV0IiAmJiBlbGVtLnR5cGUgPT09ICJidXR0b24iIHx8IG5hbWUgPT09ICJidXR0b24iOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgICAgICJ0ZXh0IjogZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBhdHRyOw0KICAgICAgICAgICAgICAgICAgICAvLyBJRTYgYW5kIDcgd2lsbCBtYXAgZWxlbS50eXBlIHRvICd0ZXh0JyBmb3IgbmV3IEhUTUw1IHR5cGVzIChzZWFyY2gsIGV0YykNCiAgICAgICAgICAgICAgICAgICAgLy8gdXNlIGdldEF0dHJpYnV0ZSBpbnN0ZWFkIHRvIHRlc3QgdGhpcyBjYXNlDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJpbnB1dCIgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0udHlwZSA9PT0gInRleHQiICYmDQogICAgICAgICAgICAgICAgICAgICAgICAoIChhdHRyID0gZWxlbS5nZXRBdHRyaWJ1dGUoInR5cGUiKSkgPT0gbnVsbCB8fCBhdHRyLnRvTG93ZXJDYXNlKCkgPT09IGVsZW0udHlwZSApOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uLWluLWNvbGxlY3Rpb24NCiAgICAgICAgICAgICAgICAiZmlyc3QiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWyAwIF07DQogICAgICAgICAgICAgICAgfSksDQogICAgICAgIA0KICAgICAgICAgICAgICAgICJsYXN0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGggKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBbIGxlbmd0aCAtIDEgXTsNCiAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgImVxIjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50ICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWyBhcmd1bWVudCA8IDAgPyBhcmd1bWVudCArIGxlbmd0aCA6IGFyZ3VtZW50IF07DQogICAgICAgICAgICAgICAgfSksDQogICAgICAgIA0KICAgICAgICAgICAgICAgICJldmVuIjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGggKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBpID0gMDsNCiAgICAgICAgICAgICAgICAgICAgZm9yICggOyBpIDwgbGVuZ3RoOyBpICs9IDIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaEluZGV4ZXMucHVzaCggaSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaEluZGV4ZXM7DQogICAgICAgICAgICAgICAgfSksDQogICAgICAgIA0KICAgICAgICAgICAgICAgICJvZGQiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAxOw0KICAgICAgICAgICAgICAgICAgICBmb3IgKCA7IGkgPCBsZW5ndGg7IGkgKz0gMiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoSW5kZXhlcy5wdXNoKCBpICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoSW5kZXhlczsNCiAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgImx0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50ICkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQ7DQogICAgICAgICAgICAgICAgICAgIGZvciAoIDsgLS1pID49IDA7ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hJbmRleGVzOw0KICAgICAgICAgICAgICAgIH0pLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAiZ3QiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBpID0gYXJndW1lbnQgPCAwID8gYXJndW1lbnQgKyBsZW5ndGggOiBhcmd1bWVudDsNCiAgICAgICAgICAgICAgICAgICAgZm9yICggOyArK2kgPCBsZW5ndGg7ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hJbmRleGVzOw0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAvLyBBZGQgYnV0dG9uL2lucHV0IHR5cGUgcHNldWRvcw0KICAgICAgICBmb3IgKCBpIGluIHsgcmFkaW86IHRydWUsIGNoZWNrYm94OiB0cnVlLCBmaWxlOiB0cnVlLCBwYXNzd29yZDogdHJ1ZSwgaW1hZ2U6IHRydWUgfSApIHsNCiAgICAgICAgICAgIEV4cHIucHNldWRvc1sgaSBdID0gY3JlYXRlSW5wdXRQc2V1ZG8oIGkgKTsNCiAgICAgICAgfQ0KICAgICAgICBmb3IgKCBpIGluIHsgc3VibWl0OiB0cnVlLCByZXNldDogdHJ1ZSB9ICkgew0KICAgICAgICAgICAgRXhwci5wc2V1ZG9zWyBpIF0gPSBjcmVhdGVCdXR0b25Qc2V1ZG8oIGkgKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gdG9rZW5pemUoIHNlbGVjdG9yLCBwYXJzZU9ubHkgKSB7DQogICAgICAgICAgICB2YXIgbWF0Y2hlZCwgbWF0Y2gsIHRva2VucywgdHlwZSwNCiAgICAgICAgICAgICAgICBzb0ZhciwgZ3JvdXBzLCBwcmVGaWx0ZXJzLA0KICAgICAgICAgICAgICAgIGNhY2hlZCA9IHRva2VuQ2FjaGVbIHNlbGVjdG9yICsgIiAiIF07DQogICAgICAgIA0KICAgICAgICAgICAgaWYgKCBjYWNoZWQgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlT25seSA/IDAgOiBjYWNoZWQuc2xpY2UoIDAgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBzb0ZhciA9IHNlbGVjdG9yOw0KICAgICAgICAgICAgZ3JvdXBzID0gW107DQogICAgICAgICAgICBwcmVGaWx0ZXJzID0gRXhwci5wcmVGaWx0ZXI7DQogICAgICAgIA0KICAgICAgICAgICAgd2hpbGUgKCBzb0ZhciApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQ29tbWEgYW5kIGZpcnN0IHJ1bg0KICAgICAgICAgICAgICAgIGlmICggIW1hdGNoZWQgfHwgKG1hdGNoID0gcmNvbW1hLmV4ZWMoIHNvRmFyICkpICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIG1hdGNoICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG9uJ3QgY29uc3VtZSB0cmFpbGluZyBjb21tYXMgYXMgdmFsaWQNCiAgICAgICAgICAgICAgICAgICAgICAgIHNvRmFyID0gc29GYXIuc2xpY2UoIG1hdGNoWzBdLmxlbmd0aCApIHx8IHNvRmFyOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGdyb3Vwcy5wdXNoKCB0b2tlbnMgPSBbXSApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgbWF0Y2hlZCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBDb21iaW5hdG9ycw0KICAgICAgICAgICAgICAgIGlmICggKG1hdGNoID0gcmNvbWJpbmF0b3JzLmV4ZWMoIHNvRmFyICkpICkgew0KICAgICAgICAgICAgICAgICAgICBtYXRjaGVkID0gbWF0Y2guc2hpZnQoKTsNCiAgICAgICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBtYXRjaGVkLA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FzdCBkZXNjZW5kYW50IGNvbWJpbmF0b3JzIHRvIHNwYWNlDQogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBtYXRjaFswXS5yZXBsYWNlKCBydHJpbSwgIiAiICkNCiAgICAgICAgICAgICAgICAgICAgfSApOw0KICAgICAgICAgICAgICAgICAgICBzb0ZhciA9IHNvRmFyLnNsaWNlKCBtYXRjaGVkLmxlbmd0aCApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gRmlsdGVycw0KICAgICAgICAgICAgICAgIGZvciAoIHR5cGUgaW4gRXhwci5maWx0ZXIgKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggKG1hdGNoID0gbWF0Y2hFeHByWyB0eXBlIF0uZXhlYyggc29GYXIgKSkgJiYgKCFwcmVGaWx0ZXJzWyB0eXBlIF0gfHwNCiAgICAgICAgICAgICAgICAgICAgICAgIChtYXRjaCA9IHByZUZpbHRlcnNbIHR5cGUgXSggbWF0Y2ggKSkpICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZCA9IG1hdGNoLnNoaWZ0KCk7DQogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnMucHVzaCggew0KICAgICAgICAgICAgICAgICAgICAgICAgCXZhbHVlOiBtYXRjaGVkLA0KICAgICAgICAgICAgICAgICAgICAgICAgCXR5cGU6IHR5cGUsDQogICAgICAgICAgICAgICAgICAgICAgICAJbWF0Y2hlczogbWF0Y2gNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNvRmFyID0gc29GYXIuc2xpY2UoIG1hdGNoZWQubGVuZ3RoICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggIW1hdGNoZWQgKSB7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAvLyBSZXR1cm4gdGhlIGxlbmd0aCBvZiB0aGUgaW52YWxpZCBleGNlc3MNCiAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGp1c3QgcGFyc2luZw0KICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCB0aHJvdyBhbiBlcnJvciBvciByZXR1cm4gdG9rZW5zDQogICAgICAgICAgICByZXR1cm4gcGFyc2VPbmx5ID8NCiAgICAgICAgICAgICAgICBzb0Zhci5sZW5ndGggOg0KICAgICAgICAgICAgICAgIHNvRmFyID8NCiAgICAgICAgICAgICAgICAgICAgU2l6emxlLmVycm9yKCBzZWxlY3RvciApIDoNCiAgICAgICAgICAgICAgICAgICAgLy8gQ2FjaGUgdGhlIHRva2Vucw0KICAgICAgICAgICAgICAgICAgICB0b2tlbkNhY2hlKCBzZWxlY3RvciwgZ3JvdXBzICkuc2xpY2UoIDAgKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gdG9TZWxlY3RvciggdG9rZW5zICkgew0KICAgICAgICAgICAgdmFyIGkgPSAwLA0KICAgICAgICAgICAgICAgIGxlbiA9IHRva2Vucy5sZW5ndGgsDQogICAgICAgICAgICAgICAgc2VsZWN0b3IgPSAiIjsNCiAgICAgICAgICAgIGZvciAoIDsgaSA8IGxlbjsgaSsrICkgew0KICAgICAgICAgICAgICAgIHNlbGVjdG9yICs9IHRva2Vuc1tpXS52YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBzZWxlY3RvcjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gYWRkQ29tYmluYXRvciggbWF0Y2hlciwgY29tYmluYXRvciwgYmFzZSApIHsNCiAgICAgICAgICAgIHZhciBkaXIgPSBjb21iaW5hdG9yLmRpciwNCiAgICAgICAgICAgICAgICBjaGVja05vbkVsZW1lbnRzID0gYmFzZSAmJiBkaXIgPT09ICJwYXJlbnROb2RlIiwNCiAgICAgICAgICAgICAgICBkb25lTmFtZSA9IGRvbmUrKzsNCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gY29tYmluYXRvci5maXJzdCA/DQogICAgICAgICAgICAgICAgLy8gQ2hlY2sgYWdhaW5zdCBjbG9zZXN0IGFuY2VzdG9yL3ByZWNlZGluZyBlbGVtZW50DQogICAgICAgICAgICAgICAgZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHsNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCXJldHVybiBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gOg0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBDaGVjayBhZ2FpbnN0IGFsbCBhbmNlc3Rvci9wcmVjZWRpbmcgZWxlbWVudHMNCiAgICAgICAgICAgICAgICBmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSwgY2FjaGUsIG91dGVyQ2FjaGUsDQogICAgICAgICAgICAgICAgICAgICAgICBkaXJrZXkgPSBkaXJydW5zICsgIiAiICsgZG9uZU5hbWU7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBXZSBjYW4ndCBzZXQgYXJiaXRyYXJ5IGRhdGEgb24gWE1MIG5vZGVzLCBzbyB0aGV5IGRvbid0IGJlbmVmaXQgZnJvbSBkaXIgY2FjaGluZw0KICAgICAgICAgICAgICAgICAgICBpZiAoIHhtbCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICggKGVsZW0gPSBlbGVtWyBkaXIgXSkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxIHx8IGNoZWNrTm9uRWxlbWVudHMgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWlmICggbWF0Y2hlciggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQlyZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICggKGVsZW0gPSBlbGVtWyBkaXIgXSkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxIHx8IGNoZWNrTm9uRWxlbWVudHMgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCW91dGVyQ2FjaGUgPSBlbGVtWyBleHBhbmRvIF0gfHwgKGVsZW1bIGV4cGFuZG8gXSA9IHt9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJaWYgKCAoY2FjaGUgPSBvdXRlckNhY2hlWyBkaXIgXSkgJiYgY2FjaGVbMF0gPT09IGRpcmtleSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWlmICggKGRhdGEgPSBjYWNoZVsxXSkgPT09IHRydWUgfHwgZGF0YSA9PT0gY2FjaGVkcnVucyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQlyZXR1cm4gZGF0YSA9PT0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWNhY2hlID0gb3V0ZXJDYWNoZVsgZGlyIF0gPSBbIGRpcmtleSBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJY2FjaGVbMV0gPSBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB8fCBjYWNoZWRydW5zOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJaWYgKCBjYWNoZVsxXSA9PT0gdHJ1ZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQlyZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApIHsNCiAgICAgICAgICAgIHJldHVybiBtYXRjaGVycy5sZW5ndGggPiAxID8NCiAgICAgICAgICAgICAgICBmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IG1hdGNoZXJzLmxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCBpLS0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFtYXRjaGVyc1tpXSggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0gOg0KICAgICAgICAgICAgICAgIG1hdGNoZXJzWzBdOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBjb25kZW5zZSggdW5tYXRjaGVkLCBtYXAsIGZpbHRlciwgY29udGV4dCwgeG1sICkgew0KICAgICAgICAgICAgdmFyIGVsZW0sDQogICAgICAgICAgICAgICAgbmV3VW5tYXRjaGVkID0gW10sDQogICAgICAgICAgICAgICAgaSA9IDAsDQogICAgICAgICAgICAgICAgbGVuID0gdW5tYXRjaGVkLmxlbmd0aCwNCiAgICAgICAgICAgICAgICBtYXBwZWQgPSBtYXAgIT0gbnVsbDsNCiAgICAgICAgDQogICAgICAgICAgICBmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsNCiAgICAgICAgICAgICAgICBpZiAoIChlbGVtID0gdW5tYXRjaGVkW2ldKSApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhZmlsdGVyIHx8IGZpbHRlciggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBuZXdVbm1hdGNoZWQucHVzaCggZWxlbSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBtYXBwZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJbWFwLnB1c2goIGkgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gbmV3VW5tYXRjaGVkOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBzZXRNYXRjaGVyKCBwcmVGaWx0ZXIsIHNlbGVjdG9yLCBtYXRjaGVyLCBwb3N0RmlsdGVyLCBwb3N0RmluZGVyLCBwb3N0U2VsZWN0b3IgKSB7DQogICAgICAgICAgICBpZiAoIHBvc3RGaWx0ZXIgJiYgIXBvc3RGaWx0ZXJbIGV4cGFuZG8gXSApIHsNCiAgICAgICAgICAgICAgICBwb3N0RmlsdGVyID0gc2V0TWF0Y2hlciggcG9zdEZpbHRlciApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCBwb3N0RmluZGVyICYmICFwb3N0RmluZGVyWyBleHBhbmRvIF0gKSB7DQogICAgICAgICAgICAgICAgcG9zdEZpbmRlciA9IHNldE1hdGNoZXIoIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3RvciApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgcmVzdWx0cywgY29udGV4dCwgeG1sICkgew0KICAgICAgICAgICAgICAgIHZhciB0ZW1wLCBpLCBlbGVtLA0KICAgICAgICAgICAgICAgICAgICBwcmVNYXAgPSBbXSwNCiAgICAgICAgICAgICAgICAgICAgcG9zdE1hcCA9IFtdLA0KICAgICAgICAgICAgICAgICAgICBwcmVleGlzdGluZyA9IHJlc3VsdHMubGVuZ3RoLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gR2V0IGluaXRpYWwgZWxlbWVudHMgZnJvbSBzZWVkIG9yIGNvbnRleHQNCiAgICAgICAgICAgICAgICAgICAgZWxlbXMgPSBzZWVkIHx8IG11bHRpcGxlQ29udGV4dHMoIHNlbGVjdG9yIHx8ICIqIiwgY29udGV4dC5ub2RlVHlwZSA/IFsgY29udGV4dCBdIDogY29udGV4dCwgW10gKSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFByZWZpbHRlciB0byBnZXQgbWF0Y2hlciBpbnB1dCwgcHJlc2VydmluZyBhIG1hcCBmb3Igc2VlZC1yZXN1bHRzIHN5bmNocm9uaXphdGlvbg0KICAgICAgICAgICAgICAgICAgICBtYXRjaGVySW4gPSBwcmVGaWx0ZXIgJiYgKCBzZWVkIHx8ICFzZWxlY3RvciApID8NCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRlbnNlKCBlbGVtcywgcHJlTWFwLCBwcmVGaWx0ZXIsIGNvbnRleHQsIHhtbCApIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1zLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlck91dCA9IG1hdGNoZXIgPw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIHBvc3RGaW5kZXIsIG9yIGZpbHRlcmVkIHNlZWQsIG9yIG5vbi1zZWVkIHBvc3RGaWx0ZXIgb3IgcHJlZXhpc3RpbmcgcmVzdWx0cywNCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RGaW5kZXIgfHwgKCBzZWVkID8gcHJlRmlsdGVyIDogcHJlZXhpc3RpbmcgfHwgcG9zdEZpbHRlciApID8NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gLi4uaW50ZXJtZWRpYXRlIHByb2Nlc3NpbmcgaXMgbmVjZXNzYXJ5DQogICAgICAgICAgICAgICAgICAgICAgICAJW10gOg0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyAuLi5vdGhlcndpc2UgdXNlIHJlc3VsdHMgZGlyZWN0bHkNCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZXN1bHRzIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXJJbjsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gRmluZCBwcmltYXJ5IG1hdGNoZXMNCiAgICAgICAgICAgICAgICBpZiAoIG1hdGNoZXIgKSB7DQogICAgICAgICAgICAgICAgICAgIG1hdGNoZXIoIG1hdGNoZXJJbiwgbWF0Y2hlck91dCwgY29udGV4dCwgeG1sICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBBcHBseSBwb3N0RmlsdGVyDQogICAgICAgICAgICAgICAgaWYgKCBwb3N0RmlsdGVyICkgew0KICAgICAgICAgICAgICAgICAgICB0ZW1wID0gY29uZGVuc2UoIG1hdGNoZXJPdXQsIHBvc3RNYXAgKTsNCiAgICAgICAgICAgICAgICAgICAgcG9zdEZpbHRlciggdGVtcCwgW10sIGNvbnRleHQsIHhtbCApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gVW4tbWF0Y2ggZmFpbGluZyBlbGVtZW50cyBieSBtb3ZpbmcgdGhlbSBiYWNrIHRvIG1hdGNoZXJJbg0KICAgICAgICAgICAgICAgICAgICBpID0gdGVtcC5sZW5ndGg7DQogICAgICAgICAgICAgICAgICAgIHdoaWxlICggaS0tICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAoZWxlbSA9IHRlbXBbaV0pICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCW1hdGNoZXJPdXRbIHBvc3RNYXBbaV0gXSA9ICEobWF0Y2hlckluWyBwb3N0TWFwW2ldIF0gPSBlbGVtKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCBzZWVkICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIHBvc3RGaW5kZXIgfHwgcHJlRmlsdGVyICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBwb3N0RmluZGVyICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIEdldCB0aGUgZmluYWwgbWF0Y2hlck91dCBieSBjb25kZW5zaW5nIHRoaXMgaW50ZXJtZWRpYXRlIGludG8gcG9zdEZpbmRlciBjb250ZXh0cw0KICAgICAgICAgICAgICAgICAgICAgICAgCXRlbXAgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpID0gbWF0Y2hlck91dC5sZW5ndGg7DQogICAgICAgICAgICAgICAgICAgICAgICAJd2hpbGUgKCBpLS0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWlmICggKGVsZW0gPSBtYXRjaGVyT3V0W2ldKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCS8vIFJlc3RvcmUgbWF0Y2hlckluIHNpbmNlIGVsZW0gaXMgbm90IHlldCBhIGZpbmFsIG1hdGNoDQogICAgICAgICAgICAgICAgICAgICAgICAJCQl0ZW1wLnB1c2goIChtYXRjaGVySW5baV0gPSBlbGVtKSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCXBvc3RGaW5kZXIoIG51bGwsIChtYXRjaGVyT3V0ID0gW10pLCB0ZW1wLCB4bWwgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBNb3ZlIG1hdGNoZWQgZWxlbWVudHMgZnJvbSBzZWVkIHRvIHJlc3VsdHMgdG8ga2VlcCB0aGVtIHN5bmNocm9uaXplZA0KICAgICAgICAgICAgICAgICAgICAgICAgaSA9IG1hdGNoZXJPdXQubGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCBpLS0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCAoZWxlbSA9IG1hdGNoZXJPdXRbaV0pICYmDQogICAgICAgICAgICAgICAgICAgICAgICAJCSh0ZW1wID0gcG9zdEZpbmRlciA/IGluZGV4T2YuY2FsbCggc2VlZCwgZWxlbSApIDogcHJlTWFwW2ldKSA+IC0xICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJc2VlZFt0ZW1wXSA9ICEocmVzdWx0c1t0ZW1wXSA9IGVsZW0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBBZGQgZWxlbWVudHMgdG8gcmVzdWx0cywgdGhyb3VnaCBwb3N0RmluZGVyIGlmIGRlZmluZWQNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBtYXRjaGVyT3V0ID0gY29uZGVuc2UoDQogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVyT3V0ID09PSByZXN1bHRzID8NCiAgICAgICAgICAgICAgICAgICAgICAgIAltYXRjaGVyT3V0LnNwbGljZSggcHJlZXhpc3RpbmcsIG1hdGNoZXJPdXQubGVuZ3RoICkgOg0KICAgICAgICAgICAgICAgICAgICAgICAgCW1hdGNoZXJPdXQNCiAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBwb3N0RmluZGVyICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcG9zdEZpbmRlciggbnVsbCwgcmVzdWx0cywgbWF0Y2hlck91dCwgeG1sICk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBwdXNoLmFwcGx5KCByZXN1bHRzLCBtYXRjaGVyT3V0ICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gbWF0Y2hlckZyb21Ub2tlbnMoIHRva2VucyApIHsNCiAgICAgICAgICAgIHZhciBjaGVja0NvbnRleHQsIG1hdGNoZXIsIGosDQogICAgICAgICAgICAgICAgbGVuID0gdG9rZW5zLmxlbmd0aCwNCiAgICAgICAgICAgICAgICBsZWFkaW5nUmVsYXRpdmUgPSBFeHByLnJlbGF0aXZlWyB0b2tlbnNbMF0udHlwZSBdLA0KICAgICAgICAgICAgICAgIGltcGxpY2l0UmVsYXRpdmUgPSBsZWFkaW5nUmVsYXRpdmUgfHwgRXhwci5yZWxhdGl2ZVsiICJdLA0KICAgICAgICAgICAgICAgIGkgPSBsZWFkaW5nUmVsYXRpdmUgPyAxIDogMCwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gVGhlIGZvdW5kYXRpb25hbCBtYXRjaGVyIGVuc3VyZXMgdGhhdCBlbGVtZW50cyBhcmUgcmVhY2hhYmxlIGZyb20gdG9wLWxldmVsIGNvbnRleHQocykNCiAgICAgICAgICAgICAgICBtYXRjaENvbnRleHQgPSBhZGRDb21iaW5hdG9yKCBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0gPT09IGNoZWNrQ29udGV4dDsNCiAgICAgICAgICAgICAgICB9LCBpbXBsaWNpdFJlbGF0aXZlLCB0cnVlICksDQogICAgICAgICAgICAgICAgbWF0Y2hBbnlDb250ZXh0ID0gYWRkQ29tYmluYXRvciggZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmRleE9mLmNhbGwoIGNoZWNrQ29udGV4dCwgZWxlbSApID4gLTE7DQogICAgICAgICAgICAgICAgfSwgaW1wbGljaXRSZWxhdGl2ZSwgdHJ1ZSApLA0KICAgICAgICAgICAgICAgIG1hdGNoZXJzID0gWyBmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCAhbGVhZGluZ1JlbGF0aXZlICYmICggeG1sIHx8IGNvbnRleHQgIT09IG91dGVybW9zdENvbnRleHQgKSApIHx8ICgNCiAgICAgICAgICAgICAgICAgICAgICAgIChjaGVja0NvbnRleHQgPSBjb250ZXh0KS5ub2RlVHlwZSA/DQogICAgICAgICAgICAgICAgICAgICAgICAJbWF0Y2hDb250ZXh0KCBlbGVtLCBjb250ZXh0LCB4bWwgKSA6DQogICAgICAgICAgICAgICAgICAgICAgICAJbWF0Y2hBbnlDb250ZXh0KCBlbGVtLCBjb250ZXh0LCB4bWwgKSApOw0KICAgICAgICAgICAgICAgIH0gXTsNCiAgICAgICAgDQogICAgICAgICAgICBmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsNCiAgICAgICAgICAgICAgICBpZiAoIChtYXRjaGVyID0gRXhwci5yZWxhdGl2ZVsgdG9rZW5zW2ldLnR5cGUgXSkgKSB7DQogICAgICAgICAgICAgICAgICAgIG1hdGNoZXJzID0gWyBhZGRDb21iaW5hdG9yKGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApLCBtYXRjaGVyKSBdOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIG1hdGNoZXIgPSBFeHByLmZpbHRlclsgdG9rZW5zW2ldLnR5cGUgXS5hcHBseSggbnVsbCwgdG9rZW5zW2ldLm1hdGNoZXMgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBzcGVjaWFsIHVwb24gc2VlaW5nIGEgcG9zaXRpb25hbCBtYXRjaGVyDQogICAgICAgICAgICAgICAgICAgIGlmICggbWF0Y2hlclsgZXhwYW5kbyBdICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmluZCB0aGUgbmV4dCByZWxhdGl2ZSBvcGVyYXRvciAoaWYgYW55KSBmb3IgcHJvcGVyIGhhbmRsaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBqID0gKytpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggOyBqIDwgbGVuOyBqKysgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBFeHByLnJlbGF0aXZlWyB0b2tlbnNbal0udHlwZSBdICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2V0TWF0Y2hlcigNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpID4gMSAmJiBlbGVtZW50TWF0Y2hlciggbWF0Y2hlcnMgKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpID4gMSAmJiB0b1NlbGVjdG9yKCB0b2tlbnMuc2xpY2UoIDAsIGkgLSAxICkgKS5yZXBsYWNlKCBydHJpbSwgIiQxIiApLA0KICAgICAgICAgICAgICAgICAgICAgICAgCW1hdGNoZXIsDQogICAgICAgICAgICAgICAgICAgICAgICAJaSA8IGogJiYgbWF0Y2hlckZyb21Ub2tlbnMoIHRva2Vucy5zbGljZSggaSwgaiApICksDQogICAgICAgICAgICAgICAgICAgICAgICAJaiA8IGxlbiAmJiBtYXRjaGVyRnJvbVRva2VucyggKHRva2VucyA9IHRva2Vucy5zbGljZSggaiApKSApLA0KICAgICAgICAgICAgICAgICAgICAgICAgCWogPCBsZW4gJiYgdG9TZWxlY3RvciggdG9rZW5zICkNCiAgICAgICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcnMucHVzaCggbWF0Y2hlciApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIG1hdGNoZXJGcm9tR3JvdXBNYXRjaGVycyggZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycyApIHsNCiAgICAgICAgICAgIC8vIEEgY291bnRlciB0byBzcGVjaWZ5IHdoaWNoIGVsZW1lbnQgaXMgY3VycmVudGx5IGJlaW5nIG1hdGNoZWQNCiAgICAgICAgICAgIHZhciBtYXRjaGVyQ2FjaGVkUnVucyA9IDAsDQogICAgICAgICAgICAgICAgYnlTZXQgPSBzZXRNYXRjaGVycy5sZW5ndGggPiAwLA0KICAgICAgICAgICAgICAgIGJ5RWxlbWVudCA9IGVsZW1lbnRNYXRjaGVycy5sZW5ndGggPiAwLA0KICAgICAgICAgICAgICAgIHN1cGVyTWF0Y2hlciA9IGZ1bmN0aW9uKCBzZWVkLCBjb250ZXh0LCB4bWwsIHJlc3VsdHMsIGV4cGFuZENvbnRleHQgKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBlbGVtLCBqLCBtYXRjaGVyLA0KICAgICAgICAgICAgICAgICAgICAgICAgc2V0TWF0Y2hlZCA9IFtdLA0KICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZENvdW50ID0gMCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSAiMCIsDQogICAgICAgICAgICAgICAgICAgICAgICB1bm1hdGNoZWQgPSBzZWVkICYmIFtdLA0KICAgICAgICAgICAgICAgICAgICAgICAgb3V0ZXJtb3N0ID0gZXhwYW5kQ29udGV4dCAhPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dEJhY2t1cCA9IG91dGVybW9zdENvbnRleHQsDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBtdXN0IGFsd2F5cyBoYXZlIGVpdGhlciBzZWVkIGVsZW1lbnRzIG9yIGNvbnRleHQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1zID0gc2VlZCB8fCBieUVsZW1lbnQgJiYgRXhwci5maW5kWyJUQUciXSggIioiLCBleHBhbmRDb250ZXh0ICYmIGNvbnRleHQucGFyZW50Tm9kZSB8fCBjb250ZXh0ICksDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBVc2UgaW50ZWdlciBkaXJydW5zIGlmZiB0aGlzIGlzIHRoZSBvdXRlcm1vc3QgbWF0Y2hlcg0KICAgICAgICAgICAgICAgICAgICAgICAgZGlycnVuc1VuaXF1ZSA9IChkaXJydW5zICs9IGNvbnRleHRCYWNrdXAgPT0gbnVsbCA/IDEgOiBNYXRoLnJhbmRvbSgpIHx8IDAuMSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoIG91dGVybW9zdCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG91dGVybW9zdENvbnRleHQgPSBjb250ZXh0ICE9PSBkb2N1bWVudCAmJiBjb250ZXh0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkcnVucyA9IG1hdGNoZXJDYWNoZWRSdW5zOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBBZGQgZWxlbWVudHMgcGFzc2luZyBlbGVtZW50TWF0Y2hlcnMgZGlyZWN0bHkgdG8gcmVzdWx0cw0KICAgICAgICAgICAgICAgICAgICAvLyBLZWVwIGBpYCBhIHN0cmluZyBpZiB0aGVyZSBhcmUgbm8gZWxlbWVudHMgc28gYG1hdGNoZWRDb3VudGAgd2lsbCBiZSAiMDAiIGJlbG93DQogICAgICAgICAgICAgICAgICAgIGZvciAoIDsgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBieUVsZW1lbnQgJiYgZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlqID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl3aGlsZSAoIChtYXRjaGVyID0gZWxlbWVudE1hdGNoZXJzW2orK10pICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlpZiAoIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQlicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIG91dGVybW9zdCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWNhY2hlZHJ1bnMgPSArK21hdGNoZXJDYWNoZWRSdW5zOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBUcmFjayB1bm1hdGNoZWQgZWxlbWVudHMgZm9yIHNldCBmaWx0ZXJzDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGJ5U2V0ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIFRoZXkgd2lsbCBoYXZlIGdvbmUgdGhyb3VnaCBhbGwgcG9zc2libGUgbWF0Y2hlcnMNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIChlbGVtID0gIW1hdGNoZXIgJiYgZWxlbSkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCW1hdGNoZWRDb3VudC0tOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gTGVuZ3RoZW4gdGhlIGFycmF5IGZvciBldmVyeSBlbGVtZW50LCBtYXRjaGVkIG9yIG5vdA0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggc2VlZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJdW5tYXRjaGVkLnB1c2goIGVsZW0gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEFwcGx5IHNldCBmaWx0ZXJzIHRvIHVubWF0Y2hlZCBlbGVtZW50cw0KICAgICAgICAgICAgICAgICAgICBtYXRjaGVkQ291bnQgKz0gaTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBieVNldCAmJiBpICE9PSBtYXRjaGVkQ291bnQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBqID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICggKG1hdGNoZXIgPSBzZXRNYXRjaGVyc1tqKytdKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAltYXRjaGVyKCB1bm1hdGNoZWQsIHNldE1hdGNoZWQsIGNvbnRleHQsIHhtbCApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc2VlZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBSZWludGVncmF0ZSBlbGVtZW50IG1hdGNoZXMgdG8gZWxpbWluYXRlIHRoZSBuZWVkIGZvciBzb3J0aW5nDQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBtYXRjaGVkQ291bnQgPiAwICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQl3aGlsZSAoIGktLSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWlmICggISh1bm1hdGNoZWRbaV0gfHwgc2V0TWF0Y2hlZFtpXSkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJc2V0TWF0Y2hlZFtpXSA9IHBvcC5jYWxsKCByZXN1bHRzICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIERpc2NhcmQgaW5kZXggcGxhY2Vob2xkZXIgdmFsdWVzIHRvIGdldCBvbmx5IGFjdHVhbCBtYXRjaGVzDQogICAgICAgICAgICAgICAgICAgICAgICAJc2V0TWF0Y2hlZCA9IGNvbmRlbnNlKCBzZXRNYXRjaGVkICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIG1hdGNoZXMgdG8gcmVzdWx0cw0KICAgICAgICAgICAgICAgICAgICAgICAgcHVzaC5hcHBseSggcmVzdWx0cywgc2V0TWF0Y2hlZCApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNlZWRsZXNzIHNldCBtYXRjaGVzIHN1Y2NlZWRpbmcgbXVsdGlwbGUgc3VjY2Vzc2Z1bCBtYXRjaGVycyBzdGlwdWxhdGUgc29ydGluZw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBvdXRlcm1vc3QgJiYgIXNlZWQgJiYgc2V0TWF0Y2hlZC5sZW5ndGggPiAwICYmDQogICAgICAgICAgICAgICAgICAgICAgICAJKCBtYXRjaGVkQ291bnQgKyBzZXRNYXRjaGVycy5sZW5ndGggKSA+IDEgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCVNpenpsZS51bmlxdWVTb3J0KCByZXN1bHRzICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIE92ZXJyaWRlIG1hbmlwdWxhdGlvbiBvZiBnbG9iYWxzIGJ5IG5lc3RlZCBtYXRjaGVycw0KICAgICAgICAgICAgICAgICAgICBpZiAoIG91dGVybW9zdCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRpcnJ1bnMgPSBkaXJydW5zVW5pcXVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgb3V0ZXJtb3N0Q29udGV4dCA9IGNvbnRleHRCYWNrdXA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiB1bm1hdGNoZWQ7DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gYnlTZXQgPw0KICAgICAgICAgICAgICAgIG1hcmtGdW5jdGlvbiggc3VwZXJNYXRjaGVyICkgOg0KICAgICAgICAgICAgICAgIHN1cGVyTWF0Y2hlcjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgY29tcGlsZSA9IFNpenpsZS5jb21waWxlID0gZnVuY3Rpb24oIHNlbGVjdG9yLCBncm91cCAvKiBJbnRlcm5hbCBVc2UgT25seSAqLyApIHsNCiAgICAgICAgICAgIHZhciBpLA0KICAgICAgICAgICAgICAgIHNldE1hdGNoZXJzID0gW10sDQogICAgICAgICAgICAgICAgZWxlbWVudE1hdGNoZXJzID0gW10sDQogICAgICAgICAgICAgICAgY2FjaGVkID0gY29tcGlsZXJDYWNoZVsgc2VsZWN0b3IgKyAiICIgXTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAoICFjYWNoZWQgKSB7DQogICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgYSBmdW5jdGlvbiBvZiByZWN1cnNpdmUgZnVuY3Rpb25zIHRoYXQgY2FuIGJlIHVzZWQgdG8gY2hlY2sgZWFjaCBlbGVtZW50DQogICAgICAgICAgICAgICAgaWYgKCAhZ3JvdXAgKSB7DQogICAgICAgICAgICAgICAgICAgIGdyb3VwID0gdG9rZW5pemUoIHNlbGVjdG9yICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGkgPSBncm91cC5sZW5ndGg7DQogICAgICAgICAgICAgICAgd2hpbGUgKCBpLS0gKSB7DQogICAgICAgICAgICAgICAgICAgIGNhY2hlZCA9IG1hdGNoZXJGcm9tVG9rZW5zKCBncm91cFtpXSApOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIGNhY2hlZFsgZXhwYW5kbyBdICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2V0TWF0Y2hlcnMucHVzaCggY2FjaGVkICk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50TWF0Y2hlcnMucHVzaCggY2FjaGVkICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIENhY2hlIHRoZSBjb21waWxlZCBmdW5jdGlvbg0KICAgICAgICAgICAgICAgIGNhY2hlZCA9IGNvbXBpbGVyQ2FjaGUoIHNlbGVjdG9yLCBtYXRjaGVyRnJvbUdyb3VwTWF0Y2hlcnMoIGVsZW1lbnRNYXRjaGVycywgc2V0TWF0Y2hlcnMgKSApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGNhY2hlZDsNCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIG11bHRpcGxlQ29udGV4dHMoIHNlbGVjdG9yLCBjb250ZXh0cywgcmVzdWx0cyApIHsNCiAgICAgICAgICAgIHZhciBpID0gMCwNCiAgICAgICAgICAgICAgICBsZW4gPSBjb250ZXh0cy5sZW5ndGg7DQogICAgICAgICAgICBmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsNCiAgICAgICAgICAgICAgICBTaXp6bGUoIHNlbGVjdG9yLCBjb250ZXh0c1tpXSwgcmVzdWx0cyApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIHNlbGVjdCggc2VsZWN0b3IsIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQgKSB7DQogICAgICAgICAgICB2YXIgaSwgdG9rZW5zLCB0b2tlbiwgdHlwZSwgZmluZCwNCiAgICAgICAgICAgICAgICBtYXRjaCA9IHRva2VuaXplKCBzZWxlY3RvciApOw0KICAgICAgICANCiAgICAgICAgICAgIGlmICggIXNlZWQgKSB7DQogICAgICAgICAgICAgICAgLy8gVHJ5IHRvIG1pbmltaXplIG9wZXJhdGlvbnMgaWYgdGhlcmUgaXMgb25seSBvbmUgZ3JvdXANCiAgICAgICAgICAgICAgICBpZiAoIG1hdGNoLmxlbmd0aCA9PT0gMSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFRha2UgYSBzaG9ydGN1dCBhbmQgc2V0IHRoZSBjb250ZXh0IGlmIHRoZSByb290IHNlbGVjdG9yIGlzIGFuIElEDQogICAgICAgICAgICAgICAgICAgIHRva2VucyA9IG1hdGNoWzBdID0gbWF0Y2hbMF0uc2xpY2UoIDAgKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCB0b2tlbnMubGVuZ3RoID4gMiAmJiAodG9rZW4gPSB0b2tlbnNbMF0pLnR5cGUgPT09ICJJRCIgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIAljb250ZXh0Lm5vZGVUeXBlID09PSA5ICYmICFkb2N1bWVudElzWE1MICYmDQogICAgICAgICAgICAgICAgICAgICAgICAJRXhwci5yZWxhdGl2ZVsgdG9rZW5zWzFdLnR5cGUgXSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gRXhwci5maW5kWyJJRCJdKCB0b2tlbi5tYXRjaGVzWzBdLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICksIGNvbnRleHQgKVswXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIWNvbnRleHQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIHJlc3VsdHM7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3IgPSBzZWxlY3Rvci5zbGljZSggdG9rZW5zLnNoaWZ0KCkudmFsdWUubGVuZ3RoICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEZldGNoIGEgc2VlZCBzZXQgZm9yIHJpZ2h0LXRvLWxlZnQgbWF0Y2hpbmcNCiAgICAgICAgICAgICAgICAgICAgaSA9IG1hdGNoRXhwclsibmVlZHNDb250ZXh0Il0udGVzdCggc2VsZWN0b3IgKSA/IDAgOiB0b2tlbnMubGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIGktLSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdG9rZW5zW2ldOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFib3J0IGlmIHdlIGhpdCBhIGNvbWJpbmF0b3INCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggRXhwci5yZWxhdGl2ZVsgKHR5cGUgPSB0b2tlbi50eXBlKSBdICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAoZmluZCA9IEV4cHIuZmluZFsgdHlwZSBdKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBTZWFyY2gsIGV4cGFuZGluZyBjb250ZXh0IGZvciBsZWFkaW5nIHNpYmxpbmcgY29tYmluYXRvcnMNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIChzZWVkID0gZmluZCgNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJdG9rZW4ubWF0Y2hlc1swXS5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApLA0KICAgICAgICAgICAgICAgICAgICAgICAgCQlyc2libGluZy50ZXN0KCB0b2tlbnNbMF0udHlwZSApICYmIGNvbnRleHQucGFyZW50Tm9kZSB8fCBjb250ZXh0DQogICAgICAgICAgICAgICAgICAgICAgICAJKSkgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkvLyBJZiBzZWVkIGlzIGVtcHR5IG9yIG5vIHRva2VucyByZW1haW4sIHdlIGNhbiByZXR1cm4gZWFybHkNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJdG9rZW5zLnNwbGljZSggaSwgMSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQlzZWxlY3RvciA9IHNlZWQubGVuZ3RoICYmIHRvU2VsZWN0b3IoIHRva2VucyApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQlpZiAoICFzZWxlY3RvciApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCXB1c2guYXBwbHkoIHJlc3VsdHMsIHNsaWNlLmNhbGwoIHNlZWQsIDAgKSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJcmV0dXJuIHJlc3VsdHM7DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCWJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAvLyBDb21waWxlIGFuZCBleGVjdXRlIGEgZmlsdGVyaW5nIGZ1bmN0aW9uDQogICAgICAgICAgICAvLyBQcm92aWRlIGBtYXRjaGAgdG8gYXZvaWQgcmV0b2tlbml6YXRpb24gaWYgd2UgbW9kaWZpZWQgdGhlIHNlbGVjdG9yIGFib3ZlDQogICAgICAgICAgICBjb21waWxlKCBzZWxlY3RvciwgbWF0Y2ggKSgNCiAgICAgICAgICAgICAgICBzZWVkLA0KICAgICAgICAgICAgICAgIGNvbnRleHQsDQogICAgICAgICAgICAgICAgZG9jdW1lbnRJc1hNTCwNCiAgICAgICAgICAgICAgICByZXN1bHRzLA0KICAgICAgICAgICAgICAgIHJzaWJsaW5nLnRlc3QoIHNlbGVjdG9yICkNCiAgICAgICAgICAgICk7DQogICAgICAgICAgICByZXR1cm4gcmVzdWx0czsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gRGVwcmVjYXRlZA0KICAgICAgICBFeHByLnBzZXVkb3NbIm50aCJdID0gRXhwci5wc2V1ZG9zWyJlcSJdOw0KICAgICAgICANCiAgICAgICAgLy8gRWFzeSBBUEkgZm9yIGNyZWF0aW5nIG5ldyBzZXRGaWx0ZXJzDQogICAgICAgIGZ1bmN0aW9uIHNldEZpbHRlcnMoKSB7fQ0KICAgICAgICBFeHByLmZpbHRlcnMgPSBzZXRGaWx0ZXJzLnByb3RvdHlwZSA9IEV4cHIucHNldWRvczsNCiAgICAgICAgRXhwci5zZXRGaWx0ZXJzID0gbmV3IHNldEZpbHRlcnMoKTsNCiAgICAgICAgDQogICAgICAgIC8vIEluaXRpYWxpemUgd2l0aCB0aGUgZGVmYXVsdCBkb2N1bWVudA0KICAgICAgICBzZXREb2N1bWVudCgpOw0KICAgICAgICANCiAgICAgICAgLy8gT3ZlcnJpZGUgc2l6emxlIGF0dHJpYnV0ZSByZXRyaWV2YWwNCiAgICAgICAgU2l6emxlLmF0dHIgPSBqUXVlcnkuYXR0cjsNCiAgICAgICAgalF1ZXJ5LmZpbmQgPSBTaXp6bGU7DQogICAgICAgIGpRdWVyeS5leHByID0gU2l6emxlLnNlbGVjdG9yczsNCiAgICAgICAgalF1ZXJ5LmV4cHJbIjoiXSA9IGpRdWVyeS5leHByLnBzZXVkb3M7DQogICAgICAgIGpRdWVyeS51bmlxdWUgPSBTaXp6bGUudW5pcXVlU29ydDsNCiAgICAgICAgalF1ZXJ5LnRleHQgPSBTaXp6bGUuZ2V0VGV4dDsNCiAgICAgICAgalF1ZXJ5LmlzWE1MRG9jID0gU2l6emxlLmlzWE1MOw0KICAgICAgICBqUXVlcnkuY29udGFpbnMgPSBTaXp6bGUuY29udGFpbnM7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgfSkoIHdpbmRvdyApOw0KICAgICAgICB2YXIgcnVudGlsID0gL1VudGlsJC8sDQogICAgICAgICAgICBycGFyZW50c3ByZXYgPSAvXig/OnBhcmVudHN8cHJldig/OlVudGlsfEFsbCkpLywNCiAgICAgICAgICAgIGlzU2ltcGxlID0gL14uW146I1xbXC4sXSokLywNCiAgICAgICAgICAgIHJuZWVkc0NvbnRleHQgPSBqUXVlcnkuZXhwci5tYXRjaC5uZWVkc0NvbnRleHQsDQogICAgICAgICAgICAvLyBtZXRob2RzIGd1YXJhbnRlZWQgdG8gcHJvZHVjZSBhIHVuaXF1ZSBzZXQgd2hlbiBzdGFydGluZyBmcm9tIGEgdW5pcXVlIHNldA0KICAgICAgICAgICAgZ3VhcmFudGVlZFVuaXF1ZSA9IHsNCiAgICAgICAgICAgICAgICBjaGlsZHJlbjogdHJ1ZSwNCiAgICAgICAgICAgICAgICBjb250ZW50czogdHJ1ZSwNCiAgICAgICAgICAgICAgICBuZXh0OiB0cnVlLA0KICAgICAgICAgICAgICAgIHByZXY6IHRydWUNCiAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZm4uZXh0ZW5kKHsNCiAgICAgICAgICAgIGZpbmQ6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsNCiAgICAgICAgICAgICAgICB2YXIgaSwgcmV0LCBzZWxmLA0KICAgICAgICAgICAgICAgICAgICBsZW4gPSB0aGlzLmxlbmd0aDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCB0eXBlb2Ygc2VsZWN0b3IgIT09ICJzdHJpbmciICkgew0KICAgICAgICAgICAgICAgICAgICBzZWxmID0gdGhpczsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqUXVlcnkoIHNlbGVjdG9yICkuZmlsdGVyKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggaSA9IDA7IGkgPCBsZW47IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIGpRdWVyeS5jb250YWlucyggc2VsZlsgaSBdLCB0aGlzICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCXJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSkgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldCA9IFtdOw0KICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgbGVuOyBpKysgKSB7DQogICAgICAgICAgICAgICAgICAgIGpRdWVyeS5maW5kKCBzZWxlY3RvciwgdGhpc1sgaSBdLCByZXQgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIE5lZWRlZCBiZWNhdXNlICQoIHNlbGVjdG9yLCBjb250ZXh0ICkgYmVjb21lcyAkKCBjb250ZXh0ICkuZmluZCggc2VsZWN0b3IgKQ0KICAgICAgICAgICAgICAgIHJldCA9IHRoaXMucHVzaFN0YWNrKCBsZW4gPiAxID8galF1ZXJ5LnVuaXF1ZSggcmV0ICkgOiByZXQgKTsNCiAgICAgICAgICAgICAgICByZXQuc2VsZWN0b3IgPSAoIHRoaXMuc2VsZWN0b3IgPyB0aGlzLnNlbGVjdG9yICsgIiAiIDogIiIgKSArIHNlbGVjdG9yOw0KICAgICAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGhhczogZnVuY3Rpb24oIHRhcmdldCApIHsNCiAgICAgICAgICAgICAgICB2YXIgaSwNCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0cyA9IGpRdWVyeSggdGFyZ2V0LCB0aGlzICksDQogICAgICAgICAgICAgICAgICAgIGxlbiA9IHRhcmdldHMubGVuZ3RoOw0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgbGVuOyBpKysgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5jb250YWlucyggdGhpcywgdGFyZ2V0c1tpXSApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCXJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIG5vdDogZnVuY3Rpb24oIHNlbGVjdG9yICkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayggd2lubm93KHRoaXMsIHNlbGVjdG9yLCBmYWxzZSkgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgZmlsdGVyOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKCB3aW5ub3codGhpcywgc2VsZWN0b3IsIHRydWUpICk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGlzOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICEhc2VsZWN0b3IgJiYgKA0KICAgICAgICAgICAgICAgICAgICB0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciID8NCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYSBwb3NpdGlvbmFsL3JlbGF0aXZlIHNlbGVjdG9yLCBjaGVjayBtZW1iZXJzaGlwIGluIHRoZSByZXR1cm5lZCBzZXQNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvICQoInA6Zmlyc3QiKS5pcygicDpsYXN0Iikgd29uJ3QgcmV0dXJuIHRydWUgZm9yIGEgZG9jIHdpdGggdHdvICJwIi4NCiAgICAgICAgICAgICAgICAgICAgICAgIHJuZWVkc0NvbnRleHQudGVzdCggc2VsZWN0b3IgKSA/DQogICAgICAgICAgICAgICAgICAgICAgICAJalF1ZXJ5KCBzZWxlY3RvciwgdGhpcy5jb250ZXh0ICkuaW5kZXgoIHRoaXNbMF0gKSA+PSAwIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAlqUXVlcnkuZmlsdGVyKCBzZWxlY3RvciwgdGhpcyApLmxlbmd0aCA+IDAgOg0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maWx0ZXIoIHNlbGVjdG9yICkubGVuZ3RoID4gMCApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBjbG9zZXN0OiBmdW5jdGlvbiggc2VsZWN0b3JzLCBjb250ZXh0ICkgew0KICAgICAgICAgICAgICAgIHZhciBjdXIsDQogICAgICAgICAgICAgICAgICAgIGkgPSAwLA0KICAgICAgICAgICAgICAgICAgICBsID0gdGhpcy5sZW5ndGgsDQogICAgICAgICAgICAgICAgICAgIHJldCA9IFtdLA0KICAgICAgICAgICAgICAgICAgICBwb3MgPSBybmVlZHNDb250ZXh0LnRlc3QoIHNlbGVjdG9ycyApIHx8IHR5cGVvZiBzZWxlY3RvcnMgIT09ICJzdHJpbmciID8NCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeSggc2VsZWN0b3JzLCBjb250ZXh0IHx8IHRoaXMuY29udGV4dCApIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIDA7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGZvciAoIDsgaSA8IGw7IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgY3VyID0gdGhpc1tpXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHdoaWxlICggY3VyICYmIGN1ci5vd25lckRvY3VtZW50ICYmIGN1ciAhPT0gY29udGV4dCAmJiBjdXIubm9kZVR5cGUgIT09IDExICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBwb3MgPyBwb3MuaW5kZXgoY3VyKSA+IC0xIDogalF1ZXJ5LmZpbmQubWF0Y2hlc1NlbGVjdG9yKGN1ciwgc2VsZWN0b3JzKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZXQucHVzaCggY3VyICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBjdXIgPSBjdXIucGFyZW50Tm9kZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKCByZXQubGVuZ3RoID4gMSA/IGpRdWVyeS51bmlxdWUoIHJldCApIDogcmV0ICk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIC8vIERldGVybWluZSB0aGUgcG9zaXRpb24gb2YgYW4gZWxlbWVudCB3aXRoaW4NCiAgICAgICAgICAgIC8vIHRoZSBtYXRjaGVkIHNldCBvZiBlbGVtZW50cw0KICAgICAgICAgICAgaW5kZXg6IGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBObyBhcmd1bWVudCwgcmV0dXJuIGluZGV4IGluIHBhcmVudA0KICAgICAgICAgICAgICAgIGlmICggIWVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoIHRoaXNbMF0gJiYgdGhpc1swXS5wYXJlbnROb2RlICkgPyB0aGlzLmZpcnN0KCkucHJldkFsbCgpLmxlbmd0aCA6IC0xOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gaW5kZXggaW4gc2VsZWN0b3INCiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBlbGVtID09PSAic3RyaW5nIiApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5pbkFycmF5KCB0aGlzWzBdLCBqUXVlcnkoIGVsZW0gKSApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gTG9jYXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgZGVzaXJlZCBlbGVtZW50DQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5pbkFycmF5KA0KICAgICAgICAgICAgICAgICAgICAvLyBJZiBpdCByZWNlaXZlcyBhIGpRdWVyeSBvYmplY3QsIHRoZSBmaXJzdCBlbGVtZW50IGlzIHVzZWQNCiAgICAgICAgICAgICAgICAgICAgZWxlbS5qcXVlcnkgPyBlbGVtWzBdIDogZWxlbSwgdGhpcyApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCApIHsNCiAgICAgICAgICAgICAgICB2YXIgc2V0ID0gdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiA/DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIHNlbGVjdG9yLCBjb250ZXh0ICkgOg0KICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5Lm1ha2VBcnJheSggc2VsZWN0b3IgJiYgc2VsZWN0b3Iubm9kZVR5cGUgPyBbIHNlbGVjdG9yIF0gOiBzZWxlY3RvciApLA0KICAgICAgICAgICAgICAgICAgICBhbGwgPSBqUXVlcnkubWVyZ2UoIHRoaXMuZ2V0KCksIHNldCApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2soIGpRdWVyeS51bmlxdWUoYWxsKSApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBhZGRCYWNrOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkKCBzZWxlY3RvciA9PSBudWxsID8NCiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2T2JqZWN0IDogdGhpcy5wcmV2T2JqZWN0LmZpbHRlcihzZWxlY3RvcikNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGpRdWVyeS5mbi5hbmRTZWxmID0galF1ZXJ5LmZuLmFkZEJhY2s7DQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBzaWJsaW5nKCBjdXIsIGRpciApIHsNCiAgICAgICAgICAgIGRvIHsNCiAgICAgICAgICAgICAgICBjdXIgPSBjdXJbIGRpciBdOw0KICAgICAgICAgICAgfSB3aGlsZSAoIGN1ciAmJiBjdXIubm9kZVR5cGUgIT09IDEgKTsNCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gY3VyOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZWFjaCh7DQogICAgICAgICAgICBwYXJlbnQ6IGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGU7DQogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudCAmJiBwYXJlbnQubm9kZVR5cGUgIT09IDExID8gcGFyZW50IDogbnVsbDsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBwYXJlbnRzOiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInBhcmVudE5vZGUiICk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgcGFyZW50c1VudGlsOiBmdW5jdGlvbiggZWxlbSwgaSwgdW50aWwgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJwYXJlbnROb2RlIiwgdW50aWwgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBuZXh0OiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gc2libGluZyggZWxlbSwgIm5leHRTaWJsaW5nIiApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHByZXY6IGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgIHJldHVybiBzaWJsaW5nKCBlbGVtLCAicHJldmlvdXNTaWJsaW5nIiApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIG5leHRBbGw6IGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZGlyKCBlbGVtLCAibmV4dFNpYmxpbmciICk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgcHJldkFsbDogZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciICk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgbmV4dFVudGlsOiBmdW5jdGlvbiggZWxlbSwgaSwgdW50aWwgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJuZXh0U2libGluZyIsIHVudGlsICk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgcHJldlVudGlsOiBmdW5jdGlvbiggZWxlbSwgaSwgdW50aWwgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciLCB1bnRpbCApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHNpYmxpbmdzOiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LnNpYmxpbmcoICggZWxlbS5wYXJlbnROb2RlIHx8IHt9ICkuZmlyc3RDaGlsZCwgZWxlbSApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGNoaWxkcmVuOiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LnNpYmxpbmcoIGVsZW0uZmlyc3RDaGlsZCApOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGNvbnRlbnRzOiBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCAiaWZyYW1lIiApID8NCiAgICAgICAgICAgICAgICAgICAgZWxlbS5jb250ZW50RG9jdW1lbnQgfHwgZWxlbS5jb250ZW50V2luZG93LmRvY3VtZW50IDoNCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5Lm1lcmdlKCBbXSwgZWxlbS5jaGlsZE5vZGVzICk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sIGZ1bmN0aW9uKCBuYW1lLCBmbiApIHsNCiAgICAgICAgICAgIGpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHVudGlsLCBzZWxlY3RvciApIHsNCiAgICAgICAgICAgICAgICB2YXIgcmV0ID0galF1ZXJ5Lm1hcCggdGhpcywgZm4sIHVudGlsICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggIXJ1bnRpbC50ZXN0KCBuYW1lICkgKSB7DQogICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yID0gdW50aWw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIHNlbGVjdG9yICYmIHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IGpRdWVyeS5maWx0ZXIoIHNlbGVjdG9yLCByZXQgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldCA9IHRoaXMubGVuZ3RoID4gMSAmJiAhZ3VhcmFudGVlZFVuaXF1ZVsgbmFtZSBdID8galF1ZXJ5LnVuaXF1ZSggcmV0ICkgOiByZXQ7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggdGhpcy5sZW5ndGggPiAxICYmIHJwYXJlbnRzcHJldi50ZXN0KCBuYW1lICkgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IHJldC5yZXZlcnNlKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2soIHJldCApOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZXh0ZW5kKHsNCiAgICAgICAgICAgIGZpbHRlcjogZnVuY3Rpb24oIGV4cHIsIGVsZW1zLCBub3QgKSB7DQogICAgICAgICAgICAgICAgaWYgKCBub3QgKSB7DQogICAgICAgICAgICAgICAgICAgIGV4cHIgPSAiOm5vdCgiICsgZXhwciArICIpIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBlbGVtcy5sZW5ndGggPT09IDEgPw0KICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZmluZC5tYXRjaGVzU2VsZWN0b3IoZWxlbXNbMF0sIGV4cHIpID8gWyBlbGVtc1swXSBdIDogW10gOg0KICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZmluZC5tYXRjaGVzKGV4cHIsIGVsZW1zKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgZGlyOiBmdW5jdGlvbiggZWxlbSwgZGlyLCB1bnRpbCApIHsNCiAgICAgICAgICAgICAgICB2YXIgbWF0Y2hlZCA9IFtdLA0KICAgICAgICAgICAgICAgICAgICBjdXIgPSBlbGVtWyBkaXIgXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgd2hpbGUgKCBjdXIgJiYgY3VyLm5vZGVUeXBlICE9PSA5ICYmICh1bnRpbCA9PT0gdW5kZWZpbmVkIHx8IGN1ci5ub2RlVHlwZSAhPT0gMSB8fCAhalF1ZXJ5KCBjdXIgKS5pcyggdW50aWwgKSkgKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggY3VyLm5vZGVUeXBlID09PSAxICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZC5wdXNoKCBjdXIgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjdXIgPSBjdXJbZGlyXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZWQ7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIHNpYmxpbmc6IGZ1bmN0aW9uKCBuLCBlbGVtICkgew0KICAgICAgICAgICAgICAgIHZhciByID0gW107DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGZvciAoIDsgbjsgbiA9IG4ubmV4dFNpYmxpbmcgKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggbi5ub2RlVHlwZSA9PT0gMSAmJiBuICE9PSBlbGVtICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgci5wdXNoKCBuICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiByOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIC8vIEltcGxlbWVudCB0aGUgaWRlbnRpY2FsIGZ1bmN0aW9uYWxpdHkgZm9yIGZpbHRlciBhbmQgbm90DQogICAgICAgIGZ1bmN0aW9uIHdpbm5vdyggZWxlbWVudHMsIHF1YWxpZmllciwga2VlcCApIHsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBDYW4ndCBwYXNzIG51bGwgb3IgdW5kZWZpbmVkIHRvIGluZGV4T2YgaW4gRmlyZWZveCA0DQogICAgICAgICAgICAvLyBTZXQgdG8gMCB0byBza2lwIHN0cmluZyBjaGVjaw0KICAgICAgICAgICAgcXVhbGlmaWVyID0gcXVhbGlmaWVyIHx8IDA7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggcXVhbGlmaWVyICkgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5ncmVwKGVsZW1lbnRzLCBmdW5jdGlvbiggZWxlbSwgaSApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHJldFZhbCA9ICEhcXVhbGlmaWVyLmNhbGwoIGVsZW0sIGksIGVsZW0gKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbCA9PT0ga2VlcDsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgICAgICB9IGVsc2UgaWYgKCBxdWFsaWZpZXIubm9kZVR5cGUgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5ncmVwKGVsZW1lbnRzLCBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICggZWxlbSA9PT0gcXVhbGlmaWVyICkgPT09IGtlZXA7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAgICAgfSBlbHNlIGlmICggdHlwZW9mIHF1YWxpZmllciA9PT0gInN0cmluZyIgKSB7DQogICAgICAgICAgICAgICAgdmFyIGZpbHRlcmVkID0galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5ub2RlVHlwZSA9PT0gMTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCBpc1NpbXBsZS50ZXN0KCBxdWFsaWZpZXIgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5maWx0ZXIocXVhbGlmaWVyLCBmaWx0ZXJlZCwgIWtlZXApOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHF1YWxpZmllciA9IGpRdWVyeS5maWx0ZXIoIHF1YWxpZmllciwgZmlsdGVyZWQgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5ncmVwKGVsZW1lbnRzLCBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gKCBqUXVlcnkuaW5BcnJheSggZWxlbSwgcXVhbGlmaWVyICkgPj0gMCApID09PSBrZWVwOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlU2FmZUZyYWdtZW50KCBkb2N1bWVudCApIHsNCiAgICAgICAgICAgIHZhciBsaXN0ID0gbm9kZU5hbWVzLnNwbGl0KCAifCIgKSwNCiAgICAgICAgICAgICAgICBzYWZlRnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAoIHNhZmVGcmFnLmNyZWF0ZUVsZW1lbnQgKSB7DQogICAgICAgICAgICAgICAgd2hpbGUgKCBsaXN0Lmxlbmd0aCApIHsNCiAgICAgICAgICAgICAgICAgICAgc2FmZUZyYWcuY3JlYXRlRWxlbWVudCgNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QucG9wKCkNCiAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gc2FmZUZyYWc7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHZhciBub2RlTmFtZXMgPSAiYWJicnxhcnRpY2xlfGFzaWRlfGF1ZGlvfGJkaXxjYW52YXN8ZGF0YXxkYXRhbGlzdHxkZXRhaWxzfGZpZ2NhcHRpb258ZmlndXJlfGZvb3RlcnwiICsNCiAgICAgICAgICAgICAgICAiaGVhZGVyfGhncm91cHxtYXJrfG1ldGVyfG5hdnxvdXRwdXR8cHJvZ3Jlc3N8c2VjdGlvbnxzdW1tYXJ5fHRpbWV8dmlkZW8iLA0KICAgICAgICAgICAgcmlubGluZWpRdWVyeSA9IC8galF1ZXJ5XGQrPSIoPzpudWxsfFxkKykiL2csDQogICAgICAgICAgICBybm9zaGltY2FjaGUgPSBuZXcgUmVnRXhwKCI8KD86IiArIG5vZGVOYW1lcyArICIpW1xccy8+XSIsICJpIiksDQogICAgICAgICAgICBybGVhZGluZ1doaXRlc3BhY2UgPSAvXlxzKy8sDQogICAgICAgICAgICByeGh0bWxUYWcgPSAvPCg/IWFyZWF8YnJ8Y29sfGVtYmVkfGhyfGltZ3xpbnB1dHxsaW5rfG1ldGF8cGFyYW0pKChbXHc6XSspW14+XSopXC8+L2dpLA0KICAgICAgICAgICAgcnRhZ05hbWUgPSAvPChbXHc6XSspLywNCiAgICAgICAgICAgIHJ0Ym9keSA9IC88dGJvZHkvaSwNCiAgICAgICAgICAgIHJodG1sID0gLzx8JiM/XHcrOy8sDQogICAgICAgICAgICBybm9Jbm5lcmh0bWwgPSAvPCg/OnNjcmlwdHxzdHlsZXxsaW5rKS9pLA0KICAgICAgICAgICAgbWFuaXB1bGF0aW9uX3JjaGVja2FibGVUeXBlID0gL14oPzpjaGVja2JveHxyYWRpbykkL2ksDQogICAgICAgICAgICAvLyBjaGVja2VkPSJjaGVja2VkIiBvciBjaGVja2VkDQogICAgICAgICAgICByY2hlY2tlZCA9IC9jaGVja2VkXHMqKD86W149XXw9XHMqLmNoZWNrZWQuKS9pLA0KICAgICAgICAgICAgcnNjcmlwdFR5cGUgPSAvXiR8XC8oPzpqYXZhfGVjbWEpc2NyaXB0L2ksDQogICAgICAgICAgICByc2NyaXB0VHlwZU1hc2tlZCA9IC9edHJ1ZVwvKC4qKS8sDQogICAgICAgICAgICByY2xlYW5TY3JpcHQgPSAvXlxzKjwhKD86XFtDREFUQVxbfC0tKXwoPzpcXVxdfC0tKT5ccyokL2csDQogICAgICAgIA0KICAgICAgICAgICAgLy8gV2UgaGF2ZSB0byBjbG9zZSB0aGVzZSB0YWdzIHRvIHN1cHBvcnQgWEhUTUwgKCMxMzIwMCkNCiAgICAgICAgICAgIHdyYXBNYXAgPSB7DQogICAgICAgICAgICAgICAgb3B0aW9uOiBbIDEsICI8c2VsZWN0IG11bHRpcGxlPSdtdWx0aXBsZSc+IiwgIjwvc2VsZWN0PiIgXSwNCiAgICAgICAgICAgICAgICBsZWdlbmQ6IFsgMSwgIjxmaWVsZHNldD4iLCAiPC9maWVsZHNldD4iIF0sDQogICAgICAgICAgICAgICAgYXJlYTogWyAxLCAiPG1hcD4iLCAiPC9tYXA+IiBdLA0KICAgICAgICAgICAgICAgIHBhcmFtOiBbIDEsICI8b2JqZWN0PiIsICI8L29iamVjdD4iIF0sDQogICAgICAgICAgICAgICAgdGhlYWQ6IFsgMSwgIjx0YWJsZT4iLCAiPC90YWJsZT4iIF0sDQogICAgICAgICAgICAgICAgdHI6IFsgMiwgIjx0YWJsZT48dGJvZHk+IiwgIjwvdGJvZHk+PC90YWJsZT4iIF0sDQogICAgICAgICAgICAgICAgY29sOiBbIDIsICI8dGFibGU+PHRib2R5PjwvdGJvZHk+PGNvbGdyb3VwPiIsICI8L2NvbGdyb3VwPjwvdGFibGU+IiBdLA0KICAgICAgICAgICAgICAgIHRkOiBbIDMsICI8dGFibGU+PHRib2R5Pjx0cj4iLCAiPC90cj48L3Rib2R5PjwvdGFibGU+IiBdLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBJRTYtOCBjYW4ndCBzZXJpYWxpemUgbGluaywgc2NyaXB0LCBzdHlsZSwgb3IgYW55IGh0bWw1IChOb1Njb3BlKSB0YWdzLA0KICAgICAgICAgICAgICAgIC8vIHVubGVzcyB3cmFwcGVkIGluIGEgZGl2IHdpdGggbm9uLWJyZWFraW5nIGNoYXJhY3RlcnMgaW4gZnJvbnQgb2YgaXQuDQogICAgICAgICAgICAgICAgX2RlZmF1bHQ6IGpRdWVyeS5zdXBwb3J0Lmh0bWxTZXJpYWxpemUgPyBbIDAsICIiLCAiIiBdIDogWyAxLCAiWDxkaXY+IiwgIjwvZGl2PiIgIF0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBzYWZlRnJhZ21lbnQgPSBjcmVhdGVTYWZlRnJhZ21lbnQoIGRvY3VtZW50ICksDQogICAgICAgICAgICBmcmFnbWVudERpdiA9IHNhZmVGcmFnbWVudC5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikgKTsNCiAgICAgICAgDQogICAgICAgIHdyYXBNYXAub3B0Z3JvdXAgPSB3cmFwTWFwLm9wdGlvbjsNCiAgICAgICAgd3JhcE1hcC50Ym9keSA9IHdyYXBNYXAudGZvb3QgPSB3cmFwTWFwLmNvbGdyb3VwID0gd3JhcE1hcC5jYXB0aW9uID0gd3JhcE1hcC50aGVhZDsNCiAgICAgICAgd3JhcE1hcC50aCA9IHdyYXBNYXAudGQ7DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZm4uZXh0ZW5kKHsNCiAgICAgICAgICAgIHRleHQ6IGZ1bmN0aW9uKCB2YWx1ZSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgZnVuY3Rpb24oIHZhbHVlICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCA/DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkudGV4dCggdGhpcyApIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1wdHkoKS5hcHBlbmQoICggdGhpc1swXSAmJiB0aGlzWzBdLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQgKS5jcmVhdGVUZXh0Tm9kZSggdmFsdWUgKSApOw0KICAgICAgICAgICAgICAgIH0sIG51bGwsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoICk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIHdyYXBBbGw6IGZ1bmN0aW9uKCBodG1sICkgew0KICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGh0bWwgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkodGhpcykud3JhcEFsbCggaHRtbC5jYWxsKHRoaXMsIGkpICk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCB0aGlzWzBdICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZWxlbWVudHMgdG8gd3JhcCB0aGUgdGFyZ2V0IGFyb3VuZA0KICAgICAgICAgICAgICAgICAgICB2YXIgd3JhcCA9IGpRdWVyeSggaHRtbCwgdGhpc1swXS5vd25lckRvY3VtZW50ICkuZXEoMCkuY2xvbmUodHJ1ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoIHRoaXNbMF0ucGFyZW50Tm9kZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdyYXAuaW5zZXJ0QmVmb3JlKCB0aGlzWzBdICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHdyYXAubWFwKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW0gPSB0aGlzOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICggZWxlbS5maXJzdENoaWxkICYmIGVsZW0uZmlyc3RDaGlsZC5ub2RlVHlwZSA9PT0gMSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAllbGVtID0gZWxlbS5maXJzdENoaWxkOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtOw0KICAgICAgICAgICAgICAgICAgICB9KS5hcHBlbmQoIHRoaXMgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICB3cmFwSW5uZXI6IGZ1bmN0aW9uKCBodG1sICkgew0KICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGh0bWwgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkodGhpcykud3JhcElubmVyKCBodG1sLmNhbGwodGhpcywgaSkgKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IGpRdWVyeSggdGhpcyApLA0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudHMgPSBzZWxmLmNvbnRlbnRzKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoIGNvbnRlbnRzLmxlbmd0aCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRzLndyYXBBbGwoIGh0bWwgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFwcGVuZCggaHRtbCApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIHdyYXA6IGZ1bmN0aW9uKCBodG1sICkgew0KICAgICAgICAgICAgICAgIHZhciBpc0Z1bmN0aW9uID0galF1ZXJ5LmlzRnVuY3Rpb24oIGh0bWwgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihpKSB7DQogICAgICAgICAgICAgICAgICAgIGpRdWVyeSggdGhpcyApLndyYXBBbGwoIGlzRnVuY3Rpb24gPyBodG1sLmNhbGwodGhpcywgaSkgOiBodG1sICk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIHVud3JhcDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50KCkuZWFjaChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiYm9keSIgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeSggdGhpcyApLnJlcGxhY2VXaXRoKCB0aGlzLmNoaWxkTm9kZXMgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pLmVuZCgpOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBhcHBlbmQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywgdHJ1ZSwgZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggdGhpcy5ub2RlVHlwZSA9PT0gMSB8fCB0aGlzLm5vZGVUeXBlID09PSAxMSB8fCB0aGlzLm5vZGVUeXBlID09PSA5ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCggZWxlbSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIHByZXBlbmQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywgdHJ1ZSwgZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggdGhpcy5ub2RlVHlwZSA9PT0gMSB8fCB0aGlzLm5vZGVUeXBlID09PSAxMSB8fCB0aGlzLm5vZGVUeXBlID09PSA5ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnNlcnRCZWZvcmUoIGVsZW0sIHRoaXMuZmlyc3RDaGlsZCApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGJlZm9yZTogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZG9tTWFuaXAoIGFyZ3VtZW50cywgZmFsc2UsIGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIHRoaXMucGFyZW50Tm9kZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoIGVsZW0sIHRoaXMgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBhZnRlcjogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZG9tTWFuaXAoIGFyZ3VtZW50cywgZmFsc2UsIGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIHRoaXMucGFyZW50Tm9kZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoIGVsZW0sIHRoaXMubmV4dFNpYmxpbmcgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBrZWVwRGF0YSBpcyBmb3IgaW50ZXJuYWwgdXNlIG9ubHktLWRvIG5vdCBkb2N1bWVudA0KICAgICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbiggc2VsZWN0b3IsIGtlZXBEYXRhICkgew0KICAgICAgICAgICAgICAgIHZhciBlbGVtLA0KICAgICAgICAgICAgICAgICAgICBpID0gMDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgZm9yICggOyAoZWxlbSA9IHRoaXNbaV0pICE9IG51bGw7IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhc2VsZWN0b3IgfHwgalF1ZXJ5LmZpbHRlciggc2VsZWN0b3IsIFsgZWxlbSBdICkubGVuZ3RoID4gMCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIWtlZXBEYXRhICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJalF1ZXJ5LmNsZWFuRGF0YSggZ2V0QWxsKCBlbGVtICkgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGVsZW0ucGFyZW50Tm9kZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIGtlZXBEYXRhICYmIGpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCXNldEdsb2JhbEV2YWwoIGdldEFsbCggZWxlbSwgInNjcmlwdCIgKSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAllbGVtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIGVsZW0gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGVtcHR5OiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICB2YXIgZWxlbSwNCiAgICAgICAgICAgICAgICAgICAgaSA9IDA7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGZvciAoIDsgKGVsZW0gPSB0aGlzW2ldKSAhPSBudWxsOyBpKysgKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBlbGVtZW50IG5vZGVzIGFuZCBwcmV2ZW50IG1lbW9yeSBsZWFrcw0KICAgICAgICAgICAgICAgICAgICBpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0sIGZhbHNlICkgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGFueSByZW1haW5pbmcgbm9kZXMNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCBlbGVtLmZpcnN0Q2hpbGQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBlbGVtLnJlbW92ZUNoaWxkKCBlbGVtLmZpcnN0Q2hpbGQgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBpcyBhIHNlbGVjdCwgZW5zdXJlIHRoYXQgaXQgZGlzcGxheXMgZW1wdHkgKCMxMjMzNikNCiAgICAgICAgICAgICAgICAgICAgLy8gU3VwcG9ydDogSUU8OQ0KICAgICAgICAgICAgICAgICAgICBpZiAoIGVsZW0ub3B0aW9ucyAmJiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJzZWxlY3QiICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBlbGVtLm9wdGlvbnMubGVuZ3RoID0gMDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGNsb25lOiBmdW5jdGlvbiggZGF0YUFuZEV2ZW50cywgZGVlcERhdGFBbmRFdmVudHMgKSB7DQogICAgICAgICAgICAgICAgZGF0YUFuZEV2ZW50cyA9IGRhdGFBbmRFdmVudHMgPT0gbnVsbCA/IGZhbHNlIDogZGF0YUFuZEV2ZW50czsNCiAgICAgICAgICAgICAgICBkZWVwRGF0YUFuZEV2ZW50cyA9IGRlZXBEYXRhQW5kRXZlbnRzID09IG51bGwgPyBkYXRhQW5kRXZlbnRzIDogZGVlcERhdGFBbmRFdmVudHM7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1hcCggZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LmNsb25lKCB0aGlzLCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBodG1sOiBmdW5jdGlvbiggdmFsdWUgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5hY2Nlc3MoIHRoaXMsIGZ1bmN0aW9uKCB2YWx1ZSApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW0gPSB0aGlzWzBdIHx8IHt9LA0KICAgICAgICAgICAgICAgICAgICAgICAgaSA9IDAsDQogICAgICAgICAgICAgICAgICAgICAgICBsID0gdGhpcy5sZW5ndGg7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoIHZhbHVlID09PSB1bmRlZmluZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5ub2RlVHlwZSA9PT0gMSA/DQogICAgICAgICAgICAgICAgICAgICAgICAJZWxlbS5pbm5lckhUTUwucmVwbGFjZSggcmlubGluZWpRdWVyeSwgIiIgKSA6DQogICAgICAgICAgICAgICAgICAgICAgICAJdW5kZWZpbmVkOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBTZWUgaWYgd2UgY2FuIHRha2UgYSBzaG9ydGN1dCBhbmQganVzdCB1c2UgaW5uZXJIVE1MDQogICAgICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiAhcm5vSW5uZXJodG1sLnRlc3QoIHZhbHVlICkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgICggalF1ZXJ5LnN1cHBvcnQuaHRtbFNlcmlhbGl6ZSB8fCAhcm5vc2hpbWNhY2hlLnRlc3QoIHZhbHVlICkgICkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgICggalF1ZXJ5LnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2UgfHwgIXJsZWFkaW5nV2hpdGVzcGFjZS50ZXN0KCB2YWx1ZSApICkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgICF3cmFwTWFwWyAoIHJ0YWdOYW1lLmV4ZWMoIHZhbHVlICkgfHwgWyIiLCAiIl0gKVsxXS50b0xvd2VyQ2FzZSgpIF0gKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCByeGh0bWxUYWcsICI8JDE+PC8kMj4iICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlmb3IgKDsgaSA8IGw7IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gUmVtb3ZlIGVsZW1lbnQgbm9kZXMgYW5kIHByZXZlbnQgbWVtb3J5IGxlYWtzDQogICAgICAgICAgICAgICAgICAgICAgICAJCWVsZW0gPSB0aGlzW2ldIHx8IHt9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0sIGZhbHNlICkgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWVsZW0uaW5uZXJIVE1MID0gdmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCWVsZW0gPSAwOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHVzaW5nIGlubmVySFRNTCB0aHJvd3MgYW4gZXhjZXB0aW9uLCB1c2UgdGhlIGZhbGxiYWNrIG1ldGhvZA0KICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaChlKSB7fQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtcHR5KCkuYXBwZW5kKCB2YWx1ZSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwgbnVsbCwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgcmVwbGFjZVdpdGg6IGZ1bmN0aW9uKCB2YWx1ZSApIHsNCiAgICAgICAgICAgICAgICB2YXIgaXNGdW5jID0galF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBlbGVtZW50cyBhcmUgcmVtb3ZlZCBmcm9tIHRoZSBET00gYmVmb3JlIHRoZXkgYXJlIGluc2VydGVkDQogICAgICAgICAgICAgICAgLy8gdGhpcyBjYW4gaGVscCBmaXggcmVwbGFjaW5nIGEgcGFyZW50IHdpdGggY2hpbGQgZWxlbWVudHMNCiAgICAgICAgICAgICAgICBpZiAoICFpc0Z1bmMgJiYgdHlwZW9mIHZhbHVlICE9PSAic3RyaW5nIiApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBqUXVlcnkoIHZhbHVlICkubm90KCB0aGlzICkuZGV0YWNoKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kb21NYW5pcCggWyB2YWx1ZSBdLCB0cnVlLCBmdW5jdGlvbiggZWxlbSApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHQgPSB0aGlzLm5leHRTaWJsaW5nLA0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gdGhpcy5wYXJlbnROb2RlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCBwYXJlbnQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIHRoaXMgKS5yZW1vdmUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoIGVsZW0sIG5leHQgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBkZXRhY2g6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZW1vdmUoIHNlbGVjdG9yLCB0cnVlICk7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGRvbU1hbmlwOiBmdW5jdGlvbiggYXJncywgdGFibGUsIGNhbGxiYWNrICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBGbGF0dGVuIGFueSBuZXN0ZWQgYXJyYXlzDQogICAgICAgICAgICAgICAgYXJncyA9IGNvcmVfY29uY2F0LmFwcGx5KCBbXSwgYXJncyApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB2YXIgZmlyc3QsIG5vZGUsIGhhc1NjcmlwdHMsDQogICAgICAgICAgICAgICAgICAgIHNjcmlwdHMsIGRvYywgZnJhZ21lbnQsDQogICAgICAgICAgICAgICAgICAgIGkgPSAwLA0KICAgICAgICAgICAgICAgICAgICBsID0gdGhpcy5sZW5ndGgsDQogICAgICAgICAgICAgICAgICAgIHNldCA9IHRoaXMsDQogICAgICAgICAgICAgICAgICAgIGlOb0Nsb25lID0gbCAtIDEsDQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gYXJnc1swXSwNCiAgICAgICAgICAgICAgICAgICAgaXNGdW5jdGlvbiA9IGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBXZSBjYW4ndCBjbG9uZU5vZGUgZnJhZ21lbnRzIHRoYXQgY29udGFpbiBjaGVja2VkLCBpbiBXZWJLaXQNCiAgICAgICAgICAgICAgICBpZiAoIGlzRnVuY3Rpb24gfHwgISggbCA8PSAxIHx8IHR5cGVvZiB2YWx1ZSAhPT0gInN0cmluZyIgfHwgalF1ZXJ5LnN1cHBvcnQuY2hlY2tDbG9uZSB8fCAhcmNoZWNrZWQudGVzdCggdmFsdWUgKSApICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpbmRleCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZWxmID0gc2V0LmVxKCBpbmRleCApOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBpc0Z1bmN0aW9uICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWFyZ3NbMF0gPSB2YWx1ZS5jYWxsKCB0aGlzLCBpbmRleCwgdGFibGUgPyBzZWxmLmh0bWwoKSA6IHVuZGVmaW5lZCApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kb21NYW5pcCggYXJncywgdGFibGUsIGNhbGxiYWNrICk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCBsICkgew0KICAgICAgICAgICAgICAgICAgICBmcmFnbWVudCA9IGpRdWVyeS5idWlsZEZyYWdtZW50KCBhcmdzLCB0aGlzWyAwIF0ub3duZXJEb2N1bWVudCwgZmFsc2UsIHRoaXMgKTsNCiAgICAgICAgICAgICAgICAgICAgZmlyc3QgPSBmcmFnbWVudC5maXJzdENoaWxkOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCBmcmFnbWVudC5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gZmlyc3Q7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmICggZmlyc3QgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0YWJsZSA9IHRhYmxlICYmIGpRdWVyeS5ub2RlTmFtZSggZmlyc3QsICJ0ciIgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdHMgPSBqUXVlcnkubWFwKCBnZXRBbGwoIGZyYWdtZW50LCAic2NyaXB0IiApLCBkaXNhYmxlU2NyaXB0ICk7DQogICAgICAgICAgICAgICAgICAgICAgICBoYXNTY3JpcHRzID0gc2NyaXB0cy5sZW5ndGg7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRoZSBvcmlnaW5hbCBmcmFnbWVudCBmb3IgdGhlIGxhc3QgaXRlbSBpbnN0ZWFkIG9mIHRoZSBmaXJzdCBiZWNhdXNlIGl0IGNhbiBlbmQgdXANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJlaW5nIGVtcHRpZWQgaW5jb3JyZWN0bHkgaW4gY2VydGFpbiBzaXR1YXRpb25zICgjODA3MCkuDQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCA7IGkgPCBsOyBpKysgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJbm9kZSA9IGZyYWdtZW50Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIGkgIT09IGlOb0Nsb25lICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlub2RlID0galF1ZXJ5LmNsb25lKCBub2RlLCB0cnVlLCB0cnVlICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkvLyBLZWVwIHJlZmVyZW5jZXMgdG8gY2xvbmVkIHNjcmlwdHMgZm9yIGxhdGVyIHJlc3RvcmF0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICAJCWlmICggaGFzU2NyaXB0cyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWpRdWVyeS5tZXJnZSggc2NyaXB0cywgZ2V0QWxsKCBub2RlLCAic2NyaXB0IiApICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCWNhbGxiYWNrLmNhbGwoDQogICAgICAgICAgICAgICAgICAgICAgICAJCXRhYmxlICYmIGpRdWVyeS5ub2RlTmFtZSggdGhpc1tpXSwgInRhYmxlIiApID8NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWZpbmRPckFwcGVuZCggdGhpc1tpXSwgInRib2R5IiApIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCXRoaXNbaV0sDQogICAgICAgICAgICAgICAgICAgICAgICAJCW5vZGUsDQogICAgICAgICAgICAgICAgICAgICAgICAJCWkNCiAgICAgICAgICAgICAgICAgICAgICAgIAkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggaGFzU2NyaXB0cyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlkb2MgPSBzY3JpcHRzWyBzY3JpcHRzLmxlbmd0aCAtIDEgXS5vd25lckRvY3VtZW50Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBSZWVuYWJsZSBzY3JpcHRzDQogICAgICAgICAgICAgICAgICAgICAgICAJalF1ZXJ5Lm1hcCggc2NyaXB0cywgcmVzdG9yZVNjcmlwdCApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBFdmFsdWF0ZSBleGVjdXRhYmxlIHNjcmlwdHMgb24gZmlyc3QgZG9jdW1lbnQgaW5zZXJ0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICAJZm9yICggaSA9IDA7IGkgPCBoYXNTY3JpcHRzOyBpKysgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCW5vZGUgPSBzY3JpcHRzWyBpIF07DQogICAgICAgICAgICAgICAgICAgICAgICAJCWlmICggcnNjcmlwdFR5cGUudGVzdCggbm9kZS50eXBlIHx8ICIiICkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCSFqUXVlcnkuX2RhdGEoIG5vZGUsICJnbG9iYWxFdmFsIiApICYmIGpRdWVyeS5jb250YWlucyggZG9jLCBub2RlICkgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJaWYgKCBub2RlLnNyYyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkvLyBIb3BlIGFqYXggaXMgYXZhaWxhYmxlLi4uDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJalF1ZXJ5LmFqYXgoew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQl1cmw6IG5vZGUuc3JjLA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQl0eXBlOiAiR0VUIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJZGF0YVR5cGU6ICJzY3JpcHQiLA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQlhc3luYzogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCWdsb2JhbDogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCSJ0aHJvd3MiOiB0cnVlDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCWpRdWVyeS5nbG9iYWxFdmFsKCAoIG5vZGUudGV4dCB8fCBub2RlLnRleHRDb250ZW50IHx8IG5vZGUuaW5uZXJIVE1MIHx8ICIiICkucmVwbGFjZSggcmNsZWFuU2NyaXB0LCAiIiApICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gRml4ICMxMTgwOTogQXZvaWQgbGVha2luZyBtZW1vcnkNCiAgICAgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gZmlyc3QgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBmaW5kT3JBcHBlbmQoIGVsZW0sIHRhZyApIHsNCiAgICAgICAgICAgIHJldHVybiBlbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCB0YWcgKVswXSB8fCBlbGVtLmFwcGVuZENoaWxkKCBlbGVtLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudCggdGFnICkgKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gUmVwbGFjZS9yZXN0b3JlIHRoZSB0eXBlIGF0dHJpYnV0ZSBvZiBzY3JpcHQgZWxlbWVudHMgZm9yIHNhZmUgRE9NIG1hbmlwdWxhdGlvbg0KICAgICAgICBmdW5jdGlvbiBkaXNhYmxlU2NyaXB0KCBlbGVtICkgew0KICAgICAgICAgICAgdmFyIGF0dHIgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoInR5cGUiKTsNCiAgICAgICAgICAgIGVsZW0udHlwZSA9ICggYXR0ciAmJiBhdHRyLnNwZWNpZmllZCApICsgIi8iICsgZWxlbS50eXBlOw0KICAgICAgICAgICAgcmV0dXJuIGVsZW07DQogICAgICAgIH0NCiAgICAgICAgZnVuY3Rpb24gcmVzdG9yZVNjcmlwdCggZWxlbSApIHsNCiAgICAgICAgICAgIHZhciBtYXRjaCA9IHJzY3JpcHRUeXBlTWFza2VkLmV4ZWMoIGVsZW0udHlwZSApOw0KICAgICAgICAgICAgaWYgKCBtYXRjaCApIHsNCiAgICAgICAgICAgICAgICBlbGVtLnR5cGUgPSBtYXRjaFsxXTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgZWxlbS5yZW1vdmVBdHRyaWJ1dGUoInR5cGUiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBlbGVtOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBNYXJrIHNjcmlwdHMgYXMgaGF2aW5nIGFscmVhZHkgYmVlbiBldmFsdWF0ZWQNCiAgICAgICAgZnVuY3Rpb24gc2V0R2xvYmFsRXZhbCggZWxlbXMsIHJlZkVsZW1lbnRzICkgew0KICAgICAgICAgICAgdmFyIGVsZW0sDQogICAgICAgICAgICAgICAgaSA9IDA7DQogICAgICAgICAgICBmb3IgKCA7IChlbGVtID0gZWxlbXNbaV0pICE9IG51bGw7IGkrKyApIHsNCiAgICAgICAgICAgICAgICBqUXVlcnkuX2RhdGEoIGVsZW0sICJnbG9iYWxFdmFsIiwgIXJlZkVsZW1lbnRzIHx8IGpRdWVyeS5fZGF0YSggcmVmRWxlbWVudHNbaV0sICJnbG9iYWxFdmFsIiApICk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIGNsb25lQ29weUV2ZW50KCBzcmMsIGRlc3QgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgKCBkZXN0Lm5vZGVUeXBlICE9PSAxIHx8ICFqUXVlcnkuaGFzRGF0YSggc3JjICkgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIHZhciB0eXBlLCBpLCBsLA0KICAgICAgICAgICAgICAgIG9sZERhdGEgPSBqUXVlcnkuX2RhdGEoIHNyYyApLA0KICAgICAgICAgICAgICAgIGN1ckRhdGEgPSBqUXVlcnkuX2RhdGEoIGRlc3QsIG9sZERhdGEgKSwNCiAgICAgICAgICAgICAgICBldmVudHMgPSBvbGREYXRhLmV2ZW50czsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAoIGV2ZW50cyApIHsNCiAgICAgICAgICAgICAgICBkZWxldGUgY3VyRGF0YS5oYW5kbGU7DQogICAgICAgICAgICAgICAgY3VyRGF0YS5ldmVudHMgPSB7fTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgZm9yICggdHlwZSBpbiBldmVudHMgKSB7DQogICAgICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwLCBsID0gZXZlbnRzWyB0eXBlIF0ubGVuZ3RoOyBpIDwgbDsgaSsrICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LmFkZCggZGVzdCwgdHlwZSwgZXZlbnRzWyB0eXBlIF1bIGkgXSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIG1ha2UgdGhlIGNsb25lZCBwdWJsaWMgZGF0YSBvYmplY3QgYSBjb3B5IGZyb20gdGhlIG9yaWdpbmFsDQogICAgICAgICAgICBpZiAoIGN1ckRhdGEuZGF0YSApIHsNCiAgICAgICAgICAgICAgICBjdXJEYXRhLmRhdGEgPSBqUXVlcnkuZXh0ZW5kKCB7fSwgY3VyRGF0YS5kYXRhICk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIGZpeENsb25lTm9kZUlzc3Vlcyggc3JjLCBkZXN0ICkgew0KICAgICAgICAgICAgdmFyIG5vZGVOYW1lLCBlLCBkYXRhOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIFdlIGRvIG5vdCBuZWVkIHRvIGRvIGFueXRoaW5nIGZvciBub24tRWxlbWVudHMNCiAgICAgICAgICAgIGlmICggZGVzdC5ub2RlVHlwZSAhPT0gMSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgbm9kZU5hbWUgPSBkZXN0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gSUU2LTggY29waWVzIGV2ZW50cyBib3VuZCB2aWEgYXR0YWNoRXZlbnQgd2hlbiB1c2luZyBjbG9uZU5vZGUuDQogICAgICAgICAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC5ub0Nsb25lRXZlbnQgJiYgZGVzdFsgalF1ZXJ5LmV4cGFuZG8gXSApIHsNCiAgICAgICAgICAgICAgICBkYXRhID0galF1ZXJ5Ll9kYXRhKCBkZXN0ICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGZvciAoIGUgaW4gZGF0YS5ldmVudHMgKSB7DQogICAgICAgICAgICAgICAgICAgIGpRdWVyeS5yZW1vdmVFdmVudCggZGVzdCwgZSwgZGF0YS5oYW5kbGUgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEV2ZW50IGRhdGEgZ2V0cyByZWZlcmVuY2VkIGluc3RlYWQgb2YgY29waWVkIGlmIHRoZSBleHBhbmRvIGdldHMgY29waWVkIHRvbw0KICAgICAgICAgICAgICAgIGRlc3QucmVtb3ZlQXR0cmlidXRlKCBqUXVlcnkuZXhwYW5kbyApOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIElFIGJsYW5rcyBjb250ZW50cyB3aGVuIGNsb25pbmcgc2NyaXB0cywgYW5kIHRyaWVzIHRvIGV2YWx1YXRlIG5ld2x5LXNldCB0ZXh0DQogICAgICAgICAgICBpZiAoIG5vZGVOYW1lID09PSAic2NyaXB0IiAmJiBkZXN0LnRleHQgIT09IHNyYy50ZXh0ICkgew0KICAgICAgICAgICAgICAgIGRpc2FibGVTY3JpcHQoIGRlc3QgKS50ZXh0ID0gc3JjLnRleHQ7DQogICAgICAgICAgICAgICAgcmVzdG9yZVNjcmlwdCggZGVzdCApOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIElFNi0xMCBpbXByb3Blcmx5IGNsb25lcyBjaGlsZHJlbiBvZiBvYmplY3QgZWxlbWVudHMgdXNpbmcgY2xhc3NpZC4NCiAgICAgICAgICAgIC8vIElFMTAgdGhyb3dzIE5vTW9kaWZpY2F0aW9uQWxsb3dlZEVycm9yIGlmIHBhcmVudCBpcyBudWxsLCAjMTIxMzIuDQogICAgICAgICAgICB9IGVsc2UgaWYgKCBub2RlTmFtZSA9PT0gIm9iamVjdCIgKSB7DQogICAgICAgICAgICAgICAgaWYgKCBkZXN0LnBhcmVudE5vZGUgKSB7DQogICAgICAgICAgICAgICAgICAgIGRlc3Qub3V0ZXJIVE1MID0gc3JjLm91dGVySFRNTDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFRoaXMgcGF0aCBhcHBlYXJzIHVuYXZvaWRhYmxlIGZvciBJRTkuIFdoZW4gY2xvbmluZyBhbiBvYmplY3QNCiAgICAgICAgICAgICAgICAvLyBlbGVtZW50IGluIElFOSwgdGhlIG91dGVySFRNTCBzdHJhdGVneSBhYm92ZSBpcyBub3Qgc3VmZmljaWVudC4NCiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgc3JjIGhhcyBpbm5lckhUTUwgYW5kIHRoZSBkZXN0aW5hdGlvbiBkb2VzIG5vdCwNCiAgICAgICAgICAgICAgICAvLyBjb3B5IHRoZSBzcmMuaW5uZXJIVE1MIGludG8gdGhlIGRlc3QuaW5uZXJIVE1MLiAjMTAzMjQNCiAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5zdXBwb3J0Lmh0bWw1Q2xvbmUgJiYgKCBzcmMuaW5uZXJIVE1MICYmICFqUXVlcnkudHJpbShkZXN0LmlubmVySFRNTCkgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgZGVzdC5pbm5lckhUTUwgPSBzcmMuaW5uZXJIVE1MOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICB9IGVsc2UgaWYgKCBub2RlTmFtZSA9PT0gImlucHV0IiAmJiBtYW5pcHVsYXRpb25fcmNoZWNrYWJsZVR5cGUudGVzdCggc3JjLnR5cGUgKSApIHsNCiAgICAgICAgICAgICAgICAvLyBJRTYtOCBmYWlscyB0byBwZXJzaXN0IHRoZSBjaGVja2VkIHN0YXRlIG9mIGEgY2xvbmVkIGNoZWNrYm94DQogICAgICAgICAgICAgICAgLy8gb3IgcmFkaW8gYnV0dG9uLiBXb3JzZSwgSUU2LTcgZmFpbCB0byBnaXZlIHRoZSBjbG9uZWQgZWxlbWVudA0KICAgICAgICAgICAgICAgIC8vIGEgY2hlY2tlZCBhcHBlYXJhbmNlIGlmIHRoZSBkZWZhdWx0Q2hlY2tlZCB2YWx1ZSBpc24ndCBhbHNvIHNldA0KICAgICAgICANCiAgICAgICAgICAgICAgICBkZXN0LmRlZmF1bHRDaGVja2VkID0gZGVzdC5jaGVja2VkID0gc3JjLmNoZWNrZWQ7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIElFNi03IGdldCBjb25mdXNlZCBhbmQgZW5kIHVwIHNldHRpbmcgdGhlIHZhbHVlIG9mIGEgY2xvbmVkDQogICAgICAgICAgICAgICAgLy8gY2hlY2tib3gvcmFkaW8gYnV0dG9uIHRvIGFuIGVtcHR5IHN0cmluZyBpbnN0ZWFkIG9mICJvbiINCiAgICAgICAgICAgICAgICBpZiAoIGRlc3QudmFsdWUgIT09IHNyYy52YWx1ZSApIHsNCiAgICAgICAgICAgICAgICAgICAgZGVzdC52YWx1ZSA9IHNyYy52YWx1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gSUU2LTggZmFpbHMgdG8gcmV0dXJuIHRoZSBzZWxlY3RlZCBvcHRpb24gdG8gdGhlIGRlZmF1bHQgc2VsZWN0ZWQNCiAgICAgICAgICAgIC8vIHN0YXRlIHdoZW4gY2xvbmluZyBvcHRpb25zDQogICAgICAgICAgICB9IGVsc2UgaWYgKCBub2RlTmFtZSA9PT0gIm9wdGlvbiIgKSB7DQogICAgICAgICAgICAgICAgZGVzdC5kZWZhdWx0U2VsZWN0ZWQgPSBkZXN0LnNlbGVjdGVkID0gc3JjLmRlZmF1bHRTZWxlY3RlZDsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBJRTYtOCBmYWlscyB0byBzZXQgdGhlIGRlZmF1bHRWYWx1ZSB0byB0aGUgY29ycmVjdCB2YWx1ZSB3aGVuDQogICAgICAgICAgICAvLyBjbG9uaW5nIG90aGVyIHR5cGVzIG9mIGlucHV0IGZpZWxkcw0KICAgICAgICAgICAgfSBlbHNlIGlmICggbm9kZU5hbWUgPT09ICJpbnB1dCIgfHwgbm9kZU5hbWUgPT09ICJ0ZXh0YXJlYSIgKSB7DQogICAgICAgICAgICAgICAgZGVzdC5kZWZhdWx0VmFsdWUgPSBzcmMuZGVmYXVsdFZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZWFjaCh7DQogICAgICAgICAgICBhcHBlbmRUbzogImFwcGVuZCIsDQogICAgICAgICAgICBwcmVwZW5kVG86ICJwcmVwZW5kIiwNCiAgICAgICAgICAgIGluc2VydEJlZm9yZTogImJlZm9yZSIsDQogICAgICAgICAgICBpbnNlcnRBZnRlcjogImFmdGVyIiwNCiAgICAgICAgICAgIHJlcGxhY2VBbGw6ICJyZXBsYWNlV2l0aCINCiAgICAgICAgfSwgZnVuY3Rpb24oIG5hbWUsIG9yaWdpbmFsICkgew0KICAgICAgICAgICAgalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggc2VsZWN0b3IgKSB7DQogICAgICAgICAgICAgICAgdmFyIGVsZW1zLA0KICAgICAgICAgICAgICAgICAgICBpID0gMCwNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gW10sDQogICAgICAgICAgICAgICAgICAgIGluc2VydCA9IGpRdWVyeSggc2VsZWN0b3IgKSwNCiAgICAgICAgICAgICAgICAgICAgbGFzdCA9IGluc2VydC5sZW5ndGggLSAxOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBmb3IgKCA7IGkgPD0gbGFzdDsgaSsrICkgew0KICAgICAgICAgICAgICAgICAgICBlbGVtcyA9IGkgPT09IGxhc3QgPyB0aGlzIDogdGhpcy5jbG9uZSh0cnVlKTsNCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCBpbnNlcnRbaV0gKVsgb3JpZ2luYWwgXSggZWxlbXMgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIE1vZGVybiBicm93c2VycyBjYW4gYXBwbHkgalF1ZXJ5IGNvbGxlY3Rpb25zIGFzIGFycmF5cywgYnV0IG9sZElFIG5lZWRzIGEgLmdldCgpDQogICAgICAgICAgICAgICAgICAgIGNvcmVfcHVzaC5hcHBseSggcmV0LCBlbGVtcy5nZXQoKSApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKCByZXQgKTsNCiAgICAgICAgICAgIH07DQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gZ2V0QWxsKCBjb250ZXh0LCB0YWcgKSB7DQogICAgICAgICAgICB2YXIgZWxlbXMsIGVsZW0sDQogICAgICAgICAgICAgICAgaSA9IDAsDQogICAgICAgICAgICAgICAgZm91bmQgPSB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gY29yZV9zdHJ1bmRlZmluZWQgPyBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCB0YWcgfHwgIioiICkgOg0KICAgICAgICAgICAgICAgICAgICB0eXBlb2YgY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsICE9PSBjb3JlX3N0cnVuZGVmaW5lZCA/IGNvbnRleHQucXVlcnlTZWxlY3RvckFsbCggdGFnIHx8ICIqIiApIDoNCiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkOw0KICAgICAgICANCiAgICAgICAgICAgIGlmICggIWZvdW5kICkgew0KICAgICAgICAgICAgICAgIGZvciAoIGZvdW5kID0gW10sIGVsZW1zID0gY29udGV4dC5jaGlsZE5vZGVzIHx8IGNvbnRleHQ7IChlbGVtID0gZWxlbXNbaV0pICE9IG51bGw7IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhdGFnIHx8IGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgdGFnICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3VuZC5wdXNoKCBlbGVtICk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkubWVyZ2UoIGZvdW5kLCBnZXRBbGwoIGVsZW0sIHRhZyApICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIHRhZyA9PT0gdW5kZWZpbmVkIHx8IHRhZyAmJiBqUXVlcnkubm9kZU5hbWUoIGNvbnRleHQsIHRhZyApID8NCiAgICAgICAgICAgICAgICBqUXVlcnkubWVyZ2UoIFsgY29udGV4dCBdLCBmb3VuZCApIDoNCiAgICAgICAgICAgICAgICBmb3VuZDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gVXNlZCBpbiBidWlsZEZyYWdtZW50LCBmaXhlcyB0aGUgZGVmYXVsdENoZWNrZWQgcHJvcGVydHkNCiAgICAgICAgZnVuY3Rpb24gZml4RGVmYXVsdENoZWNrZWQoIGVsZW0gKSB7DQogICAgICAgICAgICBpZiAoIG1hbmlwdWxhdGlvbl9yY2hlY2thYmxlVHlwZS50ZXN0KCBlbGVtLnR5cGUgKSApIHsNCiAgICAgICAgICAgICAgICBlbGVtLmRlZmF1bHRDaGVja2VkID0gZWxlbS5jaGVja2VkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZXh0ZW5kKHsNCiAgICAgICAgICAgIGNsb25lOiBmdW5jdGlvbiggZWxlbSwgZGF0YUFuZEV2ZW50cywgZGVlcERhdGFBbmRFdmVudHMgKSB7DQogICAgICAgICAgICAgICAgdmFyIGRlc3RFbGVtZW50cywgbm9kZSwgY2xvbmUsIGksIHNyY0VsZW1lbnRzLA0KICAgICAgICAgICAgICAgICAgICBpblBhZ2UgPSBqUXVlcnkuY29udGFpbnMoIGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5zdXBwb3J0Lmh0bWw1Q2xvbmUgfHwgalF1ZXJ5LmlzWE1MRG9jKGVsZW0pIHx8ICFybm9zaGltY2FjaGUudGVzdCggIjwiICsgZWxlbS5ub2RlTmFtZSArICI+IiApICkgew0KICAgICAgICAgICAgICAgICAgICBjbG9uZSA9IGVsZW0uY2xvbmVOb2RlKCB0cnVlICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIElFPD04IGRvZXMgbm90IHByb3Blcmx5IGNsb25lIGRldGFjaGVkLCB1bmtub3duIGVsZW1lbnQgbm9kZXMNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBmcmFnbWVudERpdi5pbm5lckhUTUwgPSBlbGVtLm91dGVySFRNTDsNCiAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnREaXYucmVtb3ZlQ2hpbGQoIGNsb25lID0gZnJhZ21lbnREaXYuZmlyc3RDaGlsZCApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCAoIWpRdWVyeS5zdXBwb3J0Lm5vQ2xvbmVFdmVudCB8fCAhalF1ZXJ5LnN1cHBvcnQubm9DbG9uZUNoZWNrZWQpICYmDQogICAgICAgICAgICAgICAgICAgICAgICAoZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBlbGVtLm5vZGVUeXBlID09PSAxMSkgJiYgIWpRdWVyeS5pc1hNTERvYyhlbGVtKSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFdlIGVzY2hldyBTaXp6bGUgaGVyZSBmb3IgcGVyZm9ybWFuY2UgcmVhc29uczogaHR0cDovL2pzcGVyZi5jb20vZ2V0YWxsLXZzLXNpenpsZS8yDQogICAgICAgICAgICAgICAgICAgIGRlc3RFbGVtZW50cyA9IGdldEFsbCggY2xvbmUgKTsNCiAgICAgICAgICAgICAgICAgICAgc3JjRWxlbWVudHMgPSBnZXRBbGwoIGVsZW0gKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEZpeCBhbGwgSUUgY2xvbmluZyBpc3N1ZXMNCiAgICAgICAgICAgICAgICAgICAgZm9yICggaSA9IDA7IChub2RlID0gc3JjRWxlbWVudHNbaV0pICE9IG51bGw7ICsraSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVuc3VyZSB0aGF0IHRoZSBkZXN0aW5hdGlvbiBub2RlIGlzIG5vdCBudWxsOyBGaXhlcyAjOTU4Nw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBkZXN0RWxlbWVudHNbaV0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJZml4Q2xvbmVOb2RlSXNzdWVzKCBub2RlLCBkZXN0RWxlbWVudHNbaV0gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQ29weSB0aGUgZXZlbnRzIGZyb20gdGhlIG9yaWdpbmFsIHRvIHRoZSBjbG9uZQ0KICAgICAgICAgICAgICAgIGlmICggZGF0YUFuZEV2ZW50cyApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBkZWVwRGF0YUFuZEV2ZW50cyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNyY0VsZW1lbnRzID0gc3JjRWxlbWVudHMgfHwgZ2V0QWxsKCBlbGVtICk7DQogICAgICAgICAgICAgICAgICAgICAgICBkZXN0RWxlbWVudHMgPSBkZXN0RWxlbWVudHMgfHwgZ2V0QWxsKCBjbG9uZSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwOyAobm9kZSA9IHNyY0VsZW1lbnRzW2ldKSAhPSBudWxsOyBpKysgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJY2xvbmVDb3B5RXZlbnQoIG5vZGUsIGRlc3RFbGVtZW50c1tpXSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgY2xvbmVDb3B5RXZlbnQoIGVsZW0sIGNsb25lICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFByZXNlcnZlIHNjcmlwdCBldmFsdWF0aW9uIGhpc3RvcnkNCiAgICAgICAgICAgICAgICBkZXN0RWxlbWVudHMgPSBnZXRBbGwoIGNsb25lLCAic2NyaXB0IiApOw0KICAgICAgICAgICAgICAgIGlmICggZGVzdEVsZW1lbnRzLmxlbmd0aCA+IDAgKSB7DQogICAgICAgICAgICAgICAgICAgIHNldEdsb2JhbEV2YWwoIGRlc3RFbGVtZW50cywgIWluUGFnZSAmJiBnZXRBbGwoIGVsZW0sICJzY3JpcHQiICkgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGRlc3RFbGVtZW50cyA9IHNyY0VsZW1lbnRzID0gbm9kZSA9IG51bGw7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFJldHVybiB0aGUgY2xvbmVkIHNldA0KICAgICAgICAgICAgICAgIHJldHVybiBjbG9uZTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgYnVpbGRGcmFnbWVudDogZnVuY3Rpb24oIGVsZW1zLCBjb250ZXh0LCBzY3JpcHRzLCBzZWxlY3Rpb24gKSB7DQogICAgICAgICAgICAgICAgdmFyIGosIGVsZW0sIGNvbnRhaW5zLA0KICAgICAgICAgICAgICAgICAgICB0bXAsIHRhZywgdGJvZHksIHdyYXAsDQogICAgICAgICAgICAgICAgICAgIGwgPSBlbGVtcy5sZW5ndGgsDQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBFbnN1cmUgYSBzYWZlIGZyYWdtZW50DQogICAgICAgICAgICAgICAgICAgIHNhZmUgPSBjcmVhdGVTYWZlRnJhZ21lbnQoIGNvbnRleHQgKSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG5vZGVzID0gW10sDQogICAgICAgICAgICAgICAgICAgIGkgPSAwOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBmb3IgKCA7IGkgPCBsOyBpKysgKSB7DQogICAgICAgICAgICAgICAgICAgIGVsZW0gPSBlbGVtc1sgaSBdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCBlbGVtIHx8IGVsZW0gPT09IDAgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIG5vZGVzIGRpcmVjdGx5DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS50eXBlKCBlbGVtICkgPT09ICJvYmplY3QiICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWpRdWVyeS5tZXJnZSggbm9kZXMsIGVsZW0ubm9kZVR5cGUgPyBbIGVsZW0gXSA6IGVsZW0gKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IG5vbi1odG1sIGludG8gYSB0ZXh0IG5vZGUNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoICFyaHRtbC50ZXN0KCBlbGVtICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJbm9kZXMucHVzaCggY29udGV4dC5jcmVhdGVUZXh0Tm9kZSggZWxlbSApICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29udmVydCBodG1sIGludG8gRE9NIG5vZGVzDQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgCXRtcCA9IHRtcCB8fCBzYWZlLmFwcGVuZENoaWxkKCBjb250ZXh0LmNyZWF0ZUVsZW1lbnQoImRpdiIpICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIERlc2VyaWFsaXplIGEgc3RhbmRhcmQgcmVwcmVzZW50YXRpb24NCiAgICAgICAgICAgICAgICAgICAgICAgIAl0YWcgPSAoIHJ0YWdOYW1lLmV4ZWMoIGVsZW0gKSB8fCBbIiIsICIiXSApWzFdLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAJd3JhcCA9IHdyYXBNYXBbIHRhZyBdIHx8IHdyYXBNYXAuX2RlZmF1bHQ7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCXRtcC5pbm5lckhUTUwgPSB3cmFwWzFdICsgZWxlbS5yZXBsYWNlKCByeGh0bWxUYWcsICI8JDE+PC8kMj4iICkgKyB3cmFwWzJdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBEZXNjZW5kIHRocm91Z2ggd3JhcHBlcnMgdG8gdGhlIHJpZ2h0IGNvbnRlbnQNCiAgICAgICAgICAgICAgICAgICAgICAgIAlqID0gd3JhcFswXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl3aGlsZSAoIGotLSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJdG1wID0gdG1wLmxhc3RDaGlsZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIE1hbnVhbGx5IGFkZCBsZWFkaW5nIHdoaXRlc3BhY2UgcmVtb3ZlZCBieSBJRQ0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggIWpRdWVyeS5zdXBwb3J0LmxlYWRpbmdXaGl0ZXNwYWNlICYmIHJsZWFkaW5nV2hpdGVzcGFjZS50ZXN0KCBlbGVtICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCW5vZGVzLnB1c2goIGNvbnRleHQuY3JlYXRlVGV4dE5vZGUoIHJsZWFkaW5nV2hpdGVzcGFjZS5leGVjKCBlbGVtIClbMF0gKSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gUmVtb3ZlIElFJ3MgYXV0b2luc2VydGVkIDx0Ym9keT4gZnJvbSB0YWJsZSBmcmFnbWVudHMNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoICFqUXVlcnkuc3VwcG9ydC50Ym9keSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIFN0cmluZyB3YXMgYSA8dGFibGU+LCAqbWF5KiBoYXZlIHNwdXJpb3VzIDx0Ym9keT4NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZWxlbSA9IHRhZyA9PT0gInRhYmxlIiAmJiAhcnRib2R5LnRlc3QoIGVsZW0gKSA/DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl0bXAuZmlyc3RDaGlsZCA6DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJLy8gU3RyaW5nIHdhcyBhIGJhcmUgPHRoZWFkPiBvciA8dGZvb3Q+DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl3cmFwWzFdID09PSAiPHRhYmxlPiIgJiYgIXJ0Ym9keS50ZXN0KCBlbGVtICkgPw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCXRtcCA6DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJMDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCWogPSBlbGVtICYmIGVsZW0uY2hpbGROb2Rlcy5sZW5ndGg7DQogICAgICAgICAgICAgICAgICAgICAgICAJCXdoaWxlICggai0tICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJaWYgKCBqUXVlcnkubm9kZU5hbWUoICh0Ym9keSA9IGVsZW0uY2hpbGROb2Rlc1tqXSksICJ0Ym9keSIgKSAmJiAhdGJvZHkuY2hpbGROb2Rlcy5sZW5ndGggKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJZWxlbS5yZW1vdmVDaGlsZCggdGJvZHkgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJalF1ZXJ5Lm1lcmdlKCBub2RlcywgdG1wLmNoaWxkTm9kZXMgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gRml4ICMxMjM5MiBmb3IgV2ViS2l0IGFuZCBJRSA+IDkNCiAgICAgICAgICAgICAgICAgICAgICAgIAl0bXAudGV4dENvbnRlbnQgPSAiIjsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gRml4ICMxMjM5MiBmb3Igb2xkSUUNCiAgICAgICAgICAgICAgICAgICAgICAgIAl3aGlsZSAoIHRtcC5maXJzdENoaWxkICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQl0bXAucmVtb3ZlQ2hpbGQoIHRtcC5maXJzdENoaWxkICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBSZW1lbWJlciB0aGUgdG9wLWxldmVsIGNvbnRhaW5lciBmb3IgcHJvcGVyIGNsZWFudXANCiAgICAgICAgICAgICAgICAgICAgICAgIAl0bXAgPSBzYWZlLmxhc3RDaGlsZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gRml4ICMxMTM1NjogQ2xlYXIgZWxlbWVudHMgZnJvbSBmcmFnbWVudA0KICAgICAgICAgICAgICAgIGlmICggdG1wICkgew0KICAgICAgICAgICAgICAgICAgICBzYWZlLnJlbW92ZUNoaWxkKCB0bXAgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFJlc2V0IGRlZmF1bHRDaGVja2VkIGZvciBhbnkgcmFkaW9zIGFuZCBjaGVja2JveGVzDQogICAgICAgICAgICAgICAgLy8gYWJvdXQgdG8gYmUgYXBwZW5kZWQgdG8gdGhlIERPTSBpbiBJRSA2LzcgKCM4MDYwKQ0KICAgICAgICAgICAgICAgIGlmICggIWpRdWVyeS5zdXBwb3J0LmFwcGVuZENoZWNrZWQgKSB7DQogICAgICAgICAgICAgICAgICAgIGpRdWVyeS5ncmVwKCBnZXRBbGwoIG5vZGVzLCAiaW5wdXQiICksIGZpeERlZmF1bHRDaGVja2VkICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpID0gMDsNCiAgICAgICAgICAgICAgICB3aGlsZSAoIChlbGVtID0gbm9kZXNbIGkrKyBdKSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vICM0MDg3IC0gSWYgb3JpZ2luIGFuZCBkZXN0aW5hdGlvbiBlbGVtZW50cyBhcmUgdGhlIHNhbWUsIGFuZCB0aGlzIGlzDQogICAgICAgICAgICAgICAgICAgIC8vIHRoYXQgZWxlbWVudCwgZG8gbm90IGRvIGFueXRoaW5nDQogICAgICAgICAgICAgICAgICAgIGlmICggc2VsZWN0aW9uICYmIGpRdWVyeS5pbkFycmF5KCBlbGVtLCBzZWxlY3Rpb24gKSAhPT0gLTEgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgY29udGFpbnMgPSBqUXVlcnkuY29udGFpbnMoIGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gQXBwZW5kIHRvIGZyYWdtZW50DQogICAgICAgICAgICAgICAgICAgIHRtcCA9IGdldEFsbCggc2FmZS5hcHBlbmRDaGlsZCggZWxlbSApLCAic2NyaXB0IiApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gUHJlc2VydmUgc2NyaXB0IGV2YWx1YXRpb24gaGlzdG9yeQ0KICAgICAgICAgICAgICAgICAgICBpZiAoIGNvbnRhaW5zICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2V0R2xvYmFsRXZhbCggdG1wICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIENhcHR1cmUgZXhlY3V0YWJsZXMNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBzY3JpcHRzICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaiA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIChlbGVtID0gdG1wWyBqKysgXSkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCByc2NyaXB0VHlwZS50ZXN0KCBlbGVtLnR5cGUgfHwgIiIgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJc2NyaXB0cy5wdXNoKCBlbGVtICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICB0bXAgPSBudWxsOw0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gc2FmZTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgY2xlYW5EYXRhOiBmdW5jdGlvbiggZWxlbXMsIC8qIGludGVybmFsICovIGFjY2VwdERhdGEgKSB7DQogICAgICAgICAgICAgICAgdmFyIGVsZW0sIHR5cGUsIGlkLCBkYXRhLA0KICAgICAgICAgICAgICAgICAgICBpID0gMCwNCiAgICAgICAgICAgICAgICAgICAgaW50ZXJuYWxLZXkgPSBqUXVlcnkuZXhwYW5kbywNCiAgICAgICAgICAgICAgICAgICAgY2FjaGUgPSBqUXVlcnkuY2FjaGUsDQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZUV4cGFuZG8gPSBqUXVlcnkuc3VwcG9ydC5kZWxldGVFeHBhbmRvLA0KICAgICAgICAgICAgICAgICAgICBzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWw7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGZvciAoIDsgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCBhY2NlcHREYXRhIHx8IGpRdWVyeS5hY2NlcHREYXRhKCBlbGVtICkgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSBlbGVtWyBpbnRlcm5hbEtleSBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGlkICYmIGNhY2hlWyBpZCBdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZGF0YSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIGRhdGEuZXZlbnRzICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlmb3IgKCB0eXBlIGluIGRhdGEuZXZlbnRzICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJaWYgKCBzcGVjaWFsWyB0eXBlIF0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJalF1ZXJ5LmV2ZW50LnJlbW92ZSggZWxlbSwgdHlwZSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCS8vIFRoaXMgaXMgYSBzaG9ydGN1dCB0byBhdm9pZCBqUXVlcnkuZXZlbnQucmVtb3ZlJ3Mgb3ZlcmhlYWQNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCX0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJalF1ZXJ5LnJlbW92ZUV2ZW50KCBlbGVtLCB0eXBlLCBkYXRhLmhhbmRsZSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBSZW1vdmUgY2FjaGUgb25seSBpZiBpdCB3YXMgbm90IGFscmVhZHkgcmVtb3ZlZCBieSBqUXVlcnkuZXZlbnQucmVtb3ZlDQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBjYWNoZVsgaWQgXSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCWRlbGV0ZSBjYWNoZVsgaWQgXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIElFIGRvZXMgbm90IGFsbG93IHVzIHRvIGRlbGV0ZSBleHBhbmRvIHByb3BlcnRpZXMgZnJvbSBub2RlcywNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gbm9yIGRvZXMgaXQgaGF2ZSBhIHJlbW92ZUF0dHJpYnV0ZSBmdW5jdGlvbiBvbiBEb2N1bWVudCBub2RlczsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gd2UgbXVzdCBoYW5kbGUgYWxsIG9mIHRoZXNlIGNhc2VzDQogICAgICAgICAgICAgICAgICAgICAgICAJCWlmICggZGVsZXRlRXhwYW5kbyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWRlbGV0ZSBlbGVtWyBpbnRlcm5hbEtleSBdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfSBlbHNlIGlmICggdHlwZW9mIGVsZW0ucmVtb3ZlQXR0cmlidXRlICE9PSBjb3JlX3N0cnVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWVsZW0ucmVtb3ZlQXR0cmlidXRlKCBpbnRlcm5hbEtleSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWVsZW1bIGludGVybmFsS2V5IF0gPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQljb3JlX2RlbGV0ZWRJZHMucHVzaCggaWQgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICB2YXIgaWZyYW1lLCBnZXRTdHlsZXMsIGN1ckNTUywNCiAgICAgICAgICAgIHJhbHBoYSA9IC9hbHBoYVwoW14pXSpcKS9pLA0KICAgICAgICAgICAgcm9wYWNpdHkgPSAvb3BhY2l0eVxzKj1ccyooW14pXSopLywNCiAgICAgICAgICAgIHJwb3NpdGlvbiA9IC9eKHRvcHxyaWdodHxib3R0b218bGVmdCkkLywNCiAgICAgICAgICAgIC8vIHN3YXBwYWJsZSBpZiBkaXNwbGF5IGlzIG5vbmUgb3Igc3RhcnRzIHdpdGggdGFibGUgZXhjZXB0ICJ0YWJsZSIsICJ0YWJsZS1jZWxsIiwgb3IgInRhYmxlLWNhcHRpb24iDQogICAgICAgICAgICAvLyBzZWUgaGVyZSBmb3IgZGlzcGxheSB2YWx1ZXM6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvQ1NTL2Rpc3BsYXkNCiAgICAgICAgICAgIHJkaXNwbGF5c3dhcCA9IC9eKG5vbmV8dGFibGUoPyEtY1tlYV0pLispLywNCiAgICAgICAgICAgIHJtYXJnaW4gPSAvXm1hcmdpbi8sDQogICAgICAgICAgICBybnVtc3BsaXQgPSBuZXcgUmVnRXhwKCAiXigiICsgY29yZV9wbnVtICsgIikoLiopJCIsICJpIiApLA0KICAgICAgICAgICAgcm51bW5vbnB4ID0gbmV3IFJlZ0V4cCggIl4oIiArIGNvcmVfcG51bSArICIpKD8hcHgpW2EteiVdKyQiLCAiaSIgKSwNCiAgICAgICAgICAgIHJyZWxOdW0gPSBuZXcgUmVnRXhwKCAiXihbKy1dKT0oIiArIGNvcmVfcG51bSArICIpIiwgImkiICksDQogICAgICAgICAgICBlbGVtZGlzcGxheSA9IHsgQk9EWTogImJsb2NrIiB9LA0KICAgICAgICANCiAgICAgICAgICAgIGNzc1Nob3cgPSB7IHBvc2l0aW9uOiAiYWJzb2x1dGUiLCB2aXNpYmlsaXR5OiAiaGlkZGVuIiwgZGlzcGxheTogImJsb2NrIiB9LA0KICAgICAgICAgICAgY3NzTm9ybWFsVHJhbnNmb3JtID0gew0KICAgICAgICAgICAgICAgIGxldHRlclNwYWNpbmc6IDAsDQogICAgICAgICAgICAgICAgZm9udFdlaWdodDogNDAwDQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGNzc0V4cGFuZCA9IFsgIlRvcCIsICJSaWdodCIsICJCb3R0b20iLCAiTGVmdCIgXSwNCiAgICAgICAgICAgIGNzc1ByZWZpeGVzID0gWyAiV2Via2l0IiwgIk8iLCAiTW96IiwgIm1zIiBdOw0KICAgICAgICANCiAgICAgICAgLy8gcmV0dXJuIGEgY3NzIHByb3BlcnR5IG1hcHBlZCB0byBhIHBvdGVudGlhbGx5IHZlbmRvciBwcmVmaXhlZCBwcm9wZXJ0eQ0KICAgICAgICBmdW5jdGlvbiB2ZW5kb3JQcm9wTmFtZSggc3R5bGUsIG5hbWUgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gc2hvcnRjdXQgZm9yIG5hbWVzIHRoYXQgYXJlIG5vdCB2ZW5kb3IgcHJlZml4ZWQNCiAgICAgICAgICAgIGlmICggbmFtZSBpbiBzdHlsZSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAvLyBjaGVjayBmb3IgdmVuZG9yIHByZWZpeGVkIG5hbWVzDQogICAgICAgICAgICB2YXIgY2FwTmFtZSA9IG5hbWUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBuYW1lLnNsaWNlKDEpLA0KICAgICAgICAgICAgICAgIG9yaWdOYW1lID0gbmFtZSwNCiAgICAgICAgICAgICAgICBpID0gY3NzUHJlZml4ZXMubGVuZ3RoOw0KICAgICAgICANCiAgICAgICAgICAgIHdoaWxlICggaS0tICkgew0KICAgICAgICAgICAgICAgIG5hbWUgPSBjc3NQcmVmaXhlc1sgaSBdICsgY2FwTmFtZTsNCiAgICAgICAgICAgICAgICBpZiAoIG5hbWUgaW4gc3R5bGUgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuYW1lOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gb3JpZ05hbWU7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIGlzSGlkZGVuKCBlbGVtLCBlbCApIHsNCiAgICAgICAgICAgIC8vIGlzSGlkZGVuIG1pZ2h0IGJlIGNhbGxlZCBmcm9tIGpRdWVyeSNmaWx0ZXIgZnVuY3Rpb247DQogICAgICAgICAgICAvLyBpbiB0aGF0IGNhc2UsIGVsZW1lbnQgd2lsbCBiZSBzZWNvbmQgYXJndW1lbnQNCiAgICAgICAgICAgIGVsZW0gPSBlbCB8fCBlbGVtOw0KICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApID09PSAibm9uZSIgfHwgIWpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIHNob3dIaWRlKCBlbGVtZW50cywgc2hvdyApIHsNCiAgICAgICAgICAgIHZhciBkaXNwbGF5LCBlbGVtLCBoaWRkZW4sDQogICAgICAgICAgICAgICAgdmFsdWVzID0gW10sDQogICAgICAgICAgICAgICAgaW5kZXggPSAwLA0KICAgICAgICAgICAgICAgIGxlbmd0aCA9IGVsZW1lbnRzLmxlbmd0aDsNCiAgICAgICAgDQogICAgICAgICAgICBmb3IgKCA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkgew0KICAgICAgICAgICAgICAgIGVsZW0gPSBlbGVtZW50c1sgaW5kZXggXTsNCiAgICAgICAgICAgICAgICBpZiAoICFlbGVtLnN0eWxlICkgew0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHZhbHVlc1sgaW5kZXggXSA9IGpRdWVyeS5fZGF0YSggZWxlbSwgIm9sZGRpc3BsYXkiICk7DQogICAgICAgICAgICAgICAgZGlzcGxheSA9IGVsZW0uc3R5bGUuZGlzcGxheTsNCiAgICAgICAgICAgICAgICBpZiAoIHNob3cgKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFJlc2V0IHRoZSBpbmxpbmUgZGlzcGxheSBvZiB0aGlzIGVsZW1lbnQgdG8gbGVhcm4gaWYgaXQgaXMNCiAgICAgICAgICAgICAgICAgICAgLy8gYmVpbmcgaGlkZGVuIGJ5IGNhc2NhZGVkIHJ1bGVzIG9yIG5vdA0KICAgICAgICAgICAgICAgICAgICBpZiAoICF2YWx1ZXNbIGluZGV4IF0gJiYgZGlzcGxheSA9PT0gIm5vbmUiICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5zdHlsZS5kaXNwbGF5ID0gIiI7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFNldCBlbGVtZW50cyB3aGljaCBoYXZlIGJlZW4gb3ZlcnJpZGRlbiB3aXRoIGRpc3BsYXk6IG5vbmUNCiAgICAgICAgICAgICAgICAgICAgLy8gaW4gYSBzdHlsZXNoZWV0IHRvIHdoYXRldmVyIHRoZSBkZWZhdWx0IGJyb3dzZXIgc3R5bGUgaXMNCiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIHN1Y2ggYW4gZWxlbWVudA0KICAgICAgICAgICAgICAgICAgICBpZiAoIGVsZW0uc3R5bGUuZGlzcGxheSA9PT0gIiIgJiYgaXNIaWRkZW4oIGVsZW0gKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1sgaW5kZXggXSA9IGpRdWVyeS5fZGF0YSggZWxlbSwgIm9sZGRpc3BsYXkiLCBjc3NfZGVmYXVsdERpc3BsYXkoZWxlbS5ub2RlTmFtZSkgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoICF2YWx1ZXNbIGluZGV4IF0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBoaWRkZW4gPSBpc0hpZGRlbiggZWxlbSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZGlzcGxheSAmJiBkaXNwbGF5ICE9PSAibm9uZSIgfHwgIWhpZGRlbiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlqUXVlcnkuX2RhdGEoIGVsZW0sICJvbGRkaXNwbGF5IiwgaGlkZGVuID8gZGlzcGxheSA6IGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gU2V0IHRoZSBkaXNwbGF5IG9mIG1vc3Qgb2YgdGhlIGVsZW1lbnRzIGluIGEgc2Vjb25kIGxvb3ANCiAgICAgICAgICAgIC8vIHRvIGF2b2lkIHRoZSBjb25zdGFudCByZWZsb3cNCiAgICAgICAgICAgIGZvciAoIGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7DQogICAgICAgICAgICAgICAgZWxlbSA9IGVsZW1lbnRzWyBpbmRleCBdOw0KICAgICAgICAgICAgICAgIGlmICggIWVsZW0uc3R5bGUgKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoICFzaG93IHx8IGVsZW0uc3R5bGUuZGlzcGxheSA9PT0gIm5vbmUiIHx8IGVsZW0uc3R5bGUuZGlzcGxheSA9PT0gIiIgKSB7DQogICAgICAgICAgICAgICAgICAgIGVsZW0uc3R5bGUuZGlzcGxheSA9IHNob3cgPyB2YWx1ZXNbIGluZGV4IF0gfHwgIiIgOiAibm9uZSI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBlbGVtZW50czsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgalF1ZXJ5LmZuLmV4dGVuZCh7DQogICAgICAgICAgICBjc3M6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgbGVuLCBzdHlsZXMsDQogICAgICAgICAgICAgICAgICAgICAgICBtYXAgPSB7fSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSAwOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNBcnJheSggbmFtZSApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVzID0gZ2V0U3R5bGVzKCBlbGVtICk7DQogICAgICAgICAgICAgICAgICAgICAgICBsZW4gPSBuYW1lLmxlbmd0aDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAltYXBbIG5hbWVbIGkgXSBdID0galF1ZXJ5LmNzcyggZWxlbSwgbmFtZVsgaSBdLCBmYWxzZSwgc3R5bGVzICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hcDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlICE9PSB1bmRlZmluZWQgPw0KICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LnN0eWxlKCBlbGVtLCBuYW1lLCB2YWx1ZSApIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5jc3MoIGVsZW0sIG5hbWUgKTsNCiAgICAgICAgICAgICAgICB9LCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBzaG93OiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gc2hvd0hpZGUoIHRoaXMsIHRydWUgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBoaWRlOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gc2hvd0hpZGUoIHRoaXMgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKCBzdGF0ZSApIHsNCiAgICAgICAgICAgICAgICB2YXIgYm9vbCA9IHR5cGVvZiBzdGF0ZSA9PT0gImJvb2xlYW4iOw0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIGJvb2wgPyBzdGF0ZSA6IGlzSGlkZGVuKCB0aGlzICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIHRoaXMgKS5zaG93KCk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIHRoaXMgKS5oaWRlKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZXh0ZW5kKHsNCiAgICAgICAgICAgIC8vIEFkZCBpbiBzdHlsZSBwcm9wZXJ0eSBob29rcyBmb3Igb3ZlcnJpZGluZyB0aGUgZGVmYXVsdA0KICAgICAgICAgICAgLy8gYmVoYXZpb3Igb2YgZ2V0dGluZyBhbmQgc2V0dGluZyBhIHN0eWxlIHByb3BlcnR5DQogICAgICAgICAgICBjc3NIb29rczogew0KICAgICAgICAgICAgICAgIG9wYWNpdHk6IHsNCiAgICAgICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiggZWxlbSwgY29tcHV0ZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGNvbXB1dGVkICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIFdlIHNob3VsZCBhbHdheXMgZ2V0IGEgbnVtYmVyIGJhY2sgZnJvbSBvcGFjaXR5DQogICAgICAgICAgICAgICAgICAgICAgICAJdmFyIHJldCA9IGN1ckNTUyggZWxlbSwgIm9wYWNpdHkiICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIHJldCA9PT0gIiIgPyAiMSIgOiByZXQ7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIC8vIEV4Y2x1ZGUgdGhlIGZvbGxvd2luZyBjc3MgcHJvcGVydGllcyB0byBhZGQgcHgNCiAgICAgICAgICAgIGNzc051bWJlcjogew0KICAgICAgICAgICAgICAgICJjb2x1bW5Db3VudCI6IHRydWUsDQogICAgICAgICAgICAgICAgImZpbGxPcGFjaXR5IjogdHJ1ZSwNCiAgICAgICAgICAgICAgICAiZm9udFdlaWdodCI6IHRydWUsDQogICAgICAgICAgICAgICAgImxpbmVIZWlnaHQiOiB0cnVlLA0KICAgICAgICAgICAgICAgICJvcGFjaXR5IjogdHJ1ZSwNCiAgICAgICAgICAgICAgICAib3JwaGFucyI6IHRydWUsDQogICAgICAgICAgICAgICAgIndpZG93cyI6IHRydWUsDQogICAgICAgICAgICAgICAgInpJbmRleCI6IHRydWUsDQogICAgICAgICAgICAgICAgInpvb20iOiB0cnVlDQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIC8vIEFkZCBpbiBwcm9wZXJ0aWVzIHdob3NlIG5hbWVzIHlvdSB3aXNoIHRvIGZpeCBiZWZvcmUNCiAgICAgICAgICAgIC8vIHNldHRpbmcgb3IgZ2V0dGluZyB0aGUgdmFsdWUNCiAgICAgICAgICAgIGNzc1Byb3BzOiB7DQogICAgICAgICAgICAgICAgLy8gbm9ybWFsaXplIGZsb2F0IGNzcyBwcm9wZXJ0eQ0KICAgICAgICAgICAgICAgICJmbG9hdCI6IGpRdWVyeS5zdXBwb3J0LmNzc0Zsb2F0ID8gImNzc0Zsb2F0IiA6ICJzdHlsZUZsb2F0Ig0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBHZXQgYW5kIHNldCB0aGUgc3R5bGUgcHJvcGVydHkgb24gYSBET00gTm9kZQ0KICAgICAgICAgICAgc3R5bGU6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCB2YWx1ZSwgZXh0cmEgKSB7DQogICAgICAgICAgICAgICAgLy8gRG9uJ3Qgc2V0IHN0eWxlcyBvbiB0ZXh0IGFuZCBjb21tZW50IG5vZGVzDQogICAgICAgICAgICAgICAgaWYgKCAhZWxlbSB8fCBlbGVtLm5vZGVUeXBlID09PSAzIHx8IGVsZW0ubm9kZVR5cGUgPT09IDggfHwgIWVsZW0uc3R5bGUgKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHdlJ3JlIHdvcmtpbmcgd2l0aCB0aGUgcmlnaHQgbmFtZQ0KICAgICAgICAgICAgICAgIHZhciByZXQsIHR5cGUsIGhvb2tzLA0KICAgICAgICAgICAgICAgICAgICBvcmlnTmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKSwNCiAgICAgICAgICAgICAgICAgICAgc3R5bGUgPSBlbGVtLnN0eWxlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBuYW1lID0galF1ZXJ5LmNzc1Byb3BzWyBvcmlnTmFtZSBdIHx8ICggalF1ZXJ5LmNzc1Byb3BzWyBvcmlnTmFtZSBdID0gdmVuZG9yUHJvcE5hbWUoIHN0eWxlLCBvcmlnTmFtZSApICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIGdldHMgaG9vayBmb3IgdGhlIHByZWZpeGVkIHZlcnNpb24NCiAgICAgICAgICAgICAgICAvLyBmb2xsb3dlZCBieSB0aGUgdW5wcmVmaXhlZCB2ZXJzaW9uDQogICAgICAgICAgICAgICAgaG9va3MgPSBqUXVlcnkuY3NzSG9va3NbIG5hbWUgXSB8fCBqUXVlcnkuY3NzSG9va3NbIG9yaWdOYW1lIF07DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHdlJ3JlIHNldHRpbmcgYSB2YWx1ZQ0KICAgICAgICAgICAgICAgIGlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IHR5cGVvZiB2YWx1ZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIGNvbnZlcnQgcmVsYXRpdmUgbnVtYmVyIHN0cmluZ3MgKCs9IG9yIC09KSB0byByZWxhdGl2ZSBudW1iZXJzLiAjNzM0NQ0KICAgICAgICAgICAgICAgICAgICBpZiAoIHR5cGUgPT09ICJzdHJpbmciICYmIChyZXQgPSBycmVsTnVtLmV4ZWMoIHZhbHVlICkpICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAoIHJldFsxXSArIDEgKSAqIHJldFsyXSArIHBhcnNlRmxvYXQoIGpRdWVyeS5jc3MoIGVsZW0sIG5hbWUgKSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gRml4ZXMgYnVnICM5MjM3DQogICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gIm51bWJlciI7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IE5hTiBhbmQgbnVsbCB2YWx1ZXMgYXJlbid0IHNldC4gU2VlOiAjNzExNg0KICAgICAgICAgICAgICAgICAgICBpZiAoIHZhbHVlID09IG51bGwgfHwgdHlwZSA9PT0gIm51bWJlciIgJiYgaXNOYU4oIHZhbHVlICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIElmIGEgbnVtYmVyIHdhcyBwYXNzZWQgaW4sIGFkZCAncHgnIHRvIHRoZSAoZXhjZXB0IGZvciBjZXJ0YWluIENTUyBwcm9wZXJ0aWVzKQ0KICAgICAgICAgICAgICAgICAgICBpZiAoIHR5cGUgPT09ICJudW1iZXIiICYmICFqUXVlcnkuY3NzTnVtYmVyWyBvcmlnTmFtZSBdICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gInB4IjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gRml4ZXMgIzg5MDgsIGl0IGNhbiBiZSBkb25lIG1vcmUgY29ycmVjdGx5IGJ5IHNwZWNpZmluZyBzZXR0ZXJzIGluIGNzc0hvb2tzLA0KICAgICAgICAgICAgICAgICAgICAvLyBidXQgaXQgd291bGQgbWVhbiB0byBkZWZpbmUgZWlnaHQgKGZvciBldmVyeSBwcm9ibGVtYXRpYyBwcm9wZXJ0eSkgaWRlbnRpY2FsIGZ1bmN0aW9ucw0KICAgICAgICAgICAgICAgICAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC5jbGVhckNsb25lU3R5bGUgJiYgdmFsdWUgPT09ICIiICYmIG5hbWUuaW5kZXhPZigiYmFja2dyb3VuZCIpID09PSAwICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVbIG5hbWUgXSA9ICJpbmhlcml0IjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCwgdXNlIHRoYXQgdmFsdWUsIG90aGVyd2lzZSBqdXN0IHNldCB0aGUgc3BlY2lmaWVkIHZhbHVlDQogICAgICAgICAgICAgICAgICAgIGlmICggIWhvb2tzIHx8ICEoInNldCIgaW4gaG9va3MpIHx8ICh2YWx1ZSA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIGV4dHJhICkpICE9PSB1bmRlZmluZWQgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gV3JhcHBlZCB0byBwcmV2ZW50IElFIGZyb20gdGhyb3dpbmcgZXJyb3JzIHdoZW4gJ2ludmFsaWQnIHZhbHVlcyBhcmUgcHJvdmlkZWQNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpeGVzIGJ1ZyAjNTUwOQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlzdHlsZVsgbmFtZSBdID0gdmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHt9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCBnZXQgdGhlIG5vbi1jb21wdXRlZCB2YWx1ZSBmcm9tIHRoZXJlDQogICAgICAgICAgICAgICAgICAgIGlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgZmFsc2UsIGV4dHJhICkpICE9PSB1bmRlZmluZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UganVzdCBnZXQgdGhlIHZhbHVlIGZyb20gdGhlIHN0eWxlIG9iamVjdA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3R5bGVbIG5hbWUgXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGNzczogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGV4dHJhLCBzdHlsZXMgKSB7DQogICAgICAgICAgICAgICAgdmFyIG51bSwgdmFsLCBob29rcywNCiAgICAgICAgICAgICAgICAgICAgb3JpZ05hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKCBuYW1lICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHdlJ3JlIHdvcmtpbmcgd2l0aCB0aGUgcmlnaHQgbmFtZQ0KICAgICAgICAgICAgICAgIG5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gfHwgKCBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gPSB2ZW5kb3JQcm9wTmFtZSggZWxlbS5zdHlsZSwgb3JpZ05hbWUgKSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBnZXRzIGhvb2sgZm9yIHRoZSBwcmVmaXhlZCB2ZXJzaW9uDQogICAgICAgICAgICAgICAgLy8gZm9sbG93ZWQgYnkgdGhlIHVucHJlZml4ZWQgdmVyc2lvbg0KICAgICAgICAgICAgICAgIGhvb2tzID0galF1ZXJ5LmNzc0hvb2tzWyBuYW1lIF0gfHwgalF1ZXJ5LmNzc0hvb2tzWyBvcmlnTmFtZSBdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkIGdldCB0aGUgY29tcHV0ZWQgdmFsdWUgZnJvbSB0aGVyZQ0KICAgICAgICAgICAgICAgIGlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgKSB7DQogICAgICAgICAgICAgICAgICAgIHZhbCA9IGhvb2tzLmdldCggZWxlbSwgdHJ1ZSwgZXh0cmEgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgaWYgYSB3YXkgdG8gZ2V0IHRoZSBjb21wdXRlZCB2YWx1ZSBleGlzdHMsIHVzZSB0aGF0DQogICAgICAgICAgICAgICAgaWYgKCB2YWwgPT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFsID0gY3VyQ1NTKCBlbGVtLCBuYW1lLCBzdHlsZXMgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vY29udmVydCAibm9ybWFsIiB0byBjb21wdXRlZCB2YWx1ZQ0KICAgICAgICAgICAgICAgIGlmICggdmFsID09PSAibm9ybWFsIiAmJiBuYW1lIGluIGNzc05vcm1hbFRyYW5zZm9ybSApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFsID0gY3NzTm9ybWFsVHJhbnNmb3JtWyBuYW1lIF07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBSZXR1cm4sIGNvbnZlcnRpbmcgdG8gbnVtYmVyIGlmIGZvcmNlZCBvciBhIHF1YWxpZmllciB3YXMgcHJvdmlkZWQgYW5kIHZhbCBsb29rcyBudW1lcmljDQogICAgICAgICAgICAgICAgaWYgKCBleHRyYSA9PT0gIiIgfHwgZXh0cmEgKSB7DQogICAgICAgICAgICAgICAgICAgIG51bSA9IHBhcnNlRmxvYXQoIHZhbCApOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXh0cmEgPT09IHRydWUgfHwgalF1ZXJ5LmlzTnVtZXJpYyggbnVtICkgPyBudW0gfHwgMCA6IHZhbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgLy8gQSBtZXRob2QgZm9yIHF1aWNrbHkgc3dhcHBpbmcgaW4vb3V0IENTUyBwcm9wZXJ0aWVzIHRvIGdldCBjb3JyZWN0IGNhbGN1bGF0aW9ucw0KICAgICAgICAgICAgc3dhcDogZnVuY3Rpb24oIGVsZW0sIG9wdGlvbnMsIGNhbGxiYWNrLCBhcmdzICkgew0KICAgICAgICAgICAgICAgIHZhciByZXQsIG5hbWUsDQogICAgICAgICAgICAgICAgICAgIG9sZCA9IHt9Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBSZW1lbWJlciB0aGUgb2xkIHZhbHVlcywgYW5kIGluc2VydCB0aGUgbmV3IG9uZXMNCiAgICAgICAgICAgICAgICBmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7DQogICAgICAgICAgICAgICAgICAgIG9sZFsgbmFtZSBdID0gZWxlbS5zdHlsZVsgbmFtZSBdOw0KICAgICAgICAgICAgICAgICAgICBlbGVtLnN0eWxlWyBuYW1lIF0gPSBvcHRpb25zWyBuYW1lIF07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXQgPSBjYWxsYmFjay5hcHBseSggZWxlbSwgYXJncyB8fCBbXSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBSZXZlcnQgdGhlIG9sZCB2YWx1ZXMNCiAgICAgICAgICAgICAgICBmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7DQogICAgICAgICAgICAgICAgICAgIGVsZW0uc3R5bGVbIG5hbWUgXSA9IG9sZFsgbmFtZSBdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAvLyBOT1RFOiB3ZSd2ZSBpbmNsdWRlZCB0aGUgIndpbmRvdyIgaW4gd2luZG93LmdldENvbXB1dGVkU3R5bGUNCiAgICAgICAgLy8gYmVjYXVzZSBqc2RvbSBvbiBub2RlLmpzIHdpbGwgYnJlYWsgd2l0aG91dCBpdC4NCiAgICAgICAgaWYgKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSApIHsNCiAgICAgICAgICAgIGdldFN0eWxlcyA9IGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgIHJldHVybiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSggZWxlbSwgbnVsbCApOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgICAgICBjdXJDU1MgPSBmdW5jdGlvbiggZWxlbSwgbmFtZSwgX2NvbXB1dGVkICkgew0KICAgICAgICAgICAgICAgIHZhciB3aWR0aCwgbWluV2lkdGgsIG1heFdpZHRoLA0KICAgICAgICAgICAgICAgICAgICBjb21wdXRlZCA9IF9jb21wdXRlZCB8fCBnZXRTdHlsZXMoIGVsZW0gKSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIGdldFByb3BlcnR5VmFsdWUgaXMgb25seSBuZWVkZWQgZm9yIC5jc3MoJ2ZpbHRlcicpIGluIElFOSwgc2VlICMxMjUzNw0KICAgICAgICAgICAgICAgICAgICByZXQgPSBjb21wdXRlZCA/IGNvbXB1dGVkLmdldFByb3BlcnR5VmFsdWUoIG5hbWUgKSB8fCBjb21wdXRlZFsgbmFtZSBdIDogdW5kZWZpbmVkLA0KICAgICAgICAgICAgICAgICAgICBzdHlsZSA9IGVsZW0uc3R5bGU7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggY29tcHV0ZWQgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoIHJldCA9PT0gIiIgJiYgIWpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBqUXVlcnkuc3R5bGUoIGVsZW0sIG5hbWUgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gQSB0cmlidXRlIHRvIHRoZSAiYXdlc29tZSBoYWNrIGJ5IERlYW4gRWR3YXJkcyINCiAgICAgICAgICAgICAgICAgICAgLy8gQ2hyb21lIDwgMTcgYW5kIFNhZmFyaSA1LjAgdXNlcyAiY29tcHV0ZWQgdmFsdWUiIGluc3RlYWQgb2YgInVzZWQgdmFsdWUiIGZvciBtYXJnaW4tcmlnaHQNCiAgICAgICAgICAgICAgICAgICAgLy8gU2FmYXJpIDUuMS43IChhdCBsZWFzdCkgcmV0dXJucyBwZXJjZW50YWdlIGZvciBhIGxhcmdlciBzZXQgb2YgdmFsdWVzLCBidXQgd2lkdGggc2VlbXMgdG8gYmUgcmVsaWFibHkgcGl4ZWxzDQogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgYWdhaW5zdCB0aGUgQ1NTT00gZHJhZnQgc3BlYzogaHR0cDovL2Rldi53My5vcmcvY3Nzd2cvY3Nzb20vI3Jlc29sdmVkLXZhbHVlcw0KICAgICAgICAgICAgICAgICAgICBpZiAoIHJudW1ub25weC50ZXN0KCByZXQgKSAmJiBybWFyZ2luLnRlc3QoIG5hbWUgKSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1lbWJlciB0aGUgb3JpZ2luYWwgdmFsdWVzDQogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IHN0eWxlLndpZHRoOw0KICAgICAgICAgICAgICAgICAgICAgICAgbWluV2lkdGggPSBzdHlsZS5taW5XaWR0aDsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1heFdpZHRoID0gc3R5bGUubWF4V2lkdGg7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHV0IGluIHRoZSBuZXcgdmFsdWVzIHRvIGdldCBhIGNvbXB1dGVkIHZhbHVlIG91dA0KICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGUubWluV2lkdGggPSBzdHlsZS5tYXhXaWR0aCA9IHN0eWxlLndpZHRoID0gcmV0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gY29tcHV0ZWQud2lkdGg7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmV2ZXJ0IHRoZSBjaGFuZ2VkIHZhbHVlcw0KICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGUud2lkdGggPSB3aWR0aDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlLm1pbldpZHRoID0gbWluV2lkdGg7DQogICAgICAgICAgICAgICAgICAgICAgICBzdHlsZS5tYXhXaWR0aCA9IG1heFdpZHRoOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICAgICAgfTsNCiAgICAgICAgfSBlbHNlIGlmICggZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmN1cnJlbnRTdHlsZSApIHsNCiAgICAgICAgICAgIGdldFN0eWxlcyA9IGZ1bmN0aW9uKCBlbGVtICkgew0KICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLmN1cnJlbnRTdHlsZTsNCiAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAgICAgY3VyQ1NTID0gZnVuY3Rpb24oIGVsZW0sIG5hbWUsIF9jb21wdXRlZCApIHsNCiAgICAgICAgICAgICAgICB2YXIgbGVmdCwgcnMsIHJzTGVmdCwNCiAgICAgICAgICAgICAgICAgICAgY29tcHV0ZWQgPSBfY29tcHV0ZWQgfHwgZ2V0U3R5bGVzKCBlbGVtICksDQogICAgICAgICAgICAgICAgICAgIHJldCA9IGNvbXB1dGVkID8gY29tcHV0ZWRbIG5hbWUgXSA6IHVuZGVmaW5lZCwNCiAgICAgICAgICAgICAgICAgICAgc3R5bGUgPSBlbGVtLnN0eWxlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBBdm9pZCBzZXR0aW5nIHJldCB0byBlbXB0eSBzdHJpbmcgaGVyZQ0KICAgICAgICAgICAgICAgIC8vIHNvIHdlIGRvbid0IGRlZmF1bHQgdG8gYXV0bw0KICAgICAgICAgICAgICAgIGlmICggcmV0ID09IG51bGwgJiYgc3R5bGUgJiYgc3R5bGVbIG5hbWUgXSApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gc3R5bGVbIG5hbWUgXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEZyb20gdGhlIGF3ZXNvbWUgaGFjayBieSBEZWFuIEVkd2FyZHMNCiAgICAgICAgICAgICAgICAvLyBodHRwOi8vZXJpay5lYWUubmV0L2FyY2hpdmVzLzIwMDcvMDcvMjcvMTguNTQuMTUvI2NvbW1lbnQtMTAyMjkxDQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIElmIHdlJ3JlIG5vdCBkZWFsaW5nIHdpdGggYSByZWd1bGFyIHBpeGVsIG51bWJlcg0KICAgICAgICAgICAgICAgIC8vIGJ1dCBhIG51bWJlciB0aGF0IGhhcyBhIHdlaXJkIGVuZGluZywgd2UgbmVlZCB0byBjb252ZXJ0IGl0IHRvIHBpeGVscw0KICAgICAgICAgICAgICAgIC8vIGJ1dCBub3QgcG9zaXRpb24gY3NzIGF0dHJpYnV0ZXMsIGFzIHRob3NlIGFyZSBwcm9wb3J0aW9uYWwgdG8gdGhlIHBhcmVudCBlbGVtZW50IGluc3RlYWQNCiAgICAgICAgICAgICAgICAvLyBhbmQgd2UgY2FuJ3QgbWVhc3VyZSB0aGUgcGFyZW50IGluc3RlYWQgYmVjYXVzZSBpdCBtaWdodCB0cmlnZ2VyIGEgInN0YWNraW5nIGRvbGxzIiBwcm9ibGVtDQogICAgICAgICAgICAgICAgaWYgKCBybnVtbm9ucHgudGVzdCggcmV0ICkgJiYgIXJwb3NpdGlvbi50ZXN0KCBuYW1lICkgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBSZW1lbWJlciB0aGUgb3JpZ2luYWwgdmFsdWVzDQogICAgICAgICAgICAgICAgICAgIGxlZnQgPSBzdHlsZS5sZWZ0Ow0KICAgICAgICAgICAgICAgICAgICBycyA9IGVsZW0ucnVudGltZVN0eWxlOw0KICAgICAgICAgICAgICAgICAgICByc0xlZnQgPSBycyAmJiBycy5sZWZ0Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gUHV0IGluIHRoZSBuZXcgdmFsdWVzIHRvIGdldCBhIGNvbXB1dGVkIHZhbHVlIG91dA0KICAgICAgICAgICAgICAgICAgICBpZiAoIHJzTGVmdCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJzLmxlZnQgPSBlbGVtLmN1cnJlbnRTdHlsZS5sZWZ0Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHN0eWxlLmxlZnQgPSBuYW1lID09PSAiZm9udFNpemUiID8gIjFlbSIgOiByZXQ7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IHN0eWxlLnBpeGVsTGVmdCArICJweCI7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBSZXZlcnQgdGhlIGNoYW5nZWQgdmFsdWVzDQogICAgICAgICAgICAgICAgICAgIHN0eWxlLmxlZnQgPSBsZWZ0Ow0KICAgICAgICAgICAgICAgICAgICBpZiAoIHJzTGVmdCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJzLmxlZnQgPSByc0xlZnQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiByZXQgPT09ICIiID8gImF1dG8iIDogcmV0Ow0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gc2V0UG9zaXRpdmVOdW1iZXIoIGVsZW0sIHZhbHVlLCBzdWJ0cmFjdCApIHsNCiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gcm51bXNwbGl0LmV4ZWMoIHZhbHVlICk7DQogICAgICAgICAgICByZXR1cm4gbWF0Y2hlcyA/DQogICAgICAgICAgICAgICAgLy8gR3VhcmQgYWdhaW5zdCB1bmRlZmluZWQgInN1YnRyYWN0IiwgZS5nLiwgd2hlbiB1c2VkIGFzIGluIGNzc0hvb2tzDQogICAgICAgICAgICAgICAgTWF0aC5tYXgoIDAsIG1hdGNoZXNbIDEgXSAtICggc3VidHJhY3QgfHwgMCApICkgKyAoIG1hdGNoZXNbIDIgXSB8fCAicHgiICkgOg0KICAgICAgICAgICAgICAgIHZhbHVlOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBhdWdtZW50V2lkdGhPckhlaWdodCggZWxlbSwgbmFtZSwgZXh0cmEsIGlzQm9yZGVyQm94LCBzdHlsZXMgKSB7DQogICAgICAgICAgICB2YXIgaSA9IGV4dHJhID09PSAoIGlzQm9yZGVyQm94ID8gImJvcmRlciIgOiAiY29udGVudCIgKSA/DQogICAgICAgICAgICAgICAgLy8gSWYgd2UgYWxyZWFkeSBoYXZlIHRoZSByaWdodCBtZWFzdXJlbWVudCwgYXZvaWQgYXVnbWVudGF0aW9uDQogICAgICAgICAgICAgICAgNCA6DQogICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIGluaXRpYWxpemUgZm9yIGhvcml6b250YWwgb3IgdmVydGljYWwgcHJvcGVydGllcw0KICAgICAgICAgICAgICAgIG5hbWUgPT09ICJ3aWR0aCIgPyAxIDogMCwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdmFsID0gMDsNCiAgICAgICAgDQogICAgICAgICAgICBmb3IgKCA7IGkgPCA0OyBpICs9IDIgKSB7DQogICAgICAgICAgICAgICAgLy8gYm90aCBib3ggbW9kZWxzIGV4Y2x1ZGUgbWFyZ2luLCBzbyBhZGQgaXQgaWYgd2Ugd2FudCBpdA0KICAgICAgICAgICAgICAgIGlmICggZXh0cmEgPT09ICJtYXJnaW4iICkgew0KICAgICAgICAgICAgICAgICAgICB2YWwgKz0galF1ZXJ5LmNzcyggZWxlbSwgZXh0cmEgKyBjc3NFeHBhbmRbIGkgXSwgdHJ1ZSwgc3R5bGVzICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIGlzQm9yZGVyQm94ICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBib3JkZXItYm94IGluY2x1ZGVzIHBhZGRpbmcsIHNvIHJlbW92ZSBpdCBpZiB3ZSB3YW50IGNvbnRlbnQNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBleHRyYSA9PT0gImNvbnRlbnQiICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsIC09IGpRdWVyeS5jc3MoIGVsZW0sICJwYWRkaW5nIiArIGNzc0V4cGFuZFsgaSBdLCB0cnVlLCBzdHlsZXMgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gYXQgdGhpcyBwb2ludCwgZXh0cmEgaXNuJ3QgYm9yZGVyIG5vciBtYXJnaW4sIHNvIHJlbW92ZSBib3JkZXINCiAgICAgICAgICAgICAgICAgICAgaWYgKCBleHRyYSAhPT0gIm1hcmdpbiIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWwgLT0galF1ZXJ5LmNzcyggZWxlbSwgImJvcmRlciIgKyBjc3NFeHBhbmRbIGkgXSArICJXaWR0aCIsIHRydWUsIHN0eWxlcyApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gYXQgdGhpcyBwb2ludCwgZXh0cmEgaXNuJ3QgY29udGVudCwgc28gYWRkIHBhZGRpbmcNCiAgICAgICAgICAgICAgICAgICAgdmFsICs9IGpRdWVyeS5jc3MoIGVsZW0sICJwYWRkaW5nIiArIGNzc0V4cGFuZFsgaSBdLCB0cnVlLCBzdHlsZXMgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIGF0IHRoaXMgcG9pbnQsIGV4dHJhIGlzbid0IGNvbnRlbnQgbm9yIHBhZGRpbmcsIHNvIGFkZCBib3JkZXINCiAgICAgICAgICAgICAgICAgICAgaWYgKCBleHRyYSAhPT0gInBhZGRpbmciICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsICs9IGpRdWVyeS5jc3MoIGVsZW0sICJib3JkZXIiICsgY3NzRXhwYW5kWyBpIF0gKyAiV2lkdGgiLCB0cnVlLCBzdHlsZXMgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gdmFsOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBnZXRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBTdGFydCB3aXRoIG9mZnNldCBwcm9wZXJ0eSwgd2hpY2ggaXMgZXF1aXZhbGVudCB0byB0aGUgYm9yZGVyLWJveCB2YWx1ZQ0KICAgICAgICAgICAgdmFyIHZhbHVlSXNCb3JkZXJCb3ggPSB0cnVlLA0KICAgICAgICAgICAgICAgIHZhbCA9IG5hbWUgPT09ICJ3aWR0aCIgPyBlbGVtLm9mZnNldFdpZHRoIDogZWxlbS5vZmZzZXRIZWlnaHQsDQogICAgICAgICAgICAgICAgc3R5bGVzID0gZ2V0U3R5bGVzKCBlbGVtICksDQogICAgICAgICAgICAgICAgaXNCb3JkZXJCb3ggPSBqUXVlcnkuc3VwcG9ydC5ib3hTaXppbmcgJiYgalF1ZXJ5LmNzcyggZWxlbSwgImJveFNpemluZyIsIGZhbHNlLCBzdHlsZXMgKSA9PT0gImJvcmRlci1ib3giOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIHNvbWUgbm9uLWh0bWwgZWxlbWVudHMgcmV0dXJuIHVuZGVmaW5lZCBmb3Igb2Zmc2V0V2lkdGgsIHNvIGNoZWNrIGZvciBudWxsL3VuZGVmaW5lZA0KICAgICAgICAgICAgLy8gc3ZnIC0gaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NjQ5Mjg1DQogICAgICAgICAgICAvLyBNYXRoTUwgLSBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD00OTE2NjgNCiAgICAgICAgICAgIGlmICggdmFsIDw9IDAgfHwgdmFsID09IG51bGwgKSB7DQogICAgICAgICAgICAgICAgLy8gRmFsbCBiYWNrIHRvIGNvbXB1dGVkIHRoZW4gdW5jb21wdXRlZCBjc3MgaWYgbmVjZXNzYXJ5DQogICAgICAgICAgICAgICAgdmFsID0gY3VyQ1NTKCBlbGVtLCBuYW1lLCBzdHlsZXMgKTsNCiAgICAgICAgICAgICAgICBpZiAoIHZhbCA8IDAgfHwgdmFsID09IG51bGwgKSB7DQogICAgICAgICAgICAgICAgICAgIHZhbCA9IGVsZW0uc3R5bGVbIG5hbWUgXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIENvbXB1dGVkIHVuaXQgaXMgbm90IHBpeGVscy4gU3RvcCBoZXJlIGFuZCByZXR1cm4uDQogICAgICAgICAgICAgICAgaWYgKCBybnVtbm9ucHgudGVzdCh2YWwpICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0aGUgY2hlY2sgZm9yIHN0eWxlIGluIGNhc2UgYSBicm93c2VyIHdoaWNoIHJldHVybnMgdW5yZWxpYWJsZSB2YWx1ZXMNCiAgICAgICAgICAgICAgICAvLyBmb3IgZ2V0Q29tcHV0ZWRTdHlsZSBzaWxlbnRseSBmYWxscyBiYWNrIHRvIHRoZSByZWxpYWJsZSBlbGVtLnN0eWxlDQogICAgICAgICAgICAgICAgdmFsdWVJc0JvcmRlckJveCA9IGlzQm9yZGVyQm94ICYmICggalF1ZXJ5LnN1cHBvcnQuYm94U2l6aW5nUmVsaWFibGUgfHwgdmFsID09PSBlbGVtLnN0eWxlWyBuYW1lIF0gKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gTm9ybWFsaXplICIiLCBhdXRvLCBhbmQgcHJlcGFyZSBmb3IgZXh0cmENCiAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KCB2YWwgKSB8fCAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIHVzZSB0aGUgYWN0aXZlIGJveC1zaXppbmcgbW9kZWwgdG8gYWRkL3N1YnRyYWN0IGlycmVsZXZhbnQgc3R5bGVzDQogICAgICAgICAgICByZXR1cm4gKCB2YWwgKw0KICAgICAgICAgICAgICAgIGF1Z21lbnRXaWR0aE9ySGVpZ2h0KA0KICAgICAgICAgICAgICAgICAgICBlbGVtLA0KICAgICAgICAgICAgICAgICAgICBuYW1lLA0KICAgICAgICAgICAgICAgICAgICBleHRyYSB8fCAoIGlzQm9yZGVyQm94ID8gImJvcmRlciIgOiAiY29udGVudCIgKSwNCiAgICAgICAgICAgICAgICAgICAgdmFsdWVJc0JvcmRlckJveCwNCiAgICAgICAgICAgICAgICAgICAgc3R5bGVzDQogICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgKSArICJweCI7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIFRyeSB0byBkZXRlcm1pbmUgdGhlIGRlZmF1bHQgZGlzcGxheSB2YWx1ZSBvZiBhbiBlbGVtZW50DQogICAgICAgIGZ1bmN0aW9uIGNzc19kZWZhdWx0RGlzcGxheSggbm9kZU5hbWUgKSB7DQogICAgICAgICAgICB2YXIgZG9jID0gZG9jdW1lbnQsDQogICAgICAgICAgICAgICAgZGlzcGxheSA9IGVsZW1kaXNwbGF5WyBub2RlTmFtZSBdOw0KICAgICAgICANCiAgICAgICAgICAgIGlmICggIWRpc3BsYXkgKSB7DQogICAgICAgICAgICAgICAgZGlzcGxheSA9IGFjdHVhbERpc3BsYXkoIG5vZGVOYW1lLCBkb2MgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gSWYgdGhlIHNpbXBsZSB3YXkgZmFpbHMsIHJlYWQgZnJvbSBpbnNpZGUgYW4gaWZyYW1lDQogICAgICAgICAgICAgICAgaWYgKCBkaXNwbGF5ID09PSAibm9uZSIgfHwgIWRpc3BsYXkgKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgYWxyZWFkeS1jcmVhdGVkIGlmcmFtZSBpZiBwb3NzaWJsZQ0KICAgICAgICAgICAgICAgICAgICBpZnJhbWUgPSAoIGlmcmFtZSB8fA0KICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCI8aWZyYW1lIGZyYW1lYm9yZGVyPScwJyB3aWR0aD0nMCcgaGVpZ2h0PScwJy8+IikNCiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3MoICJjc3NUZXh0IiwgImRpc3BsYXk6YmxvY2sgIWltcG9ydGFudCIgKQ0KICAgICAgICAgICAgICAgICAgICApLmFwcGVuZFRvKCBkb2MuZG9jdW1lbnRFbGVtZW50ICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBBbHdheXMgd3JpdGUgYSBuZXcgSFRNTCBza2VsZXRvbiBzbyBXZWJraXQgYW5kIEZpcmVmb3ggZG9uJ3QgY2hva2Ugb24gcmV1c2UNCiAgICAgICAgICAgICAgICAgICAgZG9jID0gKCBpZnJhbWVbMF0uY29udGVudFdpbmRvdyB8fCBpZnJhbWVbMF0uY29udGVudERvY3VtZW50ICkuZG9jdW1lbnQ7DQogICAgICAgICAgICAgICAgICAgIGRvYy53cml0ZSgiPCFkb2N0eXBlIGh0bWw+PGh0bWw+PGJvZHk+Iik7DQogICAgICAgICAgICAgICAgICAgIGRvYy5jbG9zZSgpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheSA9IGFjdHVhbERpc3BsYXkoIG5vZGVOYW1lLCBkb2MgKTsNCiAgICAgICAgICAgICAgICAgICAgaWZyYW1lLmRldGFjaCgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gU3RvcmUgdGhlIGNvcnJlY3QgZGVmYXVsdCBkaXNwbGF5DQogICAgICAgICAgICAgICAgZWxlbWRpc3BsYXlbIG5vZGVOYW1lIF0gPSBkaXNwbGF5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBkaXNwbGF5Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBDYWxsZWQgT05MWSBmcm9tIHdpdGhpbiBjc3NfZGVmYXVsdERpc3BsYXkNCiAgICAgICAgZnVuY3Rpb24gYWN0dWFsRGlzcGxheSggbmFtZSwgZG9jICkgew0KICAgICAgICAgICAgdmFyIGVsZW0gPSBqUXVlcnkoIGRvYy5jcmVhdGVFbGVtZW50KCBuYW1lICkgKS5hcHBlbmRUbyggZG9jLmJvZHkgKSwNCiAgICAgICAgICAgICAgICBkaXNwbGF5ID0galF1ZXJ5LmNzcyggZWxlbVswXSwgImRpc3BsYXkiICk7DQogICAgICAgICAgICBlbGVtLnJlbW92ZSgpOw0KICAgICAgICAgICAgcmV0dXJuIGRpc3BsYXk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGpRdWVyeS5lYWNoKFsgImhlaWdodCIsICJ3aWR0aCIgXSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7DQogICAgICAgICAgICBqUXVlcnkuY3NzSG9va3NbIG5hbWUgXSA9IHsNCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCwgZXh0cmEgKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggY29tcHV0ZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBjZXJ0YWluIGVsZW1lbnRzIGNhbiBoYXZlIGRpbWVuc2lvbiBpbmZvIGlmIHdlIGludmlzaWJseSBzaG93IHRoZW0NCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhvd2V2ZXIsIGl0IG11c3QgaGF2ZSBhIGN1cnJlbnQgZGlzcGxheSBzdHlsZSB0aGF0IHdvdWxkIGJlbmVmaXQgZnJvbSB0aGlzDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5vZmZzZXRXaWR0aCA9PT0gMCAmJiByZGlzcGxheXN3YXAudGVzdCggalF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkgKSA/DQogICAgICAgICAgICAgICAgICAgICAgICAJalF1ZXJ5LnN3YXAoIGVsZW0sIGNzc1Nob3csIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlyZXR1cm4gZ2V0V2lkdGhPckhlaWdodCggZWxlbSwgbmFtZSwgZXh0cmEgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9KSA6DQogICAgICAgICAgICAgICAgICAgICAgICAJZ2V0V2lkdGhPckhlaWdodCggZWxlbSwgbmFtZSwgZXh0cmEgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlLCBleHRyYSApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHN0eWxlcyA9IGV4dHJhICYmIGdldFN0eWxlcyggZWxlbSApOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2V0UG9zaXRpdmVOdW1iZXIoIGVsZW0sIHZhbHVlLCBleHRyYSA/DQogICAgICAgICAgICAgICAgICAgICAgICBhdWdtZW50V2lkdGhPckhlaWdodCgNCiAgICAgICAgICAgICAgICAgICAgICAgIAllbGVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgCW5hbWUsDQogICAgICAgICAgICAgICAgICAgICAgICAJZXh0cmEsDQogICAgICAgICAgICAgICAgICAgICAgICAJalF1ZXJ5LnN1cHBvcnQuYm94U2l6aW5nICYmIGpRdWVyeS5jc3MoIGVsZW0sICJib3hTaXppbmciLCBmYWxzZSwgc3R5bGVzICkgPT09ICJib3JkZXItYm94IiwNCiAgICAgICAgICAgICAgICAgICAgICAgIAlzdHlsZXMNCiAgICAgICAgICAgICAgICAgICAgICAgICkgOiAwDQogICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC5vcGFjaXR5ICkgew0KICAgICAgICAgICAgalF1ZXJ5LmNzc0hvb2tzLm9wYWNpdHkgPSB7DQogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiggZWxlbSwgY29tcHV0ZWQgKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIElFIHVzZXMgZmlsdGVycyBmb3Igb3BhY2l0eQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm9wYWNpdHkudGVzdCggKGNvbXB1dGVkICYmIGVsZW0uY3VycmVudFN0eWxlID8gZWxlbS5jdXJyZW50U3R5bGUuZmlsdGVyIDogZWxlbS5zdHlsZS5maWx0ZXIpIHx8ICIiICkgPw0KICAgICAgICAgICAgICAgICAgICAgICAgKCAwLjAxICogcGFyc2VGbG9hdCggUmVnRXhwLiQxICkgKSArICIiIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXB1dGVkID8gIjEiIDogIiI7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBzdHlsZSA9IGVsZW0uc3R5bGUsDQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3R5bGUgPSBlbGVtLmN1cnJlbnRTdHlsZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHkgPSBqUXVlcnkuaXNOdW1lcmljKCB2YWx1ZSApID8gImFscGhhKG9wYWNpdHk9IiArIHZhbHVlICogMTAwICsgIikiIDogIiIsDQogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIgPSBjdXJyZW50U3R5bGUgJiYgY3VycmVudFN0eWxlLmZpbHRlciB8fCBzdHlsZS5maWx0ZXIgfHwgIiI7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBJRSBoYXMgdHJvdWJsZSB3aXRoIG9wYWNpdHkgaWYgaXQgZG9lcyBub3QgaGF2ZSBsYXlvdXQNCiAgICAgICAgICAgICAgICAgICAgLy8gRm9yY2UgaXQgYnkgc2V0dGluZyB0aGUgem9vbSBsZXZlbA0KICAgICAgICAgICAgICAgICAgICBzdHlsZS56b29tID0gMTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIGlmIHNldHRpbmcgb3BhY2l0eSB0byAxLCBhbmQgbm8gb3RoZXIgZmlsdGVycyBleGlzdCAtIGF0dGVtcHQgdG8gcmVtb3ZlIGZpbHRlciBhdHRyaWJ1dGUgIzY2NTINCiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdmFsdWUgPT09ICIiLCB0aGVuIHJlbW92ZSBpbmxpbmUgb3BhY2l0eSAjMTI2ODUNCiAgICAgICAgICAgICAgICAgICAgaWYgKCAoIHZhbHVlID49IDEgfHwgdmFsdWUgPT09ICIiICkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIAlqUXVlcnkudHJpbSggZmlsdGVyLnJlcGxhY2UoIHJhbHBoYSwgIiIgKSApID09PSAiIiAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgCXN0eWxlLnJlbW92ZUF0dHJpYnV0ZSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXR0aW5nIHN0eWxlLmZpbHRlciB0byBudWxsLCAiIiAmICIgIiBzdGlsbCBsZWF2ZSAiZmlsdGVyOiIgaW4gdGhlIGNzc1RleHQNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmICJmaWx0ZXI6IiBpcyBwcmVzZW50IGF0IGFsbCwgY2xlYXJUeXBlIGlzIGRpc2FibGVkLCB3ZSB3YW50IHRvIGF2b2lkIHRoaXMNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0eWxlLnJlbW92ZUF0dHJpYnV0ZSBpcyBJRSBPbmx5LCBidXQgc28gYXBwYXJlbnRseSBpcyB0aGlzIGNvZGUgcGF0aC4uLg0KICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGUucmVtb3ZlQXR0cmlidXRlKCAiZmlsdGVyIiApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIGZpbHRlciBzdHlsZSBhcHBsaWVkIGluIGEgY3NzIHJ1bGUgb3IgdW5zZXQgaW5saW5lIG9wYWNpdHksIHdlIGFyZSBkb25lDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHZhbHVlID09PSAiIiB8fCBjdXJyZW50U3R5bGUgJiYgIWN1cnJlbnRTdHlsZS5maWx0ZXIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UsIHNldCBuZXcgZmlsdGVyIHZhbHVlcw0KICAgICAgICAgICAgICAgICAgICBzdHlsZS5maWx0ZXIgPSByYWxwaGEudGVzdCggZmlsdGVyICkgPw0KICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyLnJlcGxhY2UoIHJhbHBoYSwgb3BhY2l0eSApIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlciArICIgIiArIG9wYWNpdHk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gVGhlc2UgaG9va3MgY2Fubm90IGJlIGFkZGVkIHVudGlsIERPTSByZWFkeSBiZWNhdXNlIHRoZSBzdXBwb3J0IHRlc3QNCiAgICAgICAgLy8gZm9yIGl0IGlzIG5vdCBydW4gdW50aWwgYWZ0ZXIgRE9NIHJlYWR5DQogICAgICAgIGpRdWVyeShmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIGlmICggIWpRdWVyeS5zdXBwb3J0LnJlbGlhYmxlTWFyZ2luUmlnaHQgKSB7DQogICAgICAgICAgICAgICAgalF1ZXJ5LmNzc0hvb2tzLm1hcmdpblJpZ2h0ID0gew0KICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggY29tcHV0ZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gV2ViS2l0IEJ1ZyAxMzM0MyAtIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyB3cm9uZyB2YWx1ZSBmb3IgbWFyZ2luLXJpZ2h0DQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gV29yayBhcm91bmQgYnkgdGVtcG9yYXJpbHkgc2V0dGluZyBlbGVtZW50IGRpc3BsYXkgdG8gaW5saW5lLWJsb2NrDQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIGpRdWVyeS5zd2FwKCBlbGVtLCB7ICJkaXNwbGF5IjogImlubGluZS1ibG9jayIgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJY3VyQ1NTLCBbIGVsZW0sICJtYXJnaW5SaWdodCIgXSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAvLyBXZWJraXQgYnVnOiBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MjkwODQNCiAgICAgICAgICAgIC8vIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyBwZXJjZW50IHdoZW4gc3BlY2lmaWVkIGZvciB0b3AvbGVmdC9ib3R0b20vcmlnaHQNCiAgICAgICAgICAgIC8vIHJhdGhlciB0aGFuIG1ha2UgdGhlIGNzcyBtb2R1bGUgZGVwZW5kIG9uIHRoZSBvZmZzZXQgbW9kdWxlLCB3ZSBqdXN0IGNoZWNrIGZvciBpdCBoZXJlDQogICAgICAgICAgICBpZiAoICFqUXVlcnkuc3VwcG9ydC5waXhlbFBvc2l0aW9uICYmIGpRdWVyeS5mbi5wb3NpdGlvbiApIHsNCiAgICAgICAgICAgICAgICBqUXVlcnkuZWFjaCggWyAidG9wIiwgImxlZnQiIF0sIGZ1bmN0aW9uKCBpLCBwcm9wICkgew0KICAgICAgICAgICAgICAgICAgICBqUXVlcnkuY3NzSG9va3NbIHByb3AgXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggY29tcHV0ZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWNvbXB1dGVkID0gY3VyQ1NTKCBlbGVtLCBwcm9wICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIGlmIGN1ckNTUyByZXR1cm5zIHBlcmNlbnRhZ2UsIGZhbGxiYWNrIHRvIG9mZnNldA0KICAgICAgICAgICAgICAgICAgICAgICAgCQlyZXR1cm4gcm51bW5vbnB4LnRlc3QoIGNvbXB1dGVkICkgPw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJalF1ZXJ5KCBlbGVtICkucG9zaXRpb24oKVsgcHJvcCBdICsgInB4IiA6DQogICAgICAgICAgICAgICAgICAgICAgICAJCQljb21wdXRlZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGlmICggalF1ZXJ5LmV4cHIgJiYgalF1ZXJ5LmV4cHIuZmlsdGVycyApIHsNCiAgICAgICAgICAgIGpRdWVyeS5leHByLmZpbHRlcnMuaGlkZGVuID0gZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgLy8gU3VwcG9ydDogT3BlcmEgPD0gMTIuMTINCiAgICAgICAgICAgICAgICAvLyBPcGVyYSByZXBvcnRzIG9mZnNldFdpZHRocyBhbmQgb2Zmc2V0SGVpZ2h0cyBsZXNzIHRoYW4gemVybyBvbiBzb21lIGVsZW1lbnRzDQogICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0ub2Zmc2V0V2lkdGggPD0gMCAmJiBlbGVtLm9mZnNldEhlaWdodCA8PSAwIHx8DQogICAgICAgICAgICAgICAgICAgICghalF1ZXJ5LnN1cHBvcnQucmVsaWFibGVIaWRkZW5PZmZzZXRzICYmICgoZWxlbS5zdHlsZSAmJiBlbGVtLnN0eWxlLmRpc3BsYXkpIHx8IGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApKSA9PT0gIm5vbmUiKTsNCiAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAgICAgalF1ZXJ5LmV4cHIuZmlsdGVycy52aXNpYmxlID0gZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICFqUXVlcnkuZXhwci5maWx0ZXJzLmhpZGRlbiggZWxlbSApOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gVGhlc2UgaG9va3MgYXJlIHVzZWQgYnkgYW5pbWF0ZSB0byBleHBhbmQgcHJvcGVydGllcw0KICAgICAgICBqUXVlcnkuZWFjaCh7DQogICAgICAgICAgICBtYXJnaW46ICIiLA0KICAgICAgICAgICAgcGFkZGluZzogIiIsDQogICAgICAgICAgICBib3JkZXI6ICJXaWR0aCINCiAgICAgICAgfSwgZnVuY3Rpb24oIHByZWZpeCwgc3VmZml4ICkgew0KICAgICAgICAgICAgalF1ZXJ5LmNzc0hvb2tzWyBwcmVmaXggKyBzdWZmaXggXSA9IHsNCiAgICAgICAgICAgICAgICBleHBhbmQ6IGZ1bmN0aW9uKCB2YWx1ZSApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgZXhwYW5kZWQgPSB7fSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBhc3N1bWVzIGEgc2luZ2xlIG51bWJlciBpZiBub3QgYSBzdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRzID0gdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiA/IHZhbHVlLnNwbGl0KCIgIikgOiBbIHZhbHVlIF07DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBmb3IgKCA7IGkgPCA0OyBpKysgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBleHBhbmRlZFsgcHJlZml4ICsgY3NzRXhwYW5kWyBpIF0gKyBzdWZmaXggXSA9DQogICAgICAgICAgICAgICAgICAgICAgICAJcGFydHNbIGkgXSB8fCBwYXJ0c1sgaSAtIDIgXSB8fCBwYXJ0c1sgMCBdOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhwYW5kZWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAoICFybWFyZ2luLnRlc3QoIHByZWZpeCApICkgew0KICAgICAgICAgICAgICAgIGpRdWVyeS5jc3NIb29rc1sgcHJlZml4ICsgc3VmZml4IF0uc2V0ID0gc2V0UG9zaXRpdmVOdW1iZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICB2YXIgcjIwID0gLyUyMC9nLA0KICAgICAgICAgICAgcmJyYWNrZXQgPSAvXFtcXSQvLA0KICAgICAgICAgICAgckNSTEYgPSAvXHI/XG4vZywNCiAgICAgICAgICAgIHJzdWJtaXR0ZXJUeXBlcyA9IC9eKD86c3VibWl0fGJ1dHRvbnxpbWFnZXxyZXNldHxmaWxlKSQvaSwNCiAgICAgICAgICAgIHJzdWJtaXR0YWJsZSA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGtleWdlbikvaTsNCiAgICAgICAgDQogICAgICAgIGpRdWVyeS5mbi5leHRlbmQoew0KICAgICAgICAgICAgc2VyaWFsaXplOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LnBhcmFtKCB0aGlzLnNlcmlhbGl6ZUFycmF5KCkgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBzZXJpYWxpemVBcnJheTogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgICAgIC8vIENhbiBhZGQgcHJvcEhvb2sgZm9yICJlbGVtZW50cyIgdG8gZmlsdGVyIG9yIGFkZCBmb3JtIGVsZW1lbnRzDQogICAgICAgICAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IGpRdWVyeS5wcm9wKCB0aGlzLCAiZWxlbWVudHMiICk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50cyA/IGpRdWVyeS5tYWtlQXJyYXkoIGVsZW1lbnRzICkgOiB0aGlzOw0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IHRoaXMudHlwZTsNCiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIC5pcygiOmRpc2FibGVkIikgc28gdGhhdCBmaWVsZHNldFtkaXNhYmxlZF0gd29ya3MNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmFtZSAmJiAhalF1ZXJ5KCB0aGlzICkuaXMoICI6ZGlzYWJsZWQiICkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIHJzdWJtaXR0YWJsZS50ZXN0KCB0aGlzLm5vZGVOYW1lICkgJiYgIXJzdWJtaXR0ZXJUeXBlcy50ZXN0KCB0eXBlICkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgICggdGhpcy5jaGVja2VkIHx8ICFtYW5pcHVsYXRpb25fcmNoZWNrYWJsZVR5cGUudGVzdCggdHlwZSApICk7DQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uKCBpLCBlbGVtICl7DQogICAgICAgICAgICAgICAgICAgIHZhciB2YWwgPSBqUXVlcnkoIHRoaXMgKS52YWwoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWwgPT0gbnVsbCA/DQogICAgICAgICAgICAgICAgICAgICAgICBudWxsIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5pc0FycmF5KCB2YWwgKSA/DQogICAgICAgICAgICAgICAgICAgICAgICAJalF1ZXJ5Lm1hcCggdmFsLCBmdW5jdGlvbiggdmFsICl7DQogICAgICAgICAgICAgICAgICAgICAgICAJCXJldHVybiB7IG5hbWU6IGVsZW0ubmFtZSwgdmFsdWU6IHZhbC5yZXBsYWNlKCByQ1JMRiwgIlxyXG4iICkgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9KSA6DQogICAgICAgICAgICAgICAgICAgICAgICAJeyBuYW1lOiBlbGVtLm5hbWUsIHZhbHVlOiB2YWwucmVwbGFjZSggckNSTEYsICJcclxuIiApIH07DQogICAgICAgICAgICAgICAgfSkuZ2V0KCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgLy9TZXJpYWxpemUgYW4gYXJyYXkgb2YgZm9ybSBlbGVtZW50cyBvciBhIHNldCBvZg0KICAgICAgICAvL2tleS92YWx1ZXMgaW50byBhIHF1ZXJ5IHN0cmluZw0KICAgICAgICBqUXVlcnkucGFyYW0gPSBmdW5jdGlvbiggYSwgdHJhZGl0aW9uYWwgKSB7DQogICAgICAgICAgICB2YXIgcHJlZml4LA0KICAgICAgICAgICAgICAgIHMgPSBbXSwNCiAgICAgICAgICAgICAgICBhZGQgPSBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdmFsdWUgaXMgYSBmdW5jdGlvbiwgaW52b2tlIGl0IGFuZCByZXR1cm4gaXRzIHZhbHVlDQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0galF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgPyB2YWx1ZSgpIDogKCB2YWx1ZSA9PSBudWxsID8gIiIgOiB2YWx1ZSApOw0KICAgICAgICAgICAgICAgICAgICBzWyBzLmxlbmd0aCBdID0gZW5jb2RlVVJJQ29tcG9uZW50KCBrZXkgKSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudCggdmFsdWUgKTsNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgICAgIC8vIFNldCB0cmFkaXRpb25hbCB0byB0cnVlIGZvciBqUXVlcnkgPD0gMS4zLjIgYmVoYXZpb3IuDQogICAgICAgICAgICBpZiAoIHRyYWRpdGlvbmFsID09PSB1bmRlZmluZWQgKSB7DQogICAgICAgICAgICAgICAgdHJhZGl0aW9uYWwgPSBqUXVlcnkuYWpheFNldHRpbmdzICYmIGpRdWVyeS5hamF4U2V0dGluZ3MudHJhZGl0aW9uYWw7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gSWYgYW4gYXJyYXkgd2FzIHBhc3NlZCBpbiwgYXNzdW1lIHRoYXQgaXQgaXMgYW4gYXJyYXkgb2YgZm9ybSBlbGVtZW50cy4NCiAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzQXJyYXkoIGEgKSB8fCAoIGEuanF1ZXJ5ICYmICFqUXVlcnkuaXNQbGFpbk9iamVjdCggYSApICkgKSB7DQogICAgICAgICAgICAgICAgLy8gU2VyaWFsaXplIHRoZSBmb3JtIGVsZW1lbnRzDQogICAgICAgICAgICAgICAgalF1ZXJ5LmVhY2goIGEsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBhZGQoIHRoaXMubmFtZSwgdGhpcy52YWx1ZSApOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gSWYgdHJhZGl0aW9uYWwsIGVuY29kZSB0aGUgIm9sZCIgd2F5ICh0aGUgd2F5IDEuMy4yIG9yIG9sZGVyDQogICAgICAgICAgICAgICAgLy8gZGlkIGl0KSwgb3RoZXJ3aXNlIGVuY29kZSBwYXJhbXMgcmVjdXJzaXZlbHkuDQogICAgICAgICAgICAgICAgZm9yICggcHJlZml4IGluIGEgKSB7DQogICAgICAgICAgICAgICAgICAgIGJ1aWxkUGFyYW1zKCBwcmVmaXgsIGFbIHByZWZpeCBdLCB0cmFkaXRpb25hbCwgYWRkICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgcmVzdWx0aW5nIHNlcmlhbGl6YXRpb24NCiAgICAgICAgICAgIHJldHVybiBzLmpvaW4oICImIiApLnJlcGxhY2UoIHIyMCwgIisiICk7DQogICAgICAgIH07DQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBidWlsZFBhcmFtcyggcHJlZml4LCBvYmosIHRyYWRpdGlvbmFsLCBhZGQgKSB7DQogICAgICAgICAgICB2YXIgbmFtZTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAoIGpRdWVyeS5pc0FycmF5KCBvYmogKSApIHsNCiAgICAgICAgICAgICAgICAvLyBTZXJpYWxpemUgYXJyYXkgaXRlbS4NCiAgICAgICAgICAgICAgICBqUXVlcnkuZWFjaCggb2JqLCBmdW5jdGlvbiggaSwgdiApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCB0cmFkaXRpb25hbCB8fCByYnJhY2tldC50ZXN0KCBwcmVmaXggKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyZWF0IGVhY2ggYXJyYXkgaXRlbSBhcyBhIHNjYWxhci4NCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZCggcHJlZml4LCB2ICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSXRlbSBpcyBub24tc2NhbGFyIChhcnJheSBvciBvYmplY3QpLCBlbmNvZGUgaXRzIG51bWVyaWMgaW5kZXguDQogICAgICAgICAgICAgICAgICAgICAgICBidWlsZFBhcmFtcyggcHJlZml4ICsgIlsiICsgKCB0eXBlb2YgdiA9PT0gIm9iamVjdCIgPyBpIDogIiIgKSArICJdIiwgdiwgdHJhZGl0aW9uYWwsIGFkZCApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAgICAgfSBlbHNlIGlmICggIXRyYWRpdGlvbmFsICYmIGpRdWVyeS50eXBlKCBvYmogKSA9PT0gIm9iamVjdCIgKSB7DQogICAgICAgICAgICAgICAgLy8gU2VyaWFsaXplIG9iamVjdCBpdGVtLg0KICAgICAgICAgICAgICAgIGZvciAoIG5hbWUgaW4gb2JqICkgew0KICAgICAgICAgICAgICAgICAgICBidWlsZFBhcmFtcyggcHJlZml4ICsgIlsiICsgbmFtZSArICJdIiwgb2JqWyBuYW1lIF0sIHRyYWRpdGlvbmFsLCBhZGQgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBTZXJpYWxpemUgc2NhbGFyIGl0ZW0uDQogICAgICAgICAgICAgICAgYWRkKCBwcmVmaXgsIG9iaiApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGpRdWVyeS5lYWNoKCAoImJsdXIgZm9jdXMgZm9jdXNpbiBmb2N1c291dCBsb2FkIHJlc2l6ZSBzY3JvbGwgdW5sb2FkIGNsaWNrIGRibGNsaWNrICIgKw0KICAgICAgICAgICAgIm1vdXNlZG93biBtb3VzZXVwIG1vdXNlbW92ZSBtb3VzZW92ZXIgbW91c2VvdXQgbW91c2VlbnRlciBtb3VzZWxlYXZlICIgKw0KICAgICAgICAgICAgImNoYW5nZSBzZWxlY3Qgc3VibWl0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgZXJyb3IgY29udGV4dG1lbnUiKS5zcGxpdCgiICIpLCBmdW5jdGlvbiggaSwgbmFtZSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBIYW5kbGUgZXZlbnQgYmluZGluZw0KICAgICAgICAgICAgalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggZGF0YSwgZm4gKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPiAwID8NCiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbiggbmFtZSwgbnVsbCwgZGF0YSwgZm4gKSA6DQogICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlciggbmFtZSApOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZm4uaG92ZXIgPSBmdW5jdGlvbiggZm5PdmVyLCBmbk91dCApIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLm1vdXNlZW50ZXIoIGZuT3ZlciApLm1vdXNlbGVhdmUoIGZuT3V0IHx8IGZuT3ZlciApOw0KICAgICAgICB9Ow0KICAgICAgICB2YXINCiAgICAgICAgICAgIC8vIERvY3VtZW50IGxvY2F0aW9uDQogICAgICAgICAgICBhamF4TG9jUGFydHMsDQogICAgICAgICAgICBhamF4TG9jYXRpb24sDQogICAgICAgICAgICBhamF4X25vbmNlID0galF1ZXJ5Lm5vdygpLA0KICAgICAgICANCiAgICAgICAgICAgIGFqYXhfcnF1ZXJ5ID0gL1w/LywNCiAgICAgICAgICAgIHJoYXNoID0gLyMuKiQvLA0KICAgICAgICAgICAgcnRzID0gLyhbPyZdKV89W14mXSovLA0KICAgICAgICAgICAgcmhlYWRlcnMgPSAvXiguKj8pOlsgXHRdKihbXlxyXG5dKilccj8kL21nLCAvLyBJRSBsZWF2ZXMgYW4gXHIgY2hhcmFjdGVyIGF0IEVPTA0KICAgICAgICAgICAgLy8gIzc2NTMsICM4MTI1LCAjODE1MjogbG9jYWwgcHJvdG9jb2wgZGV0ZWN0aW9uDQogICAgICAgICAgICBybG9jYWxQcm90b2NvbCA9IC9eKD86YWJvdXR8YXBwfGFwcC1zdG9yYWdlfC4rLWV4dGVuc2lvbnxmaWxlfHJlc3x3aWRnZXQpOiQvLA0KICAgICAgICAgICAgcm5vQ29udGVudCA9IC9eKD86R0VUfEhFQUQpJC8sDQogICAgICAgICAgICBycHJvdG9jb2wgPSAvXlwvXC8vLA0KICAgICAgICAgICAgcnVybCA9IC9eKFtcdy4rLV0rOikoPzpcL1wvKFteXC8/IzpdKikoPzo6KFxkKyl8KXwpLywNCiAgICAgICAgDQogICAgICAgICAgICAvLyBLZWVwIGEgY29weSBvZiB0aGUgb2xkIGxvYWQgbWV0aG9kDQogICAgICAgICAgICBfbG9hZCA9IGpRdWVyeS5mbi5sb2FkLA0KICAgICAgICANCiAgICAgICAgICAgIC8qIFByZWZpbHRlcnMNCiAgICAgICAgICAgICAqIDEpIFRoZXkgYXJlIHVzZWZ1bCB0byBpbnRyb2R1Y2UgY3VzdG9tIGRhdGFUeXBlcyAoc2VlIGFqYXgvanNvbnAuanMgZm9yIGFuIGV4YW1wbGUpDQogICAgICAgICAgICAgKiAyKSBUaGVzZSBhcmUgY2FsbGVkOg0KICAgICAgICAgICAgICogICAgLSBCRUZPUkUgYXNraW5nIGZvciBhIHRyYW5zcG9ydA0KICAgICAgICAgICAgICogICAgLSBBRlRFUiBwYXJhbSBzZXJpYWxpemF0aW9uIChzLmRhdGEgaXMgYSBzdHJpbmcgaWYgcy5wcm9jZXNzRGF0YSBpcyB0cnVlKQ0KICAgICAgICAgICAgICogMykga2V5IGlzIHRoZSBkYXRhVHlwZQ0KICAgICAgICAgICAgICogNCkgdGhlIGNhdGNoYWxsIHN5bWJvbCAiKiIgY2FuIGJlIHVzZWQNCiAgICAgICAgICAgICAqIDUpIGV4ZWN1dGlvbiB3aWxsIHN0YXJ0IHdpdGggdHJhbnNwb3J0IGRhdGFUeXBlIGFuZCBUSEVOIGNvbnRpbnVlIGRvd24gdG8gIioiIGlmIG5lZWRlZA0KICAgICAgICAgICAgICovDQogICAgICAgICAgICBwcmVmaWx0ZXJzID0ge30sDQogICAgICAgIA0KICAgICAgICAgICAgLyogVHJhbnNwb3J0cyBiaW5kaW5ncw0KICAgICAgICAgICAgICogMSkga2V5IGlzIHRoZSBkYXRhVHlwZQ0KICAgICAgICAgICAgICogMikgdGhlIGNhdGNoYWxsIHN5bWJvbCAiKiIgY2FuIGJlIHVzZWQNCiAgICAgICAgICAgICAqIDMpIHNlbGVjdGlvbiB3aWxsIHN0YXJ0IHdpdGggdHJhbnNwb3J0IGRhdGFUeXBlIGFuZCBUSEVOIGdvIHRvICIqIiBpZiBuZWVkZWQNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgdHJhbnNwb3J0cyA9IHt9LA0KICAgICAgICANCiAgICAgICAgICAgIC8vIEF2b2lkIGNvbW1lbnQtcHJvbG9nIGNoYXIgc2VxdWVuY2UgKCMxMDA5OCk7IG11c3QgYXBwZWFzZSBsaW50IGFuZCBldmFkZSBjb21wcmVzc2lvbg0KICAgICAgICAgICAgYWxsVHlwZXMgPSAiKi8iLmNvbmNhdCgiKiIpOw0KICAgICAgICANCiAgICAgICAgLy8gIzgxMzgsIElFIG1heSB0aHJvdyBhbiBleGNlcHRpb24gd2hlbiBhY2Nlc3NpbmcNCiAgICAgICAgLy8gYSBmaWVsZCBmcm9tIHdpbmRvdy5sb2NhdGlvbiBpZiBkb2N1bWVudC5kb21haW4gaGFzIGJlZW4gc2V0DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBhamF4TG9jYXRpb24gPSBsb2NhdGlvbi5ocmVmOw0KICAgICAgICB9IGNhdGNoKCBlICkgew0KICAgICAgICAgICAgLy8gVXNlIHRoZSBocmVmIGF0dHJpYnV0ZSBvZiBhbiBBIGVsZW1lbnQNCiAgICAgICAgICAgIC8vIHNpbmNlIElFIHdpbGwgbW9kaWZ5IGl0IGdpdmVuIGRvY3VtZW50LmxvY2F0aW9uDQogICAgICAgICAgICBhamF4TG9jYXRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiYSIgKTsNCiAgICAgICAgICAgIGFqYXhMb2NhdGlvbi5ocmVmID0gIiI7DQogICAgICAgICAgICBhamF4TG9jYXRpb24gPSBhamF4TG9jYXRpb24uaHJlZjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gU2VnbWVudCBsb2NhdGlvbiBpbnRvIHBhcnRzDQogICAgICAgIGFqYXhMb2NQYXJ0cyA9IHJ1cmwuZXhlYyggYWpheExvY2F0aW9uLnRvTG93ZXJDYXNlKCkgKSB8fCBbXTsNCiAgICAgICAgDQogICAgICAgIC8vIEJhc2UgImNvbnN0cnVjdG9yIiBmb3IgalF1ZXJ5LmFqYXhQcmVmaWx0ZXIgYW5kIGpRdWVyeS5hamF4VHJhbnNwb3J0DQogICAgICAgIGZ1bmN0aW9uIGFkZFRvUHJlZmlsdGVyc09yVHJhbnNwb3J0cyggc3RydWN0dXJlICkgew0KICAgICAgICANCiAgICAgICAgICAgIC8vIGRhdGFUeXBlRXhwcmVzc2lvbiBpcyBvcHRpb25hbCBhbmQgZGVmYXVsdHMgdG8gIioiDQogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oIGRhdGFUeXBlRXhwcmVzc2lvbiwgZnVuYyApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgZGF0YVR5cGVFeHByZXNzaW9uICE9PSAic3RyaW5nIiApIHsNCiAgICAgICAgICAgICAgICAgICAgZnVuYyA9IGRhdGFUeXBlRXhwcmVzc2lvbjsNCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGVFeHByZXNzaW9uID0gIioiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgdmFyIGRhdGFUeXBlLA0KICAgICAgICAgICAgICAgICAgICBpID0gMCwNCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGVzID0gZGF0YVR5cGVFeHByZXNzaW9uLnRvTG93ZXJDYXNlKCkubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgW107DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGZ1bmMgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGVhY2ggZGF0YVR5cGUgaW4gdGhlIGRhdGFUeXBlRXhwcmVzc2lvbg0KICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIChkYXRhVHlwZSA9IGRhdGFUeXBlc1tpKytdKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByZXBlbmQgaWYgcmVxdWVzdGVkDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGRhdGFUeXBlWzBdID09PSAiKyIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJZGF0YVR5cGUgPSBkYXRhVHlwZS5zbGljZSggMSApIHx8ICIqIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkoc3RydWN0dXJlWyBkYXRhVHlwZSBdID0gc3RydWN0dXJlWyBkYXRhVHlwZSBdIHx8IFtdKS51bnNoaWZ0KCBmdW5jICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIGFwcGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkoc3RydWN0dXJlWyBkYXRhVHlwZSBdID0gc3RydWN0dXJlWyBkYXRhVHlwZSBdIHx8IFtdKS5wdXNoKCBmdW5jICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBCYXNlIGluc3BlY3Rpb24gZnVuY3Rpb24gZm9yIHByZWZpbHRlcnMgYW5kIHRyYW5zcG9ydHMNCiAgICAgICAgZnVuY3Rpb24gaW5zcGVjdFByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHN0cnVjdHVyZSwgb3B0aW9ucywgb3JpZ2luYWxPcHRpb25zLCBqcVhIUiApIHsNCiAgICAgICAgDQogICAgICAgICAgICB2YXIgaW5zcGVjdGVkID0ge30sDQogICAgICAgICAgICAgICAgc2Vla2luZ1RyYW5zcG9ydCA9ICggc3RydWN0dXJlID09PSB0cmFuc3BvcnRzICk7DQogICAgICAgIA0KICAgICAgICAgICAgZnVuY3Rpb24gaW5zcGVjdCggZGF0YVR5cGUgKSB7DQogICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkOw0KICAgICAgICAgICAgICAgIGluc3BlY3RlZFsgZGF0YVR5cGUgXSA9IHRydWU7DQogICAgICAgICAgICAgICAgalF1ZXJ5LmVhY2goIHN0cnVjdHVyZVsgZGF0YVR5cGUgXSB8fCBbXSwgZnVuY3Rpb24oIF8sIHByZWZpbHRlck9yRmFjdG9yeSApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFUeXBlT3JUcmFuc3BvcnQgPSBwcmVmaWx0ZXJPckZhY3RvcnkoIG9wdGlvbnMsIG9yaWdpbmFsT3B0aW9ucywganFYSFIgKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIHR5cGVvZiBkYXRhVHlwZU9yVHJhbnNwb3J0ID09PSAic3RyaW5nIiAmJiAhc2Vla2luZ1RyYW5zcG9ydCAmJiAhaW5zcGVjdGVkWyBkYXRhVHlwZU9yVHJhbnNwb3J0IF0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGFUeXBlcy51bnNoaWZ0KCBkYXRhVHlwZU9yVHJhbnNwb3J0ICk7DQogICAgICAgICAgICAgICAgICAgICAgICBpbnNwZWN0KCBkYXRhVHlwZU9yVHJhbnNwb3J0ICk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIHNlZWtpbmdUcmFuc3BvcnQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gISggc2VsZWN0ZWQgPSBkYXRhVHlwZU9yVHJhbnNwb3J0ICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWQ7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIGluc3BlY3QoIG9wdGlvbnMuZGF0YVR5cGVzWyAwIF0gKSB8fCAhaW5zcGVjdGVkWyAiKiIgXSAmJiBpbnNwZWN0KCAiKiIgKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gQSBzcGVjaWFsIGV4dGVuZCBmb3IgYWpheCBvcHRpb25zDQogICAgICAgIC8vIHRoYXQgdGFrZXMgImZsYXQiIG9wdGlvbnMgKG5vdCB0byBiZSBkZWVwIGV4dGVuZGVkKQ0KICAgICAgICAvLyBGaXhlcyAjOTg4Nw0KICAgICAgICBmdW5jdGlvbiBhamF4RXh0ZW5kKCB0YXJnZXQsIHNyYyApIHsNCiAgICAgICAgICAgIHZhciBkZWVwLCBrZXksDQogICAgICAgICAgICAgICAgZmxhdE9wdGlvbnMgPSBqUXVlcnkuYWpheFNldHRpbmdzLmZsYXRPcHRpb25zIHx8IHt9Ow0KICAgICAgICANCiAgICAgICAgICAgIGZvciAoIGtleSBpbiBzcmMgKSB7DQogICAgICAgICAgICAgICAgaWYgKCBzcmNbIGtleSBdICE9PSB1bmRlZmluZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICggZmxhdE9wdGlvbnNbIGtleSBdID8gdGFyZ2V0IDogKCBkZWVwIHx8IChkZWVwID0ge30pICkgKVsga2V5IF0gPSBzcmNbIGtleSBdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICggZGVlcCApIHsNCiAgICAgICAgICAgICAgICBqUXVlcnkuZXh0ZW5kKCB0cnVlLCB0YXJnZXQsIGRlZXAgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gdGFyZ2V0Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZm4ubG9hZCA9IGZ1bmN0aW9uKCB1cmwsIHBhcmFtcywgY2FsbGJhY2sgKSB7DQogICAgICAgICAgICBpZiAoIHR5cGVvZiB1cmwgIT09ICJzdHJpbmciICYmIF9sb2FkICkgew0KICAgICAgICAgICAgICAgIHJldHVybiBfbG9hZC5hcHBseSggdGhpcywgYXJndW1lbnRzICk7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgdmFyIHNlbGVjdG9yLCByZXNwb25zZSwgdHlwZSwNCiAgICAgICAgICAgICAgICBzZWxmID0gdGhpcywNCiAgICAgICAgICAgICAgICBvZmYgPSB1cmwuaW5kZXhPZigiICIpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmICggb2ZmID49IDAgKSB7DQogICAgICAgICAgICAgICAgc2VsZWN0b3IgPSB1cmwuc2xpY2UoIG9mZiwgdXJsLmxlbmd0aCApOw0KICAgICAgICAgICAgICAgIHVybCA9IHVybC5zbGljZSggMCwgb2ZmICk7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gSWYgaXQncyBhIGZ1bmN0aW9uDQogICAgICAgICAgICBpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBwYXJhbXMgKSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gV2UgYXNzdW1lIHRoYXQgaXQncyB0aGUgY2FsbGJhY2sNCiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IHBhcmFtczsNCiAgICAgICAgICAgICAgICBwYXJhbXMgPSB1bmRlZmluZWQ7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBidWlsZCBhIHBhcmFtIHN0cmluZw0KICAgICAgICAgICAgfSBlbHNlIGlmICggcGFyYW1zICYmIHR5cGVvZiBwYXJhbXMgPT09ICJvYmplY3QiICkgew0KICAgICAgICAgICAgICAgIHR5cGUgPSAiUE9TVCI7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSBlbGVtZW50cyB0byBtb2RpZnksIG1ha2UgdGhlIHJlcXVlc3QNCiAgICAgICAgICAgIGlmICggc2VsZi5sZW5ndGggPiAwICkgew0KICAgICAgICAgICAgICAgIGpRdWVyeS5hamF4KHsNCiAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsDQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBpZiAidHlwZSIgdmFyaWFibGUgaXMgdW5kZWZpbmVkLCB0aGVuICJHRVQiIG1ldGhvZCB3aWxsIGJlIHVzZWQNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSwNCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJodG1sIiwNCiAgICAgICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zDQogICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiggcmVzcG9uc2VUZXh0ICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gU2F2ZSByZXNwb25zZSBmb3IgdXNlIGluIGNvbXBsZXRlIGNhbGxiYWNrDQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gYXJndW1lbnRzOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgc2VsZi5odG1sKCBzZWxlY3RvciA/DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgYSBzZWxlY3RvciB3YXMgc3BlY2lmaWVkLCBsb2NhdGUgdGhlIHJpZ2h0IGVsZW1lbnRzIGluIGEgZHVtbXkgZGl2DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBFeGNsdWRlIHNjcmlwdHMgdG8gYXZvaWQgSUUgJ1Blcm1pc3Npb24gRGVuaWVkJyBlcnJvcnMNCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeSgiPGRpdj4iKS5hcHBlbmQoIGpRdWVyeS5wYXJzZUhUTUwoIHJlc3BvbnNlVGV4dCApICkuZmluZCggc2VsZWN0b3IgKSA6DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIHVzZSB0aGUgZnVsbCByZXN1bHQNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlVGV4dCApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB9KS5jb21wbGV0ZSggY2FsbGJhY2sgJiYgZnVuY3Rpb24oIGpxWEhSLCBzdGF0dXMgKSB7DQogICAgICAgICAgICAgICAgICAgIHNlbGYuZWFjaCggY2FsbGJhY2ssIHJlc3BvbnNlIHx8IFsganFYSFIucmVzcG9uc2VUZXh0LCBzdGF0dXMsIGpxWEhSIF0gKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIC8vIEF0dGFjaCBhIGJ1bmNoIG9mIGZ1bmN0aW9ucyBmb3IgaGFuZGxpbmcgY29tbW9uIEFKQVggZXZlbnRzDQogICAgICAgIGpRdWVyeS5lYWNoKCBbICJhamF4U3RhcnQiLCAiYWpheFN0b3AiLCAiYWpheENvbXBsZXRlIiwgImFqYXhFcnJvciIsICJhamF4U3VjY2VzcyIsICJhamF4U2VuZCIgXSwgZnVuY3Rpb24oIGksIHR5cGUgKXsNCiAgICAgICAgICAgIGpRdWVyeS5mblsgdHlwZSBdID0gZnVuY3Rpb24oIGZuICl7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMub24oIHR5cGUsIGZuICk7DQogICAgICAgICAgICB9Ow0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGpRdWVyeS5lYWNoKCBbICJnZXQiLCAicG9zdCIgXSwgZnVuY3Rpb24oIGksIG1ldGhvZCApIHsNCiAgICAgICAgICAgIGpRdWVyeVsgbWV0aG9kIF0gPSBmdW5jdGlvbiggdXJsLCBkYXRhLCBjYWxsYmFjaywgdHlwZSApIHsNCiAgICAgICAgICAgICAgICAvLyBzaGlmdCBhcmd1bWVudHMgaWYgZGF0YSBhcmd1bWVudCB3YXMgb21pdHRlZA0KICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGRhdGEgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IHR5cGUgfHwgY2FsbGJhY2s7DQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gZGF0YTsNCiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuYWpheCh7DQogICAgICAgICAgICAgICAgICAgIHVybDogdXJsLA0KICAgICAgICAgICAgICAgICAgICB0eXBlOiBtZXRob2QsDQogICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiB0eXBlLA0KICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLA0KICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBjYWxsYmFjaw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZXh0ZW5kKHsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBDb3VudGVyIGZvciBob2xkaW5nIHRoZSBudW1iZXIgb2YgYWN0aXZlIHF1ZXJpZXMNCiAgICAgICAgICAgIGFjdGl2ZTogMCwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBMYXN0LU1vZGlmaWVkIGhlYWRlciBjYWNoZSBmb3IgbmV4dCByZXF1ZXN0DQogICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHt9LA0KICAgICAgICAgICAgZXRhZzoge30sDQogICAgICAgIA0KICAgICAgICAgICAgYWpheFNldHRpbmdzOiB7DQogICAgICAgICAgICAgICAgdXJsOiBhamF4TG9jYXRpb24sDQogICAgICAgICAgICAgICAgdHlwZTogIkdFVCIsDQogICAgICAgICAgICAgICAgaXNMb2NhbDogcmxvY2FsUHJvdG9jb2wudGVzdCggYWpheExvY1BhcnRzWyAxIF0gKSwNCiAgICAgICAgICAgICAgICBnbG9iYWw6IHRydWUsDQogICAgICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IHRydWUsDQogICAgICAgICAgICAgICAgYXN5bmM6IHRydWUsDQogICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9VVRGLTgiLA0KICAgICAgICAgICAgICAgIC8qDQogICAgICAgICAgICAgICAgdGltZW91dDogMCwNCiAgICAgICAgICAgICAgICBkYXRhOiBudWxsLA0KICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBudWxsLA0KICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBudWxsLA0KICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBudWxsLA0KICAgICAgICAgICAgICAgIGNhY2hlOiBudWxsLA0KICAgICAgICAgICAgICAgIHRocm93czogZmFsc2UsDQogICAgICAgICAgICAgICAgdHJhZGl0aW9uYWw6IGZhbHNlLA0KICAgICAgICAgICAgICAgIGhlYWRlcnM6IHt9LA0KICAgICAgICAgICAgICAgICovDQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFjY2VwdHM6IHsNCiAgICAgICAgICAgICAgICAgICAgIioiOiBhbGxUeXBlcywNCiAgICAgICAgICAgICAgICAgICAgdGV4dDogInRleHQvcGxhaW4iLA0KICAgICAgICAgICAgICAgICAgICBodG1sOiAidGV4dC9odG1sIiwNCiAgICAgICAgICAgICAgICAgICAgeG1sOiAiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCIsDQogICAgICAgICAgICAgICAgICAgIGpzb246ICJhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L2phdmFzY3JpcHQiDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgY29udGVudHM6IHsNCiAgICAgICAgICAgICAgICAgICAgeG1sOiAveG1sLywNCiAgICAgICAgICAgICAgICAgICAgaHRtbDogL2h0bWwvLA0KICAgICAgICAgICAgICAgICAgICBqc29uOiAvanNvbi8NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXNwb25zZUZpZWxkczogew0KICAgICAgICAgICAgICAgICAgICB4bWw6ICJyZXNwb25zZVhNTCIsDQogICAgICAgICAgICAgICAgICAgIHRleHQ6ICJyZXNwb25zZVRleHQiDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gRGF0YSBjb252ZXJ0ZXJzDQogICAgICAgICAgICAgICAgLy8gS2V5cyBzZXBhcmF0ZSBzb3VyY2UgKG9yIGNhdGNoYWxsICIqIikgYW5kIGRlc3RpbmF0aW9uIHR5cGVzIHdpdGggYSBzaW5nbGUgc3BhY2UNCiAgICAgICAgICAgICAgICBjb252ZXJ0ZXJzOiB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IGFueXRoaW5nIHRvIHRleHQNCiAgICAgICAgICAgICAgICAgICAgIiogdGV4dCI6IHdpbmRvdy5TdHJpbmcsDQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBUZXh0IHRvIGh0bWwgKHRydWUgPSBubyB0cmFuc2Zvcm1hdGlvbikNCiAgICAgICAgICAgICAgICAgICAgInRleHQgaHRtbCI6IHRydWUsDQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBFdmFsdWF0ZSB0ZXh0IGFzIGEganNvbiBleHByZXNzaW9uDQogICAgICAgICAgICAgICAgICAgICJ0ZXh0IGpzb24iOiBqUXVlcnkucGFyc2VKU09OLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gUGFyc2UgdGV4dCBhcyB4bWwNCiAgICAgICAgICAgICAgICAgICAgInRleHQgeG1sIjogalF1ZXJ5LnBhcnNlWE1MDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gRm9yIG9wdGlvbnMgdGhhdCBzaG91bGRuJ3QgYmUgZGVlcCBleHRlbmRlZDoNCiAgICAgICAgICAgICAgICAvLyB5b3UgY2FuIGFkZCB5b3VyIG93biBjdXN0b20gb3B0aW9ucyBoZXJlIGlmDQogICAgICAgICAgICAgICAgLy8gYW5kIHdoZW4geW91IGNyZWF0ZSBvbmUgdGhhdCBzaG91bGRuJ3QgYmUNCiAgICAgICAgICAgICAgICAvLyBkZWVwIGV4dGVuZGVkIChzZWUgYWpheEV4dGVuZCkNCiAgICAgICAgICAgICAgICBmbGF0T3B0aW9uczogew0KICAgICAgICAgICAgICAgICAgICB1cmw6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IHRydWUNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIC8vIENyZWF0ZXMgYSBmdWxsIGZsZWRnZWQgc2V0dGluZ3Mgb2JqZWN0IGludG8gdGFyZ2V0DQogICAgICAgICAgICAvLyB3aXRoIGJvdGggYWpheFNldHRpbmdzIGFuZCBzZXR0aW5ncyBmaWVsZHMuDQogICAgICAgICAgICAvLyBJZiB0YXJnZXQgaXMgb21pdHRlZCwgd3JpdGVzIGludG8gYWpheFNldHRpbmdzLg0KICAgICAgICAgICAgYWpheFNldHVwOiBmdW5jdGlvbiggdGFyZ2V0LCBzZXR0aW5ncyApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gc2V0dGluZ3MgPw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gQnVpbGRpbmcgYSBzZXR0aW5ncyBvYmplY3QNCiAgICAgICAgICAgICAgICAgICAgYWpheEV4dGVuZCggYWpheEV4dGVuZCggdGFyZ2V0LCBqUXVlcnkuYWpheFNldHRpbmdzICksIHNldHRpbmdzICkgOg0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gRXh0ZW5kaW5nIGFqYXhTZXR0aW5ncw0KICAgICAgICAgICAgICAgICAgICBhamF4RXh0ZW5kKCBqUXVlcnkuYWpheFNldHRpbmdzLCB0YXJnZXQgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgYWpheFByZWZpbHRlcjogYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBwcmVmaWx0ZXJzICksDQogICAgICAgICAgICBhamF4VHJhbnNwb3J0OiBhZGRUb1ByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHRyYW5zcG9ydHMgKSwNCiAgICAgICAgDQogICAgICAgICAgICAvLyBNYWluIG1ldGhvZA0KICAgICAgICAgICAgYWpheDogZnVuY3Rpb24oIHVybCwgb3B0aW9ucyApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gSWYgdXJsIGlzIGFuIG9iamVjdCwgc2ltdWxhdGUgcHJlLTEuNSBzaWduYXR1cmUNCiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiB1cmwgPT09ICJvYmplY3QiICkgew0KICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gdXJsOw0KICAgICAgICAgICAgICAgICAgICB1cmwgPSB1bmRlZmluZWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBGb3JjZSBvcHRpb25zIHRvIGJlIGFuIG9iamVjdA0KICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICB2YXIgLy8gQ3Jvc3MtZG9tYWluIGRldGVjdGlvbiB2YXJzDQogICAgICAgICAgICAgICAgICAgIHBhcnRzLA0KICAgICAgICAgICAgICAgICAgICAvLyBMb29wIHZhcmlhYmxlDQogICAgICAgICAgICAgICAgICAgIGksDQogICAgICAgICAgICAgICAgICAgIC8vIFVSTCB3aXRob3V0IGFudGktY2FjaGUgcGFyYW0NCiAgICAgICAgICAgICAgICAgICAgY2FjaGVVUkwsDQogICAgICAgICAgICAgICAgICAgIC8vIFJlc3BvbnNlIGhlYWRlcnMgYXMgc3RyaW5nDQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlSGVhZGVyc1N0cmluZywNCiAgICAgICAgICAgICAgICAgICAgLy8gdGltZW91dCBoYW5kbGUNCiAgICAgICAgICAgICAgICAgICAgdGltZW91dFRpbWVyLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gVG8ga25vdyBpZiBnbG9iYWwgZXZlbnRzIGFyZSB0byBiZSBkaXNwYXRjaGVkDQogICAgICAgICAgICAgICAgICAgIGZpcmVHbG9iYWxzLA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgdHJhbnNwb3J0LA0KICAgICAgICAgICAgICAgICAgICAvLyBSZXNwb25zZSBoZWFkZXJzDQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlSGVhZGVycywNCiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBmaW5hbCBvcHRpb25zIG9iamVjdA0KICAgICAgICAgICAgICAgICAgICBzID0galF1ZXJ5LmFqYXhTZXR1cCgge30sIG9wdGlvbnMgKSwNCiAgICAgICAgICAgICAgICAgICAgLy8gQ2FsbGJhY2tzIGNvbnRleHQNCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tDb250ZXh0ID0gcy5jb250ZXh0IHx8IHMsDQogICAgICAgICAgICAgICAgICAgIC8vIENvbnRleHQgZm9yIGdsb2JhbCBldmVudHMgaXMgY2FsbGJhY2tDb250ZXh0IGlmIGl0IGlzIGEgRE9NIG5vZGUgb3IgalF1ZXJ5IGNvbGxlY3Rpb24NCiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRXZlbnRDb250ZXh0ID0gcy5jb250ZXh0ICYmICggY2FsbGJhY2tDb250ZXh0Lm5vZGVUeXBlIHx8IGNhbGxiYWNrQ29udGV4dC5qcXVlcnkgKSA/DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIGNhbGxiYWNrQ29udGV4dCApIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5ldmVudCwNCiAgICAgICAgICAgICAgICAgICAgLy8gRGVmZXJyZWRzDQogICAgICAgICAgICAgICAgICAgIGRlZmVycmVkID0galF1ZXJ5LkRlZmVycmVkKCksDQogICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlRGVmZXJyZWQgPSBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLA0KICAgICAgICAgICAgICAgICAgICAvLyBTdGF0dXMtZGVwZW5kZW50IGNhbGxiYWNrcw0KICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlID0gcy5zdGF0dXNDb2RlIHx8IHt9LA0KICAgICAgICAgICAgICAgICAgICAvLyBIZWFkZXJzICh0aGV5IGFyZSBzZW50IGFsbCBhdCBvbmNlKQ0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0SGVhZGVycyA9IHt9LA0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0SGVhZGVyc05hbWVzID0ge30sDQogICAgICAgICAgICAgICAgICAgIC8vIFRoZSBqcVhIUiBzdGF0ZQ0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IDAsDQogICAgICAgICAgICAgICAgICAgIC8vIERlZmF1bHQgYWJvcnQgbWVzc2FnZQ0KICAgICAgICAgICAgICAgICAgICBzdHJBYm9ydCA9ICJjYW5jZWxlZCIsDQogICAgICAgICAgICAgICAgICAgIC8vIEZha2UgeGhyDQogICAgICAgICAgICAgICAgICAgIGpxWEhSID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVhZHlTdGF0ZTogMCwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBCdWlsZHMgaGVhZGVycyBoYXNodGFibGUgaWYgbmVlZGVkDQogICAgICAgICAgICAgICAgICAgICAgICBnZXRSZXNwb25zZUhlYWRlcjogZnVuY3Rpb24oIGtleSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl2YXIgbWF0Y2g7DQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBzdGF0ZSA9PT0gMiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJaWYgKCAhcmVzcG9uc2VIZWFkZXJzICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJcmVzcG9uc2VIZWFkZXJzID0ge307DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl3aGlsZSAoIChtYXRjaCA9IHJoZWFkZXJzLmV4ZWMoIHJlc3BvbnNlSGVhZGVyc1N0cmluZyApKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQlyZXNwb25zZUhlYWRlcnNbIG1hdGNoWzFdLnRvTG93ZXJDYXNlKCkgXSA9IG1hdGNoWyAyIF07DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJbWF0Y2ggPSByZXNwb25zZUhlYWRlcnNbIGtleS50b0xvd2VyQ2FzZSgpIF07DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCXJldHVybiBtYXRjaCA9PSBudWxsID8gbnVsbCA6IG1hdGNoOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBSYXcgc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBnZXRBbGxSZXNwb25zZUhlYWRlcnM6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCXJldHVybiBzdGF0ZSA9PT0gMiA/IHJlc3BvbnNlSGVhZGVyc1N0cmluZyA6IG51bGw7DQogICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENhY2hlcyB0aGUgaGVhZGVyDQogICAgICAgICAgICAgICAgICAgICAgICBzZXRSZXF1ZXN0SGVhZGVyOiBmdW5jdGlvbiggbmFtZSwgdmFsdWUgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJdmFyIGxuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggIXN0YXRlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQluYW1lID0gcmVxdWVzdEhlYWRlcnNOYW1lc1sgbG5hbWUgXSA9IHJlcXVlc3RIZWFkZXJzTmFtZXNbIGxuYW1lIF0gfHwgbmFtZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJcmVxdWVzdEhlYWRlcnNbIG5hbWUgXSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZXR1cm4gdGhpczsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3ZlcnJpZGVzIHJlc3BvbnNlIGNvbnRlbnQtdHlwZSBoZWFkZXINCiAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJyaWRlTWltZVR5cGU6IGZ1bmN0aW9uKCB0eXBlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggIXN0YXRlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlzLm1pbWVUeXBlID0gdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIHRoaXM7DQogICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzDQogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiBmdW5jdGlvbiggbWFwICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCXZhciBjb2RlOw0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggbWFwICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlpZiAoIHN0YXRlIDwgMiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWZvciAoIGNvZGUgaW4gbWFwICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCS8vIExhenktYWRkIHRoZSBuZXcgY2FsbGJhY2sgaW4gYSB3YXkgdGhhdCBwcmVzZXJ2ZXMgb2xkIG9uZXMNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQlzdGF0dXNDb2RlWyBjb2RlIF0gPSBbIHN0YXR1c0NvZGVbIGNvZGUgXSwgbWFwWyBjb2RlIF0gXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCS8vIEV4ZWN1dGUgdGhlIGFwcHJvcHJpYXRlIGNhbGxiYWNrcw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJanFYSFIuYWx3YXlzKCBtYXBbIGpxWEhSLnN0YXR1cyBdICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICAJcmV0dXJuIHRoaXM7DQogICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENhbmNlbCB0aGUgcmVxdWVzdA0KICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnQ6IGZ1bmN0aW9uKCBzdGF0dXNUZXh0ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCXZhciBmaW5hbFRleHQgPSBzdGF0dXNUZXh0IHx8IHN0ckFib3J0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggdHJhbnNwb3J0ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQl0cmFuc3BvcnQuYWJvcnQoIGZpbmFsVGV4dCApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAlkb25lKCAwLCBmaW5hbFRleHQgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZXR1cm4gdGhpczsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQXR0YWNoIGRlZmVycmVkcw0KICAgICAgICAgICAgICAgIGRlZmVycmVkLnByb21pc2UoIGpxWEhSICkuY29tcGxldGUgPSBjb21wbGV0ZURlZmVycmVkLmFkZDsNCiAgICAgICAgICAgICAgICBqcVhIUi5zdWNjZXNzID0ganFYSFIuZG9uZTsNCiAgICAgICAgICAgICAgICBqcVhIUi5lcnJvciA9IGpxWEhSLmZhaWw7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBoYXNoIGNoYXJhY3RlciAoIzc1MzE6IGFuZCBzdHJpbmcgcHJvbW90aW9uKQ0KICAgICAgICAgICAgICAgIC8vIEFkZCBwcm90b2NvbCBpZiBub3QgcHJvdmlkZWQgKCM1ODY2OiBJRTcgaXNzdWUgd2l0aCBwcm90b2NvbC1sZXNzIHVybHMpDQogICAgICAgICAgICAgICAgLy8gSGFuZGxlIGZhbHN5IHVybCBpbiB0aGUgc2V0dGluZ3Mgb2JqZWN0ICgjMTAwOTM6IGNvbnNpc3RlbmN5IHdpdGggb2xkIHNpZ25hdHVyZSkNCiAgICAgICAgICAgICAgICAvLyBXZSBhbHNvIHVzZSB0aGUgdXJsIHBhcmFtZXRlciBpZiBhdmFpbGFibGUNCiAgICAgICAgICAgICAgICBzLnVybCA9ICggKCB1cmwgfHwgcy51cmwgfHwgYWpheExvY2F0aW9uICkgKyAiIiApLnJlcGxhY2UoIHJoYXNoLCAiIiApLnJlcGxhY2UoIHJwcm90b2NvbCwgYWpheExvY1BhcnRzWyAxIF0gKyAiLy8iICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEFsaWFzIG1ldGhvZCBvcHRpb24gdG8gdHlwZSBhcyBwZXIgdGlja2V0ICMxMjAwNA0KICAgICAgICAgICAgICAgIHMudHlwZSA9IG9wdGlvbnMubWV0aG9kIHx8IG9wdGlvbnMudHlwZSB8fCBzLm1ldGhvZCB8fCBzLnR5cGU7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEV4dHJhY3QgZGF0YVR5cGVzIGxpc3QNCiAgICAgICAgICAgICAgICBzLmRhdGFUeXBlcyA9IGpRdWVyeS50cmltKCBzLmRhdGFUeXBlIHx8ICIqIiApLnRvTG93ZXJDYXNlKCkubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgWyIiXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQSBjcm9zcy1kb21haW4gcmVxdWVzdCBpcyBpbiBvcmRlciB3aGVuIHdlIGhhdmUgYSBwcm90b2NvbDpob3N0OnBvcnQgbWlzbWF0Y2gNCiAgICAgICAgICAgICAgICBpZiAoIHMuY3Jvc3NEb21haW4gPT0gbnVsbCApIHsNCiAgICAgICAgICAgICAgICAgICAgcGFydHMgPSBydXJsLmV4ZWMoIHMudXJsLnRvTG93ZXJDYXNlKCkgKTsNCiAgICAgICAgICAgICAgICAgICAgcy5jcm9zc0RvbWFpbiA9ICEhKCBwYXJ0cyAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgKCBwYXJ0c1sgMSBdICE9PSBhamF4TG9jUGFydHNbIDEgXSB8fCBwYXJ0c1sgMiBdICE9PSBhamF4TG9jUGFydHNbIDIgXSB8fA0KICAgICAgICAgICAgICAgICAgICAgICAgCSggcGFydHNbIDMgXSB8fCAoIHBhcnRzWyAxIF0gPT09ICJodHRwOiIgPyA4MCA6IDQ0MyApICkgIT0NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJKCBhamF4TG9jUGFydHNbIDMgXSB8fCAoIGFqYXhMb2NQYXJ0c1sgMSBdID09PSAiaHR0cDoiID8gODAgOiA0NDMgKSApICkNCiAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgZGF0YSBpZiBub3QgYWxyZWFkeSBhIHN0cmluZw0KICAgICAgICAgICAgICAgIGlmICggcy5kYXRhICYmIHMucHJvY2Vzc0RhdGEgJiYgdHlwZW9mIHMuZGF0YSAhPT0gInN0cmluZyIgKSB7DQogICAgICAgICAgICAgICAgICAgIHMuZGF0YSA9IGpRdWVyeS5wYXJhbSggcy5kYXRhLCBzLnRyYWRpdGlvbmFsICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBBcHBseSBwcmVmaWx0ZXJzDQogICAgICAgICAgICAgICAgaW5zcGVjdFByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHByZWZpbHRlcnMsIHMsIG9wdGlvbnMsIGpxWEhSICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIElmIHJlcXVlc3Qgd2FzIGFib3J0ZWQgaW5zaWRlIGEgcHJlZmlsdGVyLCBzdG9wIHRoZXJlDQogICAgICAgICAgICAgICAgaWYgKCBzdGF0ZSA9PT0gMiApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpxWEhSOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gV2UgY2FuIGZpcmUgZ2xvYmFsIGV2ZW50cyBhcyBvZiBub3cgaWYgYXNrZWQgdG8NCiAgICAgICAgICAgICAgICBmaXJlR2xvYmFscyA9IHMuZ2xvYmFsOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBXYXRjaCBmb3IgYSBuZXcgc2V0IG9mIHJlcXVlc3RzDQogICAgICAgICAgICAgICAgaWYgKCBmaXJlR2xvYmFscyAmJiBqUXVlcnkuYWN0aXZlKysgPT09IDAgKSB7DQogICAgICAgICAgICAgICAgICAgIGpRdWVyeS5ldmVudC50cmlnZ2VyKCJhamF4U3RhcnQiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFVwcGVyY2FzZSB0aGUgdHlwZQ0KICAgICAgICAgICAgICAgIHMudHlwZSA9IHMudHlwZS50b1VwcGVyQ2FzZSgpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBEZXRlcm1pbmUgaWYgcmVxdWVzdCBoYXMgY29udGVudA0KICAgICAgICAgICAgICAgIHMuaGFzQ29udGVudCA9ICFybm9Db250ZW50LnRlc3QoIHMudHlwZSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBTYXZlIHRoZSBVUkwgaW4gY2FzZSB3ZSdyZSB0b3lpbmcgd2l0aCB0aGUgSWYtTW9kaWZpZWQtU2luY2UNCiAgICAgICAgICAgICAgICAvLyBhbmQvb3IgSWYtTm9uZS1NYXRjaCBoZWFkZXIgbGF0ZXIgb24NCiAgICAgICAgICAgICAgICBjYWNoZVVSTCA9IHMudXJsOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBNb3JlIG9wdGlvbnMgaGFuZGxpbmcgZm9yIHJlcXVlc3RzIHdpdGggbm8gY29udGVudA0KICAgICAgICAgICAgICAgIGlmICggIXMuaGFzQ29udGVudCApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIElmIGRhdGEgaXMgYXZhaWxhYmxlLCBhcHBlbmQgZGF0YSB0byB1cmwNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBzLmRhdGEgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZVVSTCA9ICggcy51cmwgKz0gKCBhamF4X3JxdWVyeS50ZXN0KCBjYWNoZVVSTCApID8gIiYiIDogIj8iICkgKyBzLmRhdGEgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICM5NjgyOiByZW1vdmUgZGF0YSBzbyB0aGF0IGl0J3Mgbm90IHVzZWQgaW4gYW4gZXZlbnR1YWwgcmV0cnkNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBzLmRhdGE7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEFkZCBhbnRpLWNhY2hlIGluIHVybCBpZiBuZWVkZWQNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBzLmNhY2hlID09PSBmYWxzZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHMudXJsID0gcnRzLnRlc3QoIGNhY2hlVVJMICkgPw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBJZiB0aGVyZSBpcyBhbHJlYWR5IGEgJ18nIHBhcmFtZXRlciwgc2V0IGl0cyB2YWx1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgCWNhY2hlVVJMLnJlcGxhY2UoIHJ0cywgIiQxXz0iICsgYWpheF9ub25jZSsrICkgOg0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBPdGhlcndpc2UgYWRkIG9uZSB0byB0aGUgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICAJY2FjaGVVUkwgKyAoIGFqYXhfcnF1ZXJ5LnRlc3QoIGNhY2hlVVJMICkgPyAiJiIgOiAiPyIgKSArICJfPSIgKyBhamF4X25vbmNlKys7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgSWYtTW9kaWZpZWQtU2luY2UgYW5kL29yIElmLU5vbmUtTWF0Y2ggaGVhZGVyLCBpZiBpbiBpZk1vZGlmaWVkIG1vZGUuDQogICAgICAgICAgICAgICAgaWYgKCBzLmlmTW9kaWZpZWQgKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5Lmxhc3RNb2RpZmllZFsgY2FjaGVVUkwgXSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpxWEhSLnNldFJlcXVlc3RIZWFkZXIoICJJZi1Nb2RpZmllZC1TaW5jZSIsIGpRdWVyeS5sYXN0TW9kaWZpZWRbIGNhY2hlVVJMIF0gKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5ldGFnWyBjYWNoZVVSTCBdICkgew0KICAgICAgICAgICAgICAgICAgICAgICAganFYSFIuc2V0UmVxdWVzdEhlYWRlciggIklmLU5vbmUtTWF0Y2giLCBqUXVlcnkuZXRhZ1sgY2FjaGVVUkwgXSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGNvcnJlY3QgaGVhZGVyLCBpZiBkYXRhIGlzIGJlaW5nIHNlbnQNCiAgICAgICAgICAgICAgICBpZiAoIHMuZGF0YSAmJiBzLmhhc0NvbnRlbnQgJiYgcy5jb250ZW50VHlwZSAhPT0gZmFsc2UgfHwgb3B0aW9ucy5jb250ZW50VHlwZSApIHsNCiAgICAgICAgICAgICAgICAgICAganFYSFIuc2V0UmVxdWVzdEhlYWRlciggIkNvbnRlbnQtVHlwZSIsIHMuY29udGVudFR5cGUgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgQWNjZXB0cyBoZWFkZXIgZm9yIHRoZSBzZXJ2ZXIsIGRlcGVuZGluZyBvbiB0aGUgZGF0YVR5cGUNCiAgICAgICAgICAgICAgICBqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKA0KICAgICAgICAgICAgICAgICAgICAiQWNjZXB0IiwNCiAgICAgICAgICAgICAgICAgICAgcy5kYXRhVHlwZXNbIDAgXSAmJiBzLmFjY2VwdHNbIHMuZGF0YVR5cGVzWzBdIF0gPw0KICAgICAgICAgICAgICAgICAgICAgICAgcy5hY2NlcHRzWyBzLmRhdGFUeXBlc1swXSBdICsgKCBzLmRhdGFUeXBlc1sgMCBdICE9PSAiKiIgPyAiLCAiICsgYWxsVHlwZXMgKyAiOyBxPTAuMDEiIDogIiIgKSA6DQogICAgICAgICAgICAgICAgICAgICAgICBzLmFjY2VwdHNbICIqIiBdDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGhlYWRlcnMgb3B0aW9uDQogICAgICAgICAgICAgICAgZm9yICggaSBpbiBzLmhlYWRlcnMgKSB7DQogICAgICAgICAgICAgICAgICAgIGpxWEhSLnNldFJlcXVlc3RIZWFkZXIoIGksIHMuaGVhZGVyc1sgaSBdICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBBbGxvdyBjdXN0b20gaGVhZGVycy9taW1ldHlwZXMgYW5kIGVhcmx5IGFib3J0DQogICAgICAgICAgICAgICAgaWYgKCBzLmJlZm9yZVNlbmQgJiYgKCBzLmJlZm9yZVNlbmQuY2FsbCggY2FsbGJhY2tDb250ZXh0LCBqcVhIUiwgcyApID09PSBmYWxzZSB8fCBzdGF0ZSA9PT0gMiApICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBBYm9ydCBpZiBub3QgZG9uZSBhbHJlYWR5IGFuZCByZXR1cm4NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpxWEhSLmFib3J0KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBhYm9ydGluZyBpcyBubyBsb25nZXIgYSBjYW5jZWxsYXRpb24NCiAgICAgICAgICAgICAgICBzdHJBYm9ydCA9ICJhYm9ydCI7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEluc3RhbGwgY2FsbGJhY2tzIG9uIGRlZmVycmVkcw0KICAgICAgICAgICAgICAgIGZvciAoIGkgaW4geyBzdWNjZXNzOiAxLCBlcnJvcjogMSwgY29tcGxldGU6IDEgfSApIHsNCiAgICAgICAgICAgICAgICAgICAganFYSFJbIGkgXSggc1sgaSBdICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBHZXQgdHJhbnNwb3J0DQogICAgICAgICAgICAgICAgdHJhbnNwb3J0ID0gaW5zcGVjdFByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHRyYW5zcG9ydHMsIHMsIG9wdGlvbnMsIGpxWEhSICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIElmIG5vIHRyYW5zcG9ydCwgd2UgYXV0by1hYm9ydA0KICAgICAgICAgICAgICAgIGlmICggIXRyYW5zcG9ydCApIHsNCiAgICAgICAgICAgICAgICAgICAgZG9uZSggLTEsICJObyBUcmFuc3BvcnQiICk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAganFYSFIucmVhZHlTdGF0ZSA9IDE7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBTZW5kIGdsb2JhbCBldmVudA0KICAgICAgICAgICAgICAgICAgICBpZiAoIGZpcmVHbG9iYWxzICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoICJhamF4U2VuZCIsIFsganFYSFIsIHMgXSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIC8vIFRpbWVvdXQNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBzLmFzeW5jICYmIHMudGltZW91dCA+IDAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0VGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWpxWEhSLmFib3J0KCJ0aW1lb3V0Iik7DQogICAgICAgICAgICAgICAgICAgICAgICB9LCBzLnRpbWVvdXQgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlID0gMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zcG9ydC5zZW5kKCByZXF1ZXN0SGVhZGVycywgZG9uZSApOw0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoICggZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByb3BhZ2F0ZSBleGNlcHRpb24gYXMgZXJyb3IgaWYgbm90IGRvbmUNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc3RhdGUgPCAyICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWRvbmUoIC0xLCBlICk7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBTaW1wbHkgcmV0aHJvdyBvdGhlcndpc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJdGhyb3cgZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gQ2FsbGJhY2sgZm9yIHdoZW4gZXZlcnl0aGluZyBpcyBkb25lDQogICAgICAgICAgICAgICAgZnVuY3Rpb24gZG9uZSggc3RhdHVzLCBuYXRpdmVTdGF0dXNUZXh0LCByZXNwb25zZXMsIGhlYWRlcnMgKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBpc1N1Y2Nlc3MsIHN1Y2Nlc3MsIGVycm9yLCByZXNwb25zZSwgbW9kaWZpZWQsDQogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gbmF0aXZlU3RhdHVzVGV4dDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIENhbGxlZCBvbmNlDQogICAgICAgICAgICAgICAgICAgIGlmICggc3RhdGUgPT09IDIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFN0YXRlIGlzICJkb25lIiBub3cNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSAyOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYXIgdGltZW91dCBpZiBpdCBleGlzdHMNCiAgICAgICAgICAgICAgICAgICAgaWYgKCB0aW1lb3V0VGltZXIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoIHRpbWVvdXRUaW1lciApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBEZXJlZmVyZW5jZSB0cmFuc3BvcnQgZm9yIGVhcmx5IGdhcmJhZ2UgY29sbGVjdGlvbg0KICAgICAgICAgICAgICAgICAgICAvLyAobm8gbWF0dGVyIGhvdyBsb25nIHRoZSBqcVhIUiBvYmplY3Qgd2lsbCBiZSB1c2VkKQ0KICAgICAgICAgICAgICAgICAgICB0cmFuc3BvcnQgPSB1bmRlZmluZWQ7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBDYWNoZSByZXNwb25zZSBoZWFkZXJzDQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlSGVhZGVyc1N0cmluZyA9IGhlYWRlcnMgfHwgIiI7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBTZXQgcmVhZHlTdGF0ZQ0KICAgICAgICAgICAgICAgICAgICBqcVhIUi5yZWFkeVN0YXRlID0gc3RhdHVzID4gMCA/IDQgOiAwOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gR2V0IHJlc3BvbnNlIGRhdGENCiAgICAgICAgICAgICAgICAgICAgaWYgKCByZXNwb25zZXMgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IGFqYXhIYW5kbGVSZXNwb25zZXMoIHMsIGpxWEhSLCByZXNwb25zZXMgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgc3VjY2Vzc2Z1bCwgaGFuZGxlIHR5cGUgY2hhaW5pbmcNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBzdGF0dXMgPj0gMjAwICYmIHN0YXR1cyA8IDMwMCB8fCBzdGF0dXMgPT09IDMwNCApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIElmLU1vZGlmaWVkLVNpbmNlIGFuZC9vciBJZi1Ob25lLU1hdGNoIGhlYWRlciwgaWYgaW4gaWZNb2RpZmllZCBtb2RlLg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBzLmlmTW9kaWZpZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJbW9kaWZpZWQgPSBqcVhIUi5nZXRSZXNwb25zZUhlYWRlcigiTGFzdC1Nb2RpZmllZCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggbW9kaWZpZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWpRdWVyeS5sYXN0TW9kaWZpZWRbIGNhY2hlVVJMIF0gPSBtb2RpZmllZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICAJbW9kaWZpZWQgPSBqcVhIUi5nZXRSZXNwb25zZUhlYWRlcigiZXRhZyIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggbW9kaWZpZWQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWpRdWVyeS5ldGFnWyBjYWNoZVVSTCBdID0gbW9kaWZpZWQ7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIG5vIGNvbnRlbnQNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc3RhdHVzID09PSAyMDQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJaXNTdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlzdGF0dXNUZXh0ID0gIm5vY29udGVudCI7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgbm90IG1vZGlmaWVkDQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBzdGF0dXMgPT09IDMwNCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpc1N1Y2Nlc3MgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgCXN0YXR1c1RleHQgPSAibm90bW9kaWZpZWQiOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHdlIGhhdmUgZGF0YSwgbGV0J3MgY29udmVydCBpdA0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpc1N1Y2Nlc3MgPSBhamF4Q29udmVydCggcywgcmVzcG9uc2UgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlzdGF0dXNUZXh0ID0gaXNTdWNjZXNzLnN0YXRlOw0KICAgICAgICAgICAgICAgICAgICAgICAgCXN1Y2Nlc3MgPSBpc1N1Y2Nlc3MuZGF0YTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAllcnJvciA9IGlzU3VjY2Vzcy5lcnJvcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpc1N1Y2Nlc3MgPSAhZXJyb3I7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBleHRyYWN0IGVycm9yIGZyb20gc3RhdHVzVGV4dA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlbiBub3JtYWxpemUgc3RhdHVzVGV4dCBhbmQgc3RhdHVzIGZvciBub24tYWJvcnRzDQogICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IHN0YXR1c1RleHQ7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHN0YXR1cyB8fCAhc3RhdHVzVGV4dCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlzdGF0dXNUZXh0ID0gImVycm9yIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIHN0YXR1cyA8IDAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCXN0YXR1cyA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBTZXQgZGF0YSBmb3IgdGhlIGZha2UgeGhyIG9iamVjdA0KICAgICAgICAgICAgICAgICAgICBqcVhIUi5zdGF0dXMgPSBzdGF0dXM7DQogICAgICAgICAgICAgICAgICAgIGpxWEhSLnN0YXR1c1RleHQgPSAoIG5hdGl2ZVN0YXR1c1RleHQgfHwgc3RhdHVzVGV4dCApICsgIiI7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBTdWNjZXNzL0Vycm9yDQogICAgICAgICAgICAgICAgICAgIGlmICggaXNTdWNjZXNzICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZVdpdGgoIGNhbGxiYWNrQ29udGV4dCwgWyBzdWNjZXNzLCBzdGF0dXNUZXh0LCBqcVhIUiBdICk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3RXaXRoKCBjYWxsYmFja0NvbnRleHQsIFsganFYSFIsIHN0YXR1c1RleHQsIGVycm9yIF0gKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gU3RhdHVzLWRlcGVuZGVudCBjYWxsYmFja3MNCiAgICAgICAgICAgICAgICAgICAganFYSFIuc3RhdHVzQ29kZSggc3RhdHVzQ29kZSApOw0KICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlID0gdW5kZWZpbmVkOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCBmaXJlR2xvYmFscyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbEV2ZW50Q29udGV4dC50cmlnZ2VyKCBpc1N1Y2Nlc3MgPyAiYWpheFN1Y2Nlc3MiIDogImFqYXhFcnJvciIsDQogICAgICAgICAgICAgICAgICAgICAgICAJWyBqcVhIUiwgcywgaXNTdWNjZXNzID8gc3VjY2VzcyA6IGVycm9yIF0gKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gQ29tcGxldGUNCiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVEZWZlcnJlZC5maXJlV2l0aCggY2FsbGJhY2tDb250ZXh0LCBbIGpxWEhSLCBzdGF0dXNUZXh0IF0gKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmICggZmlyZUdsb2JhbHMgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWxFdmVudENvbnRleHQudHJpZ2dlciggImFqYXhDb21wbGV0ZSIsIFsganFYSFIsIHMgXSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIHRoZSBnbG9iYWwgQUpBWCBjb3VudGVyDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICEoIC0talF1ZXJ5LmFjdGl2ZSApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWpRdWVyeS5ldmVudC50cmlnZ2VyKCJhamF4U3RvcCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4ganFYSFI7DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIGdldFNjcmlwdDogZnVuY3Rpb24oIHVybCwgY2FsbGJhY2sgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5nZXQoIHVybCwgdW5kZWZpbmVkLCBjYWxsYmFjaywgInNjcmlwdCIgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgIA0KICAgICAgICAgICAgZ2V0SlNPTjogZnVuY3Rpb24oIHVybCwgZGF0YSwgY2FsbGJhY2sgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5nZXQoIHVybCwgZGF0YSwgY2FsbGJhY2ssICJqc29uIiApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIC8qIEhhbmRsZXMgcmVzcG9uc2VzIHRvIGFuIGFqYXggcmVxdWVzdDoNCiAgICAgICAgICogLSBzZXRzIGFsbCByZXNwb25zZVhYWCBmaWVsZHMgYWNjb3JkaW5nbHkNCiAgICAgICAgICogLSBmaW5kcyB0aGUgcmlnaHQgZGF0YVR5cGUgKG1lZGlhdGVzIGJldHdlZW4gY29udGVudC10eXBlIGFuZCBleHBlY3RlZCBkYXRhVHlwZSkNCiAgICAgICAgICogLSByZXR1cm5zIHRoZSBjb3JyZXNwb25kaW5nIHJlc3BvbnNlDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBhamF4SGFuZGxlUmVzcG9uc2VzKCBzLCBqcVhIUiwgcmVzcG9uc2VzICkgew0KICAgICAgICAgICAgdmFyIGZpcnN0RGF0YVR5cGUsIGN0LCBmaW5hbERhdGFUeXBlLCB0eXBlLA0KICAgICAgICAgICAgICAgIGNvbnRlbnRzID0gcy5jb250ZW50cywNCiAgICAgICAgICAgICAgICBkYXRhVHlwZXMgPSBzLmRhdGFUeXBlcywNCiAgICAgICAgICAgICAgICByZXNwb25zZUZpZWxkcyA9IHMucmVzcG9uc2VGaWVsZHM7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gRmlsbCByZXNwb25zZVhYWCBmaWVsZHMNCiAgICAgICAgICAgIGZvciAoIHR5cGUgaW4gcmVzcG9uc2VGaWVsZHMgKSB7DQogICAgICAgICAgICAgICAgaWYgKCB0eXBlIGluIHJlc3BvbnNlcyApIHsNCiAgICAgICAgICAgICAgICAgICAganFYSFJbIHJlc3BvbnNlRmllbGRzW3R5cGVdIF0gPSByZXNwb25zZXNbIHR5cGUgXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gUmVtb3ZlIGF1dG8gZGF0YVR5cGUgYW5kIGdldCBjb250ZW50LXR5cGUgaW4gdGhlIHByb2Nlc3MNCiAgICAgICAgICAgIHdoaWxlKCBkYXRhVHlwZXNbIDAgXSA9PT0gIioiICkgew0KICAgICAgICAgICAgICAgIGRhdGFUeXBlcy5zaGlmdCgpOw0KICAgICAgICAgICAgICAgIGlmICggY3QgPT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICAgICAgY3QgPSBzLm1pbWVUeXBlIHx8IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJDb250ZW50LVR5cGUiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gQ2hlY2sgaWYgd2UncmUgZGVhbGluZyB3aXRoIGEga25vd24gY29udGVudC10eXBlDQogICAgICAgICAgICBpZiAoIGN0ICkgew0KICAgICAgICAgICAgICAgIGZvciAoIHR5cGUgaW4gY29udGVudHMgKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggY29udGVudHNbIHR5cGUgXSAmJiBjb250ZW50c1sgdHlwZSBdLnRlc3QoIGN0ICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZXMudW5zaGlmdCggdHlwZSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gQ2hlY2sgdG8gc2VlIGlmIHdlIGhhdmUgYSByZXNwb25zZSBmb3IgdGhlIGV4cGVjdGVkIGRhdGFUeXBlDQogICAgICAgICAgICBpZiAoIGRhdGFUeXBlc1sgMCBdIGluIHJlc3BvbnNlcyApIHsNCiAgICAgICAgICAgICAgICBmaW5hbERhdGFUeXBlID0gZGF0YVR5cGVzWyAwIF07DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIFRyeSBjb252ZXJ0aWJsZSBkYXRhVHlwZXMNCiAgICAgICAgICAgICAgICBmb3IgKCB0eXBlIGluIHJlc3BvbnNlcyApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhZGF0YVR5cGVzWyAwIF0gfHwgcy5jb252ZXJ0ZXJzWyB0eXBlICsgIiAiICsgZGF0YVR5cGVzWzBdIF0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmaW5hbERhdGFUeXBlID0gdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmICggIWZpcnN0RGF0YVR5cGUgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmaXJzdERhdGFUeXBlID0gdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvLyBPciBqdXN0IHVzZSBmaXJzdCBvbmUNCiAgICAgICAgICAgICAgICBmaW5hbERhdGFUeXBlID0gZmluYWxEYXRhVHlwZSB8fCBmaXJzdERhdGFUeXBlOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIElmIHdlIGZvdW5kIGEgZGF0YVR5cGUNCiAgICAgICAgICAgIC8vIFdlIGFkZCB0aGUgZGF0YVR5cGUgdG8gdGhlIGxpc3QgaWYgbmVlZGVkDQogICAgICAgICAgICAvLyBhbmQgcmV0dXJuIHRoZSBjb3JyZXNwb25kaW5nIHJlc3BvbnNlDQogICAgICAgICAgICBpZiAoIGZpbmFsRGF0YVR5cGUgKSB7DQogICAgICAgICAgICAgICAgaWYgKCBmaW5hbERhdGFUeXBlICE9PSBkYXRhVHlwZXNbIDAgXSApIHsNCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGVzLnVuc2hpZnQoIGZpbmFsRGF0YVR5cGUgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlc1sgZmluYWxEYXRhVHlwZSBdOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBDaGFpbiBjb252ZXJzaW9ucyBnaXZlbiB0aGUgcmVxdWVzdCBhbmQgdGhlIG9yaWdpbmFsIHJlc3BvbnNlDQogICAgICAgIGZ1bmN0aW9uIGFqYXhDb252ZXJ0KCBzLCByZXNwb25zZSApIHsNCiAgICAgICAgICAgIHZhciBjb252MiwgY3VycmVudCwgY29udiwgdG1wLA0KICAgICAgICAgICAgICAgIGNvbnZlcnRlcnMgPSB7fSwNCiAgICAgICAgICAgICAgICBpID0gMCwNCiAgICAgICAgICAgICAgICAvLyBXb3JrIHdpdGggYSBjb3B5IG9mIGRhdGFUeXBlcyBpbiBjYXNlIHdlIG5lZWQgdG8gbW9kaWZ5IGl0IGZvciBjb252ZXJzaW9uDQogICAgICAgICAgICAgICAgZGF0YVR5cGVzID0gcy5kYXRhVHlwZXMuc2xpY2UoKSwNCiAgICAgICAgICAgICAgICBwcmV2ID0gZGF0YVR5cGVzWyAwIF07DQogICAgICAgIA0KICAgICAgICAgICAgLy8gQXBwbHkgdGhlIGRhdGFGaWx0ZXIgaWYgcHJvdmlkZWQNCiAgICAgICAgICAgIGlmICggcy5kYXRhRmlsdGVyICkgew0KICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gcy5kYXRhRmlsdGVyKCByZXNwb25zZSwgcy5kYXRhVHlwZSApOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIENyZWF0ZSBjb252ZXJ0ZXJzIG1hcCB3aXRoIGxvd2VyY2FzZWQga2V5cw0KICAgICAgICAgICAgaWYgKCBkYXRhVHlwZXNbIDEgXSApIHsNCiAgICAgICAgICAgICAgICBmb3IgKCBjb252IGluIHMuY29udmVydGVycyApIHsNCiAgICAgICAgICAgICAgICAgICAgY29udmVydGVyc1sgY29udi50b0xvd2VyQ2FzZSgpIF0gPSBzLmNvbnZlcnRlcnNbIGNvbnYgXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gQ29udmVydCB0byBlYWNoIHNlcXVlbnRpYWwgZGF0YVR5cGUsIHRvbGVyYXRpbmcgbGlzdCBtb2RpZmljYXRpb24NCiAgICAgICAgICAgIGZvciAoIDsgKGN1cnJlbnQgPSBkYXRhVHlwZXNbKytpXSk7ICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBUaGVyZSdzIG9ubHkgd29yayB0byBkbyBpZiBjdXJyZW50IGRhdGFUeXBlIGlzIG5vbi1hdXRvDQogICAgICAgICAgICAgICAgaWYgKCBjdXJyZW50ICE9PSAiKiIgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IHJlc3BvbnNlIGlmIHByZXYgZGF0YVR5cGUgaXMgbm9uLWF1dG8gYW5kIGRpZmZlcnMgZnJvbSBjdXJyZW50DQogICAgICAgICAgICAgICAgICAgIGlmICggcHJldiAhPT0gIioiICYmIHByZXYgIT09IGN1cnJlbnQgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2VlayBhIGRpcmVjdCBjb252ZXJ0ZXINCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnYgPSBjb252ZXJ0ZXJzWyBwcmV2ICsgIiAiICsgY3VycmVudCBdIHx8IGNvbnZlcnRlcnNbICIqICIgKyBjdXJyZW50IF07DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgbm9uZSBmb3VuZCwgc2VlayBhIHBhaXINCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIWNvbnYgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJZm9yICggY29udjIgaW4gY29udmVydGVycyApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIElmIGNvbnYyIG91dHB1dHMgY3VycmVudA0KICAgICAgICAgICAgICAgICAgICAgICAgCQl0bXAgPSBjb252Mi5zcGxpdCgiICIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQlpZiAoIHRtcFsgMSBdID09PSBjdXJyZW50ICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCS8vIElmIHByZXYgY2FuIGJlIGNvbnZlcnRlZCB0byBhY2NlcHRlZCBpbnB1dA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJY29udiA9IGNvbnZlcnRlcnNbIHByZXYgKyAiICIgKyB0bXBbIDAgXSBdIHx8DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJY29udmVydGVyc1sgIiogIiArIHRtcFsgMCBdIF07DQogICAgICAgICAgICAgICAgICAgICAgICAJCQlpZiAoIGNvbnYgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJLy8gQ29uZGVuc2UgZXF1aXZhbGVuY2UgY29udmVydGVycw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCWlmICggY29udiA9PT0gdHJ1ZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJY29udiA9IGNvbnZlcnRlcnNbIGNvbnYyIF07DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCS8vIE90aGVyd2lzZSwgaW5zZXJ0IHRoZSBpbnRlcm1lZGlhdGUgZGF0YVR5cGUNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQl9IGVsc2UgaWYgKCBjb252ZXJ0ZXJzWyBjb252MiBdICE9PSB0cnVlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQljdXJyZW50ID0gdG1wWyAwIF07DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCWRhdGFUeXBlcy5zcGxpY2UoIGktLSwgMCwgY3VycmVudCApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCX0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXBwbHkgY29udmVydGVyIChpZiBub3QgYW4gZXF1aXZhbGVuY2UpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGNvbnYgIT09IHRydWUgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIFVubGVzcyBlcnJvcnMgYXJlIGFsbG93ZWQgdG8gYnViYmxlLCBjYXRjaCBhbmQgcmV0dXJuIHRoZW0NCiAgICAgICAgICAgICAgICAgICAgICAgIAlpZiAoIGNvbnYgJiYgc1sidGhyb3dzIl0gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCXJlc3BvbnNlID0gY29udiggcmVzcG9uc2UgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgCQl0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJcmVzcG9uc2UgPSBjb252KCByZXNwb25zZSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9IGNhdGNoICggZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCXJldHVybiB7IHN0YXRlOiAicGFyc2VyZXJyb3IiLCBlcnJvcjogY29udiA/IGUgOiAiTm8gY29udmVyc2lvbiBmcm9tICIgKyBwcmV2ICsgIiB0byAiICsgY3VycmVudCB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgcHJldiBmb3IgbmV4dCBpdGVyYXRpb24NCiAgICAgICAgICAgICAgICAgICAgcHJldiA9IGN1cnJlbnQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIHJldHVybiB7IHN0YXRlOiAic3VjY2VzcyIsIGRhdGE6IHJlc3BvbnNlIH07DQogICAgICAgIH0NCiAgICAgICAgLy8gSW5zdGFsbCBzY3JpcHQgZGF0YVR5cGUNCiAgICAgICAgalF1ZXJ5LmFqYXhTZXR1cCh7DQogICAgICAgICAgICBhY2NlcHRzOiB7DQogICAgICAgICAgICAgICAgc2NyaXB0OiAidGV4dC9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9lY21hc2NyaXB0LCBhcHBsaWNhdGlvbi94LWVjbWFzY3JpcHQiDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgY29udGVudHM6IHsNCiAgICAgICAgICAgICAgICBzY3JpcHQ6IC8oPzpqYXZhfGVjbWEpc2NyaXB0Lw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGNvbnZlcnRlcnM6IHsNCiAgICAgICAgICAgICAgICAidGV4dCBzY3JpcHQiOiBmdW5jdGlvbiggdGV4dCApIHsNCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5Lmdsb2JhbEV2YWwoIHRleHQgKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRleHQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIC8vIEhhbmRsZSBjYWNoZSdzIHNwZWNpYWwgY2FzZSBhbmQgZ2xvYmFsDQogICAgICAgIGpRdWVyeS5hamF4UHJlZmlsdGVyKCAic2NyaXB0IiwgZnVuY3Rpb24oIHMgKSB7DQogICAgICAgICAgICBpZiAoIHMuY2FjaGUgPT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICBzLmNhY2hlID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIHMuY3Jvc3NEb21haW4gKSB7DQogICAgICAgICAgICAgICAgcy50eXBlID0gIkdFVCI7DQogICAgICAgICAgICAgICAgcy5nbG9iYWwgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAvLyBCaW5kIHNjcmlwdCB0YWcgaGFjayB0cmFuc3BvcnQNCiAgICAgICAgalF1ZXJ5LmFqYXhUcmFuc3BvcnQoICJzY3JpcHQiLCBmdW5jdGlvbihzKSB7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gVGhpcyB0cmFuc3BvcnQgb25seSBkZWFscyB3aXRoIGNyb3NzIGRvbWFpbiByZXF1ZXN0cw0KICAgICAgICAgICAgaWYgKCBzLmNyb3NzRG9tYWluICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICB2YXIgc2NyaXB0LA0KICAgICAgICAgICAgICAgICAgICBoZWFkID0gZG9jdW1lbnQuaGVhZCB8fCBqUXVlcnkoImhlYWQiKVswXSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBzZW5kOiBmdW5jdGlvbiggXywgY2FsbGJhY2sgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0LmFzeW5jID0gdHJ1ZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHMuc2NyaXB0Q2hhcnNldCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlzY3JpcHQuY2hhcnNldCA9IHMuc2NyaXB0Q2hhcnNldDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHQuc3JjID0gcy51cmw7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXR0YWNoIGhhbmRsZXJzIGZvciBhbGwgYnJvd3NlcnMNCiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdC5vbmxvYWQgPSBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oIF8sIGlzQWJvcnQgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggaXNBYm9ydCB8fCAhc2NyaXB0LnJlYWR5U3RhdGUgfHwgL2xvYWRlZHxjb21wbGV0ZS8udGVzdCggc2NyaXB0LnJlYWR5U3RhdGUgKSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIEhhbmRsZSBtZW1vcnkgbGVhayBpbiBJRQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQlzY3JpcHQub25sb2FkID0gc2NyaXB0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGw7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkvLyBSZW1vdmUgdGhlIHNjcmlwdA0KICAgICAgICAgICAgICAgICAgICAgICAgCQlpZiAoIHNjcmlwdC5wYXJlbnROb2RlICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJc2NyaXB0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIHNjcmlwdCApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkvLyBEZXJlZmVyZW5jZSB0aGUgc2NyaXB0DQogICAgICAgICAgICAgICAgICAgICAgICAJCXNjcmlwdCA9IG51bGw7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkvLyBDYWxsYmFjayBpZiBub3QgYWJvcnQNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJaWYgKCAhaXNBYm9ydCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWNhbGxiYWNrKCAyMDAsICJzdWNjZXNzIiApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBDaXJjdW12ZW50IElFNiBidWdzIHdpdGggYmFzZSBlbGVtZW50cyAoIzI3MDkgYW5kICM0Mzc4KSBieSBwcmVwZW5kaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBVc2UgbmF0aXZlIERPTSBtYW5pcHVsYXRpb24gdG8gYXZvaWQgb3VyIGRvbU1hbmlwIEFKQVggdHJpY2tlcnkNCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQuaW5zZXJ0QmVmb3JlKCBzY3JpcHQsIGhlYWQuZmlyc3RDaGlsZCApOw0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgYWJvcnQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBzY3JpcHQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJc2NyaXB0Lm9ubG9hZCggdW5kZWZpbmVkLCB0cnVlICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgdmFyIG9sZENhbGxiYWNrcyA9IFtdLA0KICAgICAgICAgICAgcmpzb25wID0gLyg9KVw/KD89JnwkKXxcP1w/LzsNCiAgICAgICAgDQogICAgICAgIC8vIERlZmF1bHQganNvbnAgc2V0dGluZ3MNCiAgICAgICAgalF1ZXJ5LmFqYXhTZXR1cCh7DQogICAgICAgICAgICBqc29ucDogImNhbGxiYWNrIiwNCiAgICAgICAgICAgIGpzb25wQ2FsbGJhY2s6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHZhciBjYWxsYmFjayA9IG9sZENhbGxiYWNrcy5wb3AoKSB8fCAoIGpRdWVyeS5leHBhbmRvICsgIl8iICsgKCBhamF4X25vbmNlKysgKSApOw0KICAgICAgICAgICAgICAgIHRoaXNbIGNhbGxiYWNrIF0gPSB0cnVlOw0KICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAvLyBEZXRlY3QsIG5vcm1hbGl6ZSBvcHRpb25zIGFuZCBpbnN0YWxsIGNhbGxiYWNrcyBmb3IganNvbnAgcmVxdWVzdHMNCiAgICAgICAgalF1ZXJ5LmFqYXhQcmVmaWx0ZXIoICJqc29uIGpzb25wIiwgZnVuY3Rpb24oIHMsIG9yaWdpbmFsU2V0dGluZ3MsIGpxWEhSICkgew0KICAgICAgICANCiAgICAgICAgICAgIHZhciBjYWxsYmFja05hbWUsIG92ZXJ3cml0dGVuLCByZXNwb25zZUNvbnRhaW5lciwNCiAgICAgICAgICAgICAgICBqc29uUHJvcCA9IHMuanNvbnAgIT09IGZhbHNlICYmICggcmpzb25wLnRlc3QoIHMudXJsICkgPw0KICAgICAgICAgICAgICAgICAgICAidXJsIiA6DQogICAgICAgICAgICAgICAgICAgIHR5cGVvZiBzLmRhdGEgPT09ICJzdHJpbmciICYmICEoIHMuY29udGVudFR5cGUgfHwgIiIgKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSAmJiByanNvbnAudGVzdCggcy5kYXRhICkgJiYgImRhdGEiDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBIYW5kbGUgaWZmIHRoZSBleHBlY3RlZCBkYXRhIHR5cGUgaXMgImpzb25wIiBvciB3ZSBoYXZlIGEgcGFyYW1ldGVyIHRvIHNldA0KICAgICAgICAgICAgaWYgKCBqc29uUHJvcCB8fCBzLmRhdGFUeXBlc1sgMCBdID09PSAianNvbnAiICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBHZXQgY2FsbGJhY2sgbmFtZSwgcmVtZW1iZXJpbmcgcHJlZXhpc3RpbmcgdmFsdWUgYXNzb2NpYXRlZCB3aXRoIGl0DQogICAgICAgICAgICAgICAgY2FsbGJhY2tOYW1lID0gcy5qc29ucENhbGxiYWNrID0galF1ZXJ5LmlzRnVuY3Rpb24oIHMuanNvbnBDYWxsYmFjayApID8NCiAgICAgICAgICAgICAgICAgICAgcy5qc29ucENhbGxiYWNrKCkgOg0KICAgICAgICAgICAgICAgICAgICBzLmpzb25wQ2FsbGJhY2s7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEluc2VydCBjYWxsYmFjayBpbnRvIHVybCBvciBmb3JtIGRhdGENCiAgICAgICAgICAgICAgICBpZiAoIGpzb25Qcm9wICkgew0KICAgICAgICAgICAgICAgICAgICBzWyBqc29uUHJvcCBdID0gc1sganNvblByb3AgXS5yZXBsYWNlKCByanNvbnAsICIkMSIgKyBjYWxsYmFja05hbWUgKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBzLmpzb25wICE9PSBmYWxzZSApIHsNCiAgICAgICAgICAgICAgICAgICAgcy51cmwgKz0gKCBhamF4X3JxdWVyeS50ZXN0KCBzLnVybCApID8gIiYiIDogIj8iICkgKyBzLmpzb25wICsgIj0iICsgY2FsbGJhY2tOYW1lOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gVXNlIGRhdGEgY29udmVydGVyIHRvIHJldHJpZXZlIGpzb24gYWZ0ZXIgc2NyaXB0IGV4ZWN1dGlvbg0KICAgICAgICAgICAgICAgIHMuY29udmVydGVyc1sic2NyaXB0IGpzb24iXSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoICFyZXNwb25zZUNvbnRhaW5lciApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5lcnJvciggY2FsbGJhY2tOYW1lICsgIiB3YXMgbm90IGNhbGxlZCIgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VDb250YWluZXJbIDAgXTsNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBmb3JjZSBqc29uIGRhdGFUeXBlDQogICAgICAgICAgICAgICAgcy5kYXRhVHlwZXNbIDAgXSA9ICJqc29uIjsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gSW5zdGFsbCBjYWxsYmFjaw0KICAgICAgICAgICAgICAgIG92ZXJ3cml0dGVuID0gd2luZG93WyBjYWxsYmFja05hbWUgXTsNCiAgICAgICAgICAgICAgICB3aW5kb3dbIGNhbGxiYWNrTmFtZSBdID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlQ29udGFpbmVyID0gYXJndW1lbnRzOw0KICAgICAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIENsZWFuLXVwIGZ1bmN0aW9uIChmaXJlcyBhZnRlciBjb252ZXJ0ZXJzKQ0KICAgICAgICAgICAgICAgIGpxWEhSLmFsd2F5cyhmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gUmVzdG9yZSBwcmVleGlzdGluZyB2YWx1ZQ0KICAgICAgICAgICAgICAgICAgICB3aW5kb3dbIGNhbGxiYWNrTmFtZSBdID0gb3ZlcndyaXR0ZW47DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBTYXZlIGJhY2sgYXMgZnJlZQ0KICAgICAgICAgICAgICAgICAgICBpZiAoIHNbIGNhbGxiYWNrTmFtZSBdICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoYXQgcmUtdXNpbmcgdGhlIG9wdGlvbnMgZG9lc24ndCBzY3JldyB0aGluZ3MgYXJvdW5kDQogICAgICAgICAgICAgICAgICAgICAgICBzLmpzb25wQ2FsbGJhY2sgPSBvcmlnaW5hbFNldHRpbmdzLmpzb25wQ2FsbGJhY2s7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2F2ZSB0aGUgY2FsbGJhY2sgbmFtZSBmb3IgZnV0dXJlIHVzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgb2xkQ2FsbGJhY2tzLnB1c2goIGNhbGxiYWNrTmFtZSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBDYWxsIGlmIGl0IHdhcyBhIGZ1bmN0aW9uIGFuZCB3ZSBoYXZlIGEgcmVzcG9uc2UNCiAgICAgICAgICAgICAgICAgICAgaWYgKCByZXNwb25zZUNvbnRhaW5lciAmJiBqUXVlcnkuaXNGdW5jdGlvbiggb3ZlcndyaXR0ZW4gKSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJ3cml0dGVuKCByZXNwb25zZUNvbnRhaW5lclsgMCBdICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlQ29udGFpbmVyID0gb3ZlcndyaXR0ZW4gPSB1bmRlZmluZWQ7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIERlbGVnYXRlIHRvIHNjcmlwdA0KICAgICAgICAgICAgICAgIHJldHVybiAic2NyaXB0IjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIHZhciB4aHJDYWxsYmFja3MsIHhoclN1cHBvcnRlZCwNCiAgICAgICAgICAgIHhocklkID0gMCwNCiAgICAgICAgICAgIC8vICM1MjgwOiBJbnRlcm5ldCBFeHBsb3JlciB3aWxsIGtlZXAgY29ubmVjdGlvbnMgYWxpdmUgaWYgd2UgZG9uJ3QgYWJvcnQgb24gdW5sb2FkDQogICAgICAgICAgICB4aHJPblVubG9hZEFib3J0ID0gd2luZG93LkFjdGl2ZVhPYmplY3QgJiYgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgLy8gQWJvcnQgYWxsIHBlbmRpbmcgcmVxdWVzdHMNCiAgICAgICAgICAgICAgICB2YXIga2V5Ow0KICAgICAgICAgICAgICAgIGZvciAoIGtleSBpbiB4aHJDYWxsYmFja3MgKSB7DQogICAgICAgICAgICAgICAgICAgIHhockNhbGxiYWNrc1sga2V5IF0oIHVuZGVmaW5lZCwgdHJ1ZSApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAvLyBGdW5jdGlvbnMgdG8gY3JlYXRlIHhocnMNCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlU3RhbmRhcmRYSFIoKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgd2luZG93LlhNTEh0dHBSZXF1ZXN0KCk7DQogICAgICAgICAgICB9IGNhdGNoKCBlICkge30NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQWN0aXZlWEhSKCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHdpbmRvdy5BY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MSFRUUCIpOw0KICAgICAgICAgICAgfSBjYXRjaCggZSApIHt9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIENyZWF0ZSB0aGUgcmVxdWVzdCBvYmplY3QNCiAgICAgICAgLy8gKFRoaXMgaXMgc3RpbGwgYXR0YWNoZWQgdG8gYWpheFNldHRpbmdzIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5KQ0KICAgICAgICBqUXVlcnkuYWpheFNldHRpbmdzLnhociA9IHdpbmRvdy5BY3RpdmVYT2JqZWN0ID8NCiAgICAgICAgICAgIC8qIE1pY3Jvc29mdCBmYWlsZWQgdG8gcHJvcGVybHkNCiAgICAgICAgICAgICAqIGltcGxlbWVudCB0aGUgWE1MSHR0cFJlcXVlc3QgaW4gSUU3IChjYW4ndCByZXF1ZXN0IGxvY2FsIGZpbGVzKSwNCiAgICAgICAgICAgICAqIHNvIHdlIHVzZSB0aGUgQWN0aXZlWE9iamVjdCB3aGVuIGl0IGlzIGF2YWlsYWJsZQ0KICAgICAgICAgICAgICogQWRkaXRpb25hbGx5IFhNTEh0dHBSZXF1ZXN0IGNhbiBiZSBkaXNhYmxlZCBpbiBJRTcvSUU4IHNvDQogICAgICAgICAgICAgKiB3ZSBuZWVkIGEgZmFsbGJhY2suDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiAhdGhpcy5pc0xvY2FsICYmIGNyZWF0ZVN0YW5kYXJkWEhSKCkgfHwgY3JlYXRlQWN0aXZlWEhSKCk7DQogICAgICAgICAgICB9IDoNCiAgICAgICAgICAgIC8vIEZvciBhbGwgb3RoZXIgYnJvd3NlcnMsIHVzZSB0aGUgc3RhbmRhcmQgWE1MSHR0cFJlcXVlc3Qgb2JqZWN0DQogICAgICAgICAgICBjcmVhdGVTdGFuZGFyZFhIUjsNCiAgICAgICAgDQogICAgICAgIC8vIERldGVybWluZSBzdXBwb3J0IHByb3BlcnRpZXMNCiAgICAgICAgeGhyU3VwcG9ydGVkID0galF1ZXJ5LmFqYXhTZXR0aW5ncy54aHIoKTsNCiAgICAgICAgalF1ZXJ5LnN1cHBvcnQuY29ycyA9ICEheGhyU3VwcG9ydGVkICYmICggIndpdGhDcmVkZW50aWFscyIgaW4geGhyU3VwcG9ydGVkICk7DQogICAgICAgIHhoclN1cHBvcnRlZCA9IGpRdWVyeS5zdXBwb3J0LmFqYXggPSAhIXhoclN1cHBvcnRlZDsNCiAgICAgICAgDQogICAgICAgIC8vIENyZWF0ZSB0cmFuc3BvcnQgaWYgdGhlIGJyb3dzZXIgY2FuIHByb3ZpZGUgYW4geGhyDQogICAgICAgIGlmICggeGhyU3VwcG9ydGVkICkgew0KICAgICAgICANCiAgICAgICAgICAgIGpRdWVyeS5hamF4VHJhbnNwb3J0KGZ1bmN0aW9uKCBzICkgew0KICAgICAgICAgICAgICAgIC8vIENyb3NzIGRvbWFpbiBvbmx5IGFsbG93ZWQgaWYgc3VwcG9ydGVkIHRocm91Z2ggWE1MSHR0cFJlcXVlc3QNCiAgICAgICAgICAgICAgICBpZiAoICFzLmNyb3NzRG9tYWluIHx8IGpRdWVyeS5zdXBwb3J0LmNvcnMgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICB2YXIgY2FsbGJhY2s7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZDogZnVuY3Rpb24oIGhlYWRlcnMsIGNvbXBsZXRlICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBHZXQgYSBuZXcgeGhyDQogICAgICAgICAgICAgICAgICAgICAgICAJdmFyIGhhbmRsZSwgaSwNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJeGhyID0gcy54aHIoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gT3BlbiB0aGUgc29ja2V0DQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gUGFzc2luZyBudWxsIHVzZXJuYW1lLCBnZW5lcmF0ZXMgYSBsb2dpbiBwb3B1cCBvbiBPcGVyYSAoIzI4NjUpDQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBzLnVzZXJuYW1lICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQl4aHIub3Blbiggcy50eXBlLCBzLnVybCwgcy5hc3luYywgcy51c2VybmFtZSwgcy5wYXNzd29yZCApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCXhoci5vcGVuKCBzLnR5cGUsIHMudXJsLCBzLmFzeW5jICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBBcHBseSBjdXN0b20gZmllbGRzIGlmIHByb3ZpZGVkDQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBzLnhockZpZWxkcyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZm9yICggaSBpbiBzLnhockZpZWxkcyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCXhoclsgaSBdID0gcy54aHJGaWVsZHNbIGkgXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gT3ZlcnJpZGUgbWltZSB0eXBlIGlmIG5lZWRlZA0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggcy5taW1lVHlwZSAmJiB4aHIub3ZlcnJpZGVNaW1lVHlwZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJeGhyLm92ZXJyaWRlTWltZVR5cGUoIHMubWltZVR5cGUgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIFgtUmVxdWVzdGVkLVdpdGggaGVhZGVyDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gRm9yIGNyb3NzLWRvbWFpbiByZXF1ZXN0cywgc2VlaW5nIGFzIGNvbmRpdGlvbnMgZm9yIGEgcHJlZmxpZ2h0IGFyZQ0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIGFraW4gdG8gYSBqaWdzYXcgcHV6emxlLCB3ZSBzaW1wbHkgbmV2ZXIgc2V0IGl0IHRvIGJlIHN1cmUuDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gKGl0IGNhbiBhbHdheXMgYmUgc2V0IG9uIGEgcGVyLXJlcXVlc3QgYmFzaXMgb3IgZXZlbiB1c2luZyBhamF4U2V0dXApDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gRm9yIHNhbWUtZG9tYWluIHJlcXVlc3RzLCB3b24ndCBjaGFuZ2UgaGVhZGVyIGlmIGFscmVhZHkgcHJvdmlkZWQuDQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCAhcy5jcm9zc0RvbWFpbiAmJiAhaGVhZGVyc1siWC1SZXF1ZXN0ZWQtV2l0aCJdICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQloZWFkZXJzWyJYLVJlcXVlc3RlZC1XaXRoIl0gPSAiWE1MSHR0cFJlcXVlc3QiOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gTmVlZCBhbiBleHRyYSB0cnkvY2F0Y2ggZm9yIGNyb3NzIGRvbWFpbiByZXF1ZXN0cyBpbiBGaXJlZm94IDMNCiAgICAgICAgICAgICAgICAgICAgICAgIAl0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQlmb3IgKCBpIGluIGhlYWRlcnMgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl4aHIuc2V0UmVxdWVzdEhlYWRlciggaSwgaGVhZGVyc1sgaSBdICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAl9IGNhdGNoKCBlcnIgKSB7fQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBEbyBzZW5kIHRoZSByZXF1ZXN0DQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gVGhpcyBtYXkgcmFpc2UgYW4gZXhjZXB0aW9uIHdoaWNoIGlzIGFjdHVhbGx5DQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gaGFuZGxlZCBpbiBqUXVlcnkuYWpheCAoc28gbm8gdHJ5L2NhdGNoIGhlcmUpDQogICAgICAgICAgICAgICAgICAgICAgICAJeGhyLnNlbmQoICggcy5oYXNDb250ZW50ICYmIHMuZGF0YSApIHx8IG51bGwgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gTGlzdGVuZXINCiAgICAgICAgICAgICAgICAgICAgICAgIAljYWxsYmFjayA9IGZ1bmN0aW9uKCBfLCBpc0Fib3J0ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQl2YXIgc3RhdHVzLCByZXNwb25zZUhlYWRlcnMsIHN0YXR1c1RleHQsIHJlc3BvbnNlczsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIEZpcmVmb3ggdGhyb3dzIGV4Y2VwdGlvbnMgd2hlbiBhY2Nlc3NpbmcgcHJvcGVydGllcw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkvLyBvZiBhbiB4aHIgd2hlbiBhIG5ldHdvcmsgZXJyb3Igb2NjdXJyZWQNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gaHR0cDovL2hlbHBmdWwua25vYnMtZGlhbHMuY29tL2luZGV4LnBocC9Db21wb25lbnRfcmV0dXJuZWRfZmFpbHVyZV9jb2RlOl8weDgwMDQwMTExXyhOU19FUlJPUl9OT1RfQVZBSUxBQkxFKQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQl0cnkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCS8vIFdhcyBuZXZlciBjYWxsZWQgYW5kIGlzIGFib3J0ZWQgb3IgY29tcGxldGUNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWlmICggY2FsbGJhY2sgJiYgKCBpc0Fib3J0IHx8IHhoci5yZWFkeVN0YXRlID09PSA0ICkgKSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCS8vIE9ubHkgY2FsbGVkIG9uY2UNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQljYWxsYmFjayA9IHVuZGVmaW5lZDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJLy8gRG8gbm90IGtlZXAgYXMgYWN0aXZlIGFueW1vcmUNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQlpZiAoIGhhbmRsZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGpRdWVyeS5ub29wOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQlpZiAoIHhock9uVW5sb2FkQWJvcnQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCQlkZWxldGUgeGhyQ2FsbGJhY2tzWyBoYW5kbGUgXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCX0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJLy8gSWYgaXQncyBhbiBhYm9ydA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCWlmICggaXNBYm9ydCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJLy8gQWJvcnQgaXQgbWFudWFsbHkgaWYgbmVlZGVkDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCWlmICggeGhyLnJlYWR5U3RhdGUgIT09IDQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCQl4aHIuYWJvcnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCX0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCXJlc3BvbnNlcyA9IHt9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQlzdGF0dXMgPSB4aHIuc3RhdHVzOw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQlyZXNwb25zZUhlYWRlcnMgPSB4aHIuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQkvLyBXaGVuIHJlcXVlc3RpbmcgYmluYXJ5IGRhdGEsIElFNi05IHdpbGwgdGhyb3cgYW4gZXhjZXB0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCS8vIG9uIGFueSBhdHRlbXB0IHRvIGFjY2VzcyByZXNwb25zZVRleHQgKCMxMTQyNikNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJaWYgKCB0eXBlb2YgeGhyLnJlc3BvbnNlVGV4dCA9PT0gInN0cmluZyIgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCQlyZXNwb25zZXMudGV4dCA9IHhoci5yZXNwb25zZVRleHQ7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCX0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCS8vIEZpcmVmb3ggdGhyb3dzIGFuIGV4Y2VwdGlvbiB3aGVuIGFjY2Vzc2luZw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQkvLyBzdGF0dXNUZXh0IGZvciBmYXVsdHkgY3Jvc3MtZG9tYWluIHJlcXVlc3RzDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCXRyeSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCQlzdGF0dXNUZXh0ID0geGhyLnN0YXR1c1RleHQ7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCX0gY2F0Y2goIGUgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCQkvLyBXZSBub3JtYWxpemUgd2l0aCBXZWJraXQgZ2l2aW5nIGFuIGVtcHR5IHN0YXR1c1RleHQNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJCXN0YXR1c1RleHQgPSAiIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJLy8gRmlsdGVyIHN0YXR1cyBmb3Igbm9uIHN0YW5kYXJkIGJlaGF2aW9ycw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJLy8gSWYgdGhlIHJlcXVlc3QgaXMgbG9jYWwgYW5kIHdlIGhhdmUgZGF0YTogYXNzdW1lIGEgc3VjY2Vzcw0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQkvLyAoc3VjY2VzcyB3aXRoIG5vIGRhdGEgd29uJ3QgZ2V0IG5vdGlmaWVkLCB0aGF0J3MgdGhlIGJlc3Qgd2UNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJLy8gY2FuIGRvIGdpdmVuIGN1cnJlbnQgaW1wbGVtZW50YXRpb25zKQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQlpZiAoICFzdGF0dXMgJiYgcy5pc0xvY2FsICYmICFzLmNyb3NzRG9tYWluICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCQkJc3RhdHVzID0gcmVzcG9uc2VzLnRleHQgPyAyMDAgOiA0MDQ7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCS8vIElFIC0gIzE0NTA6IHNvbWV0aW1lcyByZXR1cm5zIDEyMjMgd2hlbiBpdCBzaG91bGQgYmUgMjA0DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJCX0gZWxzZSBpZiAoIHN0YXR1cyA9PT0gMTIyMyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJCXN0YXR1cyA9IDIwNDsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCQkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfSBjYXRjaCggZmlyZWZveEFjY2Vzc0V4Y2VwdGlvbiApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCWlmICggIWlzQWJvcnQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkJY29tcGxldGUoIC0xLCBmaXJlZm94QWNjZXNzRXhjZXB0aW9uICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJCX0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIENhbGwgY29tcGxldGUgaWYgbmVlZGVkDQogICAgICAgICAgICAgICAgICAgICAgICAJCWlmICggcmVzcG9uc2VzICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJY29tcGxldGUoIHN0YXR1cywgc3RhdHVzVGV4dCwgcmVzcG9uc2VzLCByZXNwb25zZUhlYWRlcnMgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCX07DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCWlmICggIXMuYXN5bmMgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCS8vIGlmIHdlJ3JlIGluIHN5bmMgbW9kZSB3ZSBmaXJlIHRoZSBjYWxsYmFjaw0KICAgICAgICAgICAgICAgICAgICAgICAgCQljYWxsYmFjaygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0gZWxzZSBpZiAoIHhoci5yZWFkeVN0YXRlID09PSA0ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkvLyAoSUU2ICYgSUU3KSBpZiBpdCdzIGluIGNhY2hlIGFuZCBoYXMgYmVlbg0KICAgICAgICAgICAgICAgICAgICAgICAgCQkvLyByZXRyaWV2ZWQgZGlyZWN0bHkgd2UgbmVlZCB0byBmaXJlIHRoZSBjYWxsYmFjaw0KICAgICAgICAgICAgICAgICAgICAgICAgCQlzZXRUaW1lb3V0KCBjYWxsYmFjayApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWhhbmRsZSA9ICsreGhySWQ7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWlmICggeGhyT25VbmxvYWRBYm9ydCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCS8vIENyZWF0ZSB0aGUgYWN0aXZlIHhocnMgY2FsbGJhY2tzIGxpc3QgaWYgbmVlZGVkDQogICAgICAgICAgICAgICAgICAgICAgICAJCQkvLyBhbmQgYXR0YWNoIHRoZSB1bmxvYWQgaGFuZGxlcg0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJaWYgKCAheGhyQ2FsbGJhY2tzICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCXhockNhbGxiYWNrcyA9IHt9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgCQkJCWpRdWVyeSggd2luZG93ICkudW5sb2FkKCB4aHJPblVubG9hZEFib3J0ICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAJCQkvLyBBZGQgdG8gbGlzdCBvZiBhY3RpdmUgeGhycyBjYWxsYmFja3MNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJCXhockNhbGxiYWNrc1sgaGFuZGxlIF0gPSBjYWxsYmFjazsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gY2FsbGJhY2s7DQogICAgICAgICAgICAgICAgICAgICAgICAJfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBhYm9ydDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBjYWxsYmFjayApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJY2FsbGJhY2soIHVuZGVmaW5lZCwgdHJ1ZSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgZnhOb3csIHRpbWVySWQsDQogICAgICAgICAgICByZnh0eXBlcyA9IC9eKD86dG9nZ2xlfHNob3d8aGlkZSkkLywNCiAgICAgICAgICAgIHJmeG51bSA9IG5ldyBSZWdFeHAoICJeKD86KFsrLV0pPXwpKCIgKyBjb3JlX3BudW0gKyAiKShbYS16JV0qKSQiLCAiaSIgKSwNCiAgICAgICAgICAgIHJydW4gPSAvcXVldWVIb29rcyQvLA0KICAgICAgICAgICAgYW5pbWF0aW9uUHJlZmlsdGVycyA9IFsgZGVmYXVsdFByZWZpbHRlciBdLA0KICAgICAgICAgICAgdHdlZW5lcnMgPSB7DQogICAgICAgICAgICAgICAgIioiOiBbZnVuY3Rpb24oIHByb3AsIHZhbHVlICkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgZW5kLCB1bml0LA0KICAgICAgICAgICAgICAgICAgICAgICAgdHdlZW4gPSB0aGlzLmNyZWF0ZVR3ZWVuKCBwcm9wLCB2YWx1ZSApLA0KICAgICAgICAgICAgICAgICAgICAgICAgcGFydHMgPSByZnhudW0uZXhlYyggdmFsdWUgKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCA9IHR3ZWVuLmN1cigpLA0KICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSArdGFyZ2V0IHx8IDAsDQogICAgICAgICAgICAgICAgICAgICAgICBzY2FsZSA9IDEsDQogICAgICAgICAgICAgICAgICAgICAgICBtYXhJdGVyYXRpb25zID0gMjA7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoIHBhcnRzICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kID0gK3BhcnRzWzJdOw0KICAgICAgICAgICAgICAgICAgICAgICAgdW5pdCA9IHBhcnRzWzNdIHx8ICggalF1ZXJ5LmNzc051bWJlclsgcHJvcCBdID8gIiIgOiAicHgiICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBjb21wdXRlIHN0YXJ0aW5nIHZhbHVlDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHVuaXQgIT09ICJweCIgJiYgc3RhcnQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gSXRlcmF0aXZlbHkgYXBwcm94aW1hdGUgZnJvbSBhIG5vbnplcm8gc3RhcnRpbmcgcG9pbnQNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBQcmVmZXIgdGhlIGN1cnJlbnQgcHJvcGVydHksIGJlY2F1c2UgdGhpcyBwcm9jZXNzIHdpbGwgYmUgdHJpdmlhbCBpZiBpdCB1c2VzIHRoZSBzYW1lIHVuaXRzDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gRmFsbGJhY2sgdG8gZW5kIG9yIGEgc2ltcGxlIGNvbnN0YW50DQogICAgICAgICAgICAgICAgICAgICAgICAJc3RhcnQgPSBqUXVlcnkuY3NzKCB0d2Vlbi5lbGVtLCBwcm9wLCB0cnVlICkgfHwgZW5kIHx8IDE7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCWRvIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gSWYgcHJldmlvdXMgaXRlcmF0aW9uIHplcm9lZCBvdXQsIGRvdWJsZSB1bnRpbCB3ZSBnZXQgKnNvbWV0aGluZyoNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gVXNlIGEgc3RyaW5nIGZvciBkb3VibGluZyBmYWN0b3Igc28gd2UgZG9uJ3QgYWNjaWRlbnRhbGx5IHNlZSBzY2FsZSBhcyB1bmNoYW5nZWQgYmVsb3cNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJc2NhbGUgPSBzY2FsZSB8fCAiLjUiOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIAkJLy8gQWRqdXN0IGFuZCBhcHBseQ0KICAgICAgICAgICAgICAgICAgICAgICAgCQlzdGFydCA9IHN0YXJ0IC8gc2NhbGU7DQogICAgICAgICAgICAgICAgICAgICAgICAJCWpRdWVyeS5zdHlsZSggdHdlZW4uZWxlbSwgcHJvcCwgc3RhcnQgKyB1bml0ICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIFVwZGF0ZSBzY2FsZSwgdG9sZXJhdGluZyB6ZXJvIG9yIE5hTiBmcm9tIHR3ZWVuLmN1cigpDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gQW5kIGJyZWFraW5nIHRoZSBsb29wIGlmIHNjYWxlIGlzIHVuY2hhbmdlZCBvciBwZXJmZWN0LCBvciBpZiB3ZSd2ZSBqdXN0IGhhZCBlbm91Z2gNCiAgICAgICAgICAgICAgICAgICAgICAgIAl9IHdoaWxlICggc2NhbGUgIT09IChzY2FsZSA9IHR3ZWVuLmN1cigpIC8gdGFyZ2V0KSAmJiBzY2FsZSAhPT0gMSAmJiAtLW1heEl0ZXJhdGlvbnMgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0d2Vlbi51bml0ID0gdW5pdDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHR3ZWVuLnN0YXJ0ID0gc3RhcnQ7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBhICs9Ly09IHRva2VuIHdhcyBwcm92aWRlZCwgd2UncmUgZG9pbmcgYSByZWxhdGl2ZSBhbmltYXRpb24NCiAgICAgICAgICAgICAgICAgICAgICAgIHR3ZWVuLmVuZCA9IHBhcnRzWzFdID8gc3RhcnQgKyAoIHBhcnRzWzFdICsgMSApICogZW5kIDogZW5kOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0d2VlbjsNCiAgICAgICAgICAgICAgICB9XQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIC8vIEFuaW1hdGlvbnMgY3JlYXRlZCBzeW5jaHJvbm91c2x5IHdpbGwgcnVuIHN5bmNocm9ub3VzbHkNCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlRnhOb3coKSB7DQogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGZ4Tm93ID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICByZXR1cm4gKCBmeE5vdyA9IGpRdWVyeS5ub3coKSApOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVUd2VlbnMoIGFuaW1hdGlvbiwgcHJvcHMgKSB7DQogICAgICAgICAgICBqUXVlcnkuZWFjaCggcHJvcHMsIGZ1bmN0aW9uKCBwcm9wLCB2YWx1ZSApIHsNCiAgICAgICAgICAgICAgICB2YXIgY29sbGVjdGlvbiA9ICggdHdlZW5lcnNbIHByb3AgXSB8fCBbXSApLmNvbmNhdCggdHdlZW5lcnNbICIqIiBdICksDQogICAgICAgICAgICAgICAgICAgIGluZGV4ID0gMCwNCiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gY29sbGVjdGlvbi5sZW5ndGg7DQogICAgICAgICAgICAgICAgZm9yICggOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBjb2xsZWN0aW9uWyBpbmRleCBdLmNhbGwoIGFuaW1hdGlvbiwgcHJvcCwgdmFsdWUgKSApIHsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSdyZSBkb25lIHdpdGggdGhpcyBwcm9wZXJ0eQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIEFuaW1hdGlvbiggZWxlbSwgcHJvcGVydGllcywgb3B0aW9ucyApIHsNCiAgICAgICAgICAgIHZhciByZXN1bHQsDQogICAgICAgICAgICAgICAgc3RvcHBlZCwNCiAgICAgICAgICAgICAgICBpbmRleCA9IDAsDQogICAgICAgICAgICAgICAgbGVuZ3RoID0gYW5pbWF0aW9uUHJlZmlsdGVycy5sZW5ndGgsDQogICAgICAgICAgICAgICAgZGVmZXJyZWQgPSBqUXVlcnkuRGVmZXJyZWQoKS5hbHdheXMoIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBkb24ndCBtYXRjaCBlbGVtIGluIHRoZSA6YW5pbWF0ZWQgc2VsZWN0b3INCiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRpY2suZWxlbTsNCiAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgICB0aWNrID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggc3RvcHBlZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudFRpbWUgPSBmeE5vdyB8fCBjcmVhdGVGeE5vdygpLA0KICAgICAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nID0gTWF0aC5tYXgoIDAsIGFuaW1hdGlvbi5zdGFydFRpbWUgKyBhbmltYXRpb24uZHVyYXRpb24gLSBjdXJyZW50VGltZSApLA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXJjaGFpYyBjcmFzaCBidWcgd29uJ3QgYWxsb3cgdXMgdG8gdXNlIDEgLSAoIDAuNSB8fCAwICkgKCMxMjQ5NykNCiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgPSByZW1haW5pbmcgLyBhbmltYXRpb24uZHVyYXRpb24gfHwgMCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnQgPSAxIC0gdGVtcCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gMCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IGFuaW1hdGlvbi50d2VlbnMubGVuZ3RoOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZm9yICggOyBpbmRleCA8IGxlbmd0aCA7IGluZGV4KysgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb24udHdlZW5zWyBpbmRleCBdLnJ1biggcGVyY2VudCApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5ub3RpZnlXaXRoKCBlbGVtLCBbIGFuaW1hdGlvbiwgcGVyY2VudCwgcmVtYWluaW5nIF0pOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCBwZXJjZW50IDwgMSAmJiBsZW5ndGggKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVtYWluaW5nOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZVdpdGgoIGVsZW0sIFsgYW5pbWF0aW9uIF0gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgYW5pbWF0aW9uID0gZGVmZXJyZWQucHJvbWlzZSh7DQogICAgICAgICAgICAgICAgICAgIGVsZW06IGVsZW0sDQogICAgICAgICAgICAgICAgICAgIHByb3BzOiBqUXVlcnkuZXh0ZW5kKCB7fSwgcHJvcGVydGllcyApLA0KICAgICAgICAgICAgICAgICAgICBvcHRzOiBqUXVlcnkuZXh0ZW5kKCB0cnVlLCB7IHNwZWNpYWxFYXNpbmc6IHt9IH0sIG9wdGlvbnMgKSwNCiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxQcm9wZXJ0aWVzOiBwcm9wZXJ0aWVzLA0KICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbE9wdGlvbnM6IG9wdGlvbnMsDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogZnhOb3cgfHwgY3JlYXRlRnhOb3coKSwNCiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IG9wdGlvbnMuZHVyYXRpb24sDQogICAgICAgICAgICAgICAgICAgIHR3ZWVuczogW10sDQogICAgICAgICAgICAgICAgICAgIGNyZWF0ZVR3ZWVuOiBmdW5jdGlvbiggcHJvcCwgZW5kICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR3ZWVuID0galF1ZXJ5LlR3ZWVuKCBlbGVtLCBhbmltYXRpb24ub3B0cywgcHJvcCwgZW5kLA0KICAgICAgICAgICAgICAgICAgICAgICAgCQlhbmltYXRpb24ub3B0cy5zcGVjaWFsRWFzaW5nWyBwcm9wIF0gfHwgYW5pbWF0aW9uLm9wdHMuZWFzaW5nICk7DQogICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb24udHdlZW5zLnB1c2goIHR3ZWVuICk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHdlZW47DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHN0b3A6IGZ1bmN0aW9uKCBnb3RvRW5kICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gMCwNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBpZiB3ZSBhcmUgZ29pbmcgdG8gdGhlIGVuZCwgd2Ugd2FudCB0byBydW4gYWxsIHRoZSB0d2VlbnMNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBvdGhlcndpc2Ugd2Ugc2tpcCB0aGlzIHBhcnQNCiAgICAgICAgICAgICAgICAgICAgICAgIAlsZW5ndGggPSBnb3RvRW5kID8gYW5pbWF0aW9uLnR3ZWVucy5sZW5ndGggOiAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBzdG9wcGVkICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCXJldHVybiB0aGlzOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgc3RvcHBlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlhbmltYXRpb24udHdlZW5zWyBpbmRleCBdLnJ1biggMSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlc29sdmUgd2hlbiB3ZSBwbGF5ZWQgdGhlIGxhc3QgZnJhbWUNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSwgcmVqZWN0DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGdvdG9FbmQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJZGVmZXJyZWQucmVzb2x2ZVdpdGgoIGVsZW0sIFsgYW5pbWF0aW9uLCBnb3RvRW5kIF0gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJZGVmZXJyZWQucmVqZWN0V2l0aCggZWxlbSwgWyBhbmltYXRpb24sIGdvdG9FbmQgXSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgICBwcm9wcyA9IGFuaW1hdGlvbi5wcm9wczsNCiAgICAgICAgDQogICAgICAgICAgICBwcm9wRmlsdGVyKCBwcm9wcywgYW5pbWF0aW9uLm9wdHMuc3BlY2lhbEVhc2luZyApOw0KICAgICAgICANCiAgICAgICAgICAgIGZvciAoIDsgaW5kZXggPCBsZW5ndGggOyBpbmRleCsrICkgew0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IGFuaW1hdGlvblByZWZpbHRlcnNbIGluZGV4IF0uY2FsbCggYW5pbWF0aW9uLCBlbGVtLCBwcm9wcywgYW5pbWF0aW9uLm9wdHMgKTsNCiAgICAgICAgICAgICAgICBpZiAoIHJlc3VsdCApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgY3JlYXRlVHdlZW5zKCBhbmltYXRpb24sIHByb3BzICk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggYW5pbWF0aW9uLm9wdHMuc3RhcnQgKSApIHsNCiAgICAgICAgICAgICAgICBhbmltYXRpb24ub3B0cy5zdGFydC5jYWxsKCBlbGVtLCBhbmltYXRpb24gKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBqUXVlcnkuZngudGltZXIoDQogICAgICAgICAgICAgICAgalF1ZXJ5LmV4dGVuZCggdGljaywgew0KICAgICAgICAgICAgICAgICAgICBlbGVtOiBlbGVtLA0KICAgICAgICAgICAgICAgICAgICBhbmltOiBhbmltYXRpb24sDQogICAgICAgICAgICAgICAgICAgIHF1ZXVlOiBhbmltYXRpb24ub3B0cy5xdWV1ZQ0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICApOw0KICAgICAgICANCiAgICAgICAgICAgIC8vIGF0dGFjaCBjYWxsYmFja3MgZnJvbSBvcHRpb25zDQogICAgICAgICAgICByZXR1cm4gYW5pbWF0aW9uLnByb2dyZXNzKCBhbmltYXRpb24ub3B0cy5wcm9ncmVzcyApDQogICAgICAgICAgICAgICAgLmRvbmUoIGFuaW1hdGlvbi5vcHRzLmRvbmUsIGFuaW1hdGlvbi5vcHRzLmNvbXBsZXRlICkNCiAgICAgICAgICAgICAgICAuZmFpbCggYW5pbWF0aW9uLm9wdHMuZmFpbCApDQogICAgICAgICAgICAgICAgLmFsd2F5cyggYW5pbWF0aW9uLm9wdHMuYWx3YXlzICk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIHByb3BGaWx0ZXIoIHByb3BzLCBzcGVjaWFsRWFzaW5nICkgew0KICAgICAgICAgICAgdmFyIHZhbHVlLCBuYW1lLCBpbmRleCwgZWFzaW5nLCBob29rczsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBjYW1lbENhc2UsIHNwZWNpYWxFYXNpbmcgYW5kIGV4cGFuZCBjc3NIb29rIHBhc3MNCiAgICAgICAgICAgIGZvciAoIGluZGV4IGluIHByb3BzICkgew0KICAgICAgICAgICAgICAgIG5hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKCBpbmRleCApOw0KICAgICAgICAgICAgICAgIGVhc2luZyA9IHNwZWNpYWxFYXNpbmdbIG5hbWUgXTsNCiAgICAgICAgICAgICAgICB2YWx1ZSA9IHByb3BzWyBpbmRleCBdOw0KICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbHVlICkgKSB7DQogICAgICAgICAgICAgICAgICAgIGVhc2luZyA9IHZhbHVlWyAxIF07DQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcHJvcHNbIGluZGV4IF0gPSB2YWx1ZVsgMCBdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCBpbmRleCAhPT0gbmFtZSApIHsNCiAgICAgICAgICAgICAgICAgICAgcHJvcHNbIG5hbWUgXSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgICAgICBkZWxldGUgcHJvcHNbIGluZGV4IF07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdOw0KICAgICAgICAgICAgICAgIGlmICggaG9va3MgJiYgImV4cGFuZCIgaW4gaG9va3MgKSB7DQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gaG9va3MuZXhwYW5kKCB2YWx1ZSApOw0KICAgICAgICAgICAgICAgICAgICBkZWxldGUgcHJvcHNbIG5hbWUgXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIG5vdCBxdWl0ZSAkLmV4dGVuZCwgdGhpcyB3b250IG92ZXJ3cml0ZSBrZXlzIGFscmVhZHkgcHJlc2VudC4NCiAgICAgICAgICAgICAgICAgICAgLy8gYWxzbyAtIHJldXNpbmcgJ2luZGV4JyBmcm9tIGFib3ZlIGJlY2F1c2Ugd2UgaGF2ZSB0aGUgY29ycmVjdCAibmFtZSINCiAgICAgICAgICAgICAgICAgICAgZm9yICggaW5kZXggaW4gdmFsdWUgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICEoIGluZGV4IGluIHByb3BzICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJcHJvcHNbIGluZGV4IF0gPSB2YWx1ZVsgaW5kZXggXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlzcGVjaWFsRWFzaW5nWyBpbmRleCBdID0gZWFzaW5nOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgc3BlY2lhbEVhc2luZ1sgbmFtZSBdID0gZWFzaW5nOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgalF1ZXJ5LkFuaW1hdGlvbiA9IGpRdWVyeS5leHRlbmQoIEFuaW1hdGlvbiwgew0KICAgICAgICANCiAgICAgICAgICAgIHR3ZWVuZXI6IGZ1bmN0aW9uKCBwcm9wcywgY2FsbGJhY2sgKSB7DQogICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggcHJvcHMgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBwcm9wczsNCiAgICAgICAgICAgICAgICAgICAgcHJvcHMgPSBbICIqIiBdOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHByb3BzID0gcHJvcHMuc3BsaXQoIiAiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHZhciBwcm9wLA0KICAgICAgICAgICAgICAgICAgICBpbmRleCA9IDAsDQogICAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgZm9yICggOyBpbmRleCA8IGxlbmd0aCA7IGluZGV4KysgKSB7DQogICAgICAgICAgICAgICAgICAgIHByb3AgPSBwcm9wc1sgaW5kZXggXTsNCiAgICAgICAgICAgICAgICAgICAgdHdlZW5lcnNbIHByb3AgXSA9IHR3ZWVuZXJzWyBwcm9wIF0gfHwgW107DQogICAgICAgICAgICAgICAgICAgIHR3ZWVuZXJzWyBwcm9wIF0udW5zaGlmdCggY2FsbGJhY2sgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgICAgIHByZWZpbHRlcjogZnVuY3Rpb24oIGNhbGxiYWNrLCBwcmVwZW5kICkgew0KICAgICAgICAgICAgICAgIGlmICggcHJlcGVuZCApIHsNCiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uUHJlZmlsdGVycy51bnNoaWZ0KCBjYWxsYmFjayApOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvblByZWZpbHRlcnMucHVzaCggY2FsbGJhY2sgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gZGVmYXVsdFByZWZpbHRlciggZWxlbSwgcHJvcHMsIG9wdHMgKSB7DQogICAgICAgICAgICAvKmpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqLw0KICAgICAgICAgICAgdmFyIHByb3AsIGluZGV4LCBsZW5ndGgsDQogICAgICAgICAgICAgICAgdmFsdWUsIGRhdGFTaG93LCB0b2dnbGUsDQogICAgICAgICAgICAgICAgdHdlZW4sIGhvb2tzLCBvbGRmaXJlLA0KICAgICAgICAgICAgICAgIGFuaW0gPSB0aGlzLA0KICAgICAgICAgICAgICAgIHN0eWxlID0gZWxlbS5zdHlsZSwNCiAgICAgICAgICAgICAgICBvcmlnID0ge30sDQogICAgICAgICAgICAgICAgaGFuZGxlZCA9IFtdLA0KICAgICAgICAgICAgICAgIGhpZGRlbiA9IGVsZW0ubm9kZVR5cGUgJiYgaXNIaWRkZW4oIGVsZW0gKTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBoYW5kbGUgcXVldWU6IGZhbHNlIHByb21pc2VzDQogICAgICAgICAgICBpZiAoICFvcHRzLnF1ZXVlICkgew0KICAgICAgICAgICAgICAgIGhvb2tzID0galF1ZXJ5Ll9xdWV1ZUhvb2tzKCBlbGVtLCAiZngiICk7DQogICAgICAgICAgICAgICAgaWYgKCBob29rcy51bnF1ZXVlZCA9PSBudWxsICkgew0KICAgICAgICAgICAgICAgICAgICBob29rcy51bnF1ZXVlZCA9IDA7DQogICAgICAgICAgICAgICAgICAgIG9sZGZpcmUgPSBob29rcy5lbXB0eS5maXJlOw0KICAgICAgICAgICAgICAgICAgICBob29rcy5lbXB0eS5maXJlID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICFob29rcy51bnF1ZXVlZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlvbGRmaXJlKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGhvb2tzLnVucXVldWVkKys7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuaW0uYWx3YXlzKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBkb2luZyB0aGlzIG1ha2VzIHN1cmUgdGhhdCB0aGUgY29tcGxldGUgaGFuZGxlciB3aWxsIGJlIGNhbGxlZA0KICAgICAgICAgICAgICAgICAgICAvLyBiZWZvcmUgdGhpcyBjb21wbGV0ZXMNCiAgICAgICAgICAgICAgICAgICAgYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBob29rcy51bnF1ZXVlZC0tOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhalF1ZXJ5LnF1ZXVlKCBlbGVtLCAiZngiICkubGVuZ3RoICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWhvb2tzLmVtcHR5LmZpcmUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gaGVpZ2h0L3dpZHRoIG92ZXJmbG93IHBhc3MNCiAgICAgICAgICAgIGlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoICJoZWlnaHQiIGluIHByb3BzIHx8ICJ3aWR0aCIgaW4gcHJvcHMgKSApIHsNCiAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCBub3RoaW5nIHNuZWFrcyBvdXQNCiAgICAgICAgICAgICAgICAvLyBSZWNvcmQgYWxsIDMgb3ZlcmZsb3cgYXR0cmlidXRlcyBiZWNhdXNlIElFIGRvZXMgbm90DQogICAgICAgICAgICAgICAgLy8gY2hhbmdlIHRoZSBvdmVyZmxvdyBhdHRyaWJ1dGUgd2hlbiBvdmVyZmxvd1ggYW5kDQogICAgICAgICAgICAgICAgLy8gb3ZlcmZsb3dZIGFyZSBzZXQgdG8gdGhlIHNhbWUgdmFsdWUNCiAgICAgICAgICAgICAgICBvcHRzLm92ZXJmbG93ID0gWyBzdHlsZS5vdmVyZmxvdywgc3R5bGUub3ZlcmZsb3dYLCBzdHlsZS5vdmVyZmxvd1kgXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gU2V0IGRpc3BsYXkgcHJvcGVydHkgdG8gaW5saW5lLWJsb2NrIGZvciBoZWlnaHQvd2lkdGgNCiAgICAgICAgICAgICAgICAvLyBhbmltYXRpb25zIG9uIGlubGluZSBlbGVtZW50cyB0aGF0IGFyZSBoYXZpbmcgd2lkdGgvaGVpZ2h0IGFuaW1hdGVkDQogICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuY3NzKCBlbGVtLCAiZGlzcGxheSIgKSA9PT0gImlubGluZSIgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5jc3MoIGVsZW0sICJmbG9hdCIgKSA9PT0gIm5vbmUiICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gaW5saW5lLWxldmVsIGVsZW1lbnRzIGFjY2VwdCBpbmxpbmUtYmxvY2s7DQogICAgICAgICAgICAgICAgICAgIC8vIGJsb2NrLWxldmVsIGVsZW1lbnRzIG5lZWQgdG8gYmUgaW5saW5lIHdpdGggbGF5b3V0DQogICAgICAgICAgICAgICAgICAgIGlmICggIWpRdWVyeS5zdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXQgfHwgY3NzX2RlZmF1bHREaXNwbGF5KCBlbGVtLm5vZGVOYW1lICkgPT09ICJpbmxpbmUiICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlLnpvb20gPSAxOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmICggb3B0cy5vdmVyZmxvdyApIHsNCiAgICAgICAgICAgICAgICBzdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOw0KICAgICAgICAgICAgICAgIGlmICggIWpRdWVyeS5zdXBwb3J0LnNocmlua1dyYXBCbG9ja3MgKSB7DQogICAgICAgICAgICAgICAgICAgIGFuaW0uYWx3YXlzKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGUub3ZlcmZsb3cgPSBvcHRzLm92ZXJmbG93WyAwIF07DQogICAgICAgICAgICAgICAgICAgICAgICBzdHlsZS5vdmVyZmxvd1ggPSBvcHRzLm92ZXJmbG93WyAxIF07DQogICAgICAgICAgICAgICAgICAgICAgICBzdHlsZS5vdmVyZmxvd1kgPSBvcHRzLm92ZXJmbG93WyAyIF07DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICAgICAgLy8gc2hvdy9oaWRlIHBhc3MNCiAgICAgICAgICAgIGZvciAoIGluZGV4IGluIHByb3BzICkgew0KICAgICAgICAgICAgICAgIHZhbHVlID0gcHJvcHNbIGluZGV4IF07DQogICAgICAgICAgICAgICAgaWYgKCByZnh0eXBlcy5leGVjKCB2YWx1ZSApICkgew0KICAgICAgICAgICAgICAgICAgICBkZWxldGUgcHJvcHNbIGluZGV4IF07DQogICAgICAgICAgICAgICAgICAgIHRvZ2dsZSA9IHRvZ2dsZSB8fCB2YWx1ZSA9PT0gInRvZ2dsZSI7DQogICAgICAgICAgICAgICAgICAgIGlmICggdmFsdWUgPT09ICggaGlkZGVuID8gImhpZGUiIDogInNob3ciICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVkLnB1c2goIGluZGV4ICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGxlbmd0aCA9IGhhbmRsZWQubGVuZ3RoOw0KICAgICAgICAgICAgaWYgKCBsZW5ndGggKSB7DQogICAgICAgICAgICAgICAgZGF0YVNob3cgPSBqUXVlcnkuX2RhdGEoIGVsZW0sICJmeHNob3ciICkgfHwgalF1ZXJ5Ll9kYXRhKCBlbGVtLCAiZnhzaG93Iiwge30gKTsNCiAgICAgICAgICAgICAgICBpZiAoICJoaWRkZW4iIGluIGRhdGFTaG93ICkgew0KICAgICAgICAgICAgICAgICAgICBoaWRkZW4gPSBkYXRhU2hvdy5oaWRkZW47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBzdGF0ZSBpZiBpdHMgdG9nZ2xlIC0gZW5hYmxlcyAuc3RvcCgpLnRvZ2dsZSgpIHRvICJyZXZlcnNlIg0KICAgICAgICAgICAgICAgIGlmICggdG9nZ2xlICkgew0KICAgICAgICAgICAgICAgICAgICBkYXRhU2hvdy5oaWRkZW4gPSAhaGlkZGVuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIGhpZGRlbiApIHsNCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCBlbGVtICkuc2hvdygpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGFuaW0uZG9uZShmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeSggZWxlbSApLmhpZGUoKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGFuaW0uZG9uZShmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHByb3A7DQogICAgICAgICAgICAgICAgICAgIGpRdWVyeS5fcmVtb3ZlRGF0YSggZWxlbSwgImZ4c2hvdyIgKTsNCiAgICAgICAgICAgICAgICAgICAgZm9yICggcHJvcCBpbiBvcmlnICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LnN0eWxlKCBlbGVtLCBwcm9wLCBvcmlnWyBwcm9wIF0gKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGZvciAoIGluZGV4ID0gMCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgcHJvcCA9IGhhbmRsZWRbIGluZGV4IF07DQogICAgICAgICAgICAgICAgICAgIHR3ZWVuID0gYW5pbS5jcmVhdGVUd2VlbiggcHJvcCwgaGlkZGVuID8gZGF0YVNob3dbIHByb3AgXSA6IDAgKTsNCiAgICAgICAgICAgICAgICAgICAgb3JpZ1sgcHJvcCBdID0gZGF0YVNob3dbIHByb3AgXSB8fCBqUXVlcnkuc3R5bGUoIGVsZW0sIHByb3AgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmICggISggcHJvcCBpbiBkYXRhU2hvdyApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVNob3dbIHByb3AgXSA9IHR3ZWVuLnN0YXJ0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBoaWRkZW4gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJdHdlZW4uZW5kID0gdHdlZW4uc3RhcnQ7DQogICAgICAgICAgICAgICAgICAgICAgICAJdHdlZW4uc3RhcnQgPSBwcm9wID09PSAid2lkdGgiIHx8IHByb3AgPT09ICJoZWlnaHQiID8gMSA6IDA7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIFR3ZWVuKCBlbGVtLCBvcHRpb25zLCBwcm9wLCBlbmQsIGVhc2luZyApIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgVHdlZW4ucHJvdG90eXBlLmluaXQoIGVsZW0sIG9wdGlvbnMsIHByb3AsIGVuZCwgZWFzaW5nICk7DQogICAgICAgIH0NCiAgICAgICAgalF1ZXJ5LlR3ZWVuID0gVHdlZW47DQogICAgICAgIA0KICAgICAgICBUd2Vlbi5wcm90b3R5cGUgPSB7DQogICAgICAgICAgICBjb25zdHJ1Y3RvcjogVHdlZW4sDQogICAgICAgICAgICBpbml0OiBmdW5jdGlvbiggZWxlbSwgb3B0aW9ucywgcHJvcCwgZW5kLCBlYXNpbmcsIHVuaXQgKSB7DQogICAgICAgICAgICAgICAgdGhpcy5lbGVtID0gZWxlbTsNCiAgICAgICAgICAgICAgICB0aGlzLnByb3AgPSBwcm9wOw0KICAgICAgICAgICAgICAgIHRoaXMuZWFzaW5nID0gZWFzaW5nIHx8ICJzd2luZyI7DQogICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsNCiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0ID0gdGhpcy5ub3cgPSB0aGlzLmN1cigpOw0KICAgICAgICAgICAgICAgIHRoaXMuZW5kID0gZW5kOw0KICAgICAgICAgICAgICAgIHRoaXMudW5pdCA9IHVuaXQgfHwgKCBqUXVlcnkuY3NzTnVtYmVyWyBwcm9wIF0gPyAiIiA6ICJweCIgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBjdXI6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHZhciBob29rcyA9IFR3ZWVuLnByb3BIb29rc1sgdGhpcy5wcm9wIF07DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBob29rcyAmJiBob29rcy5nZXQgPw0KICAgICAgICAgICAgICAgICAgICBob29rcy5nZXQoIHRoaXMgKSA6DQogICAgICAgICAgICAgICAgICAgIFR3ZWVuLnByb3BIb29rcy5fZGVmYXVsdC5nZXQoIHRoaXMgKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCBwZXJjZW50ICkgew0KICAgICAgICAgICAgICAgIHZhciBlYXNlZCwNCiAgICAgICAgICAgICAgICAgICAgaG9va3MgPSBUd2Vlbi5wcm9wSG9va3NbIHRoaXMucHJvcCBdOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIHRoaXMub3B0aW9ucy5kdXJhdGlvbiApIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3MgPSBlYXNlZCA9IGpRdWVyeS5lYXNpbmdbIHRoaXMuZWFzaW5nIF0oDQogICAgICAgICAgICAgICAgICAgICAgICBwZXJjZW50LCB0aGlzLm9wdGlvbnMuZHVyYXRpb24gKiBwZXJjZW50LCAwLCAxLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24NCiAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcyA9IGVhc2VkID0gcGVyY2VudDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhpcy5ub3cgPSAoIHRoaXMuZW5kIC0gdGhpcy5zdGFydCApICogZWFzZWQgKyB0aGlzLnN0YXJ0Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIHRoaXMub3B0aW9ucy5zdGVwICkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKCB0aGlzLmVsZW0sIHRoaXMubm93LCB0aGlzICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIGhvb2tzICYmIGhvb2tzLnNldCApIHsNCiAgICAgICAgICAgICAgICAgICAgaG9va3Muc2V0KCB0aGlzICk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgVHdlZW4ucHJvcEhvb2tzLl9kZWZhdWx0LnNldCggdGhpcyApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIFR3ZWVuLnByb3RvdHlwZS5pbml0LnByb3RvdHlwZSA9IFR3ZWVuLnByb3RvdHlwZTsNCiAgICAgICAgDQogICAgICAgIFR3ZWVuLnByb3BIb29rcyA9IHsNCiAgICAgICAgICAgIF9kZWZhdWx0OiB7DQogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQ7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoIHR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXSAhPSBudWxsICYmDQogICAgICAgICAgICAgICAgICAgICAgICAoIXR3ZWVuLmVsZW0uc3R5bGUgfHwgdHdlZW4uZWxlbS5zdHlsZVsgdHdlZW4ucHJvcCBdID09IG51bGwpICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gcGFzc2luZyBhbiBlbXB0eSBzdHJpbmcgYXMgYSAzcmQgcGFyYW1ldGVyIHRvIC5jc3Mgd2lsbCBhdXRvbWF0aWNhbGx5DQogICAgICAgICAgICAgICAgICAgIC8vIGF0dGVtcHQgYSBwYXJzZUZsb2F0IGFuZCBmYWxsYmFjayB0byBhIHN0cmluZyBpZiB0aGUgcGFyc2UgZmFpbHMNCiAgICAgICAgICAgICAgICAgICAgLy8gc28sIHNpbXBsZSB2YWx1ZXMgc3VjaCBhcyAiMTBweCIgYXJlIHBhcnNlZCB0byBGbG9hdC4NCiAgICAgICAgICAgICAgICAgICAgLy8gY29tcGxleCB2YWx1ZXMgc3VjaCBhcyAicm90YXRlKDFyYWQpIiBhcmUgcmV0dXJuZWQgYXMgaXMuDQogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpRdWVyeS5jc3MoIHR3ZWVuLmVsZW0sIHR3ZWVuLnByb3AsICIiICk7DQogICAgICAgICAgICAgICAgICAgIC8vIEVtcHR5IHN0cmluZ3MsIG51bGwsIHVuZGVmaW5lZCBhbmQgImF1dG8iIGFyZSBjb252ZXJ0ZWQgdG8gMC4NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFyZXN1bHQgfHwgcmVzdWx0ID09PSAiYXV0byIgPyAwIDogcmVzdWx0Ow0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIHVzZSBzdGVwIGhvb2sgZm9yIGJhY2sgY29tcGF0IC0gdXNlIGNzc0hvb2sgaWYgaXRzIHRoZXJlIC0gdXNlIC5zdHlsZSBpZiBpdHMNCiAgICAgICAgICAgICAgICAgICAgLy8gYXZhaWxhYmxlIGFuZCB1c2UgcGxhaW4gcHJvcGVydGllcyB3aGVyZSBhdmFpbGFibGUNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuZnguc3RlcFsgdHdlZW4ucHJvcCBdICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmZ4LnN0ZXBbIHR3ZWVuLnByb3AgXSggdHdlZW4gKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggdHdlZW4uZWxlbS5zdHlsZSAmJiAoIHR3ZWVuLmVsZW0uc3R5bGVbIGpRdWVyeS5jc3NQcm9wc1sgdHdlZW4ucHJvcCBdIF0gIT0gbnVsbCB8fCBqUXVlcnkuY3NzSG9va3NbIHR3ZWVuLnByb3AgXSApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LnN0eWxlKCB0d2Vlbi5lbGVtLCB0d2Vlbi5wcm9wLCB0d2Vlbi5ub3cgKyB0d2Vlbi51bml0ICk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0d2Vlbi5lbGVtWyB0d2Vlbi5wcm9wIF0gPSB0d2Vlbi5ub3c7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAvLyBSZW1vdmUgaW4gMi4wIC0gdGhpcyBzdXBwb3J0cyBJRTgncyBwYW5pYyBiYXNlZCBhcHByb2FjaA0KICAgICAgICAvLyB0byBzZXR0aW5nIHRoaW5ncyBvbiBkaXNjb25uZWN0ZWQgbm9kZXMNCiAgICAgICAgDQogICAgICAgIFR3ZWVuLnByb3BIb29rcy5zY3JvbGxUb3AgPSBUd2Vlbi5wcm9wSG9va3Muc2Nyb2xsTGVmdCA9IHsNCiAgICAgICAgICAgIHNldDogZnVuY3Rpb24oIHR3ZWVuICkgew0KICAgICAgICAgICAgICAgIGlmICggdHdlZW4uZWxlbS5ub2RlVHlwZSAmJiB0d2Vlbi5lbGVtLnBhcmVudE5vZGUgKSB7DQogICAgICAgICAgICAgICAgICAgIHR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXSA9IHR3ZWVuLm5vdzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZWFjaChbICJ0b2dnbGUiLCAic2hvdyIsICJoaWRlIiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsNCiAgICAgICAgICAgIHZhciBjc3NGbiA9IGpRdWVyeS5mblsgbmFtZSBdOw0KICAgICAgICAgICAgalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHNwZWVkID09IG51bGwgfHwgdHlwZW9mIHNwZWVkID09PSAiYm9vbGVhbiIgPw0KICAgICAgICAgICAgICAgICAgICBjc3NGbi5hcHBseSggdGhpcywgYXJndW1lbnRzICkgOg0KICAgICAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGUoIGdlbkZ4KCBuYW1lLCB0cnVlICksIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICk7DQogICAgICAgICAgICB9Ow0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGpRdWVyeS5mbi5leHRlbmQoew0KICAgICAgICAgICAgZmFkZVRvOiBmdW5jdGlvbiggc3BlZWQsIHRvLCBlYXNpbmcsIGNhbGxiYWNrICkgew0KICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzaG93IGFueSBoaWRkZW4gZWxlbWVudHMgYWZ0ZXIgc2V0dGluZyBvcGFjaXR5IHRvIDANCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXIoIGlzSGlkZGVuICkuY3NzKCAib3BhY2l0eSIsIDAgKS5zaG93KCkNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIGFuaW1hdGUgdG8gdGhlIHZhbHVlIHNwZWNpZmllZA0KICAgICAgICAgICAgICAgICAgICAuZW5kKCkuYW5pbWF0ZSh7IG9wYWNpdHk6IHRvIH0sIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgYW5pbWF0ZTogZnVuY3Rpb24oIHByb3AsIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgew0KICAgICAgICAgICAgICAgIHZhciBlbXB0eSA9IGpRdWVyeS5pc0VtcHR5T2JqZWN0KCBwcm9wICksDQogICAgICAgICAgICAgICAgICAgIG9wdGFsbCA9IGpRdWVyeS5zcGVlZCggc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKSwNCiAgICAgICAgICAgICAgICAgICAgZG9BbmltYXRpb24gPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9wZXJhdGUgb24gYSBjb3B5IG9mIHByb3Agc28gcGVyLXByb3BlcnR5IGVhc2luZyB3b24ndCBiZSBsb3N0DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYW5pbSA9IEFuaW1hdGlvbiggdGhpcywgalF1ZXJ5LmV4dGVuZCgge30sIHByb3AgKSwgb3B0YWxsICk7DQogICAgICAgICAgICAgICAgICAgICAgICBkb0FuaW1hdGlvbi5maW5pc2ggPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlhbmltLnN0b3AoIHRydWUgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBFbXB0eSBhbmltYXRpb25zLCBvciBmaW5pc2hpbmcgcmVzb2x2ZXMgaW1tZWRpYXRlbHkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZW1wdHkgfHwgalF1ZXJ5Ll9kYXRhKCB0aGlzLCAiZmluaXNoIiApICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCWFuaW0uc3RvcCggdHJ1ZSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICBkb0FuaW1hdGlvbi5maW5pc2ggPSBkb0FuaW1hdGlvbjsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIGVtcHR5IHx8IG9wdGFsbC5xdWV1ZSA9PT0gZmFsc2UgPw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmVhY2goIGRvQW5pbWF0aW9uICkgOg0KICAgICAgICAgICAgICAgICAgICB0aGlzLnF1ZXVlKCBvcHRhbGwucXVldWUsIGRvQW5pbWF0aW9uICk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24oIHR5cGUsIGNsZWFyUXVldWUsIGdvdG9FbmQgKSB7DQogICAgICAgICAgICAgICAgdmFyIHN0b3BRdWV1ZSA9IGZ1bmN0aW9uKCBob29rcyApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3AgPSBob29rcy5zdG9wOw0KICAgICAgICAgICAgICAgICAgICBkZWxldGUgaG9va3Muc3RvcDsNCiAgICAgICAgICAgICAgICAgICAgc3RvcCggZ290b0VuZCApOw0KICAgICAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIHR5cGUgIT09ICJzdHJpbmciICkgew0KICAgICAgICAgICAgICAgICAgICBnb3RvRW5kID0gY2xlYXJRdWV1ZTsNCiAgICAgICAgICAgICAgICAgICAgY2xlYXJRdWV1ZSA9IHR5cGU7DQogICAgICAgICAgICAgICAgICAgIHR5cGUgPSB1bmRlZmluZWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICggY2xlYXJRdWV1ZSAmJiB0eXBlICE9PSBmYWxzZSApIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWV1ZSggdHlwZSB8fCAiZngiLCBbXSApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGRlcXVldWUgPSB0cnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSB0eXBlICE9IG51bGwgJiYgdHlwZSArICJxdWV1ZUhvb2tzIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVycyA9IGpRdWVyeS50aW1lcnMsDQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0galF1ZXJ5Ll9kYXRhKCB0aGlzICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoIGluZGV4ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBkYXRhWyBpbmRleCBdICYmIGRhdGFbIGluZGV4IF0uc3RvcCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlzdG9wUXVldWUoIGRhdGFbIGluZGV4IF0gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIGluZGV4IGluIGRhdGEgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKCBkYXRhWyBpbmRleCBdICYmIGRhdGFbIGluZGV4IF0uc3RvcCAmJiBycnVuLnRlc3QoIGluZGV4ICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJCXN0b3BRdWV1ZSggZGF0YVsgaW5kZXggXSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgCX0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZm9yICggaW5kZXggPSB0aW1lcnMubGVuZ3RoOyBpbmRleC0tOyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdGltZXJzWyBpbmRleCBdLmVsZW0gPT09IHRoaXMgJiYgKHR5cGUgPT0gbnVsbCB8fCB0aW1lcnNbIGluZGV4IF0ucXVldWUgPT09IHR5cGUpICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCXRpbWVyc1sgaW5kZXggXS5hbmltLnN0b3AoIGdvdG9FbmQgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlkZXF1ZXVlID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICAJdGltZXJzLnNwbGljZSggaW5kZXgsIDEgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gc3RhcnQgdGhlIG5leHQgaW4gdGhlIHF1ZXVlIGlmIHRoZSBsYXN0IHN0ZXAgd2Fzbid0IGZvcmNlZA0KICAgICAgICAgICAgICAgICAgICAvLyB0aW1lcnMgY3VycmVudGx5IHdpbGwgY2FsbCB0aGVpciBjb21wbGV0ZSBjYWxsYmFja3MsIHdoaWNoIHdpbGwgZGVxdWV1ZQ0KICAgICAgICAgICAgICAgICAgICAvLyBidXQgb25seSBpZiB0aGV5IHdlcmUgZ290b0VuZA0KICAgICAgICAgICAgICAgICAgICBpZiAoIGRlcXVldWUgfHwgIWdvdG9FbmQgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZmluaXNoOiBmdW5jdGlvbiggdHlwZSApIHsNCiAgICAgICAgICAgICAgICBpZiAoIHR5cGUgIT09IGZhbHNlICkgew0KICAgICAgICAgICAgICAgICAgICB0eXBlID0gdHlwZSB8fCAiZngiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXgsDQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0galF1ZXJ5Ll9kYXRhKCB0aGlzICksDQogICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZSA9IGRhdGFbIHR5cGUgKyAicXVldWUiIF0sDQogICAgICAgICAgICAgICAgICAgICAgICBob29rcyA9IGRhdGFbIHR5cGUgKyAicXVldWVIb29rcyIgXSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVycyA9IGpRdWVyeS50aW1lcnMsDQogICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSBxdWV1ZSA/IHF1ZXVlLmxlbmd0aCA6IDA7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBlbmFibGUgZmluaXNoaW5nIGZsYWcgb24gcHJpdmF0ZSBkYXRhDQogICAgICAgICAgICAgICAgICAgIGRhdGEuZmluaXNoID0gdHJ1ZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIGVtcHR5IHRoZSBxdWV1ZSBmaXJzdA0KICAgICAgICAgICAgICAgICAgICBqUXVlcnkucXVldWUoIHRoaXMsIHR5cGUsIFtdICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoIGhvb2tzICYmIGhvb2tzLmN1ciAmJiBob29rcy5jdXIuZmluaXNoICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaG9va3MuY3VyLmZpbmlzaC5jYWxsKCB0aGlzICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIGxvb2sgZm9yIGFueSBhY3RpdmUgYW5pbWF0aW9ucywgYW5kIGZpbmlzaCB0aGVtDQogICAgICAgICAgICAgICAgICAgIGZvciAoIGluZGV4ID0gdGltZXJzLmxlbmd0aDsgaW5kZXgtLTsgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHRpbWVyc1sgaW5kZXggXS5lbGVtID09PSB0aGlzICYmIHRpbWVyc1sgaW5kZXggXS5xdWV1ZSA9PT0gdHlwZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAl0aW1lcnNbIGluZGV4IF0uYW5pbS5zdG9wKCB0cnVlICk7DQogICAgICAgICAgICAgICAgICAgICAgICAJdGltZXJzLnNwbGljZSggaW5kZXgsIDEgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gbG9vayBmb3IgYW55IGFuaW1hdGlvbnMgaW4gdGhlIG9sZCBxdWV1ZSBhbmQgZmluaXNoIHRoZW0NCiAgICAgICAgICAgICAgICAgICAgZm9yICggaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcXVldWVbIGluZGV4IF0gJiYgcXVldWVbIGluZGV4IF0uZmluaXNoICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgCXF1ZXVlWyBpbmRleCBdLmZpbmlzaC5jYWxsKCB0aGlzICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIHR1cm4gb2ZmIGZpbmlzaGluZyBmbGFnDQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkYXRhLmZpbmlzaDsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAvLyBHZW5lcmF0ZSBwYXJhbWV0ZXJzIHRvIGNyZWF0ZSBhIHN0YW5kYXJkIGFuaW1hdGlvbg0KICAgICAgICBmdW5jdGlvbiBnZW5GeCggdHlwZSwgaW5jbHVkZVdpZHRoICkgew0KICAgICAgICAgICAgdmFyIHdoaWNoLA0KICAgICAgICAgICAgICAgIGF0dHJzID0geyBoZWlnaHQ6IHR5cGUgfSwNCiAgICAgICAgICAgICAgICBpID0gMDsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBpZiB3ZSBpbmNsdWRlIHdpZHRoLCBzdGVwIHZhbHVlIGlzIDEgdG8gZG8gYWxsIGNzc0V4cGFuZCB2YWx1ZXMsDQogICAgICAgICAgICAvLyBpZiB3ZSBkb24ndCBpbmNsdWRlIHdpZHRoLCBzdGVwIHZhbHVlIGlzIDIgdG8gc2tpcCBvdmVyIExlZnQgYW5kIFJpZ2h0DQogICAgICAgICAgICBpbmNsdWRlV2lkdGggPSBpbmNsdWRlV2lkdGg/IDEgOiAwOw0KICAgICAgICAgICAgZm9yKCA7IGkgPCA0IDsgaSArPSAyIC0gaW5jbHVkZVdpZHRoICkgew0KICAgICAgICAgICAgICAgIHdoaWNoID0gY3NzRXhwYW5kWyBpIF07DQogICAgICAgICAgICAgICAgYXR0cnNbICJtYXJnaW4iICsgd2hpY2ggXSA9IGF0dHJzWyAicGFkZGluZyIgKyB3aGljaCBdID0gdHlwZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZiAoIGluY2x1ZGVXaWR0aCApIHsNCiAgICAgICAgICAgICAgICBhdHRycy5vcGFjaXR5ID0gYXR0cnMud2lkdGggPSB0eXBlOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBhdHRyczsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gR2VuZXJhdGUgc2hvcnRjdXRzIGZvciBjdXN0b20gYW5pbWF0aW9ucw0KICAgICAgICBqUXVlcnkuZWFjaCh7DQogICAgICAgICAgICBzbGlkZURvd246IGdlbkZ4KCJzaG93IiksDQogICAgICAgICAgICBzbGlkZVVwOiBnZW5GeCgiaGlkZSIpLA0KICAgICAgICAgICAgc2xpZGVUb2dnbGU6IGdlbkZ4KCJ0b2dnbGUiKSwNCiAgICAgICAgICAgIGZhZGVJbjogeyBvcGFjaXR5OiAic2hvdyIgfSwNCiAgICAgICAgICAgIGZhZGVPdXQ6IHsgb3BhY2l0eTogImhpZGUiIH0sDQogICAgICAgICAgICBmYWRlVG9nZ2xlOiB7IG9wYWNpdHk6ICJ0b2dnbGUiIH0NCiAgICAgICAgfSwgZnVuY3Rpb24oIG5hbWUsIHByb3BzICkgew0KICAgICAgICAgICAgalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0ZSggcHJvcHMsIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICk7DQogICAgICAgICAgICB9Ow0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGpRdWVyeS5zcGVlZCA9IGZ1bmN0aW9uKCBzcGVlZCwgZWFzaW5nLCBmbiApIHsNCiAgICAgICAgICAgIHZhciBvcHQgPSBzcGVlZCAmJiB0eXBlb2Ygc3BlZWQgPT09ICJvYmplY3QiID8galF1ZXJ5LmV4dGVuZCgge30sIHNwZWVkICkgOiB7DQogICAgICAgICAgICAgICAgY29tcGxldGU6IGZuIHx8ICFmbiAmJiBlYXNpbmcgfHwNCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmlzRnVuY3Rpb24oIHNwZWVkICkgJiYgc3BlZWQsDQogICAgICAgICAgICAgICAgZHVyYXRpb246IHNwZWVkLA0KICAgICAgICAgICAgICAgIGVhc2luZzogZm4gJiYgZWFzaW5nIHx8IGVhc2luZyAmJiAhalF1ZXJ5LmlzRnVuY3Rpb24oIGVhc2luZyApICYmIGVhc2luZw0KICAgICAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgICAgICBvcHQuZHVyYXRpb24gPSBqUXVlcnkuZngub2ZmID8gMCA6IHR5cGVvZiBvcHQuZHVyYXRpb24gPT09ICJudW1iZXIiID8gb3B0LmR1cmF0aW9uIDoNCiAgICAgICAgICAgICAgICBvcHQuZHVyYXRpb24gaW4galF1ZXJ5LmZ4LnNwZWVkcyA/IGpRdWVyeS5meC5zcGVlZHNbIG9wdC5kdXJhdGlvbiBdIDogalF1ZXJ5LmZ4LnNwZWVkcy5fZGVmYXVsdDsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBub3JtYWxpemUgb3B0LnF1ZXVlIC0gdHJ1ZS91bmRlZmluZWQvbnVsbCAtPiAiZngiDQogICAgICAgICAgICBpZiAoIG9wdC5xdWV1ZSA9PSBudWxsIHx8IG9wdC5xdWV1ZSA9PT0gdHJ1ZSApIHsNCiAgICAgICAgICAgICAgICBvcHQucXVldWUgPSAiZngiOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIFF1ZXVlaW5nDQogICAgICAgICAgICBvcHQub2xkID0gb3B0LmNvbXBsZXRlOw0KICAgICAgICANCiAgICAgICAgICAgIG9wdC5jb21wbGV0ZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIG9wdC5vbGQgKSApIHsNCiAgICAgICAgICAgICAgICAgICAgb3B0Lm9sZC5jYWxsKCB0aGlzICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoIG9wdC5xdWV1ZSApIHsNCiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmRlcXVldWUoIHRoaXMsIG9wdC5xdWV1ZSApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIG9wdDsNCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIGpRdWVyeS5lYXNpbmcgPSB7DQogICAgICAgICAgICBsaW5lYXI6IGZ1bmN0aW9uKCBwICkgew0KICAgICAgICAgICAgICAgIHJldHVybiBwOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHN3aW5nOiBmdW5jdGlvbiggcCApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gMC41IC0gTWF0aC5jb3MoIHAqTWF0aC5QSSApIC8gMjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIGpRdWVyeS50aW1lcnMgPSBbXTsNCiAgICAgICAgalF1ZXJ5LmZ4ID0gVHdlZW4ucHJvdG90eXBlLmluaXQ7DQogICAgICAgIGpRdWVyeS5meC50aWNrID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB2YXIgdGltZXIsDQogICAgICAgICAgICAgICAgdGltZXJzID0galF1ZXJ5LnRpbWVycywNCiAgICAgICAgICAgICAgICBpID0gMDsNCiAgICAgICAgDQogICAgICAgICAgICBmeE5vdyA9IGpRdWVyeS5ub3coKTsNCiAgICAgICAgDQogICAgICAgICAgICBmb3IgKCA7IGkgPCB0aW1lcnMubGVuZ3RoOyBpKysgKSB7DQogICAgICAgICAgICAgICAgdGltZXIgPSB0aW1lcnNbIGkgXTsNCiAgICAgICAgICAgICAgICAvLyBDaGVja3MgdGhlIHRpbWVyIGhhcyBub3QgYWxyZWFkeSBiZWVuIHJlbW92ZWQNCiAgICAgICAgICAgICAgICBpZiAoICF0aW1lcigpICYmIHRpbWVyc1sgaSBdID09PSB0aW1lciApIHsNCiAgICAgICAgICAgICAgICAgICAgdGltZXJzLnNwbGljZSggaS0tLCAxICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmICggIXRpbWVycy5sZW5ndGggKSB7DQogICAgICAgICAgICAgICAgalF1ZXJ5LmZ4LnN0b3AoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZ4Tm93ID0gdW5kZWZpbmVkOw0KICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgalF1ZXJ5LmZ4LnRpbWVyID0gZnVuY3Rpb24oIHRpbWVyICkgew0KICAgICAgICAgICAgaWYgKCB0aW1lcigpICYmIGpRdWVyeS50aW1lcnMucHVzaCggdGltZXIgKSApIHsNCiAgICAgICAgICAgICAgICBqUXVlcnkuZnguc3RhcnQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIGpRdWVyeS5meC5pbnRlcnZhbCA9IDEzOw0KICAgICAgICANCiAgICAgICAgalF1ZXJ5LmZ4LnN0YXJ0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICBpZiAoICF0aW1lcklkICkgew0KICAgICAgICAgICAgICAgIHRpbWVySWQgPSBzZXRJbnRlcnZhbCggalF1ZXJ5LmZ4LnRpY2ssIGpRdWVyeS5meC5pbnRlcnZhbCApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgalF1ZXJ5LmZ4LnN0b3AgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoIHRpbWVySWQgKTsNCiAgICAgICAgICAgIHRpbWVySWQgPSBudWxsOw0KICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgalF1ZXJ5LmZ4LnNwZWVkcyA9IHsNCiAgICAgICAgICAgIHNsb3c6IDYwMCwNCiAgICAgICAgICAgIGZhc3Q6IDIwMCwNCiAgICAgICAgICAgIC8vIERlZmF1bHQgc3BlZWQNCiAgICAgICAgICAgIF9kZWZhdWx0OiA0MDANCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIC8vIEJhY2sgQ29tcGF0IDwxLjggZXh0ZW5zaW9uIHBvaW50DQogICAgICAgIGpRdWVyeS5meC5zdGVwID0ge307DQogICAgICAgIA0KICAgICAgICBpZiAoIGpRdWVyeS5leHByICYmIGpRdWVyeS5leHByLmZpbHRlcnMgKSB7DQogICAgICAgICAgICBqUXVlcnkuZXhwci5maWx0ZXJzLmFuaW1hdGVkID0gZnVuY3Rpb24oIGVsZW0gKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5ncmVwKGpRdWVyeS50aW1lcnMsIGZ1bmN0aW9uKCBmbiApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0gPT09IGZuLmVsZW07DQogICAgICAgICAgICAgICAgfSkubGVuZ3RoOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICBqUXVlcnkuZm4ub2Zmc2V0ID0gZnVuY3Rpb24oIG9wdGlvbnMgKSB7DQogICAgICAgICAgICBpZiAoIGFyZ3VtZW50cy5sZW5ndGggKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMgPT09IHVuZGVmaW5lZCA/DQogICAgICAgICAgICAgICAgICAgIHRoaXMgOg0KICAgICAgICAgICAgICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24oIGkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkub2Zmc2V0LnNldE9mZnNldCggdGhpcywgb3B0aW9ucywgaSApOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICB2YXIgZG9jRWxlbSwgd2luLA0KICAgICAgICAgICAgICAgIGJveCA9IHsgdG9wOiAwLCBsZWZ0OiAwIH0sDQogICAgICAgICAgICAgICAgZWxlbSA9IHRoaXNbIDAgXSwNCiAgICAgICAgICAgICAgICBkb2MgPSBlbGVtICYmIGVsZW0ub3duZXJEb2N1bWVudDsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAoICFkb2MgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGRvY0VsZW0gPSBkb2MuZG9jdW1lbnRFbGVtZW50Ow0KICAgICAgICANCiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSBpdCdzIG5vdCBhIGRpc2Nvbm5lY3RlZCBET00gbm9kZQ0KICAgICAgICAgICAgaWYgKCAhalF1ZXJ5LmNvbnRhaW5zKCBkb2NFbGVtLCBlbGVtICkgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJveDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAvLyBJZiB3ZSBkb24ndCBoYXZlIGdCQ1IsIGp1c3QgdXNlIDAsMCByYXRoZXIgdGhhbiBlcnJvcg0KICAgICAgICAgICAgLy8gQmxhY2tCZXJyeSA1LCBpT1MgMyAob3JpZ2luYWwgaVBob25lKQ0KICAgICAgICAgICAgaWYgKCB0eXBlb2YgZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QgIT09IGNvcmVfc3RydW5kZWZpbmVkICkgew0KICAgICAgICAgICAgICAgIGJveCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB3aW4gPSBnZXRXaW5kb3coIGRvYyApOw0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICB0b3A6IGJveC50b3AgICsgKCB3aW4ucGFnZVlPZmZzZXQgfHwgZG9jRWxlbS5zY3JvbGxUb3AgKSAgLSAoIGRvY0VsZW0uY2xpZW50VG9wICB8fCAwICksDQogICAgICAgICAgICAgICAgbGVmdDogYm94LmxlZnQgKyAoIHdpbi5wYWdlWE9mZnNldCB8fCBkb2NFbGVtLnNjcm9sbExlZnQgKSAtICggZG9jRWxlbS5jbGllbnRMZWZ0IHx8IDAgKQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIGpRdWVyeS5vZmZzZXQgPSB7DQogICAgICAgIA0KICAgICAgICAgICAgc2V0T2Zmc2V0OiBmdW5jdGlvbiggZWxlbSwgb3B0aW9ucywgaSApIHsNCiAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb24gPSBqUXVlcnkuY3NzKCBlbGVtLCAicG9zaXRpb24iICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHNldCBwb3NpdGlvbiBmaXJzdCwgaW4tY2FzZSB0b3AvbGVmdCBhcmUgc2V0IGV2ZW4gb24gc3RhdGljIGVsZW0NCiAgICAgICAgICAgICAgICBpZiAoIHBvc2l0aW9uID09PSAic3RhdGljIiApIHsNCiAgICAgICAgICAgICAgICAgICAgZWxlbS5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICB2YXIgY3VyRWxlbSA9IGpRdWVyeSggZWxlbSApLA0KICAgICAgICAgICAgICAgICAgICBjdXJPZmZzZXQgPSBjdXJFbGVtLm9mZnNldCgpLA0KICAgICAgICAgICAgICAgICAgICBjdXJDU1NUb3AgPSBqUXVlcnkuY3NzKCBlbGVtLCAidG9wIiApLA0KICAgICAgICAgICAgICAgICAgICBjdXJDU1NMZWZ0ID0galF1ZXJ5LmNzcyggZWxlbSwgImxlZnQiICksDQogICAgICAgICAgICAgICAgICAgIGNhbGN1bGF0ZVBvc2l0aW9uID0gKCBwb3NpdGlvbiA9PT0gImFic29sdXRlIiB8fCBwb3NpdGlvbiA9PT0gImZpeGVkIiApICYmIGpRdWVyeS5pbkFycmF5KCJhdXRvIiwgW2N1ckNTU1RvcCwgY3VyQ1NTTGVmdF0pID4gLTEsDQogICAgICAgICAgICAgICAgICAgIHByb3BzID0ge30sIGN1clBvc2l0aW9uID0ge30sIGN1clRvcCwgY3VyTGVmdDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gbmVlZCB0byBiZSBhYmxlIHRvIGNhbGN1bGF0ZSBwb3NpdGlvbiBpZiBlaXRoZXIgdG9wIG9yIGxlZnQgaXMgYXV0byBhbmQgcG9zaXRpb24gaXMgZWl0aGVyIGFic29sdXRlIG9yIGZpeGVkDQogICAgICAgICAgICAgICAgaWYgKCBjYWxjdWxhdGVQb3NpdGlvbiApIHsNCiAgICAgICAgICAgICAgICAgICAgY3VyUG9zaXRpb24gPSBjdXJFbGVtLnBvc2l0aW9uKCk7DQogICAgICAgICAgICAgICAgICAgIGN1clRvcCA9IGN1clBvc2l0aW9uLnRvcDsNCiAgICAgICAgICAgICAgICAgICAgY3VyTGVmdCA9IGN1clBvc2l0aW9uLmxlZnQ7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY3VyVG9wID0gcGFyc2VGbG9hdCggY3VyQ1NTVG9wICkgfHwgMDsNCiAgICAgICAgICAgICAgICAgICAgY3VyTGVmdCA9IHBhcnNlRmxvYXQoIGN1ckNTU0xlZnQgKSB8fCAwOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggb3B0aW9ucyApICkgew0KICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucy5jYWxsKCBlbGVtLCBpLCBjdXJPZmZzZXQgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICggb3B0aW9ucy50b3AgIT0gbnVsbCApIHsNCiAgICAgICAgICAgICAgICAgICAgcHJvcHMudG9wID0gKCBvcHRpb25zLnRvcCAtIGN1ck9mZnNldC50b3AgKSArIGN1clRvcDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCBvcHRpb25zLmxlZnQgIT0gbnVsbCApIHsNCiAgICAgICAgICAgICAgICAgICAgcHJvcHMubGVmdCA9ICggb3B0aW9ucy5sZWZ0IC0gY3VyT2Zmc2V0LmxlZnQgKSArIGN1ckxlZnQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoICJ1c2luZyIgaW4gb3B0aW9ucyApIHsNCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy51c2luZy5jYWxsKCBlbGVtLCBwcm9wcyApOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGN1ckVsZW0uY3NzKCBwcm9wcyApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBqUXVlcnkuZm4uZXh0ZW5kKHsNCiAgICAgICAgDQogICAgICAgICAgICBwb3NpdGlvbjogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgaWYgKCAhdGhpc1sgMCBdICkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0UGFyZW50LCBvZmZzZXQsDQogICAgICAgICAgICAgICAgICAgIHBhcmVudE9mZnNldCA9IHsgdG9wOiAwLCBsZWZ0OiAwIH0sDQogICAgICAgICAgICAgICAgICAgIGVsZW0gPSB0aGlzWyAwIF07DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIGZpeGVkIGVsZW1lbnRzIGFyZSBvZmZzZXQgZnJvbSB3aW5kb3cgKHBhcmVudE9mZnNldCA9IHt0b3A6MCwgbGVmdDogMH0sIGJlY2F1c2UgaXQgaXMgaXQncyBvbmx5IG9mZnNldCBwYXJlbnQNCiAgICAgICAgICAgICAgICBpZiAoIGpRdWVyeS5jc3MoIGVsZW0sICJwb3NpdGlvbiIgKSA9PT0gImZpeGVkIiApIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gd2UgYXNzdW1lIHRoYXQgZ2V0Qm91bmRpbmdDbGllbnRSZWN0IGlzIGF2YWlsYWJsZSB3aGVuIGNvbXB1dGVkIHBvc2l0aW9uIGlzIGZpeGVkDQogICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gR2V0ICpyZWFsKiBvZmZzZXRQYXJlbnQNCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0UGFyZW50ID0gdGhpcy5vZmZzZXRQYXJlbnQoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEdldCBjb3JyZWN0IG9mZnNldHMNCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gdGhpcy5vZmZzZXQoKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhalF1ZXJ5Lm5vZGVOYW1lKCBvZmZzZXRQYXJlbnRbIDAgXSwgImh0bWwiICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRPZmZzZXQgPSBvZmZzZXRQYXJlbnQub2Zmc2V0KCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEFkZCBvZmZzZXRQYXJlbnQgYm9yZGVycw0KICAgICAgICAgICAgICAgICAgICBwYXJlbnRPZmZzZXQudG9wICArPSBqUXVlcnkuY3NzKCBvZmZzZXRQYXJlbnRbIDAgXSwgImJvcmRlclRvcFdpZHRoIiwgdHJ1ZSApOw0KICAgICAgICAgICAgICAgICAgICBwYXJlbnRPZmZzZXQubGVmdCArPSBqUXVlcnkuY3NzKCBvZmZzZXRQYXJlbnRbIDAgXSwgImJvcmRlckxlZnRXaWR0aCIsIHRydWUgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFN1YnRyYWN0IHBhcmVudCBvZmZzZXRzIGFuZCBlbGVtZW50IG1hcmdpbnMNCiAgICAgICAgICAgICAgICAvLyBub3RlOiB3aGVuIGFuIGVsZW1lbnQgaGFzIG1hcmdpbjogYXV0byB0aGUgb2Zmc2V0TGVmdCBhbmQgbWFyZ2luTGVmdA0KICAgICAgICAgICAgICAgIC8vIGFyZSB0aGUgc2FtZSBpbiBTYWZhcmkgY2F1c2luZyBvZmZzZXQubGVmdCB0byBpbmNvcnJlY3RseSBiZSAwDQogICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgICAgdG9wOiAgb2Zmc2V0LnRvcCAgLSBwYXJlbnRPZmZzZXQudG9wIC0galF1ZXJ5LmNzcyggZWxlbSwgIm1hcmdpblRvcCIsIHRydWUgKSwNCiAgICAgICAgICAgICAgICAgICAgbGVmdDogb2Zmc2V0LmxlZnQgLSBwYXJlbnRPZmZzZXQubGVmdCAtIGpRdWVyeS5jc3MoIGVsZW0sICJtYXJnaW5MZWZ0IiwgdHJ1ZSkNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgICAgICBvZmZzZXRQYXJlbnQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIG9mZnNldFBhcmVudCA9IHRoaXMub2Zmc2V0UGFyZW50IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCBvZmZzZXRQYXJlbnQgJiYgKCAhalF1ZXJ5Lm5vZGVOYW1lKCBvZmZzZXRQYXJlbnQsICJodG1sIiApICYmIGpRdWVyeS5jc3MoIG9mZnNldFBhcmVudCwgInBvc2l0aW9uIikgPT09ICJzdGF0aWMiICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXRQYXJlbnQgPSBvZmZzZXRQYXJlbnQub2Zmc2V0UGFyZW50Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvZmZzZXRQYXJlbnQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Ow0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICAvLyBDcmVhdGUgc2Nyb2xsTGVmdCBhbmQgc2Nyb2xsVG9wIG1ldGhvZHMNCiAgICAgICAgalF1ZXJ5LmVhY2goIHtzY3JvbGxMZWZ0OiAicGFnZVhPZmZzZXQiLCBzY3JvbGxUb3A6ICJwYWdlWU9mZnNldCJ9LCBmdW5jdGlvbiggbWV0aG9kLCBwcm9wICkgew0KICAgICAgICAgICAgdmFyIHRvcCA9IC9ZLy50ZXN0KCBwcm9wICk7DQogICAgICAgIA0KICAgICAgICAgICAgalF1ZXJ5LmZuWyBtZXRob2QgXSA9IGZ1bmN0aW9uKCB2YWwgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5hY2Nlc3MoIHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCBtZXRob2QsIHZhbCApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHdpbiA9IGdldFdpbmRvdyggZWxlbSApOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCB2YWwgPT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3aW4gPyAocHJvcCBpbiB3aW4pID8gd2luWyBwcm9wIF0gOg0KICAgICAgICAgICAgICAgICAgICAgICAgCXdpbi5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbIG1ldGhvZCBdIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIAllbGVtWyBtZXRob2QgXTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKCB3aW4gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB3aW4uc2Nyb2xsVG8oDQogICAgICAgICAgICAgICAgICAgICAgICAJIXRvcCA/IHZhbCA6IGpRdWVyeSggd2luICkuc2Nyb2xsTGVmdCgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgCXRvcCA/IHZhbCA6IGpRdWVyeSggd2luICkuc2Nyb2xsVG9wKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgZWxlbVsgbWV0aG9kIF0gPSB2YWw7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LCBtZXRob2QsIHZhbCwgYXJndW1lbnRzLmxlbmd0aCwgbnVsbCApOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBnZXRXaW5kb3coIGVsZW0gKSB7DQogICAgICAgICAgICByZXR1cm4galF1ZXJ5LmlzV2luZG93KCBlbGVtICkgPw0KICAgICAgICAgICAgICAgIGVsZW0gOg0KICAgICAgICAgICAgICAgIGVsZW0ubm9kZVR5cGUgPT09IDkgPw0KICAgICAgICAgICAgICAgICAgICBlbGVtLmRlZmF1bHRWaWV3IHx8IGVsZW0ucGFyZW50V2luZG93IDoNCiAgICAgICAgICAgICAgICAgICAgZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgLy8gQ3JlYXRlIGlubmVySGVpZ2h0LCBpbm5lcldpZHRoLCBoZWlnaHQsIHdpZHRoLCBvdXRlckhlaWdodCBhbmQgb3V0ZXJXaWR0aCBtZXRob2RzDQogICAgICAgIGpRdWVyeS5lYWNoKCB7IEhlaWdodDogImhlaWdodCIsIFdpZHRoOiAid2lkdGgiIH0sIGZ1bmN0aW9uKCBuYW1lLCB0eXBlICkgew0KICAgICAgICAgICAgalF1ZXJ5LmVhY2goIHsgcGFkZGluZzogImlubmVyIiArIG5hbWUsIGNvbnRlbnQ6IHR5cGUsICIiOiAib3V0ZXIiICsgbmFtZSB9LCBmdW5jdGlvbiggZGVmYXVsdEV4dHJhLCBmdW5jTmFtZSApIHsNCiAgICAgICAgICAgICAgICAvLyBtYXJnaW4gaXMgb25seSBmb3Igb3V0ZXJIZWlnaHQsIG91dGVyV2lkdGgNCiAgICAgICAgICAgICAgICBqUXVlcnkuZm5bIGZ1bmNOYW1lIF0gPSBmdW5jdGlvbiggbWFyZ2luLCB2YWx1ZSApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGNoYWluYWJsZSA9IGFyZ3VtZW50cy5sZW5ndGggJiYgKCBkZWZhdWx0RXh0cmEgfHwgdHlwZW9mIG1hcmdpbiAhPT0gImJvb2xlYW4iICksDQogICAgICAgICAgICAgICAgICAgICAgICBleHRyYSA9IGRlZmF1bHRFeHRyYSB8fCAoIG1hcmdpbiA9PT0gdHJ1ZSB8fCB2YWx1ZSA9PT0gdHJ1ZSA/ICJtYXJnaW4iIDogImJvcmRlciIgKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggZWxlbSwgdHlwZSwgdmFsdWUgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZG9jOw0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggalF1ZXJ5LmlzV2luZG93KCBlbGVtICkgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gQXMgb2YgNS84LzIwMTIgdGhpcyB3aWxsIHlpZWxkIGluY29ycmVjdCByZXN1bHRzIGZvciBNb2JpbGUgU2FmYXJpLCBidXQgdGhlcmUNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyBpc24ndCBhIHdob2xlIGxvdCB3ZSBjYW4gZG8uIFNlZSBwdWxsIHJlcXVlc3QgYXQgdGhpcyBVUkwgZm9yIGRpc2N1c3Npb246DQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnkvcHVsbC83NjQNCiAgICAgICAgICAgICAgICAgICAgICAgIAlyZXR1cm4gZWxlbS5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbICJjbGllbnQiICsgbmFtZSBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEdldCBkb2N1bWVudCB3aWR0aCBvciBoZWlnaHQNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZWxlbS5ub2RlVHlwZSA9PT0gOSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIAlkb2MgPSBlbGVtLmRvY3VtZW50RWxlbWVudDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gRWl0aGVyIHNjcm9sbFtXaWR0aC9IZWlnaHRdIG9yIG9mZnNldFtXaWR0aC9IZWlnaHRdIG9yIGNsaWVudFtXaWR0aC9IZWlnaHRdLCB3aGljaGV2ZXIgaXMgZ3JlYXRlc3QNCiAgICAgICAgICAgICAgICAgICAgICAgIAkvLyB1bmZvcnR1bmF0ZWx5LCB0aGlzIGNhdXNlcyBidWcgIzM4MzggaW4gSUU2Lzggb25seSwgYnV0IHRoZXJlIGlzIGN1cnJlbnRseSBubyBnb29kLCBzbWFsbCB3YXkgdG8gZml4IGl0Lg0KICAgICAgICAgICAgICAgICAgICAgICAgCXJldHVybiBNYXRoLm1heCgNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZWxlbS5ib2R5WyAic2Nyb2xsIiArIG5hbWUgXSwgZG9jWyAic2Nyb2xsIiArIG5hbWUgXSwNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZWxlbS5ib2R5WyAib2Zmc2V0IiArIG5hbWUgXSwgZG9jWyAib2Zmc2V0IiArIG5hbWUgXSwNCiAgICAgICAgICAgICAgICAgICAgICAgIAkJZG9jWyAiY2xpZW50IiArIG5hbWUgXQ0KICAgICAgICAgICAgICAgICAgICAgICAgCSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPw0KICAgICAgICAgICAgICAgICAgICAgICAgCS8vIEdldCB3aWR0aCBvciBoZWlnaHQgb24gdGhlIGVsZW1lbnQsIHJlcXVlc3RpbmcgYnV0IG5vdCBmb3JjaW5nIHBhcnNlRmxvYXQNCiAgICAgICAgICAgICAgICAgICAgICAgIAlqUXVlcnkuY3NzKCBlbGVtLCB0eXBlLCBleHRyYSApIDoNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAJLy8gU2V0IHdpZHRoIG9yIGhlaWdodCBvbiB0aGUgZWxlbWVudA0KICAgICAgICAgICAgICAgICAgICAgICAgCWpRdWVyeS5zdHlsZSggZWxlbSwgdHlwZSwgdmFsdWUsIGV4dHJhICk7DQogICAgICAgICAgICAgICAgICAgIH0sIHR5cGUsIGNoYWluYWJsZSA/IG1hcmdpbiA6IHVuZGVmaW5lZCwgY2hhaW5hYmxlLCBudWxsICk7DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgICAgLy8gTGltaXQgc2NvcGUgcG9sbHV0aW9uIGZyb20gYW55IGRlcHJlY2F0ZWQgQVBJDQogICAgICAgIC8vIChmdW5jdGlvbigpIHsNCiAgICAgICAgDQogICAgICAgIC8vIH0pKCk7DQogICAgICAgIC8vIEV4cG9zZSBqUXVlcnkgdG8gdGhlIGdsb2JhbCBvYmplY3QNCiAgICAgICAgd2luZG93LmpRdWVyeSA9IHdpbmRvdy4kID0galF1ZXJ5Ow0KICAgICAgICANCiAgICAgICAgLy8gRXhwb3NlIGpRdWVyeSBhcyBhbiBBTUQgbW9kdWxlLCBidXQgb25seSBmb3IgQU1EIGxvYWRlcnMgdGhhdA0KICAgICAgICAvLyB1bmRlcnN0YW5kIHRoZSBpc3N1ZXMgd2l0aCBsb2FkaW5nIG11bHRpcGxlIHZlcnNpb25zIG9mIGpRdWVyeQ0KICAgICAgICAvLyBpbiBhIHBhZ2UgdGhhdCBhbGwgbWlnaHQgY2FsbCBkZWZpbmUoKS4gVGhlIGxvYWRlciB3aWxsIGluZGljYXRlDQogICAgICAgIC8vIHRoZXkgaGF2ZSBzcGVjaWFsIGFsbG93YW5jZXMgZm9yIG11bHRpcGxlIGpRdWVyeSB2ZXJzaW9ucyBieQ0KICAgICAgICAvLyBzcGVjaWZ5aW5nIGRlZmluZS5hbWQualF1ZXJ5ID0gdHJ1ZS4gUmVnaXN0ZXIgYXMgYSBuYW1lZCBtb2R1bGUsDQogICAgICAgIC8vIHNpbmNlIGpRdWVyeSBjYW4gYmUgY29uY2F0ZW5hdGVkIHdpdGggb3RoZXIgZmlsZXMgdGhhdCBtYXkgdXNlIGRlZmluZSwNCiAgICAgICAgLy8gYnV0IG5vdCB1c2UgYSBwcm9wZXIgY29uY2F0ZW5hdGlvbiBzY3JpcHQgdGhhdCB1bmRlcnN0YW5kcyBhbm9ueW1vdXMNCiAgICAgICAgLy8gQU1EIG1vZHVsZXMuIEEgbmFtZWQgQU1EIGlzIHNhZmVzdCBhbmQgbW9zdCByb2J1c3Qgd2F5IHRvIHJlZ2lzdGVyLg0KICAgICAgICAvLyBMb3dlcmNhc2UganF1ZXJ5IGlzIHVzZWQgYmVjYXVzZSBBTUQgbW9kdWxlIG5hbWVzIGFyZSBkZXJpdmVkIGZyb20NCiAgICAgICAgLy8gZmlsZSBuYW1lcywgYW5kIGpRdWVyeSBpcyBub3JtYWxseSBkZWxpdmVyZWQgaW4gYSBsb3dlcmNhc2UgZmlsZSBuYW1lLg0KICAgICAgICAvLyBEbyB0aGlzIGFmdGVyIGNyZWF0aW5nIHRoZSBnbG9iYWwgc28gdGhhdCBpZiBhbiBBTUQgbW9kdWxlIHdhbnRzIHRvIGNhbGwNCiAgICAgICAgLy8gbm9Db25mbGljdCB0byBoaWRlIHRoaXMgdmVyc2lvbiBvZiBqUXVlcnksIGl0IHdpbGwgd29yay4NCiAgICAgICAgaWYgKCB0eXBlb2YgZGVmaW5lID09PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQgJiYgZGVmaW5lLmFtZC5qUXVlcnkgKSB7DQogICAgICAgICAgICBkZWZpbmUoICJqcXVlcnkiLCBbXSwgZnVuY3Rpb24gKCkgeyByZXR1cm4galF1ZXJ5OyB9ICk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIH0pKCB3aW5kb3cgKTsNCiAgICAgICAgXV0+DQogICAgPC94c2w6dGVtcGxhdGU+DQoNCg0KPC94c2w6c3R5bGVzaGVldD4NCg=="?>